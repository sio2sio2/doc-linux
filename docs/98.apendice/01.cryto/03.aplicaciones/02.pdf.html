

<!DOCTYPE html>

<html lang="es" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>9.1.3.2. Firma de documentos &#8212; documentación de Linuxnomicón - rolling</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/classic.css?v=2bf1fcf8" />
    <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
    
    <script src="../../../_static/documentation_options.js?v=a621b78a"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/translations.js?v=f85f4cfb"></script>
    
    <link rel="index" title="Índice" href="../../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../../search.html" />
    <link rel="next" title="9.1.3.3. Correo electrónico" href="03.correo.html" />
    <link rel="prev" title="9.1.3.1. Certificado digital" href="01.certdig.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="03.correo.html" title="9.1.3.3. Correo electrónico"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="01.certdig.html" title="9.1.3.1. Certificado digital"
             accesskey="P">anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" ><span class="section-number">9. </span>Apéndices</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" ><span class="section-number">9.1. </span>Criptografía</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../03.aplicaciones.html" accesskey="U"><span class="section-number">9.1.3. </span>Aplicaciones de la criptografía</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">9.1.3.2. </span>Firma de documentos</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <span class="target" id="firm-doc"></span><section id="firma-de-documentos">
<h1><span class="section-number">9.1.3.2. </span>Firma de documentos<a class="headerlink" href="#firma-de-documentos" title="Link to this heading">¶</a></h1>
<p>Para la firma de documentos digitales existen varios estándares:</p>
<dl>
<dt><abbr title="CMS Advanced Electronic Signatures">CAdES</abbr></dt><dd><p>Consiste en generar un archivo de firma en formato <code class="docutils literal notranslate"><span class="pre">.p7s</span></code> (<a class="reference internal" href="01.certdig.html#cert-p7"><span class="std std-ref">formato
PKCS #7</span></a>) que contiene la propia firma digital y, opcionalmente, el
certificado firmante e incluso el propio documento firmado. Lo habitual, no
obstante, es que no lo contenga y deban conservarse tanto el documento como
este archivo de firma.</p>
</dd>
<dt><abbr title="XML Advanced Electronic Signatures">XAdES</abbr></dt><dd><p>Es otro estándar que extiende <a class="reference external" href="https://es.wikipedia.org/wiki/Firma_XML">XML-DSig</a> y adopta el formato <abbr title="eXtensible Markup Language">XML</abbr> para
expresar la información sobre la firma. Hay tres variantes que se diferencian
por el modo en que se incluyen los datos firmados (en <em>Base64</em>) dentro del
propio archivo:</p>
<ul class="simple">
<li><p><em>Detached</em>, que es la única variante que permite, si así se desea, no
incorporar los datos firmados.</p></li>
<li><p><em>Enveloped</em>.</p></li>
<li><p><em>Enveloping</em>, que sólo es apta para documentos <abbr title="eXtensible Markup Language">XML</abbr> ya que lo incluye
dentro del archivo sin codificarlo en <em>Base64</em>.</p></li>
</ul>
</dd>
<dt><abbr title="PDF Advanced Electronic Signatures">PAdES</abbr></dt><dd><p>Es una extensión del estańdar <abbr title="Portable Dcument Format">PDF</abbr> que permite incrustar la información de
firma en un objeto interno del propio documento <abbr title="Portable Dcument Format">PDF</abbr>. Dicha información de
firma suele estar en formato <abbr title="CMS Advanced Electronic Signatures">CAdES</abbr> o <em>Detached</em> <abbr title="XML Advanced Electronic Signatures">XAdES</abbr>.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Aunque opcionalmente pueden generarse marcas visibles en el documento
que denoten quién ha firmado y cuándo lo ha hecho, la firma digital en sí
no deja huella visible en una impresión: se verifica utilizando una
herramienta de verificación sobre el archivo.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">Ver también</p>
<p>Para conocer con mayor profundidad cómo se almacenan las firmas
dentro de un <abbr title="Portable Dcument Format">PDF</abbr> puede leer <a class="reference external" href="https://itextpdf.com/en/resources/books/digital-signatures-pdf">el extenso libro blanco sobre firmas
digitales</a>
de Bruno Lowagie.</p>
</div>
</dd>
</dl>
<p>Al margen de la obviedad de que el último estándar sólo es válido para firmar
documentos <abbr title="Portable Dcument Format">PDF</abbr>, mientras que los dos primeros permiten firmar cualquier
documento, hay otra gran diferencia entre ellos: el último estándar incrusta la
firma en el propio <abbr title="Portable Dcument Format">PDF</abbr> por lo que el archivo resultante sigue siendo
directamente visualizable. En cambio los dos primeros estándares o incrustan el
documento dentro del archivo de firma (con lo cual dejan de ser visualizables) o
ni siquiera lo incluyen y obligan a conservar el documento original (<a class="reference external" href="https://en.wikipedia.org/wiki/Detached_signature">firma
despegada</a>).</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p><a class="reference external" href="https://firmaelectronica.gob.es/Home/Descargas.html">Autofirma</a> es una aplicación que permite firmar utilizando cualquiera
de estos estándares.</p>
</div>
<p>Otro aspecto importante a tener en cuenta es el procedimiento que se sigue
cuando son varios los que deben firmar un mismo documento. Hay dos estrategias:</p>
<ul class="simple">
<li><p>La <em class="dfn">cofirma</em> o <em class="dfn">firma en paralelo</em>, que ocurre cuando no hay
jerarquía alguna entre los firmantes y es irrelevante el orden en que se
realicen las firmas, ya que cada cual avala el contenido del documento y no
las firmas de los demás.</p></li>
<li><p>La <em class="dfn">contrafirma</em> o <em class="dfn">firma en cascada</em>, que ocurre cuando sí hay
jerarquía y un firmante de mayor jerarquía también avala la firma del firmante
de menor jerarquía. En este caso, el orden sí es importante y las firmas deben
realizarse de menor a mayor rango.</p></li>
</ul>
<section id="estatus-legal">
<span id="firma-legal"></span><h2><span class="section-number">9.1.3.2.1. </span>Estatus legal<a class="headerlink" href="#estatus-legal" title="Link to this heading">¶</a></h2>
<p>La validez legal de la firma digital está desarrollada en España a través de la
<a class="reference external" href="https://www.boe.es/eli/es/l/2020/11/11/6/con">Ley 6/2020</a>, de 11 de noviembre, <em>reguladora de determinados aspectos de los
servicios electrónicos de confianza</em>, y  el <a class="reference external" href="https://www.boe.es/buscar/doc.php?id=DOUE-L-2014-81822">Reglamento eIDAS</a> (<em>Reglamento
910/2014</em>, conocidos por sus siglas en ingles <abbr title="Electronic IDentification, Authentication and trust Services">eIDAS</abbr>). La normativa establece
dos tipos de <em>prestadores de servicios de confianza</em> (esto es, de <abbr title="Certification Authority">CA</abbr>):</p>
<ul class="simple">
<li><p><em class="dfn">Prestadores cualificados</em>, que son aquellos reconocidos como tales por
un organismo supervisor<a class="footnote-reference brackets" href="#id9" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>. Las obligaciones a los que están sujetos se
encuentran enumeradas en el artículo <strong>9</strong> de la <a class="reference external" href="https://www.boe.es/eli/es/l/2020/11/11/6/con">Ley 6/2020</a>.</p></li>
<li><p><em class="dfn">Prestadores no cualificados</em>, que son aquellos que no gozan de este
reconocimiento, aunque se encuentran inscritos para el ejercicio de su
actividad.</p></li>
</ul>
<p>Esta distinción origina que haya <em class="dfn">certificados digitales cualificados</em> y
<em class="dfn">certificados digitales no cualificados</em> y, consecuentemente, una
<em class="dfn">firma electrónica cualificada</em> y una <em class="dfn">firma electrónica no
cualificada</em>. La diferencia legal entre una y otra firma es que la primera tiene
los mismos efectos juridicos que la firma manuscrita, mientras que la segunda
no, aunque puede ser admitida en un juicio<a class="footnote-reference brackets" href="#id10" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>.</p>
<p>El Ministerio publica en su web la <a class="reference external" href="https://avancedigital.mineco.gob.es/es-es/Servicios/FirmaElectronica/Paginas/Prestadores.aspx">lista de prestadores cualificados y no
cualificados de confianza</a>.
Como todos los países de la Unión tiene la obligación de remitir estas listas,
es posible la <a class="reference external" href="https://digital-strategy.ec.europa.eu/en/policies/eu-trusted-lists">consulta de todos los prestadores europeos</a>.</p>
</section>
<section id="pades">
<span id="pdfsig"></span><h2><span class="section-number">9.1.3.2.2. </span><abbr title="PDF Advanced Electronic Signatures">PAdES</abbr><a class="headerlink" href="#pades" title="Link to this heading">¶</a></h2>
<p>Hay varias aplicaciones en Linux que permiten la firma y verificación de firmas
de documentos <abbr title="Portable Dcument Format">PDF</abbr>:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.libreoffice.org">LibreOffice</a> (dentro del menú «Archivo»).</p></li>
<li><p><a class="reference external" href="https://mupdf.com">MuPDF</a><a class="footnote-reference brackets" href="#id11" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>.</p></li>
<li><p><a class="reference external" href="https://poppler.freedesktop.org">Poppler</a> y todas las aplicaciones que lo tomen como base (<a class="reference external" href="https://pwmt.org/projects/zathura">Zathura</a>, <a class="reference external" href="https://wiki.gnome.org/Apps/Evince">Evince</a>)<a class="footnote-reference brackets" href="#id12" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a>.</p></li>
<li><p>Las proporcionadas por el Gobierno de España:</p>
<ul>
<li><p><a class="reference external" href="https://firmaelectronica.gob.es/Home/Descargas.html">Autofirma</a>, escrita en <em>Java</em>,
para la firma.</p></li>
<li><p>La página <a class="reference external" href="https://valide.redsara.es/">Valide</a>, para validación  de
documentos firmados con certificados expedidos por algunas <abbr title="Certification Authority">CA</abbr> reconocidas
por el <a class="reference external" href="https://mincotur.gob.es">Ministerio de Industria, Comercio y Turismo</a>. Esta página también ofrece la opción de firmar,
pero lo hace, en realidad, recurriendo a un <a class="reference external" href="https://firmaelectronica.gob.es/Home/Descargas.html">Autofirma</a> que haya instalado
en el sistema.</p></li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>El uso de las citadas utilidades del Gobierno no entraña mucha
dificultad:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://firmaelectronica.gob.es/Home/Descargas.html">Autofirma</a> se distribuye como un archivo <kbd class="kbd docutils literal notranslate">.zip</kbd> que, entre otros,
contiene un <a class="reference internal" href="../../../02.conbas/09.admbasica/08.paqueteria.html#paquetes-deb"><span class="std std-ref">paquete deb</span></a>. La instalación de este
paquete asegura que se satisfagan las dependencias y se asocie a la
aplicación el tipo <abbr title="Multipurpose Internet Mail Extensions">MIME</abbr> <code class="docutils literal notranslate"><span class="pre">x-scheme-handler/afirma</span></code> que permite soportar
el protocolo <code class="docutils literal notranslate"><span class="pre">afirma://</span></code> que usan las páginas oficiales cuando requieren
firmar un documento.</p></li>
<li><p>La <abbr title="Fábrica Nacional de Moneda y Timebre">FNMT</abbr>, que emite gratuitamente certificados personales, usa otra
aplicación más, <a class="reference external" href="https://www.sede.fnmt.gob.es/descargas/descarga-software/instalacion-software-generacion-de-claves">Configurador FNMT-RCM</a>,
exclusivamente para el proceso de generación de certificados. Esta es la
aplicación que se encarga de generar las claves, solicitar el certificado
y, finalmente, recibirlo. También para ella hay un paquete <em>deb</em> que se
encargará de satisfacer las dependencias y asociar el tipo <abbr title="Multipurpose Internet Mail Extensions">MIME</abbr>
<code class="docutils literal notranslate"><span class="pre">x-scheme-handler/fnmtcr</span></code> que permite soportar el protocolo
<code class="docutils literal notranslate"><span class="pre">fnmtcr://</span></code>.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>En realidad, ambas aplicaciones son aplicaciones escritas en
<em>Java</em>, pero no incluyen entre sus dependencias el intérprete, por lo
que, si no lo tuviéramos ya instalado, no se instalará y las aplicaciones
no funcionarán. Cerciórese, por tanto, de que lo tiene:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>java<span class="w"> </span><span class="o">||</span><span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>default-jre
</pre></div>
</div>
</div>
<p>Una vez que complete la instalación de ambas aplicaciones, cerciórese
de que el sistema es capaz de soportar los dos protocolos referidos:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>xdg-mime<span class="w"> </span>query<span class="w"> </span>default<span class="w"> </span>x-scheme-handler/fnmtcr
<span class="go">configuradorfnmt.desktop</span>
<span class="gp">$ </span>xdg-mime<span class="w"> </span>query<span class="w"> </span>default<span class="w"> </span>x-scheme-handler/afirma
<span class="go">afirma.desktop</span>
</pre></div>
</div>
<p>Para más información, consulte «<a class="reference internal" href="../../../02.conbas/99.misc/06.mimetypes.html#mimetypes"><span class="std std-ref">Aplicaciones predeterminadas</span></a>».</p>
</div>
<p>Nos centraremos en este apéndice práctico en el uso por línea de órdenes de
<em class="manpage"><a class="manpage reference external" href="https://manpages.debian.org/pdfsig">pdfsig</a></em>, una orden incluida dentro del paquete <a class="extlink-deb reference external" href="https://packages.debian.org/stable/poppler-utils">poppler-utils</a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>apt<span class="w"> </span>install<span class="w"> </span>poppler-utils
</pre></div>
</div>
<section id="validacion">
<h3><span class="section-number">9.1.3.2.2.1. </span>Validación<a class="headerlink" href="#validacion" title="Link to this heading">¶</a></h3>
<p>La validez de la firma de un <abbr title="Portable Dcument Format">PDF</abbr> se puede hacer del siguiente modo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pdfsig<span class="w"> </span>-nocert<span class="w"> </span>documento.pdf
</pre></div>
</div>
<p>La orden de arriba, sin embargo, no comprobará la fiabilidad del certificado
firmante (<kbd class="kbd docutils literal notranslate">-nocert</kbd>). Para hacerlo, es necesario que el programa utilice
un catálogo de claves que disponga de toda la cadena de confianza. Este
catálogo es <a class="reference internal" href="01.certdig.html#cert-nss"><span class="std std-ref">un almacen NSS</span></a> como los que usa <a class="reference external" href="https://www.mozilla.org">Firefox</a> o
<a class="reference external" href="https://www.chromium.org">Chromium</a>. Supuesto que dispongamos de ese catálogo, entonces podremos
comprobar la firma y cerciorarnos de la fiabilidad del certificado:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pdfsig<span class="w"> </span>-nssdir<span class="w"> </span>~/.pki/nssdb<span class="w"> </span>documento.pdf
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">Ver también</p>
<p>Consulte cómo crear, consultar y mantener un <a class="reference internal" href="01.certdig.html#cert-nss"><span class="std std-ref">catálogo NSS</span></a>. En la orden de ejemplo se ha supuesto que se usa el catálogo
creado por <a class="reference external" href="https://www.chromium.org">Chromium</a>.</p>
</div>
</section>
<section id="firma">
<h3><span class="section-number">9.1.3.2.2.2. </span>Firma<a class="headerlink" href="#firma" title="Link to this heading">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Para poder firmar documentos es necesario utilizar al menos la
versión <strong>21.01</strong> de <a class="extlink-deb reference external" href="https://packages.debian.org/stable/poppler-utils">poppler-utils</a>, y preferentemente la <strong>21.10</strong> (o
sea, al menos, <em>Bookworm</em>), que permite añadir un nuevo campo de firma.</p>
</div>
<p>Supuesto que dispongamos de un almacén <abbr title="Network Secure Services">NSS</abbr> con nuestro certificado y su cadena
de confianza:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pdfsig<span class="w"> </span>-nssdir<span class="w"> </span>~/.pki/nssdb<span class="w"> </span>-add-signature<span class="w"> </span>-nick<span class="w"> </span><span class="s1">&#39;CADENA-EN-NSSDB-DEL-CERT&#39;</span><span class="w"> </span>doc.pdf<span class="w"> </span>doc_firmado.pdf
</pre></div>
</div>
</section>
</section>
<section id="cades">
<h2><span class="section-number">9.1.3.2.3. </span><abbr title="CMS Advanced Electronic Signatures">CAdES</abbr><a class="headerlink" href="#cades" title="Link to this heading">¶</a></h2>
<p>Otro modo de firmar (en especial si el documento original no es un <abbr title="Portable Dcument Format">PDF</abbr>) es el
estándar <abbr title="CMS Advanced Electronic Signatures">CAdES</abbr>, que es básicamente el referido en el <span class="target" id="index-0"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2315.html"><strong>RFC 2315</strong></a> y que ya
hemos citado al tratar el <a class="reference internal" href="01.certdig.html#cert-p7"><span class="std std-ref">formato PKCS #7</span></a>.</p>
<section id="id5">
<h3><span class="section-number">9.1.3.2.3.1. </span>Firma<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h3>
<p>Partamos de que tenemos un documento (no necesariamente un <abbr title="Portable Dcument Format">PDF</abbr>) y un
certificado personal (<code class="file docutils literal notranslate"><span class="pre">key.pem</span></code> y <code class="file docutils literal notranslate"><span class="pre">cert.pem</span></code>) con el que queremos
firmar tal documento:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>openssl<span class="w"> </span>smime<span class="w"> </span>-sign<span class="w"> </span>-in<span class="w"> </span>fichero.txt<span class="w"> </span>-inkey<span class="w"> </span>key.pem<span class="w"> </span>-outform<span class="w"> </span>DER<span class="w"> </span>-binary<span class="w"> </span>-signer<span class="w"> </span>cert.pem<span class="w"> </span>-out<span class="w"> </span>fichero.p7s
</pre></div>
</div>
<p>Esto generará un archivo de firma (<code class="file docutils literal notranslate"><span class="pre">fichero.p7s</span></code> en formato <abbr title="Distinguised Enconding Rules">DER</abbr>) que
contiene la firma en sí y también el propio certificado (lo que simplifica luego
la verificación). A partir de ahora tendríamos que almacenar tanto el archivo
(<code class="file docutils literal notranslate"><span class="pre">fichero.txt</span></code>) como la propia firma (<code class="file docutils literal notranslate"><span class="pre">fichero.p7s</span></code>).</p>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Al archivo de firma, además de la propia firma, sólo se añade el
certificado del firmante<a class="footnote-reference brackets" href="#id13" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a>, aunque puedan existir otros certificados dentro de
<code class="file docutils literal notranslate"><span class="pre">cert.pem</span></code> que completen la cadena de confianza. Si se desea añadir
éstos también, deberán ponerse en archivo aparte y declararlo con la opción
<kbd class="kbd docutils literal notranslate">-certfile</kbd>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>openssl<span class="w"> </span>smime<span class="w"> </span>-sign<span class="w"> </span>-in<span class="w"> </span>fichero.txt<span class="w"> </span>-inkey<span class="w"> </span>key.pem<span class="w"> </span>-outform<span class="w"> </span>DER<span class="w"> </span>-binary<span class="w"> </span>-signer<span class="w"> </span>cert.pem<span class="w"> </span>-certfile<span class="w"> </span>chain.pem<span class="w"> </span>-out<span class="w"> </span>fichero.p7s
</pre></div>
</div>
</div>
</section>
<section id="id7">
<h3><span class="section-number">9.1.3.2.3.2. </span>Validación<a class="headerlink" href="#id7" title="Link to this heading">¶</a></h3>
<p>La verificación consiste en tomar el archivo de firma (<code class="file docutils literal notranslate"><span class="pre">fichero.p7s</span></code>), que
suponemos que contiene el certificado firmante, y el archivo que se firmó
(<code class="file docutils literal notranslate"><span class="pre">fichero.txt</span></code>):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>openssl<span class="w"> </span>smime<span class="w"> </span>-verify<span class="w"> </span>-inform<span class="w"> </span>DER<span class="w"> </span>-in<span class="w"> </span>fichero.p7s<span class="w"> </span>-content<span class="w"> </span>fichero.txt<span class="w"> </span>-purpose<span class="w"> </span>any<span class="w"> </span>-binary<span class="w"> </span>&gt;<span class="w"> </span>/dev/null
<span class="go">Verification successful</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>La verificación exige que la cadena de confianza esté completa. Si
<code class="file docutils literal notranslate"><span class="pre">fichero.p7s</span></code> no contiene el certificado del firmante, habrá que
referirlo a través de <kbd class="kbd docutils literal notranslate">-certfile</kbd> y, si existen autoridades intermedias,
deberemos incluir sus certificados mediante <kbd class="kbd docutils literal notranslate">-CAfile</kbd>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>El archivo <cite>.p7s</cite> es capaz de contener el archivo firmado. Si este
fuera el caso, bastaría con no usar la opción <kbd class="kbd docutils literal notranslate">-content</kbd>.</p>
</div>
</section>
</section>
<section id="firma-en-las-administraciones-publicas">
<span id="como-firma-junta"></span><h2><span class="section-number">9.1.3.2.4. </span>Firma en las administraciones públicas<a class="footnote-reference brackets" href="#id14" id="id8" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a><a class="headerlink" href="#firma-en-las-administraciones-publicas" title="Link to this heading">¶</a></h2>
<p>El <abbr title="Esquema Nacional de Interoperabilidad">ENI</abbr> incluye como parte de la interoperabilidad entre las administraciones
públicas españolas un sistema de firma digital que no es exactamente ninguno de
los anteriormente explicados y que se aplica en la firma de solicitudes,
publicación de instrucciones, etc.</p>
<p>Básicamente consiste en lo siguiente:</p>
<ul class="simple">
<li><p>El proceso de firma genera un archivo de firma <abbr title="eXtensible Markup Language">XML</abbr> de formato propio (el
<a class="reference external" href="https://www.hacienda.gob.es/SGT/catalogo_sefp/245_20150112_eni_xsd_manual_de_usuario_esquema_2_f.pdf">formato ENI</a>) que contiene la firma
en alguno de los formatos estándar ya referidos. Este archivo contiene
también los datos firmados.</p></li>
<li><p>No se facilita directamente este archivo de firma, sino que éste y una copia
del documento original se almacenan en un servidor y al usuario se le
proporciona una <abbr title="Uniform Resource Locator">URL</abbr> y un código de verificación, que actúa básicamente como
identificador con el que el usuario posteriormente puede obtener de la <abbr title="Uniform Resource Locator">URL</abbr>
el archivo <abbr title="Esquema Nacional de Interoperabilidad">ENI</abbr>.</p></li>
<li><p>Para facilitar el código de verificación se modifica el contenido del <abbr title="Portable Dcument Format">PDF</abbr>
original incluyendolo como pie en todas las páginas del documento. Este nuevo
<abbr title="Portable Dcument Format">PDF</abbr> es el que se proporciona al usuario como resultado del proceso de firma.
Consecuentemente, el usuario obtiene un <abbr title="Portable Dcument Format">PDF</abbr> que en realidad no contiene la
información de firma, sino la información de cómo obtenerla.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Nótese que a pesar de que esta estrategia, en principio, debería
permitir el uso de un documento en cualquier formato, este paso de modificar el
archivo original para incluir el código restringe el uso a archivos <abbr title="Portable Dcument Format">PDF</abbr>,
ya que el sistema śolo se ha preparado para modificar archivos de este tipo.</p>
</div>
<p>Por tanto, si el usuario quiere verificar el documento, deberá acceder a la <abbr title="Uniform Resource Locator">URL</abbr>
proporcionada y facilitar el código de verificación, lo que le dará acceso al
documento <abbr title="Esquema Nacional de Interoperabilidad">ENI</abbr> que, éste sí, contiene la información de firma. La verificación
por su parte puede hacerse destripando dicho documento o acudiento a <a class="reference external" href="https://sede.administracion.gob.es/pagSedeFront/servicios/peticionENI.htm">este
servicio web nacional</a>,
que hace el trabajo por nosotros si le proporcionamos el <abbr title="Esquema Nacional de Interoperabilidad">ENI</abbr>.</p>
<p>Esta estrategia tiene sus ventajas e inconvenientes respecto a una firma basada
en <abbr title="PDF Advanced Electronic Signatures">PAdES</abbr>:</p>
<dl class="simple">
<dt><strong>Ventajas</strong></dt><dd><ul class="simple">
<li><p>En principio, el procedimiento es válido para cualquier tipo de documento,
pero por la razón ya aducida, sólo se puede usar sobre archivos <abbr title="Portable Dcument Format">PDF</abbr>. Así
pues, esta ventaja queda en nada.</p></li>
<li><p>Si se imprime el documento en papel, aún sabremos que se firmó y cómo
verificarlo, ya que podremos ver en la copia de papel el código de
verificación y la <abbr title="Uniform Resource Locator">URL</abbr> a la que acceder. En cambio, al imprimirse un <abbr title="Portable Dcument Format">PDF</abbr>
firmado mediante <abbr title="PDF Advanced Electronic Signatures">PAdES</abbr> ningún metadato se refleja en el papel y, por
tanto, se pierde la firma.</p></li>
</ul>
</dd>
<dt><strong>Desventajas</strong></dt><dd><ul class="simple">
<li><p>El propio documento no contiene la información de firma, sino que ésta se
halla almacenada externamente.</p></li>
<li><p>La información de firma se encuentra alamacenada en un servidor ajeno,
por lo que dependeremos de que el organismo conserve tal
información, ya que de lo contrario será imposible llevar a cabo la
verificación. En principio, podríamos soslayar este problema descargando el
archivo <abbr title="Esquema Nacional de Interoperabilidad">ENI</abbr> en cuanto hubiéramos firmado, en vez de confiar en que tales
archivos se conserven siempre en el servidor remoto.</p></li>
<li><p>Las comprobaciones se hacen con el archivo <abbr title="Esquema Nacional de Interoperabilidad">ENI</abbr> que contiene el archivo
original,  y eso no asegura que el archivo resultante
de la firma no haya sido modificado maliciosamente con posterioridad. Por
tanto, habrá también que cotejar visualmente que la única diferencia entre
el original y el modificado es la información adicional de verificación.</p></li>
</ul>
</dd>
</dl>
<p>Para ilustrar el procedimiento tomemos un documento firmado por la
administración andaluza. Por ejemplo, las <a class="reference external" href="https://www.juntadeandalucia.es/educacion/portals/web/inspeccion-educativa/normativa/-/normativas/detalle/resolucion-de-26-de-junio-de-2024-de-la-direccion-general-de-formacion-profesional-por-la-que-se-dictan-instrucciones">Instrucciones para regular aspectos
relativos a la organización y el funcionamiento [de a Formación Profesional]
para el curso 2024/2025</a>.
De un simple vistazo, sabemos que están firmadas porque todas las páginas tienen
este pie:</p>
<img alt="../../../_images/info-ver.png" src="../../../_images/info-ver.png" />
<p>que es precisamente el contenido que se añade al original como consecuencia del
proceso de firma. Trae información de quién lo firmó y cuándo, pero lo realmente
sustancioso es que incluye una <abbr title="Uniform Resource Locator">URL</abbr> y un código de verificación (o un código
<abbr title="Quick Response">QR</abbr> con esa misma información). Al acceder a <a class="reference external" href="https://ws050.juntadeandalucia.es/verificarFirma/">esa URL</a>, podremos escribir el
código de verificación y obtendremos lo siguiente:</p>
<img alt="../../../_images/arc-ver.png" src="../../../_images/arc-ver.png" />
<p>Se nos indica que la firma es válida (lo cual podemos creer o no), quién y cuándo
firmó (aunque eso eran datos que ya proporcionaba el pie añadido); y sobre todo
el archivo original (que si lo descargamos podremos comprobar que es idéntico,
pero no contiene el pie informativo) y un documento <abbr title="Esquema Nacional de Interoperabilidad">ENI</abbr> del que podemos
extraer el archivo de firma <code class="docutils literal notranslate"><span class="pre">.p7s</span></code>, ya que se encuentra contenido en uno de
sus elementos:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cat<span class="w"> </span>&lt;&lt;EOF<span class="w"> </span>&gt;<span class="w"> </span>firma.p7s
<span class="go">-----BEGIN PKCS7-----</span>
<span class="gp">$</span><span class="o">(</span>xmlstarlet<span class="w"> </span>sel<span class="w"> </span>-B<span class="w"> </span>-t<span class="w"> </span>-v<span class="w"> </span><span class="s1">&#39;//enids:FirmaConCertificado&#39;</span><span class="w"> </span>documentoENI.xml<span class="o">)</span>
<span class="go">-----END PKCS7-----</span>
<span class="go">EOF</span>
</pre></div>
</div>
<p>Con ambos archivos podemos hacer la comprobación:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>openssl<span class="w"> </span>smime<span class="w"> </span>-verify<span class="w"> </span>-inform<span class="w"> </span>PEM<span class="w"> </span>-in<span class="w"> </span>firma.p7s<span class="w"> </span>-content<span class="w"> </span>original.pdf<span class="w"> </span>-purpose<span class="w"> </span>any<span class="w"> </span>-binary<span class="w"> </span>&gt;<span class="w"> </span>/dev/null
<span class="go">Verification successful</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>En las órdenes <code class="file docutils literal notranslate"><span class="pre">documentoENI.xml</span></code> es el <abbr title="eXtensible Markup Language">XML</abbr> descargado y
<code class="file docutils literal notranslate"><span class="pre">original.pdf</span></code> el <abbr title="Portable Dcument Format">PDF</abbr> original también descargado.</p>
</div>
<p class="rubric">Notas al pie</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id9" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>La <a class="reference external" href="https://avancedigital.mineco.gob.es/es-es/Paginas/index.aspx">Secretaria de Estado de Telecomunicaciones e
Infraestructuras Digitales</a> dependiente del <a class="reference external" href="https://portal.mineco.gob.es/es-es/Paginas/default.aspx">Ministerio de Asuntos Económicos
y Transformación Digital</a>. La variabilidad política hará que este párrafo
quede pronto obsoleto y el nombre del Ministerio y de la Secretaría de Estado
cambie de nombre y <em>dirección web</em>.</p>
</aside>
<aside class="footnote brackets" id="id10" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>Puede hacerse una lectura del artículo <a class="reference external" href="http://e-procesal.com/dterceros-de-confianza-y-certificacion-de-prueba-electronica-una-nueva-frontera-en-materia-de-probatica-2109">Terceros de confianza y
certificación de prueba electrónica. Una nueva frontera en materia de
probática</a>.</p>
</aside>
<aside class="footnote brackets" id="id11" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">3</a><span class="fn-bracket">]</span></span>
<p>Aunque el soporte parece deficiente y no permitir la adición de un objeto
de firma. La <a class="reference external" href="https://mupdf.readthedocs.io/en/latest/mutool-sign.html">escasa documentación</a> no contribuye a
aclararlo.</p>
</aside>
<aside class="footnote brackets" id="id12" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">4</a><span class="fn-bracket">]</span></span>
<p>En realidad, <strong class="program">Poppler</strong> a través de <a class="reference internal" href="#pdfsig"><span class="std std-ref">pdfsig</span></a> lo
permite, pero a fecha de redacción (abril de 2022) las aplicaciones
derivadas, no.</p>
</aside>
<aside class="footnote brackets" id="id13" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id6">5</a><span class="fn-bracket">]</span></span>
<p>Y lo contiene porque no hemos incluido la opción <kbd class="kbd docutils literal notranslate">-nocerts</kbd>. Si lo
hubiéramos hecho, el archivo contendría extrictamente la firma sin ningún
certificado.</p>
</aside>
<aside class="footnote brackets" id="id14" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id8">6</a><span class="fn-bracket">]</span></span>
<p>Las administraciones públicas españolas, se entiende.</p>
</aside>
</aside>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../../index.html">Tabla de contenido</a></h3>
    <ul>
<li><a class="reference internal" href="#">9.1.3.2. Firma de documentos</a><ul>
<li><a class="reference internal" href="#estatus-legal">9.1.3.2.1. Estatus legal</a></li>
<li><a class="reference internal" href="#pades">9.1.3.2.2. <abbr title="PDF Advanced Electronic Signatures">PAdES</abbr></a><ul>
<li><a class="reference internal" href="#validacion">9.1.3.2.2.1. Validación</a></li>
<li><a class="reference internal" href="#firma">9.1.3.2.2.2. Firma</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cades">9.1.3.2.3. <abbr title="CMS Advanced Electronic Signatures">CAdES</abbr></a><ul>
<li><a class="reference internal" href="#id5">9.1.3.2.3.1. Firma</a></li>
<li><a class="reference internal" href="#id7">9.1.3.2.3.2. Validación</a></li>
</ul>
</li>
<li><a class="reference internal" href="#firma-en-las-administraciones-publicas">9.1.3.2.4. Firma en las administraciones públicas</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Tema anterior</h4>
    <p class="topless"><a href="01.certdig.html"
                          title="capítulo anterior"><span class="section-number">9.1.3.1. </span>Certificado digital</a></p>
  </div>
  <div>
    <h4>Próximo tema</h4>
    <p class="topless"><a href="03.correo.html"
                          title="próximo capítulo"><span class="section-number">9.1.3.3. </span>Correo electrónico</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/98.apendice/01.cryto/03.aplicaciones/02.pdf.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Ir a" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="03.correo.html" title="9.1.3.3. Correo electrónico"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="01.certdig.html" title="9.1.3.1. Certificado digital"
             >anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" ><span class="section-number">9. </span>Apéndices</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" ><span class="section-number">9.1. </span>Criptografía</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../03.aplicaciones.html" ><span class="section-number">9.1.3. </span>Aplicaciones de la criptografía</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">9.1.3.2. </span>Firma de documentos</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright CC BY 4.0, 2016-2025, José Miguel Sánchez Alés.
      Creado usando <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    </div>
  </body>
</html>