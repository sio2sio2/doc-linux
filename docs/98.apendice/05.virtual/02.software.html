

<!DOCTYPE html>

<html lang="es" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>9.2.2. Software de virtualización &#8212; documentación de Linuxnomicón - rolling</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/classic.css?v=2bf1fcf8" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    
    <script src="../../_static/documentation_options.js?v=a621b78a"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/translations.js?v=f85f4cfb"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../search.html" />
    <link rel="next" title="9.2.2.1.1. Virtualbox" href="02.software/01.completa/01.virtualbox.html" />
    <link rel="prev" title="9.2.1. Introducción" href="01.intro.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="02.software/01.completa/01.virtualbox.html" title="9.2.2.1.1. Virtualbox"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="01.intro.html" title="9.2.1. Introducción"
             accesskey="P">anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" ><span class="section-number">9. </span>Apéndices</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U"><span class="section-number">9.2. </span>Virtualización</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">9.2.2. </span>Software de virtualización</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="software-de-virtualizacion">
<h1><span class="section-number">9.2.2. </span>Software de virtualización<a class="headerlink" href="#software-de-virtualizacion" title="Link to this heading">¶</a></h1>
<p>De las múltiples soluciones disponibles en <em>Linux</em> incluimos guía de unas pocas
de ellas, que en algunos casos serán meras notas, y en otros relaciones más extensas.</p>
<section id="virtualizacion-completa">
<span id="software-virt-completa"></span><h2><span class="section-number">9.2.2.1. </span>Virtualización completa<a class="headerlink" href="#virtualizacion-completa" title="Link to this heading">¶</a></h2>
<p>Al utilizar un <em>software</em> de virtualización para instalar y probar sistemas
operativos nos será muy útil conocer varios aspectos (además de los evidentes):</p>
<ul class="simple">
<li><p>Manipular el modo en que la máquina virtual se conecta a la red para poder
simular distintos escenarios. Por ejemplo, no es lo mismo que queramos
virtualizar un sistema de escritorio en que lo único que se necesita por lo
general es salida a internet que un servidor en que muy probablemente
necesitemos que el anfitrión pueda conectarse a él.</p></li>
<li><p>Preservar estados de disco para recuperarlos cuando sea preciso (lo que se
conoce como <em class="dfn">instantáneas</em>).</p></li>
<li><p>Crear discos que puedan utilizarse como plantilla para la creación de varias
máquinas virtuales. Por ejemplo, crear un único disco con una instalación
limpia de <em>Windows</em> 10, y usar éste como base para todos los discos de las
máquinas virtuales en que vayamos a virtualizar un <em>Windows</em> 10.</p></li>
<li><p>Virtualizar tanto <em>firmware</em> <abbr title="Basic I/O System">BIOS</abbr> como <em>firmware</em> <abbr title="Unified Extensible Firmware Interface">UEFI</abbr>.</p></li>
<li><p>Tener mecanismos sencillos para poder transferir datos entre el anfitrión
y el huésped (p.e. un directorio compartido por ambos).</p></li>
<li><p>Exportar máquinas virtuales a otros anfitriones o importarlas desde ellos.</p></li>
</ul>
<p>Trataremos dos hipervisores: <strong class="program">Virtualbox</strong> porque ofrece la posibilidad
de ejecutarse en otros sistemas operativos como <em>Windows</em>, y <abbr title="Kernel-based Virtual Machine">KVM</abbr> que es una
solución integrada oficialmente en el propio núcleo de <em>Linux</em>:</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="02.software/01.completa/01.virtualbox.html">9.2.2.1.1. Virtualbox</a></li>
<li class="toctree-l1"><a class="reference internal" href="02.software/01.completa/02.kvm.html">9.2.2.1.2. <abbr title="Kernel-based Virtual Machine">KVM</abbr></a></li>
</ul>
</div>
</section>
<section id="contenedores">
<span id="software-contenedores"></span><h2><span class="section-number">9.2.2.2. </span>Contenedores<a class="headerlink" href="#contenedores" title="Link to this heading">¶</a></h2>
<p>Los contenedores son una solución mucho más ligera<a class="footnote-reference brackets" href="#id3" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> y eficiente con la
limitación de que tendrán que contener un sistema de idéntica naturaleza a la
del anfitrión, puesto que carecen de sistema operativo propio.</p>
<p>En los sistemas <em>Linux</em> este tipo de virtualización, muy esquemáticamente, se
basa en dos conceptos:</p>
<ol class="arabic simple">
<li><p>El <strong>aislamiento</strong> a través de:</p>
<ul class="simple">
<li><p>los <em class="dfn">espacios de nombres</em> (<em>namespaces</em>) del núcleo, que proporcionan
a los procesos una visión parcial de los procesos y recursos que gestiona
el sistema operativo. Todo aquello que no haya sido incluido en el mismo
espacio de nombres, no es accesible ni aparentemente existe. Para entender
este conceptos resulta indispensable la lectura del artículo <a class="reference external" href="https://blog.quarkslab.com/digging-into-linux-namespaces-part-1.html">Digging into
Linux namespaces</a> (y <a class="reference external" href="https://blog.quarkslab.com/digging-into-linux-namespaces-part-2.html">su segunda parte</a>)<a class="footnote-reference brackets" href="#id4" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>.</p></li>
<li><p>el <em class="dfn">enjaulamiento</em> (<em class="manpage"><a class="manpage reference external" href="https://manpages.debian.org/chroot">chroot</a></em>, <em class="manpage"><a class="manpage reference external" href="https://manpages.debian.org/pivot_root">pivot_root</a></em>) dentro de
un árbol de directorios, que logra su aislamiento del resto del sistema de
archivos.</p></li>
</ul>
</li>
<li><p>La <strong>limitación</strong> de recursos a través de los <em class="dfn">grupos de control</em>
(abreviado <em>cgroups</em>). Gracias a ellos, por ejemplo, podremos impedir que un
proceso ocupe más de 128MiB de memoria <abbr title="Random Access Memory">RAM</abbr>, aunque la máquina disponga de
mucha más. Para profundizar en ellos es conveniente el artículo <a class="reference external" href="https://www.lewisgaul.co.uk/blog/coding/2022/05/13/cgroups-intro/">Cgroups
Introduction</a>. Tenga
presente que la versión predeterminada en <em>Debian</em> a partir de <em>Bulleye</em> es
la v2, así que es ésta versión la que se tomará como referencia.</p></li>
</ol>
<p>En consecuencia, la creación de un contenedor supone:</p>
<ul class="simple">
<li><p>Crearle un conjunto de espacios de nombres propios (uno para su red, otro para
sus procesos, etc). De esta manera, dentro del contenedor sólo se tiene acceso
a aquello que el sistema operativo del anfitrión gestiona para el propio
contenedor.</p></li>
<li><p>Enjaularlo dentro la porción del árbol de directorios que constituya su
&quot;sistema de archivos&quot;.</p></li>
<li><p>Crearle los grupos de control propios para limitar su uso de recursos.</p></li>
</ul>
<p>Es relativamente frecuente utilizar el término <abbr title="Virtual Machine">VM</abbr> para referir la máquina
virtual de la virtualización completa y <abbr title="Virtual Environment">VE</abbr> (entorno virtual) para referir al
contenedor. Antes de comenzar, no obstante, es preciso saber que existen
distintos tipos de contenedores:</p>
<dl>
<dt>Según los <strong>permisos</strong> de sus usuarios</dt><dd><p>Hay dos tipos distintos:</p>
<dl class="simple" id="contenedor-privilegiado">
<dt><em class="dfn">Contenedor privilegiado</em> (<em>privileged container</em>)</dt><dd><p>es aquel en que no se hace uso del concepto de <em>espacio de nombres de
usuario</em>  y, en consecuencia, los usuarios y grupos del contenedor se
corresponden con los usuarios y grupos del anfitrión. Dicho de otro modo, la
acción que realice el usuario <em>root</em> en el contenedor es una acción que el
sistema operativo del anfitrión considera que está ejecutando su propio
<em>root</em>.</p>
</dd>
</dl>
<dl class="simple" id="contenedor-no-privilegiado">
<dt><em class="dfn">Contenedor no privilegiado</em> (<em>unprivileged container</em>)</dt><dd><p>es aquel que hace uso de tal concepto, por lo que se mapean identificadores
de usuarios y grupos; y, en consecuencia, el administrador del contenedor
(<abbr title="User IDentifier">UID</abbr> <strong>0</strong>  en  el contenedor) no se corresponde con el administrador del
anfitrión (<abbr title="User IDentifier">UID</abbr> <strong>0</strong> en el anfitrión). Esto evita la posibilidad de que el
administrador escape del confinamiento del contenedor con permisos de
administrador.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Todos estos conceptos se entienden muy bien si se leen con
detenimiento las explicaciones ya recomendadas del artículo <a class="reference external" href="https://blog.quarkslab.com/digging-into-linux-namespaces-part-1.html">Digging into
Linux namespaces</a> y, en especial, <a class="reference external" href="https://blog.quarkslab.com/digging-into-linux-namespaces-part-2.html">su segunda parte</a> en que se desarrolla
el concepto de espacio de nombres de usuario (<em>user namespace</em>). Más
adelante, además, se expone <a class="reference internal" href="02.software/03.contenedores/02.lxc/01.nativas/02.unpriv.html#userns"><span class="std std-ref">un pequeño ejemplo de espacio de nombres de
usuario</span></a>.</p>
</div>
</dd>
<dt>Según los <strong>procesos</strong> que encierre</dt><dd><p>De nuevo, son dos los tipos:</p>
<dl class="simple" id="contenedor-sistema">
<dt><em class="dfn">contenedor de sistema</em></dt><dd><p>Es aquel diseñado para ejecutar aisladamente múltiples procesos a la
manera en que lo hace un sistema completo por lo que, en consecuencia,
ejecutará como primer proceso un programa <strong class="program">init</strong> (como
<a class="reference internal" href="../../04.servidor/03.init/index.html#systemd"><span class="std std-ref">systemd</span></a>). Es, por tanto, una solución más cercana al de
una virtualización completa, ya que dispondremos de un espacio de usuario
completo que recrea fielmente una distribución de <em>Linux</em>. <abbr title="LinuX Containers">LXC</abbr> provee
contenedores de este tipo.</p>
</dd>
</dl>
<dl class="simple" id="contenedor-aplicacion">
<dt><em class="dfn">contenedor de aplicaciones</em></dt><dd><p>Es aquel diseñado para ejecutar aisladamente una única aplicación (por lo
general, un servicio), por lo que ejecutará como primer proceso tal
aplicación y no un programa <strong class="program">init</strong>. Estos contenedores, por
tanto, no ofrecen un sistema completo que gestionar. <strong class="program">Docker</strong>
provee contenedores de este tipo.</p>
</dd>
</dl>
</dd>
</dl>
<p>Trataremos ambos tipos de contenedores:</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="02.software/03.contenedores/02.lxc.html">9.2.2.2.1. <abbr title="LinuX Containers">LXC</abbr></a></li>
<li class="toctree-l1"><a class="reference internal" href="02.software/03.contenedores/03.docker.html">9.2.2.2.2. Docker</a></li>
</ul>
</div>
<p class="rubric">Notas al pie</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id3" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>De hecho, este tipo de virtualización también recibe el nombre de
<em>virtulización ligera</em>.</p>
</aside>
<aside class="footnote brackets" id="id4" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>Esto incluye también a usuarios y grupos, de manera que un usuario que
dentro del contenedor actuara como usuario privilegiado (o sea, con el <abbr title="User IDentifier">UID</abbr>
0) fuera de él podría no serlo en absoluto. El interesantísimo artículo
mencionado ilustra <a class="reference external" href="https://blog.quarkslab.com/digging-into-linux-namespaces-part-2.html#combining-almost-everything">cómo crear a mano un entorno absolutamente aislado</a>
que nos puede ayudar a entender cómo funciona la <em>magia</em> de los contenedores.
Si a ese procedimiento se le añade limitación con <em>cgroups</em> (véase <a class="reference external" href="https://tbhaxor.com/docker-resource-management-in-detail/">Docker
Resource Management in Detail</a>), obtendremos
un contenedor <em>artesanal</em> sin necesidad de haber utilizado <em>software</em>
específico como <abbr title="LinuX Containers">LXC</abbr> o <em>Docker</em>.</p>
</aside>
</aside>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../index.html">Tabla de contenido</a></h3>
    <ul>
<li><a class="reference internal" href="#">9.2.2. Software de virtualización</a><ul>
<li><a class="reference internal" href="#virtualizacion-completa">9.2.2.1. Virtualización completa</a></li>
<li><a class="reference internal" href="#contenedores">9.2.2.2. Contenedores</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Tema anterior</h4>
    <p class="topless"><a href="01.intro.html"
                          title="capítulo anterior"><span class="section-number">9.2.1. </span>Introducción</a></p>
  </div>
  <div>
    <h4>Próximo tema</h4>
    <p class="topless"><a href="02.software/01.completa/01.virtualbox.html"
                          title="próximo capítulo"><span class="section-number">9.2.2.1.1. </span>Virtualbox</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/98.apendice/05.virtual/02.software.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Ir a" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="02.software/01.completa/01.virtualbox.html" title="9.2.2.1.1. Virtualbox"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="01.intro.html" title="9.2.1. Introducción"
             >anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" ><span class="section-number">9. </span>Apéndices</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" ><span class="section-number">9.2. </span>Virtualización</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">9.2.2. </span>Software de virtualización</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright CC BY 4.0, 2016-2024, José Miguel Sánchez Alés.
      Creado usando <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    </div>
  </body>
</html>