


<!DOCTYPE html>

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2.3.2. Permisos y atributos &#8212; documentación de Linuxnomicón - rolling</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/translations.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../search.html" />
    <link rel="next" title="2.4. Configuración básica" href="../06.conbas/index.html" />
    <link rel="prev" title="2.3.1. Gestión de usuarios" href="05a.usuarios.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="../06.conbas/index.html" title="2.4. Configuración básica"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="05a.usuarios.html" title="2.3.1. Gestión de usuarios"
             accesskey="P">anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" ><span class="section-number">2. </span>Conceptos básicos</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U"><span class="section-number">2.3. </span>Seguridad del sistema</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">2.3.2. </span>Permisos y atributos</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="permisos-y-atributos">
<h1><span class="section-number">2.3.2. </span>Permisos y atributos<a class="headerlink" href="#permisos-y-atributos" title="Enlazar permanentemente con este título">¶</a></h1>
<p>Los archivos del sistema se encuentran protegidos mediante un sistema de
permisos para impedir que usuarios o torpes o malintencionados puedan provocar
daños al sistema; y también, para proteger la privacidad frente a usuarios
indiscretos.</p>
<p>En lo referente a permisos y atributos se puede discutir sobre:</p>
<ul class="simple">
<li><p>Los <em>permisos clásicos</em> de <em>Unix</em> (estándar <abbr title="Portable Operating System Interface for uniX">POSIX</abbr>).</p></li>
<li><p>Los <em>atributos extendidos</em> en sistemas <em>ext4</em>.</p></li>
<li><p>Los <em>atributos extendidos de usuario</em> en sistemas que los soporten (<em>ext4</em>,
<em>brtfs</em>, <em>xfs</em>).</p></li>
<li><p>Las listas de control de accesos (<abbr title="Access Control List">ACL</abbr>).</p></li>
</ul>
<p>Se tratarán aquí exhaustivamente los permisos clásicos, por ser un pilar básico
para el uso del sistema y se comentarán brevemente los atributos extendidos, que
carecen de demasiada importancia. En cambio, son útiles para algunas situaciones
los permisos basados en listas de control de accesos, pero se su estudio se
diferirá para más adelante.</p>
<div class="section" id="estandar-posix">
<span id="ugo"></span><h2><span class="section-number">2.3.2.1. </span>Estándar <abbr title="Portable Operating System Interface for uniX">POSIX</abbr><a class="headerlink" href="#estandar-posix" title="Enlazar permanentemente con este título">¶</a></h2>
<p>En el sistema clásico de permisos de <em>unix</em> cada archivo tiene un usuario
propietario y un grupo propietario, que ya hemos visto que pueden consultarse a
través de <a class="reference internal" href="../02.informacion/03.ficheros.html#ls"><span class="std std-ref">ls</span></a> o <a class="reference internal" href="../02.informacion/03.ficheros.html#stat"><span class="std std-ref">stat</span></a>. Recibe también el nombre de
<em>permisos UGO</em> (de <strong>U</strong>suario-<strong>G</strong>rupo-<strong>Otro</strong>), porque consiste
en definir los permisos del archivo para:</p>
<ul class="simple">
<li><p>El usuario propietario.</p></li>
<li><p>El grupo propietario.</p></li>
<li><p>El resto de usuarios que ni sean el propietario ni pertenezcan al grupo
propietario.</p></li>
</ul>
<p>Para cada uno de ellos se definen tres permisos:</p>
<ul class="simple">
<li><p>El permiso de <em>lectura</em>, representado por un letra <strong>r</strong>.</p></li>
<li><p>El permiso de <em>escritura</em>, representado por una letra <strong>w</strong>.</p></li>
<li><p>El permiso de <em>ejecución</em>, representado por una letra <strong>x</strong>.</p></li>
</ul>
<p>Por todo ello, cuando inspeccionamos la salida de <strong class="command">ls</strong>, vemos lo
siguiente:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ls -l /var/log/syslog
<span class="go">-rw-r----- 1 syslog adm 125534 oct 19 10:56 /var/log/syslog</span>
</pre></div>
</div>
<p>Tal archivo pertenece a un usuario llamado <em>syslog</em> y a un grupo llamado <em>adm</em>.
Los permisos por su parte son <code class="docutils literal notranslate"><span class="pre">rw-r-----</span></code>, o sea tres ternas de permisos.
<code class="docutils literal notranslate"><span class="pre">rw-</span></code>, <code class="docutils literal notranslate"><span class="pre">r--</span></code> y <code class="docutils literal notranslate"><span class="pre">---</span></code>. La primera terna corresponde al propietario, la
segunda al grupo propietario y la tercena al resto. Como un guión indica
ausencia del permiso y el orden en que se expresan son siempre <strong>rwx</strong>,
resulta que <em>syslog</em> tiene permisos de lectura y escritura; <em>adm</em>, sólo de
lectura; y el resto de usuarios, ninguno.</p>
<p>Además, de expresar los permisos mediante letras, pueden expresarme por medio de
un código numérico de tres números, de manera que cada cifra representa una
terna de permisos. Para calcular esta cifra se toma <strong>r</strong> como 4, la <strong>w</strong> como
2 y la <strong>x</strong> como 1. Por tanto, una terna <strong>rwx</strong> es 7 (4+2+1) o una terna
<strong>r-x</strong>, 5 (4+1).</p>
<p>Por tanto, para el caso del archivo <code class="file docutils literal notranslate"><span class="pre">/var/log/syslog</span></code> los permisos se
pueden expresar con el número <strong>640</strong>. Como <strong class="command">stat</strong> muestra los permisos
en formato numérico y alfabético, podemos comprobar que hemos hecho bien el
cálculo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> stat /var/log/syslog
<span class="go">  Fichero: «/var/log/syslog»</span>
<span class="go">  Tamaño: 197721      Bloques: 392        Bloque E/S: 4096   archivo regular</span>
<span class="go">Dispositivo: 801h/2049d   Nodo-i: 1188288     Enlaces: 1</span>
<span class="go">Acceso: (0640/-rw-r-----)  Uid: (  101/  syslog)   Gid: (    4/     adm)</span>
<span class="go">Acceso: 2016-10-19 07:43:21.173102488 +0200</span>
<span class="go">Modificación: 2016-10-19 12:17:01.720998505 +0200</span>
<span class="go">      Cambio: 2016-10-19 12:17:01.720998505 +0200</span>
<span class="go">    Creación: -</span>
</pre></div>
</div>
<div class="section" id="permisos-habituales">
<span id="perm-habituales"></span><h3><span class="section-number">2.3.2.1.1. </span>Permisos habituales<a class="headerlink" href="#permisos-habituales" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Hemos introducido ya los permisos habituales, pero no hemos entrado a valorar
qué significan exactamente. Dependiendo de si el archivo es un archivo regular o
un directorio, el significado cambia:</p>
<dl class="simple">
<dt><strong>Fichero regular</strong></dt><dd><ul class="simple">
<li><p>Permiso de <em>lectura</em>: Implica que se tiene permiso para ver su contenido,
por tanto, podremos hacer un <a class="reference internal" href="../02.informacion/03.ficheros.html#cat"><span class="std std-ref">cat</span></a> sobre él.</p></li>
<li><p>Permiso de <em>escritura</em>: Implica la potestad de poder alterar su contenido.</p></li>
<li><p>Permiso de <em>ejecución</em>: Permite ejecutar el archivo como programa, si este,
obviamente, es un programa. Si no lo es, el permiso no tiene razón de ser.</p></li>
</ul>
</dd>
<dt><strong>Directorio</strong></dt><dd><ul class="simple">
<li><p>Permiso de <em>lectura</em>: Implica ver el contenido de un directorio, esto es,
poder comprobar que archivos y subdirectorios contiene. Por tanto, podremos
usar sobre él <strong class="command">ls</strong>.</p></li>
<li><p>Permiso de <em>escritura</em>: Implica modificar su contenido lo cual se traduce
en poder crear y borrar archivos dentro de él.</p></li>
<li><p>Permiso de <em>ejecución</em>: Permite acceder al directorio o a algún
subdirectorio descendiente suyo, ya que para acceder hay que pasar por él.</p></li>
</ul>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Téngase en cuenta que la posibilidad de poder borrar un archivo no reside en
los permisos del propio archivo, sino en los permisos del directorio en el que
se encuentra. Si tenemos permisos de escritura sobre el directorio, podremos
borrar el archivo. En caso contrario, no; aun teniendo permiso de escritura
sobre el archivo. Lo más que podremos hacer en este último caso es dejarlo
vacío.</p>
</div>
</div>
<div class="section" id="permisos-especiales">
<span id="perm-especiales"></span><h3><span class="section-number">2.3.2.1.2. </span>Permisos especiales<a class="headerlink" href="#permisos-especiales" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Además de los permisos habituales, se pueden definir sobre los archivos otros
tres permisos:</p>
<ul class="simple">
<li><p>El bit pegajoso (<em>sticky bit</em>), cuyo valor numérico es 1.</p></li>
<li><p>El bit <em>setgid</em>, cuyo valor numérico es 2.</p></li>
<li><p>El bit <em>setuid</em>, cuyo valor numérico es 4.</p></li>
</ul>
<p>Como en el caso de los tres permisos anteriores, esta terna de permisos
especiales puede expresarse con un numero formado por la suma de sus
respectivos valores numéricos. Al expresarse todos los permisos juntos (es decir
los especiales junto a los habituales), se usa un número de cuatro cifras: la
primera representa los permisos especiales y las otras tres los habituales. Por
ejemplo, la cifra <strong>1750</strong> representa un archivo con el bit pegajoso activo (<strong>1</strong>),
con todos los permisos para el propietario (<strong>7</strong>), y con permisos de lectura y
ejecución para el grupo propietario y con ningún permiso para el resto (<strong>0</strong>). Aunque
en puridad, la expresión completa de los permisos exige las cuatro cifras, si
sólamente se indican tres, se sobrentiende que la cifra para los
permisos especiales es <strong>0</strong>. Por tanto, unos permisos expresados como <strong>640</strong>
equivalen a <strong>0640</strong>.</p>
<p>Es pertinente también aclarar qué significa cada permisos:</p>
<dl class="simple">
<dt><strong>Ejecutable</strong> (para archivos regulares normales no tiene significado)</dt><dd><ul class="simple">
<li><p><em>Bit pegajoso</em>: El programa sigue en memoria aun después de dejarse de usar.
Esto permite no tener que volver a cargarlo, si se vuelve a usar. No obstante,
en linux se eliminó este uso, de modo que no tiene ninguna utilidad.</p></li>
<li><p><em>setgid</em>: El programa se ejecuta con los privilegios del grupo propietario.</p></li>
<li><p><em>setuid</em>: El programa se ejecuta con los privilegios del propietario.</p></li>
</ul>
</dd>
<dt><strong>Directorios</strong></dt><dd><ul class="simple">
<li><p><em>Bit pegajoso</em>: Los archivos que contiene sólo pueden ser borrados por el
propietario del propio directorio o el dueño del archivo que se pretende
borrar. Un caso típico es el del archivo temporal <code class="file docutils literal notranslate"><span class="pre">/tmp</span></code>, ya que
cualquier usuario debe poder escribir en él, por lo que todos los usuarios
tendrán permiso de escritura. Sin embargo, debe impedirse que los usuarios
borren archivos ajenos. La solución, pues, es fijar el bit pegajoso.</p></li>
<li><p><em>setgid</em>: Todos lo archivo creados dentro tendrán como grupo
propietario el grupo propietario del propio directorio y no el grupo
principal del usuario creador. En el caso de crearse un
subdirectorio, éste, además, tendrá también habilitado el <em>setgid</em>.</p></li>
<li><p><em>setuid</em>: No tiene utilidad.</p></li>
</ul>
</dd>
</dl>
<p>Por último, es necesario explicar cómo se notan estos permisos: el bit pegajoso
aparece como una <code class="docutils literal notranslate"><span class="pre">t</span></code> en el lugar donde aparece la <code class="docutils literal notranslate"><span class="pre">x</span></code> para <em>otros</em></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ls -ld /tmp
<span class="go">drwxrwxrwt 7 root root 4096 oct 19 18:43 /tmp/</span>
</pre></div>
</div>
<p>El <em>setgid</em> se nota con una <code class="docutils literal notranslate"><span class="pre">s</span></code> en el lugar donde aparece la <code class="docutils literal notranslate"><span class="pre">x</span></code> para el
grupo propietario:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> find / -perm -2000 -ls -quit <span class="m">2</span>&gt; /dev/null
<span class="go">   9605   0 drwxr-sr-x   3 root   systemd-journal    60 oct 19 19:26 /run/log/journal</span>
</pre></div>
</div>
<p>Por último, el <em>setuid</em> se nota con una <code class="docutils literal notranslate"><span class="pre">s</span></code> en el lugar donde aparece la <code class="docutils literal notranslate"><span class="pre">x</span></code>
para el grupo propietario:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ls -l /usr/bin/sudo
<span class="go">-rwsr-xr-x 1 root root 140944 jul  5 16:01 /usr/bin/sudo</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Aparecen letras minúsculas cuando el archivo tiene definido el permiso de
ejecución que oculta la letra del permiso especial. Cuando este permiso de
ejecución no existe, la letra se muestra en mayúscula.</p>
</div>
</div>
<div class="section" id="mascara">
<h3><span class="section-number">2.3.2.1.3. </span>Máscara<a class="headerlink" href="#mascara" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Cuando se crean archivo y directorios, estos pertenecen al usuario que lo crea
y el grupo propietario es el principal del creador. Además, se crean con unos
permisos específicos:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> mkdir directorio
<span class="gp">$</span> touch archivo
<span class="gp">$</span> ls -ld directorio archivo
<span class="go">drwxr-xr-x 2 usuario usuario 1024 oct 19 17:17 directorio/</span>
<span class="go">-rw-r--r-- 1 usuario usuario    0 oct 19 17:17 archivo</span>
</pre></div>
</div>
<span class="target" id="umask"></span><dl id="index-0">
<dt><strong class="command">umask</strong></dt><dd><p>El directorio se ha creado con permisos 755 y el archivo con permisos 644. Esto
es debido a que hay definida en el sistema una máscara predeterminada:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">umask</span>
<span class="go">0022</span>
</pre></div>
</div>
<p>Para saber los permisos con los que se creará un archivo es necesario hacer
la operación binaria <code class="code docutils literal notranslate"><span class="pre">0666</span> <span class="pre">&amp;</span> <span class="pre">~mask</span></code><a class="footnote-reference brackets" href="#id4" id="id1">1</a>, y para conocer aquellos con los
que se creará un directorio <code class="code docutils literal notranslate"><span class="pre">0777</span> <span class="pre">&amp;</span> <span class="pre">~mask`</span></code>. Consecuentemente, si la
máscara es <strong>0022</strong>, los archivos se crearán con permisos <strong>0644</strong> y los
directorios con permisos <strong>0755</strong>, que es precisamente lo que ocurre.</p>
<p>Para cambiar la máscara predeterminada basta con ejecutar <strong class="command">umask</strong>
indicándola como argumento:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> rm archivo directorio -r
<span class="gp">$</span> <span class="nb">umask</span> <span class="m">027</span>
<span class="gp">$</span> mkdir directorio
<span class="gp">$</span> touch archivo
<span class="go">ls -ld archivo directorio</span>
<span class="go">drwxr-x--- 2 usuario usuario 1024 oct 19 17:37 directorio</span>
<span class="go">-rw-r----- 1 usuario usuario    0 oct 19 17:37 archivo</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Obviamente, el cambio sólo tendrá efecto durante la sesión. Si se
quiere hacer permanente, se deberá incluir el comando en algún archivo de
<a class="reference internal" href="../07.avanzada/08.interpretaciones.html#inicio-bash"><span class="std std-ref">arranque de sesión</span></a> o <a class="reference internal" href="../../04.servidor/09.autenticacion/pam_modules/10.pam_umask.html#pam-umask"><span class="std std-ref">manipular el proceso de
autenticación</span></a>.</p>
</div>
</dd>
</dl>
</div>
<div class="section" id="manipulacion">
<h3><span class="section-number">2.3.2.1.4. </span>Manipulación<a class="headerlink" href="#manipulacion" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Manipular el sistema de permisos implica cambiar usuario y grupo propietarios y
cambiar los propios permisos.</p>
<span class="target" id="chgrp"></span><dl id="index-1">
<dt><strong class="command">chgrp</strong></dt><dd><p>Permite cambiar el grupo propietario del archivo. Sólo el propietario del
archivo (o <em>root</em>) es capaz de hacer este cambio y sólo podrá cambiar a un
grupo del que sea miembro:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> chgrp audio archivo
<span class="gp">$</span> ls -l archivo
<span class="go">-rw-r----- 1 usuario audio 0 oct 19 17:37 archivo</span>
<span class="gp">$</span> chgrp root archivo
<span class="go">chgrp: cambiando el grupo de «archivo»: Operación no permitida</span>
</pre></div>
</div>
<p>Es posible usar la opción <code class="docutils literal notranslate"><span class="pre">-R</span></code> para hacer los cambios recursivos y que se
apliquen a los argumentos y a toda la parte del árbol de directorios que
cuelgue de ellos.</p>
</dd>
</dl>
<span class="target" id="chown"></span><dl id="index-2">
<dt><strong class="command">chown</strong></dt><dd><p>Permite cambiar el propietario o el grupo propietario o ambos a la vez. El
cambio de propietario sólo puede llevarlo a cabo el administrador (<em>root</em>).
La sintaxis del comando es la siguiente:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">chown [usuario][:grupo] archivo1 [archivo2...]</span>
</pre></div>
</div>
<p>Así, si desea cambiarse sólo el propietario:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> chown usuario /tmp/archivo
</pre></div>
</div>
<p>Si desea cambiarse sólo el grupo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> chown :usuario /tmp/archivo
</pre></div>
</div>
<p>Y si desean cambiarse ambos a la vez:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> chown usuario:usuario /tmp/archivo
</pre></div>
</div>
<p>Como <strong class="command">chgrp`</strong>, dispone de la opción <code class="docutils literal notranslate"><span class="pre">-R</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>El carácter de separación puede ser el punto (<em>.</em>) en vez de los dos
puntos (<em>:</em>).</p>
</div>
</dd>
</dl>
<span class="target" id="chmod"></span><dl id="index-3">
<dt><strong class="command">chmod</strong></dt><dd><p>Permite cambiar los permisos sobre un archivo a su propietario (o al
administador). La sintaxis básica es la siguiente:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">chmod &lt;permisos&gt; archivo1 [archivo2...]</span>
</pre></div>
</div>
<p>La expresión de los permisos, por otro lado puede ser bien numérica, bien
alfabética. La expresión numérica no tiene dificultad alguna, si se ha
entendido lo hasta aquí explicado:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> chmod <span class="m">600</span> archivo
<span class="go">-rw------- 1 usuario audio 0 oct 19 17:37 archivo</span>
<span class="gp">$</span> chmod <span class="m">1700</span> archivo
<span class="go">-rws------ 1 usuario audio 0 oct 19 17:37 archivo</span>
</pre></div>
</div>
<p>La expresión alfabética, en cambio, requiere algo más de explicación: está
constituida por tres partes:</p>
<ul>
<li><p>La expresión de a quién se le aplica el permiso: <strong>u</strong>(usuario
propietario), <strong>g</strong>(grupo propietario), <strong>o</strong>(otros) y
<strong>a</strong>(todos). Es posible también juntar varias letras (por ejemplo,
<strong>ug</strong> significa usuario y grupo propietarios) o bien no expresar
ninguna, en cuyo último caso se usará la máscara para determinar el
efecto. Por ejemplo, si la máscara es <code class="docutils literal notranslate"><span class="pre">0022</span></code>, y se hace:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> chmod +w archivo
</pre></div>
</div>
<p>Se añadirá el permiso de escritura sólo al propierario, ya que
los permisos predeterminados sólo dan permisos de escritura a este.</p>
</li>
<li><p>Un signo que puede ser un <strong>=</strong>, si se quieren fijar los permisos que
se expresarán a continuación; un <strong>+</strong>, si se quieren añadir permisos
a los que hay ya fijados; y un <strong>-</strong>, si se quieren quitar permisos.</p></li>
<li><p>La expresión alfabética del permiso <strong>r</strong>, <strong>w</strong>o <strong>x</strong>. Se pueden
yuxtaponer varias letras si se quieren indicar varios permisos a la
vez. Por ejemplo, <strong>rw</strong> o <strong>wr</strong> significa que se quiere expresar los
permisos de lectura y escritura. Dejar en blanco esta parte implica
indicar ningún permiso.</p></li>
</ul>
<p>Ilustremos lo anterior:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> chmod <span class="nv">a</span><span class="o">=</span>rw archivo
<span class="go">-rw-rw-rw- 1 josem josem 0 oct 19 20:05 archivo</span>
<span class="gp">$</span> chmod <span class="nv">g</span><span class="o">=</span> archivo
<span class="go">-rw----rw- 1 josem josem 0 oct 19 20:05 archivo</span>
<span class="gp">$</span> chmod uo-w archivo
<span class="go">-r-----r-- 1 josem josem 0 oct 19 20:05 archivo</span>
<span class="gp">$</span> chmod u+w archivo
<span class="go">-rw----r-- 1 josem josem 0 oct 19 20:05 archivo</span>
</pre></div>
</div>
<p>También es posible escribir varias expresiones separadas por comas:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> chmod <span class="nv">u</span><span class="o">=</span>rw,g<span class="o">=</span>r,o<span class="o">=</span> archivo
<span class="go">-rw-r----- 1 josem josem 0 oct 19 20:05 archivo</span>
</pre></div>
</div>
<p>Para expresar los permisos especiales se usan las letras <code class="docutils literal notranslate"><span class="pre">s</span></code> y <code class="docutils literal notranslate"><span class="pre">t</span></code>
aplicadas a <code class="docutils literal notranslate"><span class="pre">u</span></code>, <code class="docutils literal notranslate"><span class="pre">g</span></code> o <code class="docutils literal notranslate"><span class="pre">o</span></code>, según convenga:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> chmod g+s,o<span class="o">=</span>xt archivo
<span class="go">-rw-r-S--t 1 josem josem 0 oct 19 20:05 archivo</span>
</pre></div>
</div>
<p>Como las dos órdenes anteriores, dispone de la opción <code class="docutils literal notranslate"><span class="pre">-R</span></code>.</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="atributos-extendidos">
<span id="ext4-xattr"></span><h2><span class="section-number">2.3.2.2. </span>Atributos extendidos<a class="headerlink" href="#atributos-extendidos" title="Enlazar permanentemente con este título">¶</a></h2>
<p><strong>ext4</strong> permite asignar a los archivos una serie de atributos que modifican
su comportamiento. No son en modo alguno permisos, aunque alguno de estos
atributos influye en la capacidad que tenemos para modificar o eliminar su
información. Para manipularlos es necesario ser administrador.</p>
<span class="target" id="lsattr"></span><dl id="index-4">
<dt><strong class="command">lsattr</strong></dt><dd><p>Sirve para comprobar cuáles son los atributos que tiene asignados el
archivo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> lsattr archivo
<span class="go">-------------e-- archivo</span>
</pre></div>
</div>
<p>Sólo tiene activo el atributo <code class="docutils literal notranslate"><span class="pre">e</span></code><a class="footnote-reference brackets" href="#id5" id="id2">2</a>.</p>
</dd>
</dl>
<span class="target" id="chattr"></span><dl id="index-5">
<dt><strong class="command">chattr</strong></dt><dd><p>Permite modificar el atributo con un signo <code class="docutils literal notranslate"><span class="pre">+</span></code> para activarlo y con un
signo menos para desactivarlo. Por ejemplo, para hacer inmutable el archivo
(lo cual implica que sea imborrable):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> chattr +i archivo
<span class="gp">#</span> lsaatr archivo
<span class="go">----i--------e-- archivo</span>
</pre></div>
</div>
<p>Hecho esto, será imposible alterar de forma alguna el archivo, incluso siendo
administrador:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> rm archivo
<span class="go">rm: no se puede borrar «archivo»: Operación no permitida</span>
<span class="gp">#</span> <span class="nb">echo</span> <span class="s2">&quot;GGGGG&quot;</span> &gt;&gt; archivo
<span class="go">-su: archivo: Permiso denegado</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="atributos-extendidos-de-usuario">
<span id="user-xattr"></span><h2><span class="section-number">2.3.2.3. </span>Atributos extendidos de usuario<a class="headerlink" href="#atributos-extendidos-de-usuario" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Los <em>atributos extendidos de usuario</em> tampoco tienen relación con permisos, pero
permiten asociar a un archivo atributos arbitrarios de texto con su respectivo
valor. Para poder utilizarlos es necesario haber instalado el paquete <em>attr</em> y
que el sistema de archivos haya sido montado con la opción user_xattr:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> grep xattr /proc/fs/ext4/sda1/options
<span class="go">user_xattr</span>
</pre></div>
</div>
<span class="target" id="attr"></span><dl id="index-6">
<dt><strong class="command">attr</strong></dt><dd><p>Para consultar y definir los atributos extendidos de usuarios puede usarse el
comando <strong class="command">attr</strong><a class="footnote-reference brackets" href="#id6" id="id3">3</a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> touch archivo
<span class="gp">$</span> attr -qs autor -V <span class="s2">&quot;Perico de los Palotes&quot;</span> archivo
<span class="gp">$</span> attr -qs desc -V <span class="s2">&quot;Un archivo vacio&quot;</span> archivo
</pre></div>
</div>
<p>Esto ha fijado dos atributos: <em>autor</em> y <em>desc</em> (de descripción). Los
atributos son arbitrarios, así que pueden usarse cualquier nombre. Podemos
consultados también con <strong class="command">attr</strong>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> attr -ql archivo
<span class="go">autor</span>
<span class="go">desc</span>
<span class="gp">$</span> attr -qg autor archivo
<span class="go">Perico de los Palotes</span>
</pre></div>
</div>
<p>También pueden borrarse atributos ya creados:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> attr -qr autor archivo
<span class="gp">$</span> attr -ql archivo
<span class="go">desc</span>
</pre></div>
</div>
</dd>
</dl>
<p id="getfattr"><span id="setfattr"></span>El paquete <em>attr</em> también incluye los programas <strong class="command">setfattr</strong> y
<strong class="command">getfattr</strong>, que permiten fijar, borrar y consultar permisos.</p>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Cuando se usan <strong class="command">setfattr</strong> y <strong class="command">getfattr</strong> a los nombres
de los atributos se les debe añadir el prefijo <em>user</em>: <em>user.autor</em>,
<em>user.desc</em>, etc.</p>
</div>
</div>
<div class="section" id="ejercicios-sobre-permisos">
<span id="ej-perm"></span><h2><span class="section-number">2.3.2.4. </span>Ejercicios sobre permisos<a class="headerlink" href="#ejercicios-sobre-permisos" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Es obligatorio usar el usuario sin privilegios si para hacer el
ejetcicio concreto no es necesario ser administrador.</p>
</div>
<ol class="arabic">
<li><p>Mejorar la privacidad de nuestro usuario para que
solamente él pueda ver los archivos contenidos en su espacio personal.</p></li>
<li><p>Volver a dejar el directorio personal como estaba y crear dentro un
subdirectorio al que no puedan acceder los usuarios que no pertenezca a mi
grupo principal.</p></li>
<li><p>Crear un directorio propiedad de <em>root</em> al que solo puedan acceder
los usuarios del grupo «netdev» (además del propio <em>root</em>).</p></li>
<li><p>Crear un directorio <code class="file docutils literal notranslate"><span class="pre">D</span></code>, dentro un fichero <code class="file docutils literal notranslate"><span class="pre">f</span></code> y permitir que
todos puedan ver el contenido del fichero <code class="file docutils literal notranslate"><span class="pre">f</span></code>, pero impedir que alguien
(incluido uno mismo) lo pueda borrar.</p></li>
<li><p>Cambiar el grupo del directorio <code class="file docutils literal notranslate"><span class="pre">D</span></code> a <em>plugdev</em>. ¿Es posible? ¿Y a
<em>disk</em>? ¿Por qué?</p></li>
<li><p>Hacer que de forma predeterminada cada vez que creo un archivo sólo yo pueda
leerlo.</p></li>
<li><p>Supongamos que creo el siguiente script en mi directorio personal:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>

rm /home/usuario -rf
</pre></div>
</div>
<p>Lo guardo con el nombre de <code class="file docutils literal notranslate"><span class="pre">limpiar.sh</span></code> en mi directorio personal y le
doy los siguientes permisos:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> chmod <span class="m">4755</span> limpiar.sh
</pre></div>
</div>
<p>¿Qué implicaciones tiene lo que he hecho?</p>
</li>
<li><p>Supongamos que creamos un directorio <code class="file docutils literal notranslate"><span class="pre">/srv/ftp</span></code> al que queremos
que todos los usuarios por <abbr title="File Transfer Protocol">FTP</abbr> puedan subir ficheros, pero no queremos que
unos usuarios borren o modifiquen lo que pertenecen a los demás, ¿qué podemos
hacer?</p></li>
<li><p>Tomando el caso anterior, supongamos que el directorio es para que
los estudiantes suban sus trabajos y los profesores puedan
corregirlos. En esta circunstancia, además, de que unos estudiantes
no puedan alterar o borrar los trabajos de los demás, queremos que
no se puedan copiar, ¿cómo lo logramos? Búsquense posibles soluciones</p></li>
<li><p>Supongamos que tengo un directorio llamado <code class="file docutils literal notranslate"><span class="pre">Fotos</span></code> cuyo contenido (incluido
subdirectorios) solo quiero que sea accesible por mi grupo de amigos. Para
ello, el administrador ha creado el grupo <em>amigos_usuario</em> y me ha metido
a mí y a mis amigos dentro. ¿Cómo lo hago?</p>
<ol class="loweralpha">
<li><p>Resuélvase de forma expeditiva (solución sencilla)</p></li>
<li><p>Resuélvase de forma que se pretenda dar envidia, es decir, los
usuarios que no son mis amigos. podrán ver que tengo fotos y cuáles
son («Viaje a las islas griegas», «Yo en Cancún»), pero no abrirlas.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>O sea, mire lo que ocurre en un sistema bien resuelto de esta
segunda forma::</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ls -l /tmp/Fotos
<span class="go">ls: no se puede acceder a &#39;/tmp/Fotos/MiFotoEnElCaribe.jpg&#39;: Permiso denegado</span>
<span class="go">ls: no se puede acceder a &#39;/tmp/Fotos/ZanganeandoEnMadagascar.jpg&#39;: Permiso denegado</span>
<span class="go">ls: no se puede acceder a &#39;/tmp/Fotos/EscalandoElHimalaya.jpg&#39;: Permiso denegado</span>
<span class="go">total 0</span>
<span class="go">-????????? ? ? ? ?            ? EscalandoElHimalaya.jpg</span>
<span class="go">-????????? ? ? ? ?            ? MiFotoEnElCaribe.jpg</span>
<span class="go">-????????? ? ? ? ?            ? ZanganeandoEnMadagascar.jpg</span>
</pre></div>
</div>
<p>Y si prueba a copiar alguna foto fuera del directorio, verá que es
imposible.</p>
</div>
</li>
</ol>
</li>
</ol>
</div>
<div class="section" id="ejercicios-sobre-usuarios-y-permisos">
<span id="ej-usu-perm"></span><h2><span class="section-number">2.3.2.5. </span>Ejercicios sobre usuarios y permisos<a class="headerlink" href="#ejercicios-sobre-usuarios-y-permisos" title="Enlazar permanentemente con este título">¶</a></h2>
<ol class="arabic">
<li><p>Crear un usuario llamado moises y obligarle a cambiar la contraseña en el
primer ingreso.</p></li>
<li><p>Evitar que cualquier otro usuario pueda espiar el directorio personal de
moises. ¿Puede hacer el propio moises?</p></li>
<li><p>Crear un usuario llamado «sara» cuyo grupo prinicpal sea «users». Comprobar,
además, que este grupo ya existe.</p></li>
<li><p>Crear un usuario del sistema (o sea, un usuario que no representan a una
persona física) llamado «ftp». Su directorio personal debe ser /srv/ftp.</p></li>
<li><p>Hacer que «sara» cree un subdirectorio dentro de su directorio personal
en el que otros usuarios puedan dejar ficheros, pero que unos usuarios no
puedan borrar los ficheros dejados por otro.</p></li>
<li><p>Crear con moises un directorio llamado «PRUEBA» dentro del directorio
temporal. Intente hacer con moises que el grupo propietario de este
directorio sea «www-data». ¿Es posible? Justifique la respuesta.</p></li>
<li><p>Impedir que «sara» pueda acceder al sistema.</p></li>
<li><p>Escriba en un fichero llamado «script.sh» el siguiente contenido:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>

<span class="nb">echo</span> <span class="s2">&quot;Hola, mundo!!!!&quot;</span>
</pre></div>
</div>
<ol class="loweralpha simple">
<li><p>Permita que se pueda ejecutar.</p></li>
<li><p>Ejecútelo.</p></li>
</ol>
</li>
<li><p>¿Cuál es el equivalente numérico a los permisos r-xrwxr-x?</p></li>
<li><p>¿Cuál es la máscara que debe definirse para que los ficheros de los usuarios
se creen con permisos rw——-?</p></li>
</ol>
<p class="rubric">Notas al pie</p>
<dl class="footnote brackets">
<dt class="label" id="id4"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Para entender bien cómo es esta operación binaria recuérdese que en
el número 666 cada cifra expresa una terna de permisos cada uno de
los cuales se representa con los números 4, 2 y 1. Es decir, que cada
cifra es la representación de un número de 3 bits. De modo que <strong>6</strong>
es, en realidad, <strong>110</strong> en binario.</p>
<p>Por esto mismo, si tenemos una máscara de <strong>022</strong>, su expresión en
binario es 000.010.010 y su negación <strong>~022</strong> es 111.101.101. Por
último, al hacer la operación <em>AND</em> sobre bits con <strong>666</strong> obtenemos
<span class="math notranslate nohighlight">\(110.110.110 \ \&amp;\  111.101.101 = 110.100.100\)</span>, esto es, <strong>644</strong>.</p>
<p>Si no nos queremos calentar la cabeza, simplemente nos vale con restar
en decimal. Para archivos obtendremos, <span class="math notranslate nohighlight">\(666 - 022 = 644\)</span> y, para
directorios, <span class="math notranslate nohighlight">\(777 - 022 = 755\)</span>.</p>
</dd>
<dt class="label" id="id5"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>Todos los atributos disponibles y su explicación correspondiente se
encuentran disponibles en la página de manual de <strong class="command">chattr</strong>.</p>
</dd>
<dt class="label" id="id6"><span class="brackets"><a class="fn-backref" href="#id3">3</a></span></dt>
<dd><p>El comando no viene instalado de serie, por lo que es necesario instalar
el paquete homónimo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> apt-get install attr
</pre></div>
</div>
</dd>
</dl>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Tabla de contenido</a></h3>
  <ul>
<li><a class="reference internal" href="#">2.3.2. Permisos y atributos</a><ul>
<li><a class="reference internal" href="#estandar-posix">2.3.2.1. Estándar <abbr title="Portable Operating System Interface for uniX">POSIX</abbr></a><ul>
<li><a class="reference internal" href="#permisos-habituales">2.3.2.1.1. Permisos habituales</a></li>
<li><a class="reference internal" href="#permisos-especiales">2.3.2.1.2. Permisos especiales</a></li>
<li><a class="reference internal" href="#mascara">2.3.2.1.3. Máscara</a></li>
<li><a class="reference internal" href="#manipulacion">2.3.2.1.4. Manipulación</a></li>
</ul>
</li>
<li><a class="reference internal" href="#atributos-extendidos">2.3.2.2. Atributos extendidos</a></li>
<li><a class="reference internal" href="#atributos-extendidos-de-usuario">2.3.2.3. Atributos extendidos de usuario</a></li>
<li><a class="reference internal" href="#ejercicios-sobre-permisos">2.3.2.4. Ejercicios sobre permisos</a></li>
<li><a class="reference internal" href="#ejercicios-sobre-usuarios-y-permisos">2.3.2.5. Ejercicios sobre usuarios y permisos</a></li>
</ul>
</li>
</ul>

  <h4>Tema anterior</h4>
  <p class="topless"><a href="05a.usuarios.html"
                        title="capítulo anterior"><span class="section-number">2.3.1. </span>Gestión de usuarios</a></p>
  <h4>Próximo tema</h4>
  <p class="topless"><a href="../06.conbas/index.html"
                        title="próximo capítulo"><span class="section-number">2.4. </span>Configuración básica</a></p>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/02.conbas/05.seguridad/05b.permisos.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Ir a" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="../06.conbas/index.html" title="2.4. Configuración básica"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="05a.usuarios.html" title="2.3.1. Gestión de usuarios"
             >anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" ><span class="section-number">2. </span>Conceptos básicos</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" ><span class="section-number">2.3. </span>Seguridad del sistema</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">2.3.2. </span>Permisos y atributos</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Derechos de autor CC BY 4.0, 2016-2021, José Miguel Sánchez Alés.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.4.3.
    </div>
  </body>
</html>