


<!DOCTYPE html>

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <title>2.7.3. Herramientas de manipulación &#8212; documentación de Linuxnomicón - rolling</title>
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/translations.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../search.html" />
    <link rel="next" title="2.7.4. Ejercicios aplicados de regex" href="04.ejercicios.html" />
    <link rel="prev" title="2.7.2. Herramientas de búsqueda" href="02.busqueda.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="04.ejercicios.html" title="2.7.4. Ejercicios aplicados de regex"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="02.busqueda.html" title="2.7.2. Herramientas de búsqueda"
             accesskey="P">anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" ><span class="section-number">2. </span>Conceptos básicos</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U"><span class="section-number">2.7. </span>Tratamiento de texto</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="herramientas-de-manipulacion">
<h1><span class="section-number">2.7.3. </span>Herramientas de manipulación<a class="headerlink" href="#herramientas-de-manipulacion" title="Enlazar permanentemente con este título">¶</a></h1>
<p>Se tratan ahora programas que permiten alterar un flujo de texto y obtener otro
modificado<a class="footnote-reference brackets" href="#id7" id="id1">1</a>.</p>
<span class="target" id="tr"></span><dl id="index-0">
<dt><strong class="command">tr</strong></dt><dd><p>Permite intercambiar (<strong>tr</strong>aducir) en un flujo de texto una serie de
caracteres por otros. A diferencia de otros comandos, no admite una argumento
que indique un fichero como origen del flujo, por lo que siempre lee de la
entrada estándar:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">tr [&lt;opciones&gt;] &lt;caracteres_originales&gt; [&lt;caracteres_nuevos&gt;]</span>
</pre></div>
</div>
<p>Un ejemplo simple es el siguiente:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;hola, caracola&quot;</span> <span class="p">|</span> tr <span class="s1">&#39;oa&#39;</span> <span class="s1">&#39;04&#39;</span>
<span class="go">h0l4, c4r4c0l4</span>
</pre></div>
</div>
<p>Como se ve sustituye un carácter de la primera cadena por su correspondiente
en la segunda. Ahora bien, si se incluye la opción <code class="docutils literal notranslate"><span class="pre">-d</span></code>, no es necesario
indicar la segunda ristra de caracteres, porque lo que hace es, simplemente,
eliminar los caracteres indicados:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;Pedro Sanchez&quot;</span> <span class="p">|</span> tr -d <span class="s1">&#39;aeiou&#39;</span>
<span class="go">Pdr Snchz</span>
</pre></div>
</div>
<p>Dado el uso que tiene, esta orden no utiliza expresiones regulares. Ahora
bien, sí permite indicar clases de caracteres, tal como se nombraron cuando
se dieron las regez <em>ERE</em>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;pansando a mayusculas&quot;</span> <span class="p">|</span> tr <span class="s1">&#39;[:lower:]&#39;</span> <span class="s1">&#39;[:upper:]&#39;</span>
<span class="go">PASANDO A MAYUSCULAS</span>
</pre></div>
</div>
<p>y también rangos:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;pansando a mayusculas&quot;</span> <span class="p">|</span> tr <span class="s1">&#39;a-z&#39;</span> <span class="s1">&#39;A-Z&#39;</span>
<span class="go">PASANDO A MAYUSCULAS</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>La implementación de <strong class="command">tr</strong> de que disponen los linux, no soporta
<em>utf-8</em>. Por este motivo, las letras acentuadas no tendrán un buen
tratamiento y veremos resoluciones absurdas como esta:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;ángel&quot;</span> <span class="p">|</span> tr <span class="s1">&#39;á&#39;</span> <span class="s1">&#39;a&#39;</span>
<span class="go">aangel</span>
</pre></div>
</div>
</div>
</dd>
</dl>
<span class="target" id="cut"></span><dl id="index-1">
<dt><strong class="command">cut</strong></dt><dd><p>Como su nombre indica, <strong class="command">cut</strong> permite seleccionar una parte de cada
una de las líneas que componen un fichero. Qué criterio se segurirá para
seleccionar qué interesa dependerá de qué opciones se le pasen. La sintaxis
general es:</p>
<blockquote>
<div><p>$ cut [&lt;opciones&gt;] [fichero1 [fichero2…]]</p>
</div></blockquote>
<p>Como en otros casos, no expresar fichero alguno supondrá que el flujo se
obtendrá de la entrada estándar.</p>
<p>Si lo que se pretende es seleccionar por posición, debemos usar la opción
<code class="docutils literal notranslate"><span class="pre">-c</span></code><a class="footnote-reference brackets" href="#id8" id="id2">2</a>. Por ejemplo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;1234567890&quot;</span> <span class="p">|</span> cut -c3-5
<span class="go">345</span>
</pre></div>
</div>
<p>Para expresar el rango, puede usarse como se ha hecho (<em>Inicio-Fin</em>), pero
tambíen indicando sólo el principio (<em>Inicio-</em>):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;1234567890&quot;</span> <span class="p">|</span> cut -c5-
<span class="go">567890</span>
</pre></div>
</div>
<p>o indicando sólo el final (<em>-Final</em>):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;1234567890&quot;</span> <span class="p">|</span> cut -c-5
<span class="go">12345</span>
</pre></div>
</div>
<p>Si expresamos sólo un número, entonces escogeremos exactamente ese carácter:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;1234567890&quot;</span> <span class="p">|</span> cut -c5
<span class="go">5</span>
</pre></div>
</div>
<p>También es posible seleccionar distintos rangos, separándolos por comas:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;1234567890&quot;</span> <span class="p">|</span> cut -c1-2,4,6-8
<span class="go">124678</span>
</pre></div>
</div>
<p>Si en cambio nos encontramos con líneas constituidas por campos a los que
separa un carácter delimitador, entonces la selección es mejor hacerla a
través de la opción <code class="docutils literal notranslate"><span class="pre">-d</span></code> que nos permite indicar el delimitador y <code class="docutils literal notranslate"><span class="pre">-f</span></code>
que nos pormite indicar qué campos queremos seleccionar. Si no se indica
delimitador, se sobrentiende que es la tabulación. Para expresar qué cambios
se usa exactamente la misma sintaxis que con la opción <code class="docutils literal notranslate"><span class="pre">-c</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;campo1,campo2,campo3&quot;</span> <span class="p">|</span> cut -d, -f2
<span class="go">campo2</span>
</pre></div>
</div>
<p>Un flujo que se presta enormemente al uso de <strong class="command">cut</strong> con este criterio
es el de definición de los usuarios o los grupos, cuyos campos están
separados por dos puntos:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> getent group <span class="p">|</span> cut -d: -f1
<span class="go">[... Nombres de todos los grupos que existen en el sistema ...]</span>
</pre></div>
</div>
<p>Cuando se usa este último criterio de selección, es conveniente saber que
añadir la opción <code class="docutils literal notranslate"><span class="pre">-s</span></code> excluye las líneas que no contienen el delimitador.</p>
</dd>
</dl>
<span class="target" id="sort"></span><dl id="index-2">
<dt><strong class="command">sort</strong></dt><dd><p>Ordena las líneas del flujo de datos entrante:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sort [&lt;opciones&gt;] [fichero1 [fichero2...]]</span>
</pre></div>
</div>
<p>Si se especifica un fichero o varios, se tomará como datos entrantes los
contenidos de los ficheros. Por ejemplo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sort /etc/passwd
</pre></div>
</div>
<p>Ordena los usuarios locales según el nombre que tengan, puesto que cada línea
de este fichero comienza con el nombre de un usuario (véase la <a class="reference internal" href="../05.seguridad/05a.usuarios.html#gesusu"><span class="std std-ref">gestión
de usuarios</span></a>). La ordenación de las líneas es alfabética. Si se
quiere usar una ordenación numérica, puede añadirse la opción <code class="docutils literal notranslate"><span class="pre">-n</span></code>.</p>
<p>Otra opción interesante es <code class="docutils literal notranslate"><span class="pre">-k</span></code> que permite indicar el campo<a class="footnote-reference brackets" href="#id9" id="id3">3</a> por el
que se desea ordenador y <code class="docutils literal notranslate"><span class="pre">-t</span></code> que permite indicar el caracter de separación
de campos, si éste no son espaciados:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sort -nk3 -t: /etc/passwd
</pre></div>
</div>
<p>En este caso, ordenamos por <em>UID</em>.</p>
</dd>
</dl>
<span class="target" id="uniq"></span><dl id="index-3">
<dt><strong class="command">uniq</strong></dt><dd><p>Elimina líneas repetidas del flujo de texto:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">uniq [&lt;opciones&gt;] [&lt;origen&gt; [&lt;destino&gt;]]</span>
</pre></div>
</div>
<p>Si no se especifica un origen se sobrentiende que este es la entrada
estándar. Si no se sobrentiende un destino, se mostrará el resultado en la
salida estándar.</p>
<p>Para que el comando identifique que las líneas son iguales es necesario que
sean consecutivas, por lo que suele usarse en conjunción con <strong class="command">sort</strong>
para que este las ordene primero. La siguiente orden muestra las <em>shells</em>
distintas que usan todos los usuarios definidos en el sistema:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> getent passwd <span class="p">|</span> egrep -o <span class="s1">&#39;[^:]+$&#39;</span> <span class="p">|</span> sort <span class="p">|</span> uniq
<span class="go">/bin/bash</span>
<span class="go">/bin/false</span>
<span class="go">/bin/sync</span>
<span class="go">/usr/sbin/nologin</span>
</pre></div>
</div>
</dd>
</dl>
<span class="target" id="sed"></span><dl id="index-4">
<dt><strong class="command">sed</strong></dt><dd><p><strong class="command">sed</strong> es el acrónimo de <em>Stream EDitor</em> (o sea, <em>editor de flujo</em>)
y es precisamente eso: un programa que recibe un flujo de de caracteres y es
capaz de alterarlo a través de las transformaciones que ordenemos. La
sintaxis es la siguiente:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sed <span class="o">[</span>opciones<span class="o">]</span> &lt;transformacion&gt; <span class="o">[</span>fichero<span class="o">]</span>
</pre></div>
</div>
<p>Básicamente, se proporciona una fuente de datos, esto es, un fichero o la entrada
estándar si no se especifica ninguno, y una cadena que define qué
transformación se quiere hacer. Es posible también añadir algunas opciones
que modifican la forma en que <strong class="command">sed</strong> se comporta. En cualquier caso
la que usaremos siempre es <code class="docutils literal notranslate"><span class="pre">-r</span></code> porque permite usar <em>regex</em> de tipo <em>ERE</em>,
en vez de <em>BRE</em>.</p>
<p>Es un programa que permite hacer transformaciones bastante complicadas y cuyo
manejo absoluto requiere bastante más que una pequeña reseña en unos apuntes.
Así que nos limitaremos a realizar modificaciones sencillas. Lo que es
imprescindible en cualquier caso es entender bién como funciona:</p>
<p><strong class="command">sed</strong> recibe el flujo de caracteres línea a linea y para cada línea
aplica la transformación o las transformaciones que se le hayan
ordenado; y así transformada es devuelta o no. Así continúa operando hasta
llegar a la última de las líneas<a class="footnote-reference brackets" href="#id10" id="id4">4</a>.</p>
<p>Empecemos por lo más sencillo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sed -r <span class="s1">&#39;&#39;</span> /etc/oasswd
<span class="go">[...  Contenido del fichero /etc/passwd ...]</span>
</pre></div>
</div>
<p>Como la trasnformación es no hacer nada, <strong class="command">sed</strong> no realiza ninguna
transformación, y devuelve exactamente las mismas líneas que recibió. La
consecuencia es que veremos en la pantalla el fichero original sin retocar.
Esto es así, porque de modo predeterminado <strong class="command">sed</strong> imprime la
transformada. Sin embargo, si añadimos la opción <code class="docutils literal notranslate"><span class="pre">-n</span></code>, pasará a no imprimir
a menos que explícitamente así que diga:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sed -nr <span class="s1">&#39;&#39;</span> /etc/passwd
</pre></div>
</div>
<p>No obtendremos absolutamente nada. Como podemos incluir en nuestra
transformación <code class="docutils literal notranslate"><span class="pre">p</span></code>, que significa imprimir, podría haber escrito:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sed -nr <span class="s1">&#39;p&#39;</span> /etc/passwd
<span class="go">[...  Contenido del fichero /etc/passwd ...]</span>
</pre></div>
</div>
<p>Y habríamos obtenido el mismo efecto que con la primera orden.</p>
<p>Una de las transformaciones más socorridas es modificar la línea del
siguiente modo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">s:&lt;regex&gt;:&lt;texto_modificado&gt;:[modificadores]</span>
</pre></div>
</div>
<p>Por ejemplo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sed -r <span class="s1">&#39;s:^:L.-:&#39;</span> /etc/passwd
<span class="go"> L.-root:x:0:0:root:/root:/bin/bash</span>
<span class="go"> [... Resto del fichero modificado ...]</span>
</pre></div>
</div>
<p>Añadirá al principio de línea los caracteres <kbd class="kbd docutils literal notranslate">L.-</kbd>. Las transformaciones
pueden ser todo lo complicadas que nos permitan las expresiones regulares.
Por ejemplo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sed -r <span class="s1">&#39;s:(\w+):#\1#:&#39;</span> /etc/passwd
<span class="gp">#</span>root#:x:0:0:root:/root:/bin/bash
<span class="go">[... Resto del fichero modificado ...]</span>
</pre></div>
</div>
<p>Como vemos hemos logrado rodear la primera palabra por dos almohadillas. Esto
se debe a quie la transformación consiste en capturar la palabra y
sustituirla por una almohadilla, seguida por la propia palabra y otra
almohadilla. Sin embargo no se han modificado el resto de palabras, esto es
debido a que la sustitución acaba cuando se logra hacer una vez. Si queremos
que la sustitución se repita a lo largo de toda la línea puede añadirse el
modificador <code class="docutils literal notranslate"><span class="pre">g</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sed -r <span class="s1">&#39;s:(\w+):#\1#:g&#39;</span> /etc/passwd
<span class="gp">#</span>root#:#x#:#0#:#0#:#root#:/#root#:/#bin#/#bash#
<span class="go">[... Resto del fichero modificado ...]</span>
</pre></div>
</div>
<p>Es posible realizar dos transformaciones sobre las líneas, separándolas por
un punto y coma:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sed -r <span class="s1">&#39;s:(\w+):#\1#: ; s:^:L.-:&#39;</span> /etc/passwd
<span class="go">L.-#root#:x:0:0:root:/root:/bin/bash</span>
<span class="go">[... Resto del fichero modificado ...]</span>
</pre></div>
</div>
<p>Sustituir no es la única acción que puede hacer <strong class="command">sed</strong>. También puede
borrar por completo la línea:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sed -r <span class="s1">&#39;d&#39;</span> /etc/passwd
</pre></div>
</div>
<p>Que no imprimirá nada, obviamente, puesto que antes de devolver la línea la
borramos. Esto resulta aparentemente inútil, pero no lo es, porque
<strong class="command">sed</strong> también permite indicar sobre qué líneas queremos realizar la
transformación<a class="footnote-reference brackets" href="#id11" id="id5">5</a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sed -r <span class="s1">&#39;1d&#39;</span> /etc/oasswd
<span class="go">[... Todo el fichero excepto la primera línea ...]</span>
<span class="gp">$</span> sed -r <span class="s1">&#39;$d&#39;</span> /etc/passwd
<span class="go">[... Todo el fichero excepto la última línea ...]</span>
<span class="gp">$</span> sed -r <span class="s1">&#39;1,5d&#39;</span> /etc/passwd
<span class="go">[... Todo el fichero excepto las cinco primeras líneas ...]</span>
</pre></div>
</div>
<p>Cuando lo que se quiere es realizar la acción sobre todas las línas menos
sobre las que se especifica, se añáde una exclamación:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sed -r <span class="s1">&#39;1!d&#39;</span> /etc/oasswd
<span class="go">[... Sólo la primera línea ...]</span>
<span class="gp">$</span> sed -r <span class="s1">&#39;$d&#39;</span> /etc/passwd
<span class="go">[... Sólo la última línea ...]</span>
<span class="gp">$</span> sed -r <span class="s1">&#39;1,5!d&#39;</span> /etc/passwd
<span class="go">[... Sólo las primeras cinco primeras líneas ...]</span>
</pre></div>
</div>
<p>Para seleccionar líneas también podemos usar expresiones regulares:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sed -r <span class="s1">&#39;/^u/d&#39;</span> /etc/passwd
<span class="go">[... No se muestran las líneas que empiezan por u ...]</span>
<span class="gp">$</span> sed -r <span class="s1">&#39;2,/^u/d&#39;</span> /etc/passwd
<span class="go">[... No se muestra desde la segunda líneas hasta la primera que empieza por u ...]</span>
</pre></div>
</div>
<p>Si se quiere realizar más de una transformación sobre una selección de líneas,
pueden usarse parántesis:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sed -r <span class="s1">&#39;1,5{s:^:P: ; s:$:F:}&#39;</span> /etc/passwd
<span class="go">[ ... Sólo entre las líneas 1 y 5 se realizan las sustituciones ...]</span>
</pre></div>
</div>
<p>Por último, otra acción que puede realizar es parar la edición antes de que
acabe el flujo. Para ello existe <code class="docutils literal notranslate"><span class="pre">q</span></code> y <code class="docutils literal notranslate"><span class="pre">Q</span></code>. La diferencia entre una y
otra es que <code class="docutils literal notranslate"><span class="pre">Q</span></code> acaba sin imprimir la línea pendiente:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sed -r <span class="s1">&#39;5q&#39;</span> /etc/passwd
<span class="go">[... Se imprimen las cinco primeras líneas ...]</span>
<span class="gp">$</span> sed -r <span class="s1">&#39;5Q&#39;</span> /etc/passwd
<span class="go">[... Se imprimen las cuatro primeras líneas ...]</span>
</pre></div>
</div>
</dd>
</dl>
<span class="target" id="awk"></span><dl id="index-5">
<dt><strong class="command">awk</strong><a class="footnote-reference brackets" href="#id12" id="id6">6</a></dt><dd><p>Al igual que <strong class="command">sed</strong> es un programa, cuyas capacidades exceden el
propósito de estos apuntes. De hecho, es un <a class="reference external" href="http://congresos.nnb.unam.mx/sites/default/files/TIB2014/manual_awk.pdf">lenguaje de programación completo</a>.
Nosotros, en cambio, le daremos un uso bastante limitado: lo utilizaremos
para tratar ficheros de texto cuyas líneas estén constituidas por campos y en
las que queramos realizar cambios. <strong class="command">cut</strong> con su opción <code class="docutils literal notranslate"><span class="pre">-f</span></code> sirve
para esto mismo, pero no nos permite hacer trasnformaciones en la línea. La
sintaxis más básica de <strong class="command">awk</strong> es la siguiente:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">awk [&lt;opciones&gt;] &lt;script-en-linea&gt; [fichero]</span>
</pre></div>
</div>
<p>Antes de continuar es pertinente advertir de que <em>debian</em> permite instalar
dos variantes de <strong class="command">awk</strong>: <strong class="command">mawk</strong>, que es la que viene
instalada por defecto, y es menos potente aunque más ligera; y
<strong class="command">gawk</strong>. La primera, al igual que pasa con <strong class="command">tr</strong> no soporta
<em>utf-8</em>.</p>
<p><strong class="command">awk</strong> opera igual que <strong class="command">sed</strong>: lee línea a línea y dentro de
cada una de ellas identifica los campos que existen. El delimitador es
cualquier carácter de espaciado (el propio espacio o la tabulacion), pero a
diferencia de <strong class="command">cut</strong>, los colapsa, de modo que si hay varios espacios
o tabuladores seguidos los considera como uno sólo. Con respecto a esto
define varias variables:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">NR</span></code></dt><dd><p>Es el número de registro, es decir el número de línea.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">NF</span></code></dt><dd><p>Es el número total de campos que tiene una línea.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">$0</span></code></dt><dd><p>Almacena el contenido de una línea.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">$1</span></code>, <code class="docutils literal notranslate"><span class="pre">$2</span></code>, … , etc.</dt><dd><p>Almacena el contenido de cada campo.</p>
</dd>
</dl>
<p>Además, podemos cambiar el delimitador añadiendo la opción <code class="docutils literal notranslate"><span class="pre">-F</span></code>. Así, por
ejemplo, para obtener los nombres de los grupos definidos en el sistema puede
hacerse lo siguiente:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> getent group <span class="p">|</span> awk -F: <span class="s1">&#39;{print $1}&#39;</span>
</pre></div>
</div>
<p>La acción que realicemos debe escribirse entre llaves y en caso de querer
hacer varias, todas estarán dentro de ellas y se separarán por un punto y
coma. En particular, hemos hecho <kbd class="kbd docutils literal notranslate">print $1</kbd> para imprimir (<code class="docutils literal notranslate"><span class="pre">print</span></code>) el
primer campo. Esta acción se puee usar de forma que juxtapongamos varios
argumentos:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> getent group <span class="p">|</span> awk -F: <span class="s1">&#39;{print NR &quot;: &quot; $1}&#39;</span>
<span class="go">1: root</span>
<span class="go">2: daemon</span>
<span class="go">[... Resto de grupos del sistema ...]</span>
</pre></div>
</div>
<p>También es posible separar los argumentos con comas. En este caso,
<strong class="command">awk</strong> interpondrá entre un argumento y otro el carácter que tenga
definido como separador de campos para la salida, que no tiene que coincidir
con el separador de campos para la entrada. El predeterminado es el espacio
de ahí que:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> getent group <span class="p">|</span> awk -F: <span class="s1">&#39;{print NR, $1}&#39;</span>
<span class="go">1 root</span>
<span class="go">2 daemon</span>
<span class="go">[... Resto de grupos del sistema ...]</span>
</pre></div>
</div>
<p>separa el número de registro de del primer campo con un espacio, a pesar de
que el caracter delimitador de entrada son los dos puntos. Tal delimitador de
salida se almacena en el valor de la variable <span class="var">OFS</span>, de modo que, si
cambiamos su valor, cambiará la salida:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> getent group <span class="p">|</span> awk -F: -v <span class="nv">OFS</span><span class="o">=</span><span class="s2">&quot;.- &quot;</span> <span class="s1">&#39;{print NR, $1}&#39;</span>
<span class="go">1.- root</span>
<span class="go">2.- daemon</span>
<span class="go">[... Resto de grupos del sistema ...]</span>
</pre></div>
</div>
<p><strong class="command">awk</strong> dispone de bastantes funciones que permiten alterar los
valores de las variables que se muestran, algunas de las cuales permiten
hacer sustituciones como las vistas con <strong class="command">sed</strong>. Basta consultar
un buen manual para conocerlas. Para ilustrar esto, podemos usar <code class="docutils literal notranslate"><span class="pre">toupper</span></code>
que pasa a mayúsculas:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> getent group <span class="p">|</span> awk -F: <span class="s1">&#39;{print NR, toupper($1) }&#39;</span>
<span class="go">1 ROOT</span>
<span class="go">2 DAEMON</span>
<span class="go">[... etc ...]</span>
</pre></div>
</div>
<p>Para culminar la ínfima aproximación a <strong class="command">awk</strong>, debe también
explicarse cómo filtrar líneas. Esto se logra anteponiendo una expresión
regular rodeada por barras:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> getent group <span class="p">|</span> awk -F: <span class="s1">&#39;/^[^r]/ {print NR, $1 }&#39;</span>
<span class="go">2 daemon</span>
<span class="go">3 bin</span>
<span class="go">[... etc ...]</span>
</pre></div>
</div>
<p>En este caso la expresión regular selecciona líneas que no comiencen con la
letras «<em>r</em>», de ahí que la primera línea no aparezca como resultado. Escrito
de esta forma, la expresión regular se aplica a toda la línea, esto es, al
valor de la variable <span class="var">$0</span>. Si se quiere filtrar sólo por el valor de un
campo, puede usarse la siguiente sintaxis:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> getent group <span class="p">|</span> awk -F: <span class="s1">&#39;$4 ~ /./ {print NR, $0 }&#39;</span>
<span class="go">5 adm:x:4:syslog,usuario</span>
<span class="go">18 cdrom:x:24:usuario</span>
<span class="go">21 sudo:x:27:usuario</span>
<span class="go">23 dip:x:30:usuario</span>
<span class="go">35 plugdev:x:46:usuario</span>
<span class="go">47 lpadmin:x:108:usuario</span>
<span class="go">58 sambashare:x:118:usuario</span>
</pre></div>
</div>
<p>En este caso, sólo hemos mostrado las líneas que contienen algo en el cuerto
campo. Como este, además, es el último, podríamos haberlo resuelto también
así:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> getent group <span class="p">|</span> awk -F: <span class="s1">&#39;$NF ~ /./ {print NR, $0 }&#39;</span>
<span class="go">[... Obtenemos la misma salida ...]</span>
</pre></div>
</div>
<p>por cuanto <span class="var">NF</span> vale <em>4</em> y <span class="var">$NF</span> equivale a <span class="var">$4</span>.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Para una información más sistemática consulte <a class="reference internal" href="../../03.scripts/06.misc/04.awk.html#awk-vademecum"><span class="std std-ref">awk en una línea</span></a>.</p>
</div>
</dd>
</dl>
<p class="rubric">Notas al pie</p>
<dl class="footnote brackets">
<dt class="label" id="id7"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>En puridad, ya <a class="reference internal" href="02.busqueda.html#grep"><span class="std std-ref">grep</span></a> y <a class="reference internal" href="02.busqueda.html#wc"><span class="std std-ref">wc</span></a> permiten esto: el
primero filtra líneas, por lo que se obtiene un flujo distinto y el segundo
convierte el flujo en una pequeña estadística sobre el mismo.</p>
</dd>
<dt class="label" id="id8"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>También existe la opción <code class="docutils literal notranslate"><span class="pre">-b</span></code> que selecciona por posición, pero en vez
de identificar <em>caracteres</em> identifica <em>bytes</em>. Recuérdese que hay sistemas
de codificación (y <em>UTF-8</em> está entre ellos) en que cada carácter no ocupa un
<em>byte</em> (repásese el ejemplo dado al explicar <a class="reference internal" href="#tr"><span class="std std-ref">tr</span></a>).</p>
</dd>
<dt class="label" id="id9"><span class="brackets"><a class="fn-backref" href="#id3">3</a></span></dt>
<dd><p>En realidad, <code class="docutils literal notranslate"><span class="pre">-k</span></code> escoger algo más complejo que un simple campo
(consulte <em class="manpage"><a class="manpage reference external" href="https://manpages.debian.org/sort(1)">sort(1)</a></em>). Por lo pronto permite escoger hasta dos campos
como criterio:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sort -nk4,3 /etc/passwd
</pre></div>
</div>
</dd>
<dt class="label" id="id10"><span class="brackets"><a class="fn-backref" href="#id4">4</a></span></dt>
<dd><p>Como ya se ha dicho <strong class="command">sed</strong> es bastante complejo. Este es su
comportamiento, pero permite leer la siguiente línea antes de haber acabado
de transformar la presente, o almacenar líneas transformadas y dejarlas
reservadas para devolverlas más tarde. No trataremos estas capacidades.</p>
</dd>
<dt class="label" id="id11"><span class="brackets"><a class="fn-backref" href="#id5">5</a></span></dt>
<dd><p>Para notar la última línea se usa el dólar. Ahora bien, aunque es posible
saber que se está en la última línea, es imposible conocer que es está en
la penúltima, es decir, expresiones como <kbd class="kbd docutils literal notranslate">$-1</kbd> no son válidas. Esto es
debido al modo en que actúa el programa: al ir leyendo línea a línea, es
incapaz de saber las líneas que aún le quedan por leer.</p>
</dd>
<dt class="label" id="id12"><span class="brackets"><a class="fn-backref" href="#id6">6</a></span></dt>
<dd><p>La versión de <strong class="command">awk</strong> instalada en <em>Debian</em> es <strong class="command">mawk</strong>.
Existe otra más potente pero más lenta, con el nombre de <em class="manpage"><a class="manpage reference external" href="https://manpages.debian.org/gawk">gawk</a></em></p>
</dd>
</dl>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Tema anterior</h4>
  <p class="topless"><a href="02.busqueda.html"
                        title="capítulo anterior"><span class="section-number">2.7.2. </span>Herramientas de búsqueda</a></p>
  <h4>Próximo tema</h4>
  <p class="topless"><a href="04.ejercicios.html"
                        title="próximo capítulo"><span class="section-number">2.7.4. </span>Ejercicios aplicados de regex</a></p>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/02.conbas/10.texto/03.manipulacion.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Ir a" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="04.ejercicios.html" title="2.7.4. Ejercicios aplicados de regex"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="02.busqueda.html" title="2.7.2. Herramientas de búsqueda"
             >anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" ><span class="section-number">2. </span>Conceptos básicos</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" ><span class="section-number">2.7. </span>Tratamiento de texto</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Derechos de autor CC BY 4.0, 2016-2020, José Miguel Sánchez Alés.
      Creado con <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.3.
    </div>
  </body>
</html>