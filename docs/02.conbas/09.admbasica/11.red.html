


<!DOCTYPE html>

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>2.7.4. Configuración de red &#8212; documentación de Linuxnomicón - rolling</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/classic.css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/translations.js"></script>
    
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../search.html" />
    <link rel="next" title="2.8. Tratamiento de texto" href="../10.texto/index.html" />
    <link rel="prev" title="2.7.3.2. Capacidades" href="10.priv/02.capabilities.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="../10.texto/index.html" title="2.8. Tratamiento de texto"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="10.priv/02.capabilities.html" title="2.7.3.2. Capacidades"
             accesskey="P">anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" ><span class="section-number">2. </span>Conceptos básicos</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U"><span class="section-number">2.7. </span>Administración básica</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">2.7.4. </span>Configuración de red</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="configuracion-de-red">
<span id="redminima"></span><h1><span class="section-number">2.7.4. </span>Configuración de red<a class="headerlink" href="#configuracion-de-red" title="Enlace permanente a este encabezado">¶</a></h1>
<p>Los sistemas <em>Linux</em> permiten una configuración amplísima de las interfaces de
red, y profundizar en ello requeriría un tratamiento muchísimo más amplio del
que aquí se mostrará. Bajo este epígrafe nos limitaremos a indicar cómo
hacer una configuración simple de las interfaces, tanto con herramientas
comunes a todas las distribuciones de <em>Linux</em> como con las herramientas que
provee <em>Debian</em>.</p>
<p>Tenga presente que los métodos de configuración son alternativos más  que
complementarios y, en consecuencia, <strong>no deben mezclarse</strong> (o al menos no deben
mezclarse para configurar una misma interfaz).  Por ese motivo, si una interfaz
está activa porque se usó la herramienta <a class="reference internal" href="#ifup"><span class="std std-ref">ifup</span></a> de <em>Debian</em>, sólo
debemos manipularña usando las herramientas generales, si previamente la
desactivamos usando <a class="reference internal" href="#ifdown"><span class="std std-ref">ifdown</span></a>.</p>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>El epígrafe está referido a interfaces de cable, que son las
habituales en servidores. Las interfaces inalámbricas son más engorrosas ya
que es común que cambien la red a la que están conectada con todo lo que ello
supone (cambio del <abbr title="Service Set IDentifier">SSID</abbr>, cambio de la
contraseña de acceso, etc.). Aunque es posible configurar estas interfaces
a través de la línea de órdenes y ficheros de configuración, lo más cómodo
(y recomendable) es usar herramientas más amigables e inmediatas como las que
se exponen en <a class="reference internal" href="#otros-conf-red"><span class="std std-ref">el epígrafe referente a otros modos de configuración</span></a>.</p>
</div>
<section id="interfaces-presentes">
<h2><span class="section-number">2.7.4.1. </span>Interfaces presentes<a class="headerlink" href="#interfaces-presentes" title="Enlace permanente a este encabezado">¶</a></h2>
<p>Antes de poner a configurar interfaces es indispensable saber qué interfaces hay
presentes en nuestro sistema. Para que el sistema registre una interfaz es
necesario que tal interfaz exista, pero también que haya un driver apropiado que
nos permita usarla.</p>
<p>Tradicionalmente, las interfaces ethernet cableadas se han venido llamando
<code class="docutils literal notranslate"><span class="pre">ethN</span></code> siendo <code class="docutils literal notranslate"><span class="pre">N</span></code> un número correlativo empezando en 0 (<em>eth0</em>, <em>eth1</em>,
etc.) y las interfaces inalámbricas <code class="docutils literal notranslate"><span class="pre">wlanN</span></code>. Con el advenimiento de
<a class="reference internal" href="../../04.servidor/03.init/index.html#systemd"><span class="std std-ref">systemd</span></a>, sin embargo, el nombre de las interfaces ha cambiado.
Ahora se usa un sistema de nombres que intenta evitar el que el núcleo cambie el
nombre de las interfaces al ser cambiar su número o hacerse sustituciones.</p>
<p>Para conocer cuáles son las interfaces presentes, basta con mirar dentro de
<code class="file docutils literal notranslate"><span class="pre">/sys/class/net</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ls<span class="w"> </span>/sys/class/net
<span class="go">eth0  lo</span>
</pre></div>
</div>
<p>También es posible obtener las interfaces a través del comando <a class="reference internal" href="#ip"><span class="std std-ref">ip</span></a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>ip<span class="w"> </span>link<span class="w"> </span>show
</pre></div>
</div>
</section>
<section id="configuracion">
<h2><span class="section-number">2.7.4.2. </span>Configuración<a class="headerlink" href="#configuracion" title="Enlace permanente a este encabezado">¶</a></h2>
<p>Para la configuración básica de la interfaz de red cableada presentaremos (muy
brevemente por ahora) tres alternativas:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#ifupdown"><span class="std std-ref">ifupdown</span></a>, que es el método tradicional para la configuración
de interfaces de red en <em>Debian</em> y sigue siendo el oficial<a class="footnote-reference brackets" href="#id7" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a></p></li>
<li><p>La <a class="reference internal" href="#net-univ"><span class="std std-ref">configuración directa</span></a> que sirve para manipular en caliente y
circunstancialmente las interfaces. Es interesante conocerla, aunque no sirva
como método permanente de configuración.</p></li>
<li><p><a class="reference internal" href="#systemd-networkd"><span class="std std-ref">systemd-networkd</span></a> que es la solución que facilita
<a class="reference internal" href="../../04.servidor/03.init/index.html#systemd"><span class="std std-ref">SystemD</span></a> y puede utilizarse en aquellas distribuciones que lo
usan como proceso <em>init</em>.</p></li>
</ul>
<section id="ifupdown">
<span id="id2"></span><h3><span class="section-number">2.7.4.2.1. </span>ifupdown<a class="headerlink" href="#ifupdown" title="Enlace permanente a este encabezado">¶</a></h3>
<p><em>Debian</em> gestiona sus interfaces preferentemente a través de los <em>scripts</em> que
proporciona el paquete <strong>ifupdown</strong>, los cuales consultan el contenido del
fichero <code class="file docutils literal notranslate"><span class="pre">/etc/network/interfaces</span></code><a class="footnote-reference brackets" href="#id8" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>. Por tanto, configurar las
interfaces de red mediante este método supone fundamentalmente:</p>
<ul class="simple">
<li><p>Saber cómo expresar la configuración de las interfaces dentro de
<code class="file docutils literal notranslate"><span class="pre">/etc/network/interfaces</span></code>.</p></li>
<li><p>Utilizar las herramientas de activación (<a class="reference internal" href="#ifup"><span class="std std-ref">ifup</span></a>)
y desactivación (<a class="reference internal" href="#ifdown"><span class="std std-ref">ifdown</span></a>).</p></li>
<li><p>Saber cómo definir los servidores <abbr title="Domain Name Server">DNS</abbr> para la resolución de nombres.</p></li>
</ul>
<p class="rubric">Herramientas</p>
<p>Las fundamentables son:</p>
<span class="target" id="ifup"></span><dl id="index-0">
<dt><strong class="command">ifup</strong></dt><dd><p>Permite activar la interfaz suministrada (puede pasarse varias) con la
configuración indicada en <code class="file docutils literal notranslate"><span class="pre">/etc/network/interfaces</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>ifup<span class="w"> </span>eth0
</pre></div>
</div>
<p>Es interesante la opción <code class="docutils literal notranslate"><span class="pre">-v</span></code> que muestra información adicional sobre el
proceso de activación.</p>
</dd>
</dl>
<span class="target" id="ifdown"></span><dl id="index-1">
<dt><strong class="command">ifdown</strong></dt><dd><p>Permite desactivar una interfaz previamente activada con <strong class="command">ifup</strong>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>ifdown<span class="w"> </span>eth0
</pre></div>
</div>
<p>Para que esto funcione la interfaz debió ser activada con <strong class="command">ifup</strong>. Si
se activó de cualquier otro modo, la interfaz no estará registrada como
activa, de modo que <strong class="command">ifdown</strong> no hará nada.</p>
<p>Puede también incluirse la opción <code class="docutils literal notranslate"><span class="pre">-v</span></code> y otra de interés es <code class="docutils literal notranslate"><span class="pre">--force</span></code> que
completa el proceso de desactivación incluso aunque se hayan producido
errores. Por ejemplo, porque se desactivara la interfaz de forma manual y,
cuando <strong class="command">ifdown</strong> intente desactivarla, se encuentre con que la
interfaz no tiene configuración.</p>
</dd>
</dl>
<span class="target" id="ifquery"></span><dl id="index-2">
<dt><strong class="command">ifquery</strong></dt><dd><p>Permite hacer consultas sobre las interfaces gestionadas. Lo más habitual
es preguntar por cuál es la configuración de una interfaz:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ifquery<span class="w"> </span>eth0
<span class="go">address: 192.168.4.20/24</span>
<span class="go">gateway: 192.168.4.253</span>
<span class="go">up: iptables -t nat -A POSTROUTING -o $IFACE -j MASQUERADE</span>
<span class="go">down: iptables -t nat -D POSTROUTING -o $IFACE -j MASQUERADE</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>La orden nos devuelve la configuración que se encuentra en
<code class="file docutils literal notranslate"><span class="pre">/etc/network/interfaces</span></code>, no la que realmente tenga la interfaz,
que pueden diferir, si se deshabilitó la interfaz con <a class="reference internal" href="#ifdown"><span class="std std-ref">ifdown</span></a> y se volvió a configurar de modo diferente con las
<a class="reference internal" href="#net-univ"><span class="std std-ref">herramientas generales</span></a>.</p>
</div>
<p>También puede usarse:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ifquery<span class="w"> </span>--state
<span class="go">lo=lo</span>
<span class="go">eth0=eth0</span>
</pre></div>
</div>
<p>que nos devolverá la interfaces activas a través de <strong class="command">ifup</strong>.</p>
</dd>
</dl>
<p class="rubric">Fichero de configuración</p>
<p>En realidad, el meollo de la configuración está en la escritura de
<code class="file docutils literal notranslate"><span class="pre">/etc/network/interfaces</span></code>. Mostremos un fichero con la interfaz de
<em>loopback</em>, una interfaz <em>eth0</em> configurada de forma dinámica y una interfaz
<em>eth1</em> configurada de forma estática:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>auto<span class="w"> </span>lo
iface<span class="w"> </span>lo<span class="w"> </span>inet<span class="w"> </span>loopback

<span class="c1"># Configuración dinámica (obsérvese dhcp)</span>
allow-hotplug<span class="w"> </span>eth0
iface<span class="w"> </span>eth0<span class="w"> </span>inet<span class="w"> </span>dhcp

<span class="c1"># Configuración estática (obsérvese static)</span>
allow-hotplug<span class="w"> </span>eth1
iface<span class="w"> </span>eth1<span class="w"> </span>inet<span class="w"> </span>static
<span class="w">   </span>address<span class="w"> </span><span class="m">192</span>.168.1.4/24
<span class="w">   </span>gateway<span class="w"> </span><span class="m">192</span>.168.1.1
</pre></div>
</div>
<p>La configuración es bastante elocuente. La segunda interfaz, al tener una
configuración estática, necesita algunos datos (<em>ip</em> y máscara, y puerta de
enlace). Obsérvese que no se incluyen los servidores <abbr title="Domain Name Service">DNS</abbr><a class="footnote-reference brackets" href="#id9" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>, porque estos no se expresan en este fichero, sino en
<code class="file docutils literal notranslate"><span class="pre">/etc/resolv.conf</span></code>.</p>
<p>Sí es pertinente aclarar por qué algunas interfaces van acompañadas de la
palabra <kbd class="kbd docutils literal notranslate">auto</kbd> y otras de la palabra <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">allow</kbd>-<kbd class="kbd docutils literal notranslate">hotplug</kbd></kbd>. Incluso podría
haber otras sin ninguna de esas dos líneas. En este último caso, la interfaz
no se activará durante el arranque y tendrá que ser el usuario quien manualmente
lo haga mediante <a class="reference internal" href="#ifup"><span class="std std-ref">ifup</span></a>. En cambio, una de esas dos dos líneas,
activa automáticamente en el arranque la interfaz, pero con un matiz diferente:
<kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">allow</kbd>-<kbd class="kbd docutils literal notranslate">hotplug</kbd></kbd> activa la interfaz si se detecta que esta existe y, si no
existe, no ocurrirá nada, mientras que <kbd class="kbd docutils literal notranslate">auto</kbd> intentará activar la interfaz
siempre y, si no existe, provocará un error visible. La regla general es que
<kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">allow</kbd>-<kbd class="kbd docutils literal notranslate">hotplug</kbd></kbd> se usa con interfaces físicas,  mientras que <kbd class="kbd docutils literal notranslate">auto</kbd> se
usa con interfaces virtuales que no existen previamente, sino que se crear al
ser activadas y que, por tanto, no pueden existir con anterioridad.</p>
<p>Es posible añadir también en la configuración de cada interfaz líneas que
comiencen con <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">pre</kbd>-<kbd class="kbd docutils literal notranslate">up</kbd></kbd>, <kbd class="kbd docutils literal notranslate">up</kbd>, <kbd class="kbd docutils literal notranslate">down</kbd> y <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">post</kbd>-<kbd class="kbd docutils literal notranslate">down</kbd></kbd>. Estas
líneas permiten ejecutar comandos arbitrarios justamente antes de activar la
interfaz, tras haberlo hecho, justamente antes de desactivarla o después de
haberlo hecho. Es bastante común el caso en que queremos añadir alguna regla en
el <a class="reference internal" href="../../08.redes/07.cortafuegos/index.html#firewall"><span class="std std-ref">cortafuegos</span></a> al levantar la interfaz y borrarla al
desactivarla:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">allow-hotplug eth0</span>
<span class="go">iface eth0 inet dhcp</span>
<span class="go">   pre-up    iptables -A POSTROUTING -o $IFACE -j MASQUERADE</span>
<span class="go">   post-down iptables -D POSTROUTING -o $IFACE -j MASQUERADE</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Si pretende cambiar la configuración de una interfaz, es muy
importante que antes de editar el fichero, la desactive con <a class="reference internal" href="#ifdown"><span class="std std-ref">ifdown</span></a>.  Esto es debido a que para desactivar una interfaz, este <em>script</em>
no atiende a cómo se configuró la interfaz, sino a cual es la configuración
escrita en el fichero en el momento de ejecutar <a class="reference internal" href="#ifdown"><span class="std std-ref">ifdown</span></a>. Por
eso, si al activarse la interfaz, la configuración era estática, los
<em>scripta</em> usarán internamente la orden <a class="reference internal" href="#ip"><span class="std std-ref">ip</span></a>. Si antes de
desactivaer la interfaz, modifica el fichero y vuelve la configuración
dinámica, al hacer <a class="reference internal" href="#ifdown"><span class="std std-ref">ifdown</span></a>. el <em>script</em> no desactivará la
interfaz con <a class="reference internal" href="#ip"><span class="std std-ref">ip</span></a>, sino que intentará usar internamente
<a class="reference internal" href="../../06.infraestructura/02.dhcp/02.tipos.html#dhclient"><span class="std std-ref">dhclient</span></a> y, obviamente, fallará.</p>
</div>
<p class="rubric">DNS</p>
<p>Queda, por último, tratar la configuración de los servidores <abbr title="Domain Name Service">DNS</abbr> en el fichero <code class="file docutils literal notranslate"><span class="pre">/etc/resolv.conf</span></code>. Si la configuración es
dinámica, el propio cliente <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> se encarga de escribir este fichero y no hay
que hacer ninguna configuración. En cambio, si la configuración es estática, sí
habrá que escribirlo o al menos cerciorarse que es válido. Se explicará
su contenido <a class="reference internal" href="#bas-resolv-conf"><span class="std std-ref">dentro del epígrafe siguiente</span></a>.</p>
<div class="admonition note" id="resolvconf">
<p class="admonition-title">Nota</p>
<p>Alternativamente se puede instalar y utilizar el programa
<em class="manpage"><a class="manpage reference external" href="https://manpages.debian.org/resolvconf">resolvconf</a></em> que se encarga de gestionar por nosotros el fichero
<code class="file docutils literal notranslate"><span class="pre">/etc/resolv.conf</span></code>. En este caso, no debe modificarse jamás a mano tal
fichero y cuando la configuración de la interfaz sea estática incluir en la
definición de la interfaz una línea que le indique a <strong class="program">resolvconf</strong>
cuáles son los servidores de nombres:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">allow-hotplug eth0</span>
<span class="go">iface eth0 inet static</span>
<span class="go">   address        192.168.1.4/24</span>
<span class="go">   gateway        192.168.1.1</span>
<span class="go">   dns-nameserver 1.1.1.1</span>
<span class="go">   dns-nameserver 1.0.0.1</span>
</pre></div>
</div>
</div>
</section>
<section id="metodo-universal">
<span id="net-univ"></span><h3><span class="section-number">2.7.4.2.2. </span>Método universal<a class="headerlink" href="#metodo-universal" title="Enlace permanente a este encabezado">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Recuerde que, para utilizar estas herramientas, debe cerciorarse
primero de que la interfaz no se activó mediante <a class="reference internal" href="#ifup"><span class="std std-ref">ifup</span></a>
y, si lo está, utilice <a class="reference internal" href="#ifdown"><span class="std std-ref">ifdown</span></a> antes de empezar.</p>
</div>
<section id="configuracion-dinamica">
<h4><span class="section-number">2.7.4.2.2.1. </span>Configuración dinámica<a class="headerlink" href="#configuracion-dinamica" title="Enlace permanente a este encabezado">¶</a></h4>
<p>El cliente más utilizado para la línea de órdenes es <a class="reference internal" href="../../06.infraestructura/02.dhcp/02.tipos.html#dhclient"><span class="std std-ref">dhclient</span></a>
que se encarga de configurar la interfaz y <a class="reference internal" href="#bas-resolv-conf"><span class="std std-ref">modificar los servidores</span></a>. Las acciones básicas son dos:</p>
<ol class="arabic">
<li><p>Configurar la interfaz (p.e. <em>eth0</em>):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>dhclient<span class="w"> </span>-v<span class="w"> </span>eth0
</pre></div>
</div>
</li>
<li><p>Desconfigurar la interfaz:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>dhclient<span class="w"> </span>-r<span class="w"> </span>eth0
</pre></div>
</div>
</li>
</ol>
<div class="admonition seealso">
<p class="admonition-title">Ver también</p>
<p>Para más información, consulte la <a class="reference internal" href="../../06.infraestructura/02.dhcp/02.tipos.html#dhcp-clients"><span class="std std-ref">sección dedicada a clientes
DHCP</span></a>.</p>
</div>
</section>
<section id="configuracion-manual">
<h4><span class="section-number">2.7.4.2.2.2. </span>Configuración manual<a class="headerlink" href="#configuracion-manual" title="Enlace permanente a este encabezado">¶</a></h4>
<p>Si la configuración es manual, debemos realizar tres labores:</p>
<ol class="arabic simple">
<li><p>Configurar los parámetros de red de la interfaz.</p></li>
<li><p>Añadir una entrada a la tabla de encaminamiento para indicar cuál es la
puerta de enlace.</p></li>
<li><p>Configurar los servidores <abbr title="Domain Name Server">DNS</abbr></p></li>
</ol>
<p>Así que supongamos que queremos fijar una dirección  <abbr title="Internet Protocol">IP</abbr>
<kbd class="kbd docutils literal notranslate">192.168.1.10/24</kbd>, la puerta de enlace es <kbd class="kbd docutils literal notranslate">192.168.1.1</kbd> y los
servidores <abbr title="Domain Name Server">DNS</abbr> <kbd class="kbd docutils literal notranslate">1.1.1.1</kbd> y <kbd class="kbd docutils literal notranslate">1.0.0.1</kbd>.</p>
<p>Para las dos primeras tareas, el comando apropiado es:</p>
<span class="target" id="ip"></span><dl id="index-3">
<dt><strong class="command">ip</strong></dt><dd><p>Permite la configuración de distintos aspectos relacionados con la red:
políticas de encaminamiento, parámetros de configuración de la interfaz, etc.
Tiene un modo de funcionamiento similar a los comandos disponibles en
sistemas <em>ios</em> de cisco.</p>
<p>Para configurar la interfaz basta con:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>ip<span class="w"> </span>addr<span class="w"> </span>add<span class="w"> </span><span class="m">192</span>.168.1.10/24<span class="w"> </span>dev<span class="w"> </span>eth0
</pre></div>
</div>
<p>y para activarla con tal configuración:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>ip<span class="w"> </span>link<span class="w"> </span><span class="nb">set</span><span class="w"> </span>dev<span class="w"> </span>eth0<span class="w"> </span>up
</pre></div>
</div>
<p>Esto habrá configurado la interfaz lo que puede comprobarse a través de:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ip<span class="w"> </span>addr<span class="w"> </span>show
<span class="go">[... Listado aquí ...]</span>
</pre></div>
</div>
<p>que muestra la configuración asignada y:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ip<span class="w"> </span>link<span class="w"> </span>show
<span class="go">[... Listado aquí ...]</span>
</pre></div>
</div>
<p>que muestra el estado de la interfaz. En este caso <code class="docutils literal notranslate"><span class="pre">UP</span></code> nos informa de que
la interfaz está activa y <code class="docutils literal notranslate"><span class="pre">LOWER_UP</span></code> de que tiene el cable conectado. En el
caso de estos últimos comandos es posible añadir <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">dev</kbd> <kbd class="kbd docutils literal notranslate">eth0</kbd></kbd> para obtener
información solamente de esta interfaz.</p>
<p>No obstante, aún es necesario añadir la entrada en la tabla de encaminamiento
para configurar la puerta predeterminada:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>ip<span class="w"> </span>route<span class="w"> </span>add<span class="w"> </span>default<span class="w"> </span>via<span class="w"> </span><span class="m">192</span>.168.1.1
</pre></div>
</div>
<p>Esta última orden provocará la adición de la entrada correspondiente:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ip<span class="w"> </span>route<span class="w"> </span>show
<span class="go">[... Listado aquí ...]</span>
</pre></div>
</div>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>En tutoriales antiguos de <em>Linux</em> podrá ver que estas órdenes se
hacen con <em class="manpage"><a class="manpage reference external" href="https://manpages.debian.org/ifconfig">ifconfig</a></em> y <em class="manpage"><a class="manpage reference external" href="https://manpages.debian.org/route">route</a></em>. Estas herramientas, sin
embargo, hace tiempo que se marcaron como obsoletas y, de hecho, no están
disponibles en <em>Debian</em> desde hace años. a menos que se instale expresamente
el paquete <strong>net-tools</strong>.</p>
</div>
<p class="rubric" id="bas-resolv-conf">DNS</p>
<p>En una configuración estática, es necesario definir los servidores <abbr title="Domain Name Server">DNS</abbr>, para
lo cual basta editar el fichero <code class="file docutils literal notranslate"><span class="pre">/etc/resolv.conf</span></code> e incluir las
siguientes líneas:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nameserver 1.0.0.1</span>
<span class="go">nameserver 1.1.1.1</span>
</pre></div>
</div>
</section>
</section>
<section id="systemd-networkd">
<span id="id5"></span><h3><span class="section-number">2.7.4.2.3. </span>systemd-networkd<a class="headerlink" href="#systemd-networkd" title="Enlace permanente a este encabezado">¶</a></h3>
<p><a class="reference internal" href="../../04.servidor/03.init/index.html#systemd"><span class="std std-ref">SystemD</span></a> (también) permite la gestión de interfaces de red
mediante el servicio <em class="manpage"><a class="manpage reference external" href="https://manpages.debian.org/systemd-networkd">systemd-networkd</a></em>, al que habría que sumar
<em class="manpage"><a class="manpage reference external" href="https://manpages.debian.org/systemd-resolved">systemd-resolved</a></em> si queremos también un <abbr title="Domain Name Server">DNS</abbr> caché. El método es
común a cualquier distribución que use este <em>init</em>, aunque como en el caso de
<em>Debian</em>, puede encontrarse desactivo.</p>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Evite que <a class="reference internal" href="#ifupdown"><span class="std std-ref">ifupdown</span></a> active las mismas interfaces
que piense gestionar con <strong class="program">systemd-networkd</strong>, para lo cual puede,
simplemente , evitar que arranquen automáticamente comentando las líneas que
contienen sus respectivas directivas <kbd class="kbd docutils literal notranslate">auto</kbd> o <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">allow</kbd>-<kbd class="kbd docutils literal notranslate">hotplug</kbd></kbd>.
También se puede desinstalar el paquete <em>ifupdown</em> y prescindir por completo
de su configuración.</p>
</div>
<p>La filosofía de este método es crear archivos de extensión <kbd class="kbd docutils literal notranslate">.network</kbd>
dentro del directorio <code class="file docutils literal notranslate"><span class="pre">/etc/systemd/network</span></code> cada uno de los cuales
configurará la red de una interfaz distinta.</p>
<div class="admonition seealso">
<p class="admonition-title">Ver también</p>
<p>En ese mismo directorio también puede haber archivos de extensión
<code class="file docutils literal notranslate"><span class="pre">.link</span></code> que permiten configurar las características de una interfaz
(nombre, velocidad, autonegociación, etc). Hay explicaciones adicionales en
el <a class="reference internal" href="../../08.redes/01.ifaces.html#ifaces"><span class="std std-ref">epígrafe dedicado a las interfaces de red</span></a>.</p>
</div>
<p>Los archivos se estructuran en una sección <kbd class="kbd docutils literal notranslate">[Match]</kbd> que permite definir a
cuál interfaz afecta la configuración y una o varias sección que definen tal
configuración.</p>
<p>Lo primero que debemos hacer es habilitar el servicio:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>systemd-networkd
<span class="gp"># </span>systemctl<span class="w"> </span>start<span class="w"> </span>systemd-networkd
</pre></div>
</div>
<p>y también el de resolución de nombres:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>systemd-resolved
<span class="gp"># </span>systemctl<span class="w"> </span>start<span class="w"> </span>systemd-resolved
<span class="gp"># </span>ln<span class="w"> </span>-sf<span class="w"> </span>/run/systemd/resolve/stub-resolv.conf<span class="w"> </span>/etc/resolv.conf
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>La edición de <code class="file docutils literal notranslate"><span class="pre">/etc/systemd/resolved.conf</span></code> permite definir unos
servidores <abbr title="Domain Name Server">DNS</abbr> genéricos que se usarán en caso de que no se definan
servidores particulares para las interfaces de red.</p>
</div>
<section id="id6">
<h4><span class="section-number">2.7.4.2.3.1. </span>Configuración dinámica<a class="headerlink" href="#id6" title="Enlace permanente a este encabezado">¶</a></h4>
<p>Basta con crear un archivo <code class="file docutils literal notranslate"><span class="pre">/etc/systemd/network/10-eth0.network</span></code>:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[Match]</span>
<span class="na">Name</span><span class="o">=</span><span class="s">eth0</span>

<span class="k">[Network]</span>
<span class="c1"># yes, para ipv4 e ipv6</span>
<span class="na">DHCP</span><span class="o">=</span><span class="s">ipv4</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>La expresión de la interfaz a la que afecta la configuración puede ser
mucho más rica. Por ejemplo, podríamos haber escrito:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[Match]</span>
<span class="na">Name</span><span class="o">=</span><span class="s">eth*</span>
</pre></div>
</div>
<p>que provocaría que todas las interfaces <em>ethernet</em> (supuesto que se llamen
así) estén configuradas por <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr>. También podríamos haber utilizado alguna
otra característica de la interfaz en vez del nombre, lo cual permitiría
cambiar el nombre de la interfaz, sin necesidad de redefinir este archivo:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[Match]</span>
<span class="na">Path</span><span class="o">=</span><span class="s">pci-0000:03:00.0</span>
</pre></div>
</div>
<p>Véase <a class="reference internal" href="../../08.redes/01.ifaces.html#ifaces"><span class="std std-ref">interfaces</span></a> para más información.</p>
</div>
<p>Una vez creado o modificado el archivo, deberemos recargar la configuración:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>networkctl<span class="w"> </span>reload
</pre></div>
</div>
<p>No es necesario especificar interfaz alguna, porque se recargarán las
configuraciones de todas las interfaces que hayan sufrido algún cambio. Si se
quiere activar o desactivar una interfaz individual, puede hacerse:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>networkctl<span class="w"> </span>down<span class="w"> </span>eth0
<span class="gp"># </span>networkctl<span class="w"> </span>up<span class="w"> </span>eth0
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Pero si no ha recargado antes, se aplicará la configuración antigua.</p>
</div>
<p>Para comprobar podemos consultar la configuración de la interfaz y de sus
servidores <abbr title="Domain Name Server">DNS</abbr>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>networkctl<span class="w"> </span>status<span class="w"> </span>eth0
<span class="gp">$ </span>resolvectl<span class="w"> </span>status<span class="w"> </span>eth0
</pre></div>
</div>
</section>
<section id="configuracion-estatica">
<h4><span class="section-number">2.7.4.2.3.2. </span>Configuración estática<a class="headerlink" href="#configuracion-estatica" title="Enlace permanente a este encabezado">¶</a></h4>
<p>Similar a la anterior, aunque habrá que ofrecer más información de
configuración:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[Match]</span>
<span class="na">Name</span><span class="o">=</span><span class="s">eth0</span>

<span class="k">[Network]</span>
<span class="na">Address</span><span class="o">=</span><span class="s">192.168.255.10/24</span>
<span class="na">Gateway</span><span class="o">=</span><span class="s">192.168.255.1</span>
<span class="na">DNS</span><span class="o">=</span><span class="s">1.1.1.1 1.0.0.1</span>
<span class="na">DNSOverTLS</span><span class="o">=</span><span class="s">opportunistic</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>La dos últimas líneas sobre <abbr title="Domain Name Server">DNS</abbr> no son necesarias si llegamos a
definir una configuración global en <code class="file docutils literal notranslate"><span class="pre">/etc/systemd/resolved.conf</span></code>.
Añadir esta configuración en la interfaz, provocará que se use tal
configuración para el tráfico propio de ella.  La segunda línea permite hacer
consultas cifradas, si el servidor <abbr title="Domain Name Server">DNS</abbr> las admite.</p>
</div>
</section>
</section>
<section id="otros-metodos">
<span id="otros-conf-red"></span><h3><span class="section-number">2.7.4.2.4. </span>Otros métodos<a class="headerlink" href="#otros-metodos" title="Enlace permanente a este encabezado">¶</a></h3>
<p>Existen otras aplicaciones para gestionar las interfaces de red:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://networkmanager.dev">NetworkManager</a>, usado principalmente en equipos de escritorio. Dispone de
buenos <em>frontends</em> gráficos (de hecho, su origen está en el <cite>proyecto GNOME
&lt;&gt;</cite>).</p></li>
<li><p><a class="reference external" href="https://netplan.io">netplan</a>, que no es un gestor independiente, sino un <em>frontend</em> para la
configuración de <a class="reference internal" href="#systemd-networkd"><span class="std std-ref">systemd-networkd</span></a> o <a class="reference external" href="https://networkmanager.dev">NetworkManager</a>, según lo que se
quiera usar por debajo. Lo utiliza <em>Ubuntu</em> desde su versión <em>18.04</em>.</p></li>
</ul>
</section>
<section id="ejercicios-sobre-redes">
<span id="ej-redmin"></span><h3><span class="section-number">2.7.4.2.5. </span>Ejercicios sobre redes<a class="headerlink" href="#ejercicios-sobre-redes" title="Enlace permanente a este encabezado">¶</a></h3>
<ol class="arabic simple">
<li><p>Desactivar la interfaz de red y configurar a través
de <code class="file docutils literal notranslate"><span class="pre">/etc/network/interfaces</span></code> una dirección estática
(use la que recibió dinámicamente antes para no generar
conflictos en la red).</p></li>
<li><p>Compruebe las interfaces activas y cuáles son las direcciones
<abbr title="Internet Protocol">IP</abbr> asociadas.</p></li>
<li><p>Sin usar <code class="file docutils literal notranslate"><span class="pre">/etc/network/interfaces</span></code>:</p>
<ol class="loweralpha simple">
<li><p>Activar de forma dinámica la red y, tras recibir la configuración,
desconfigurar la interfaz.</p></li>
<li><p>Activar la interfaz dándole una configuración estática (utilice
la misma dirección <abbr title="Internet Protocol">IP</abbr> que recibió dinámicamente antes)</p></li>
</ol>
</li>
<li><p>Instala una Lubuntu 18.04 en una máquina virtual</p></li>
<li><p>Configure la red dinámica y estáticamente usando la aplicación gráfica.</p></li>
</ol>
<p class="rubric">Notas al pie</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id7" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>A fecha de redacción, la estable es <em>Bullseye</em>.</p>
</aside>
<aside class="footnote brackets" id="id8" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">2</a><span class="fn-bracket">]</span></span>
<p>En realidad en el contenido de todo el directorio <code class="file docutils literal notranslate"><span class="pre">/etc/network</span></code>.</p>
</aside>
<aside class="footnote brackets" id="id9" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">3</a><span class="fn-bracket">]</span></span>
<p>Si se instala el paquete <em>resolvconf</em>, si pueden incluirse.</p>
</aside>
</aside>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../index.html">Tabla de contenido</a></h3>
    <ul>
<li><a class="reference internal" href="#">2.7.4. Configuración de red</a><ul>
<li><a class="reference internal" href="#interfaces-presentes">2.7.4.1. Interfaces presentes</a></li>
<li><a class="reference internal" href="#configuracion">2.7.4.2. Configuración</a><ul>
<li><a class="reference internal" href="#ifupdown">2.7.4.2.1. ifupdown</a></li>
<li><a class="reference internal" href="#metodo-universal">2.7.4.2.2. Método universal</a><ul>
<li><a class="reference internal" href="#configuracion-dinamica">2.7.4.2.2.1. Configuración dinámica</a></li>
<li><a class="reference internal" href="#configuracion-manual">2.7.4.2.2.2. Configuración manual</a></li>
</ul>
</li>
<li><a class="reference internal" href="#systemd-networkd">2.7.4.2.3. systemd-networkd</a><ul>
<li><a class="reference internal" href="#id6">2.7.4.2.3.1. Configuración dinámica</a></li>
<li><a class="reference internal" href="#configuracion-estatica">2.7.4.2.3.2. Configuración estática</a></li>
</ul>
</li>
<li><a class="reference internal" href="#otros-metodos">2.7.4.2.4. Otros métodos</a></li>
<li><a class="reference internal" href="#ejercicios-sobre-redes">2.7.4.2.5. Ejercicios sobre redes</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Tema anterior</h4>
    <p class="topless"><a href="10.priv/02.capabilities.html"
                          title="capítulo anterior"><span class="section-number">2.7.3.2. </span>Capacidades</a></p>
  </div>
  <div>
    <h4>Próximo tema</h4>
    <p class="topless"><a href="../10.texto/index.html"
                          title="próximo capítulo"><span class="section-number">2.8. </span>Tratamiento de texto</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/02.conbas/09.admbasica/11.red.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Ir a" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="../10.texto/index.html" title="2.8. Tratamiento de texto"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="10.priv/02.capabilities.html" title="2.7.3.2. Capacidades"
             >anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" ><span class="section-number">2. </span>Conceptos básicos</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" ><span class="section-number">2.7. </span>Administración básica</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">2.7.4. </span>Configuración de red</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Derechos de autor CC BY 4.0, 2016-2023, José Miguel Sánchez Alés.
      Creado usando <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>