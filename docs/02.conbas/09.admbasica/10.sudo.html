


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="es">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>2.6.4. sudo &#8212; documentación de Linuxnomicón - rolling</title>
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../search.html" />
    <link rel="next" title="2.6.5. Configuración de red" href="11.red.html" />
    <link rel="prev" title="2.6.3. Control de procesos" href="09.procesos.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="11.red.html" title="2.6.5. Configuración de red"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="09.procesos.html" title="2.6.3. Control de procesos"
             accesskey="P">anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >2. Conceptos básicos</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2.6. Administración básica</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <span class="target" id="sudo"></span><div class="section" id="index-0">
<span id="id1"></span><h1>2.6.4. sudo<a class="headerlink" href="#index-0" title="Enlazar permanentemente con este título">¶</a></h1>
<p>Ya se ha visto que una forma de que un usuario se convierta en otro (típicamente
en el administrador) es el comando <a class="reference internal" href="../05.seguridad/05a.usuarios.html#su"><span class="std std-ref">su</span></a>. Ahora bien, su uso tiene dos
inconvenientes:</p>
<ol class="arabic simple">
<li>Por un lado, si necesitamos que varios usuarios puedan convertirse en otro
particular, todos esos usuarios deberán conocer la contraseña; y una
contraseña compartida, es una contraseña poco segura.</li>
<li>Por otro, la conversión es total y al convertirse en el otro usuario,
adquieren todos los privilegios de éste. Por ejemplo, supongamos que
deseamos que un usuario sea capaz de configurar la red de forma manual.
Para ello, sólo necesita ser capaz de ejecutar el comando <a class="reference internal" href="11.red.html#ip"><span class="std std-ref">ip</span></a>
con permisos de administrador. <strong class="command">su</strong> no permite ser
restrictivo. así que para permitir que el usuario administre la red,
deberemos dejarle accedo absoluto a la cuenta de <em>root</em></li>
</ol>
<p><strong class="command">sudo</strong> viene a paliar estas deficiencias, ya que no exige conocer la
contraseña del usuario destino y, además, permite especificar aquellos comandos
que queremos que se puedan ejecutar con sus privilegios.</p>
<p>En <em>debian</em> no está inslado de inicio, así que:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> apt-get install sudo
</pre></div>
</div>
<p>La forma habitual de ejecutar <strong class="command">sudo</strong> es:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo &lt;comando&gt;</span>
</pre></div>
</div>
<p>Pero esto exige haber configurado primero el programa. Si ha sido así, se
comprobará que se permitió al usuario ejecutar tal programa como administrador<a class="footnote-reference" href="#id3" id="id2">[1]</a> y se pedirá la contraseña propia. Tras validarse, se ejecutará como
administrador la orden que se haya determinado y durante los siguiente cinco
minutos, <strong class="command">sudo</strong> almacenará en su caché que ya nos validamos, con lo que
podremos seguir ejecutando dentro de los siguientes cinco minutos comandos a
través de él, sin volver a introducir la contraseña. Si se quiere ampliar quince
minutos más este periodo, se puede hacer:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo -v
</pre></div>
</div>
<p>En cuanto a la configuración se encuentra bien en el fichero
<code class="file docutils literal notranslate"><span class="pre">/etc/sudores</span></code> bien en cualquier fichero dentro del directorio
<code class="file docutils literal notranslate"><span class="pre">/etc/sudoers.d</span></code>. Puede usarse un editor directamente para esta tarea,
pero es más conveniente a través de:</p>
<span class="target" id="visudo"></span><dl class="docutils" id="index-1">
<dt><strong class="command">visudo</strong></dt>
<dd><p class="first">Permite editar la configuración de <strong class="command">sudo</strong>. Sin argumentos:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> visudo
</pre></div>
</div>
<p>edita el fichero general <code class="file docutils literal notranslate"><span class="pre">/etc/sudoers</span></code>, de modo que si se quiere crear
un fichero específico dentro de <code class="file docutils literal notranslate"><span class="pre">/etc/sudoers.d</span></code>, debe expecificarse
con la opción <code class="docutils literal notranslate"><span class="pre">-f</span></code>:</p>
<div class="last highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> visudo -f /etc/sudoers.d/pruebas
</pre></div>
</div>
</dd>
</dl>
<p>Configurar <strong class="command">sudo</strong> implica básicamente conocer cuál es la sintaxis de
<em>sudoers</em>. Esta se basa en definir <em>alias</em>, opciones y <em>reglas de acceso</em>.
Trataremos lo primero y lo último:</p>
<dl class="docutils">
<dt><strong>Alias</strong></dt>
<dd><p class="first">Sirven para indentificar bajo un mismo nombre a grupos de usuarios, de
máquinas o de órdenes. Para la definición, pueden usarse otros alias
definidos anteriormente.</p>
<dl class="last docutils">
<dt><strong>Cmnd_Alias</strong></dt>
<dd><p class="first">Permite definir conjuntos de comandos:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Cmnd_Alias NETEXEC = /sbin/if*, /sbin/route, /sbin/ip</span>
</pre></div>
</div>
<p>Para separar unos de otros se usa la coma. Pueden usarse comodines y
también expresar argumentos que será obligatorio que escriba el usuario si
quiere poder ejecutar el comando a través de <strong class="command">sudo</strong>. Por
ejemplo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Cmnd_Alias NETEXEC = /sbin/if* eth*, /sbin/route</span>
</pre></div>
</div>
<p>Esto permitiría usar <code class="file docutils literal notranslate"><span class="pre">/sbin/ifup</span></code> o <code class="file docutils literal notranslate"><span class="pre">/sbin/ifdown</span></code> pero sólo
si justamente después hay un argumento que empieza por <code class="docutils literal notranslate"><span class="pre">eth</span></code>. Si es
otro, se denegará la ejecución.</p>
<p>Como ya se ha dicho, unos alias pueden usarse en la definición de otros,
así que esto mismo lo podíamos haber escrito del siguiente modo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Cmnd_Alias IFUPDOWN = /sbin/if* eth*</span>
<span class="go">Cmnd_Alias NETEXEC = IFUPDOWN, /sbin/route</span>
</pre></div>
</div>
<p>Es tambíen posible indicar explícitamente comandos que no queremos que se
puedan ejecutar anteponiendo una exclamación:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Cmnd_Alias IFUPDOWN = /sbin/if*, !/sbin/ifconfig</span>
</pre></div>
</div>
<p class="last">Existe el alias predefinido <code class="docutils literal notranslate"><span class="pre">ALL</span></code> que permite ejecutar cualquier cosa.</p>
</dd>
<dt><strong>User_Alias</strong></dt>
<dd><p class="first">Permite definir grupos de usuarios y grupos. Para incluir estos últimos en
la sentencia se les debe anteponer un <em>%</em>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">User_Alias COLEGUILLAS = pepe, paco, %amigospepe, %amigospaco</span>
</pre></div>
</div>
<p>También existe <code class="docutils literal notranslate"><span class="pre">ALL</span></code> para referirse, en este caso, a cualquier usuario;
y la posibilidad de anteponer una exclamación para excluir a un usuario:</p>
<div class="last highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">User_Alias CASTA = ALL, !apestado, !%parias</span>
</pre></div>
</div>
</dd>
<dt><strong>RunAs_Alias</strong></dt>
<dd><p class="first">Como el anterior, pero permite incluir también identificadores de usuario
en vez de nombres. Basta con anteponerles el carácter almohadilla:</p>
<div class="last highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">RunAs_Alias COLEGUILLAS = pepe, #1001</span>
</pre></div>
</div>
</dd>
<dt><strong>Host_Alias</strong></dt>
<dd><p class="first">Define conjuntos de máquinas desde las que se podrá ejecutar el comando a
través de <strong class="command">sudo</strong>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Host_Alias LAN = 172.22.0.0/16, 192.168.0.0/255.255.255.0, 192.168.1.1</span>
</pre></div>
</div>
<p class="last">Pueden usarse nombres también y el alias predefinido <code class="docutils literal notranslate"><span class="pre">ALL</span></code></p>
</dd>
</dl>
</dd>
<dt><strong>Reglas de acceso</strong></dt>
<dd><p class="first">Definen los permisos que se concede a los distintos usuarios. Tienen este
aspecto:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&lt;usuario&gt; &lt;maquina&gt; = [(&lt;poderdante&gt;)] &lt;comando1&gt;[, &lt;comando2&gt;, ...]</span>
</pre></div>
</div>
<ul class="simple">
<li>El <em>usuario</em> es un usuario, grupo o alias que hayamos definido. Es al que se
conceden el privilegio de usar los comandos mediante <strong class="command">su</strong>.</li>
<li>La <em>maquina</em> es la máquina (o alias) desde la que se podrá ejecutar
<strong class="command">sudo</strong>.</li>
<li>El <em>poderdante</em> es el usuario en nombre del cual se ejecutará el comando.
Si no se especifica se sobrentenderá que es <em>root</em>.</li>
<li>Por último se incluye la lista de comandos o alias.</li>
</ul>
<p>Por ejemplo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">COLEGUILLAS ALL = (root) NETEXEC</span>
</pre></div>
</div>
<p>Es posible incluir algunas opciones en las reglas. Una es <code class="docutils literal notranslate"><span class="pre">NOPASSWD</span></code> que
evita la petición de la contraseña:</p>
<div class="last highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">COLEGUILLAS ALL = (root) NOPASSWD: NETEXEC</span>
</pre></div>
</div>
</dd>
</dl>
<p>Por último, hay dos opciones interesantes cuando se ejecuta sudo. Una es <code class="docutils literal notranslate"><span class="pre">-l</span></code>
que le muestra al usuario qué comandos puede ejecutar a través de
<strong class="command">sudo</strong>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo -l
</pre></div>
</div>
<p>El otro es <code class="docutils literal notranslate"><span class="pre">-e</span></code> que permite editar ficheros, siempre que se haya incluido
alguna regla de acceso que permita al usuario ejecutar <strong class="command">sudoedit</strong>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">usuario ALL = sudoedit</span>
</pre></div>
</div>
<p>Esta línea permitiría a usuario editar cualquier fichero.</p>
<p class="rubric">Notas al pie</p>
<table class="docutils footnote" frame="void" id="id3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[1]</a></td><td>En realidad, sudo permite ejecutar comandos como otro usuario distinto al
administrador. Consúltese la página del manual.</td></tr>
</tbody>
</table>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Tema anterior</h4>
  <p class="topless"><a href="09.procesos.html"
                        title="capítulo anterior">2.6.3. Control de procesos</a></p>
  <h4>Próximo tema</h4>
  <p class="topless"><a href="11.red.html"
                        title="próximo capítulo">2.6.5. Configuración de red</a></p>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/02.conbas/09.admbasica/10.sudo.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Ir a" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="11.red.html" title="2.6.5. Configuración de red"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="09.procesos.html" title="2.6.3. Control de procesos"
             >anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >2. Conceptos básicos</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2.6. Administración básica</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Derechos de autor CC BY 4.0, 2016-2020, José Miguel Sánchez Alés.
      Creado con <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>