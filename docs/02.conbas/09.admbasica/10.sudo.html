


<!DOCTYPE html>

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2.6.4. Escalada de privilegios &#8212; documentación de Linuxnomicón - rolling</title>
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/translations.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../search.html" />
    <link rel="next" title="2.6.5. Configuración de red" href="11.red.html" />
    <link rel="prev" title="2.6.3. Control de procesos" href="09.procesos.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="11.red.html" title="2.6.5. Configuración de red"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="09.procesos.html" title="2.6.3. Control de procesos"
             accesskey="P">anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" ><span class="section-number">2. </span>Conceptos básicos</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U"><span class="section-number">2.6. </span>Administración básica</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">2.6.4. </span>Escalada de privilegios</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="escalada-de-privilegios">
<span id="escalar-priv"></span><h1><span class="section-number">2.6.4. </span>Escalada de privilegios<a class="headerlink" href="#escalada-de-privilegios" title="Enlazar permanentemente con este título">¶</a></h1>
<p>Como no debe usarse jamás el usuario administrador a menos que sea estrictamente
necesario, es habitual que el administrador se encuentre utilizando un usuario
sin privilegios y, en un momento determinado, requiera escalar privilegios y
convertirse en <em>root</em> para llevar a cabo la operación. Hay dos estrategias:</p>
<ul>
<li><p>Usar <a class="reference internal" href="../05.seguridad/05a.usuarios.html#su"><span class="std std-ref">su</span></a>, cuyo uso ya se describió:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> su -
</pre></div>
</div>
<p>Esta orden requiere la introducción de la contraseña de administrador<a class="footnote-reference brackets" href="#id4" id="id1">1</a>,
tras lo cual conseguiremos una sesión interactivos en la que nos convertiremos
en el administrador. La instalación básica de <em>Debian</em> está pensada para usar
esta orden.</p>
</li>
<li><p>Usar <a class="reference internal" href="#sudo"><span class="std std-ref">sudo</span></a>, que es la estrategia que han adoptado otras
distribuciones como <em>Ubuntu</em>, y a cuya configuración y uso dedicaremos el
resto del epígrafe.</p></li>
</ul>
<p>Ambas son herramientas válidas y no tiene por qué ser preferible el uso de una
sobre la otra, pero dependiendo del enfoque que han tomando los responsables de
las distribuciones, se ha preferido una y otra. Algunos criterios para
decantarse por la una o la otra son:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#sudo"><span class="std std-ref">sudo</span></a> requiere una configuración adicional. Las distribuciones
que optan por incorporar la herramienta por defecto se limitan a permitir que
el usuario sin privilegios que se crea durante la instalación no tenga
limitaciones en su uso y requiera la introducción de su propia contraseña.</p></li>
<li><p><a class="reference internal" href="#sudo"><span class="std std-ref">sudo</span></a> está pensada en principio para ejecutar una orden puntual,
pero recuerda durante un tiempo la contraseña introducida, por lo que en
ulteriores usos no vuelve a pedirla. Esto la presta a que pueda usarse para
ejecutar repetidamenete órdenes del administrador sin caer en el tedio de
tener que introducir constantemente la contraseña.</p></li>
<li><p>Como consecuencia directa de los anterior, puede usarse sin llegar a tener que
crear una sesión interactiva. Esto podrían verlo algunos como una ventaja, ya
que evita que el usuario accidentalmente deje abierta la sesión de
administrador.</p></li>
<li><p><a class="reference internal" href="#sudo"><span class="std std-ref">sudo</span></a> puede requerir la introducción de la propia contrasela del
usuario, en vez de la del adminsitrador. Si esto es así, la contraseña del
administrador no tiene utilidad y, en consecuencia, puede instalrse el sistema
dejando <em>root</em> sin contraseña válida. La consecuencia es que una persona jamás
podrá entrar en el sistema como administrador<a class="footnote-reference brackets" href="#id5" id="id2">2</a> y no tendrá la tentación
de <em>loguearse</em> siempre como administrador para evitar el tedio de no tener
permisos. Esta es la principal razón que aducen los defensores del uso de
<a class="reference internal" href="#sudo"><span class="std std-ref">sudo</span></a>.</p></li>
<li><p>Por otra parte, el uso ilimitado qe <a class="reference internal" href="#sudo"><span class="std std-ref">sudo</span></a> que se concede a un
usuario, provoca que si se obtiene la contraseña de éste, se haya obtenido el
acceso total al sistema.</p></li>
</ul>
<span class="target" id="sudo"></span><p id="index-0">El resto del epigrafe lo dedicaremos a describir cómo conbfigurar y usar
<strong class="program">sudo</strong>, porque aunque no viene instalado por defecto en <em>Debian</em> se
puede instalar:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> apt-get install sudo
</pre></div>
</div>
<p>La forma habitual de ejecutar <strong class="command">sudo</strong> es:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo &lt;comando&gt;</span>
</pre></div>
</div>
<p>Pero esto exige haber configurado primero el programa. Si ha sido así, se
comprobará que se permitió al usuario ejecutar tal programa como administrador<a class="footnote-reference brackets" href="#id6" id="id3">3</a> y se pedirá la contraseña propia. Tras validarse, se ejecutará como
administrador la orden que se haya determinado y durante los siguiente cinco
minutos, <strong class="command">sudo</strong> almacenará en su caché que ya nos validamos, con lo que
podremos seguir ejecutando dentro de los siguientes cinco minutos comandos a
través de él, sin volver a introducir la contraseña. Si se quiere ampliar quince
minutos más este periodo, se puede hacer:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo -v
</pre></div>
</div>
<p>En cuanto a la configuración se encuentra bien en el fichero
<code class="file docutils literal notranslate"><span class="pre">/etc/sudores</span></code> bien en cualquier fichero dentro del directorio
<code class="file docutils literal notranslate"><span class="pre">/etc/sudoers.d</span></code>. Puede usarse un editor directamente para esta tarea,
pero es más conveniente a través de:</p>
<span class="target" id="visudo"></span><dl id="index-1">
<dt><strong class="command">visudo</strong></dt><dd><p>Permite editar la configuración de <strong class="command">sudo</strong>. Sin argumentos:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> visudo
</pre></div>
</div>
<p>edita el fichero general <code class="file docutils literal notranslate"><span class="pre">/etc/sudoers</span></code>, de modo que si se quiere crear
un fichero específico dentro de <code class="file docutils literal notranslate"><span class="pre">/etc/sudoers.d</span></code>, debe expecificarse
con la opción <code class="docutils literal notranslate"><span class="pre">-f</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> visudo -f /etc/sudoers.d/pruebas
</pre></div>
</div>
</dd>
</dl>
<p>Configurar <strong class="command">sudo</strong> implica básicamente conocer cuál es la sintaxis de
<em>sudoers</em>. Esta se basa en definir <em>alias</em>, opciones y <em>reglas de acceso</em>.
Trataremos lo primero y lo último:</p>
<dl>
<dt><strong>Alias</strong></dt><dd><p>Sirven para indentificar bajo un mismo nombre a grupos de usuarios, de
máquinas o de órdenes. Para la definición, pueden usarse otros alias
definidos anteriormente.</p>
<dl>
<dt><strong>Cmnd_Alias</strong></dt><dd><p>Permite definir conjuntos de comandos:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Cmnd_Alias NETEXEC = /sbin/if*, /sbin/route, /sbin/ip</span>
</pre></div>
</div>
<p>Para separar unos de otros se usa la coma. Pueden usarse comodines y
también expresar argumentos que será obligatorio que escriba el usuario si
quiere poder ejecutar el comando a través de <strong class="command">sudo</strong>. Por
ejemplo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Cmnd_Alias NETEXEC = /sbin/if* eth*, /sbin/route</span>
</pre></div>
</div>
<p>Esto permitiría usar <code class="file docutils literal notranslate"><span class="pre">/sbin/ifup</span></code> o <code class="file docutils literal notranslate"><span class="pre">/sbin/ifdown</span></code> pero sólo
si justamente después hay un argumento que empieza por <code class="docutils literal notranslate"><span class="pre">eth</span></code>. Si es
otro, se denegará la ejecución.</p>
<p>Como ya se ha dicho, unos alias pueden usarse en la definición de otros,
así que esto mismo lo podíamos haber escrito del siguiente modo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Cmnd_Alias IFUPDOWN = /sbin/if* eth*</span>
<span class="go">Cmnd_Alias NETEXEC = IFUPDOWN, /sbin/route</span>
</pre></div>
</div>
<p>Es tambíen posible indicar explícitamente comandos que no queremos que se
puedan ejecutar anteponiendo una exclamación:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Cmnd_Alias IFUPDOWN = /sbin/if*, !/sbin/ifconfig</span>
</pre></div>
</div>
<p>Existe el alias predefinido <code class="docutils literal notranslate"><span class="pre">ALL</span></code> que permite ejecutar cualquier cosa.</p>
</dd>
<dt><strong>User_Alias</strong></dt><dd><p>Permite definir grupos de usuarios y grupos. Para incluir estos últimos en
la sentencia se les debe anteponer un <em>%</em>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">User_Alias COLEGUILLAS = pepe, paco, %amigospepe, %amigospaco</span>
</pre></div>
</div>
<p>También existe <code class="docutils literal notranslate"><span class="pre">ALL</span></code> para referirse, en este caso, a cualquier usuario;
y la posibilidad de anteponer una exclamación para excluir a un usuario:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">User_Alias CASTA = ALL, !apestado, !%parias</span>
</pre></div>
</div>
</dd>
<dt><strong>RunAs_Alias</strong></dt><dd><p>Como el anterior, pero permite incluir también identificadores de usuario
en vez de nombres. Basta con anteponerles el carácter almohadilla:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">RunAs_Alias COLEGUILLAS = pepe, #1001</span>
</pre></div>
</div>
</dd>
<dt><strong>Host_Alias</strong></dt><dd><p>Define conjuntos de máquinas desde las que se podrá ejecutar el comando a
través de <strong class="command">sudo</strong>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Host_Alias LAN = 172.22.0.0/16, 192.168.0.0/255.255.255.0, 192.168.1.1</span>
</pre></div>
</div>
<p>Pueden usarse nombres también y el alias predefinido <code class="docutils literal notranslate"><span class="pre">ALL</span></code></p>
</dd>
</dl>
</dd>
<dt><strong>Reglas de acceso</strong></dt><dd><p>Definen los permisos que se concede a los distintos usuarios. Tienen este
aspecto:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&lt;usuario&gt; &lt;maquina&gt; = [(&lt;poderdante&gt;)] &lt;comando1&gt;[, &lt;comando2&gt;, ...]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>El <em>usuario</em> es un usuario, grupo o alias que hayamos definido. Es al que se
conceden el privilegio de usar los comandos mediante <strong class="command">su</strong>.</p></li>
<li><p>La <em>maquina</em> es la máquina (o alias) desde la que se podrá ejecutar
<strong class="command">sudo</strong>.</p></li>
<li><p>El <em>poderdante</em> es el usuario en nombre del cual se ejecutará el comando.
Si no se especifica se sobrentenderá que es <em>root</em>.</p></li>
<li><p>Por último se incluye la lista de comandos o alias.</p></li>
</ul>
<p>Por ejemplo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">COLEGUILLAS ALL = (root) NETEXEC</span>
</pre></div>
</div>
<p>Es posible incluir algunas opciones en las reglas. Una es <code class="docutils literal notranslate"><span class="pre">NOPASSWD</span></code> que
evita la petición de la contraseña:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">COLEGUILLAS ALL = (root) NOPASSWD: NETEXEC</span>
</pre></div>
</div>
</dd>
</dl>
<p>Hay dos opciones interesantes cuando se ejecuta sudo. Una es <code class="docutils literal notranslate"><span class="pre">-l</span></code>
que le muestra al usuario qué comandos puede ejecutar a través de
<strong class="command">sudo</strong>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo -l
</pre></div>
</div>
<p>El otro es <code class="docutils literal notranslate"><span class="pre">-e</span></code> que permite editar ficheros, siempre que se haya incluido
alguna regla de acceso que permita al usuario ejecutar <strong class="command">sudoedit</strong>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">usuario ALL = sudoedit</span>
</pre></div>
</div>
<p>Esta línea permitiría a usuario editar cualquier fichero.</p>
<p>Por último, es posible también abrir sesiones interactivas con <strong class="command">sudo</strong>,
del mismo modo que se abrian con <a class="reference internal" href="../05.seguridad/05a.usuarios.html#su"><span class="std std-ref">su</span></a>.  Para ello podríamos hacer:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> sudo su -
</pre></div>
</div>
<p>o bien:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> sudo -i
</pre></div>
</div>
<p>La primera orden exige que hayamos proprocionados permisos para ejecutar
<a class="reference internal" href="../05.seguridad/05a.usuarios.html#su"><span class="std std-ref">su</span></a> con <strong class="command">sudo</strong>; y la segunda, permisos sobre la <em>shell</em>
interactiva que use el usuario <em>root</em> (típicamente <strong class="program">bash</strong>).</p>
<p class="rubric">Notas al pie</p>
<dl class="footnote brackets">
<dt class="label" id="id4"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>En realidad, <a class="reference internal" href="../05.seguridad/05a.usuarios.html#su"><span class="std std-ref">su</span></a> permite convertirse en cualquier otro
usuario:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> su - otro_usuario
</pre></div>
</div>
<p>para la cual se requerirá la contraseña de ese otro usuario (a menos que ya
seamos el administrador que cambiará de itentidad sin necesidad de contraseña
alguna).</p>
</dd>
<dt class="label" id="id5"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>A menos, claro está, que le configure una contraseña. Pero, en ese caso,
no estaremos hablando de un usuario despistado.</p>
</dd>
<dt class="label" id="id6"><span class="brackets"><a class="fn-backref" href="#id3">3</a></span></dt>
<dd><p>En realidad, sudo permite ejecutar comandos como otro usuario distinto al
administrador. Consúltese la página del manual.</p>
</dd>
</dl>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Tema anterior</h4>
  <p class="topless"><a href="09.procesos.html"
                        title="capítulo anterior"><span class="section-number">2.6.3. </span>Control de procesos</a></p>
  <h4>Próximo tema</h4>
  <p class="topless"><a href="11.red.html"
                        title="próximo capítulo"><span class="section-number">2.6.5. </span>Configuración de red</a></p>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/02.conbas/09.admbasica/10.sudo.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Ir a" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="11.red.html" title="2.6.5. Configuración de red"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="09.procesos.html" title="2.6.3. Control de procesos"
             >anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" ><span class="section-number">2. </span>Conceptos básicos</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" ><span class="section-number">2.6. </span>Administración básica</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">2.6.4. </span>Escalada de privilegios</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Derechos de autor CC BY 4.0, 2016-2020, José Miguel Sánchez Alés.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
  </body>
</html>