

<!DOCTYPE html>

<html lang="es" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>6.5. Impresión &#8212; documentación de Linuxnomicón - rolling</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/classic.css?v=def86cc0" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    
    <script src="../../_static/documentation_options.js?v=a621b78a"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/translations.js?v=d190bf04"></script>
    
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../search.html" />
    <link rel="next" title="7. Servicios de red" href="../../07.serre/index.html" />
    <link rel="prev" title="6.4.2.6. Impresión" href="../05.directorio/06.samba/06.print/index.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="../../07.serre/index.html" title="7. Servicios de red"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="../05.directorio/06.samba/06.print/index.html" title="6.4.2.6. Impresión"
             accesskey="P">anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U"><span class="section-number">6. </span>Servicios de infraestructura</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">6.5. </span>Impresión</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="impresion">
<span id="cups"></span><h1><span class="section-number">6.5. </span>Impresión<a class="headerlink" href="#impresion" title="Link to this heading">¶</a></h1>
<p>La impresión se lleva a cabo en los linux modernos gracias al servidor
<abbr title="Common Unix Printing System">CUPS</abbr>, y a una serie de drivers para las distintas impresoras en
formato <code class="docutils literal notranslate"><span class="pre">.ppd</span></code>.  De todo ello tratará el presente documento.</p>
<section id="configuracion-inicial">
<h2><span class="section-number">6.5.1. </span>Configuración inicial<a class="headerlink" href="#configuracion-inicial" title="Link to this heading">¶</a></h2>
<section id="instalacion">
<h3><span class="section-number">6.5.1.1. </span>Instalación<a class="headerlink" href="#instalacion" title="Link to this heading">¶</a></h3>
<p>La instalación básica es sencilla:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>apt-get<span class="w"> </span>install<span class="w"> </span>cups
</pre></div>
</div>
<p>ya que basta instalar <strong class="program">cups</strong>. Podemos también instalar una impresora
virtual PDF, por si deseamos realizar pruebas y no disponemos de impresora:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>apt-get<span class="w"> </span>install<span class="w"> </span>printer-driver-cups-pdf
</pre></div>
</div>
</section>
<section id="ficheros">
<h3><span class="section-number">6.5.1.2. </span>Ficheros<a class="headerlink" href="#ficheros" title="Link to this heading">¶</a></h3>
<p>La configuración del servidor se almacena bajo <code class="file docutils literal notranslate"><span class="pre">/etc/cups</span></code>. Tienen
especial relevancia:</p>
<ul class="simple">
<li><p><code class="file docutils literal notranslate"><span class="pre">cupsd.conf</span></code>, que es el fichero de configuración del servidor.</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">cupsd-printers.conf</span></code>, que es el fichero donde se almacenan las
impresoras configuradas.</p></li>
</ul>
<p>El segundo es recomendable no retocarlo a mano, sino a través de las
herramientas que proporciona <strong class="program">cups</strong>. En el primero pueden tocarse los
permisos para permitir que usen el servidor otras máquinas como clientes. Para
ello es necesario:</p>
<ol class="arabic">
<li><p>Sustituir la línea:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Listen localhost:631</span>
</pre></div>
</div>
<p>por la línea:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Port 631</span>
</pre></div>
</div>
</li>
<li><p>Permitir expresamente el acceso en las localizaciones <strong>/</strong>, <strong>/admin</strong> y
<strong>/admin/config</strong> con una línea del tipo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Allow from 192.168.1.0/24</span>
</pre></div>
</div>
<p>o semejante que permita el acceso a las redes que nos interesen.</p>
</li>
</ol>
</section>
<section id="permisos">
<h3><span class="section-number">6.5.1.3. </span>Permisos<a class="headerlink" href="#permisos" title="Link to this heading">¶</a></h3>
<p>En principio hay dos usuarios relacionados con la impresión:</p>
<ul class="simple">
<li><p><strong>lpadmin</strong>, que tiene permisos para la administración.</p></li>
<li><p><strong>lp</strong>, que tiene permisos para imprimir.</p></li>
</ul>
</section>
<section id="manejo">
<h3><span class="section-number">6.5.1.4. </span>Manejo<a class="headerlink" href="#manejo" title="Link to this heading">¶</a></h3>
<p>Hay dos formas de gestionar el servidor:</p>
<ol class="arabic simple">
<li><p>A través de su interfaz web que escucha en el puerto <strong>631</strong>.</p></li>
<li><p>Mediante la línea de comandos.</p></li>
</ol>
<p>La primera es bastante intuitiva y recomendable en la mayor parte de los casos,
así que trataremos aquí la segunda.</p>
</section>
</section>
<section id="administracion">
<h2><span class="section-number">6.5.2. </span>Administración<a class="headerlink" href="#administracion" title="Link to this heading">¶</a></h2>
<section id="impresoras">
<h3><span class="section-number">6.5.2.1. </span>Impresoras<a class="headerlink" href="#impresoras" title="Link to this heading">¶</a></h3>
<section id="busqueda">
<h4><span class="section-number">6.5.2.1.1. </span>Búsqueda<a class="headerlink" href="#busqueda" title="Link to this heading">¶</a></h4>
<p>Lo primero es localizar cuáles son las impresoras disponibles para ser añadidas
y cuáles son los drivers instalados en el sistema. Para lo primero<a class="footnote-reference brackets" href="#id9" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a><a class="footnote-reference brackets" href="#id10" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>lpinfo<span class="w"> </span>-v
<span class="go">network beh</span>
<span class="go">file cups-pdf:/</span>
<span class="go">network ipp</span>
<span class="go">network ipp14</span>
<span class="go">serial serial:/dev/ttyS0?baud=115200</span>
<span class="go">network http</span>
<span class="go">network https</span>
<span class="go">network ipps</span>
<span class="go">network lpd</span>
<span class="go">network socket</span>
<span class="go">network socket://172.16.1.241</span>
</pre></div>
</div>
<p>En este caso, hay disponibles la impresora virtual PDF.(gracias a la
instalación que ya hicimos de su driver)  La consulta de drives disponbles se
hace mediante otra opción:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>lpinfo<span class="w"> </span>-m
<span class="go">lsb/usr/cupsfilters/Fuji_Xerox-DocuPrint_CM305_df-PDF.ppd Fuji Xerox</span>
<span class="go">...</span>
</pre></div>
</div>
</section>
<section id="id3">
<h4><span class="section-number">6.5.2.1.2. </span>Instalación<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h4>
<p>Debe usarse <strong class="command">lpadmin</strong>. Por ejemplo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>lpadmin<span class="w"> </span>-p<span class="w"> </span>PDFVirtual<span class="w"> </span>-D<span class="w"> </span><span class="s2">&quot;Impresora PDF Virtual&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-L<span class="w"> </span><span class="s2">&quot;Ninguna&quot;</span><span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;cups-pdf:/&quot;</span><span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;lsb/usr/cups-pdf/CUPS-PDF.ppd&quot;</span>
</pre></div>
</div>
<p>esto añade la impresora virtual llamada <em>PDFVirtual</em> con una descripción
(opción <code class="docutils literal notranslate"><span class="pre">-D</span></code>) y  una localización (opción <code class="docutils literal notranslate"><span class="pre">-L</span></code>) asociada al dispositivo
dado con la opción <code class="docutils literal notranslate"><span class="pre">-v</span></code> y usando el driver de la opción <code class="docutils literal notranslate"><span class="pre">-m</span></code>. Los valores de
las últimas opciones se han tomado de las salidas correspondientes de
<strong class="command">lpinfo</strong>.</p>
<p>Una vez hecho esta. se habrá añadido la impresora y podremos verla al listar las
<strong>disponibles</strong>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>lpstat<span class="w"> </span>-p
<span class="go">la impresora PDF está inactiva.  activada desde dom 19 nov 2017 10:35:06 CET</span>
<span class="go">la impresora PDFVirtual está deshabilitada desde dom 19 nov 2017 11:52:41 CET</span>
</pre></div>
</div>
<p>La primera de ellas es la impresora virtual que se añade automáticamente al
instalar el paquete que driver. De hecho, nuestra acción ha sido totalmente
inútil, más allá de que sirva para ilustrar cómo agregar. Observemos que
nuestra impresora está deshabilitada. Para habilitarla es necesario<a class="footnote-reference brackets" href="#id11" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>lpadmin<span class="w"> </span>-p<span class="w"> </span>PDFVirtual<span class="w"> </span>-E
</pre></div>
</div>
<p>También es útil listar las impresoras para que nos diga no su estado, sino el
dispositivo al que están asociadas:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>lpstat<span class="w"> </span>-v
<span class="go">dispositivo para PDF: cups-pdf:/</span>
<span class="go">dispositivo para PDFVirtual: cups-pdf:/</span>
</pre></div>
</div>
<p>La opción <kbd class="kbd docutils literal notranslate">-s</kbd> devuelve la misma salida pero añadiendo cuál es la impresora
predeterminada:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>lpstat<span class="w"> </span>-s
<span class="go">destino predeterminado del sistema: PDF</span>
<span class="go">dispositivo para PDF: cups-pdf:/</span>
<span class="go">dispositivo para PDFVirtual: cups-pdf:/</span>
</pre></div>
</div>
<p>Si <strong class="program">cups</strong> no dispone del driver adecuado, pero podemos obtener el
fichero <code class="docutils literal notranslate"><span class="pre">.ppd</span></code>, es posible agregar la impresora con él:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>lpadmin<span class="w"> </span>-p<span class="w"> </span>RICOH<span class="w"> </span>-D<span class="w"> </span><span class="s2">&quot;RICOH Aficio MP 171&quot;</span><span class="w"> </span>-L<span class="w"> </span><span class="s2">&quot;Sala de Profesores&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-v<span class="w"> </span><span class="s2">&quot;socket://172.16.1.241&quot;</span><span class="w"> </span>-P<span class="w"> </span>/path/a/MP_171.ppd
</pre></div>
</div>
<p>Aunque este método no hará disponible el fichero para posteriores agregaciones.
Si queremos que el el archivo <code class="docutils literal notranslate"><span class="pre">.ppd</span></code> se agrege a loa driver disponibles, basta
con moverlo a <code class="file docutils literal notranslate"><span class="pre">/usr/share/cups/model/</span></code> y reiniciar el servidor:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>mv<span class="w"> </span>/path/a/MP_171.ppdf<span class="w"> </span>/usr/share/cups/model/
<span class="gp"># </span>invoke-rc.d<span class="w"> </span>cups<span class="w"> </span>restart
</pre></div>
</div>
<p>Hecho esto, el driver aparecerá en la salida de <code class="code docutils literal notranslate"><span class="pre">lpinfo</span> <span class="pre">-m</span></code> y se podrá
agregar la impresora usando la opción <code class="docutils literal notranslate"><span class="pre">-m</span></code>.</p>
</section>
<section id="gestion">
<h4><span class="section-number">6.5.2.1.3. </span>Gestión<a class="headerlink" href="#gestion" title="Link to this heading">¶</a></h4>
<p>Cuando hay varias impresoras, una de ellas es la predeterminada, esto es,
aquella sobre la que se realizará una determinada acción (p.e. imprimir), en
caso de que no se especifique sobre cuál. Podemos conocer cuál está definida
como tal:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>lpstat<span class="w"> </span>-d
<span class="go">destino predeterminado del sistema: PDFVirtual</span>
</pre></div>
</div>
<p>Para cambiarla basta<a class="footnote-reference brackets" href="#id12" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a> con usar <strong class="command">lpadmin</strong>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>lpadmin<span class="w"> </span>-d<span class="w"> </span>PDF
</pre></div>
</div>
<p>Para borrar una impresora, basta con usar la opción <code class="docutils literal notranslate"><span class="pre">-x</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>lpadmin<span class="w"> </span>-x<span class="w"> </span>PDFVirtual
</pre></div>
</div>
</section>
<section id="opciones">
<h4><span class="section-number">6.5.2.1.4. </span>Opciones<a class="headerlink" href="#opciones" title="Link to this heading">¶</a></h4>
<p>Las impresoras tienen una serie de opciones predeterminadas que pueden cambiarse
mediante la orden <strong class="command">lpoptions</strong>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>loptions<span class="w"> </span>-p<span class="w"> </span>RICOH
<span class="go">copies=1 device-uri=ipp://172.16.16.241/xxxx finishings=3</span>
<span class="go">job-cancel-after=10800 job-hold-until=no-hold job-priority=50</span>
<span class="go">job-sheets=none,none marker-change-time=0 number-up=1</span>
<span class="go">printer-commands=AutoConfigure,Clean,PrintSelfTestPage printer-info=&#39;RICOH</span>
<span class="go">Aficio MP 171&#39; printer-is-accepting-jobs=false printer-is-shared=true</span>
<span class="go">printer-location=&#39;Sala de Profesores&#39; printer-make-and-model=&#39;Ricoh Aficio MP</span>
<span class="go">171 PXL&#39; printer-state=3 printer-state-change-time=1511091934</span>
<span class="go">printer-state-reasons=none printer-type=8917204</span>
<span class="go">printer-uri-supported=ipp://localhost/printers/RICOH</span>
</pre></div>
</div>
<p>Sin más, muestra las opciones con la que está definida. Estas opciones pueden
alterarse (o añadirse otras) usando la opción <code class="docutils literal notranslate"><span class="pre">-o</span></code>. Ahora bien, también
podemos crear <em>instancias</em> de la impresora que contengan distintas opciones de
impresión. Por ejemplo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>lpoptions<span class="w"> </span>-p<span class="w"> </span>RICOH/doscaras<span class="w"> </span>-o<span class="w"> </span><span class="nv">sides</span><span class="o">=</span>two-sided-short-edge
</pre></div>
</div>
<p>De esta forma, lograremos otro perfil de impresión que incluye de forma
predeterminada la impresión a dos caras. De hecho, si comprobamos las impresoras
disponibles, ahora veremos esto:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>lpstat<span class="w"> </span>-p
<span class="go">la impresora PDF está inactiva.  activada desde dom 19 nov 2017 10:35:06 CET</span>
<span class="go">la impresora RICOH está inactiva.  activada desde dom 19 nov 2017 12:45:34 CET</span>
<span class="go">la impresora RICOH/doscaras está inactiva.  activada desde dom 19 nov 2017 12:45:34 CET</span>
</pre></div>
</div>
<p>Si lo que se desea es eliminar una opción puede usarse la opción <code class="docutils literal notranslate"><span class="pre">-r</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>lpoptions<span class="w"> </span>-p<span class="w"> </span>RICOH/doscaras<span class="w"> </span>-r<span class="w"> </span>sides
</pre></div>
</div>
<p>pero entonces nuestro perfiles de dos caras, imprimirá a una y será exactamente
igual que el perfil normal.</p>
<p>Hay un conjunto de opciones que son comunes a todos los drivers y que pueden
consultarse en <a class="reference external" href="https://www.cups.org/doc/options.html#OPTIONS">la documentación de cups</a> o en la página de manual de
<em class="manpage"><a class="manpage reference external" href="https://manpages.debian.org/cups-client/lp(1)">cups-client/lp(1)</a></em>. Otro conjunto, sin embargo, son <em>particulares</em> de cada
<em>driver</em>, pero pueden consultarse gracias a <strong class="command">lopoptions</strong>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>lpoptions<span class="w"> </span>-p<span class="w"> </span>RICOH<span class="w"> </span>-l
<span class="go">OptionTray/Option Tray: *NotInstalled 1Cassette 2Cassette</span>
<span class="go">ColorModel/Color Mode: *Grayscale</span>
<span class="go">Resolution/Resolution: *600dpi</span>
<span class="go">PageSize/PageSize: A4 A5 B5 Legal *Letter Statement F Folio ...</span>
<span class="go">InputSlot/InputSlot: MultiTray 1Tray 2Tray 3Tray *Auto</span>
<span class="go">Duplex/Duplex: *None DuplexNoTumble DuplexTumble</span>
<span class="go">Collate/Collate: *False True</span>
<span class="go">MediaType/Paper Type: *Auto Plain Recycled Special Colored Letterhead</span>
<span class="go">Preprinted Prepunched Labels Bond Cardstock OHP Thick</span>
<span class="go">RIPrintMode/Toner Saving: *0rhit 5rhit</span>
<span class="go">JobType/JobType: *Normal</span>
<span class="go">UserCode/User Code (up to 8 digits): *None 1001 1002 1003 Custom.PASSCODE</span>
</pre></div>
</div>
<p id="impr-predeterminada">Con <strong class="command">lpoptions</strong> también puede cambiarse la impresora predeterminada,
incluso a un perfil particular:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>lpoptions<span class="w"> </span>-d<span class="w"> </span>RICOH/doscaras
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Sin embargo, <strong class="command">lpadmin</strong> y <strong class="command">lpoptions</strong> no actúan
sobre la misma parte de la configuración (el primero altera
<code class="file docutils literal notranslate"><span class="pre">/etc/cups/printers.conf</span></code> y el segundo crea <code class="file docutils literal notranslate"><span class="pre">/etc/cups/lpoptions</span></code>)
y prevalece lo dispuesto por este segundo. Esto hace que si se ha usado
<strong class="command">lpoptions</strong> y se ha creado el segundo fichero, <strong class="command">lpadmin</strong>,
deje de tener efecto. Por tanto, es bastante más recomendable usar
<strong class="command">lpoptions</strong> siempre para este propósito.</p>
</div>
</section>
</section>
<section id="trabajos">
<h3><span class="section-number">6.5.2.2. </span>Trabajos<a class="headerlink" href="#trabajos" title="Link to this heading">¶</a></h3>
<section id="id6">
<h4><span class="section-number">6.5.2.2.1. </span>Impresión<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h4>
<p>Desde línea de comandos es muy sencillo imprimir directamente archivos de texto,
<em>postscript</em> o <abbr title="Portable Document Format">PDF</abbr>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>lp<span class="w"> </span>/etc/passwd
<span class="gp">$ </span>ls<span class="w"> </span>/usr/bin<span class="w"> </span><span class="p">|</span><span class="w"> </span>lp
<span class="gp">$ </span>lp<span class="w"> </span>certificado.pdf
</pre></div>
</div>
<p>Usado de este modo, imprimiremos en la impresora predeterminada con las opciones
predeterminadas. Si queremos imprimir algún otro tipo de fichero tendremos que
hacer una conversión previa a uno de estos tres tipos. Por ejemplo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>w3m<span class="w"> </span>-dump<span class="w"> </span>http://www.google.es<span class="w"> </span><span class="p">|</span><span class="w"> </span>lp
</pre></div>
</div>
<p>imprime la página principal de <a class="reference external" href="http://www.google.es">Google</a>, puesto que la
opción <code class="docutils literal notranslate"><span class="pre">-dump</span></code> hace una transformación a texto plano de la página<a class="footnote-reference brackets" href="#id13" id="id7" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a>.</p>
<p>Si se desea imprimir con otra impresora puede hacerse a través de la opción
<code class="docutils literal notranslate"><span class="pre">-d</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>lp<span class="w"> </span>-d<span class="w"> </span>RICOH<span class="w"> </span>certificado.pdf
<span class="gp">$ </span>lp<span class="w"> </span>-d<span class="w"> </span>RICOH/doscaras<span class="w"> </span>certificado.pdf
</pre></div>
</div>
<p>Para alterar las opciones predeterminadas de impresion, puede incluirse la
opción <code class="docutils literal notranslate"><span class="pre">-o</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>lp<span class="w"> </span>-d<span class="w"> </span>RICOH<span class="w"> </span>-o<span class="w"> </span><span class="nv">sides</span><span class="o">=</span>two-sided-short-edge<span class="w"> </span>certificado.pdf
</pre></div>
</div>
<p>Si se quiere redefinir varias opciones, se puede repetir la opción <code class="docutils literal notranslate"><span class="pre">-o</span></code>
o usar la misma y separar con un espacio:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>lp<span class="w"> </span>-d<span class="w"> </span>RICOH<span class="w"> </span>-o<span class="w"> </span><span class="nv">sides</span><span class="o">=</span>two-sided-short-edge<span class="w"> </span>-o<span class="w"> </span><span class="nv">media</span><span class="o">=</span>a4<span class="w"> </span>certificado.pdf
<span class="gp">$ </span>lp<span class="w"> </span>-d<span class="w"> </span>RICOH<span class="w"> </span>-o<span class="w"> </span><span class="s2">&quot;sides=two-sided-short-edge media=a4&quot;</span><span class="w"> </span>certificado.pdf
</pre></div>
</div>
<p>Para mandar varias copias a la impresora existe la opción <code class="docutils literal notranslate"><span class="pre">-n</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>lp<span class="w"> </span>-n2<span class="w"> </span>certificado.pdf
</pre></div>
</div>
</section>
<section id="gestion-de-colas">
<h4><span class="section-number">6.5.2.2.2. </span>Gestión de colas<a class="headerlink" href="#gestion-de-colas" title="Link to this heading">¶</a></h4>
<p>La consulta de los trabajos de impresión puede realizarse con
<strong class="command">lpstat</strong>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>lpstat
<span class="go">PDF-3                   usuario           2048   dom 19 nov 2017 17:59:35 CET</span>
<span class="go">PDF-4                   usuario           2048   dom 19 nov 2017 18:02:34 CET</span>
</pre></div>
</div>
<p>La orden muestra los trabajos pendientes y es equivalente a:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>lpstat<span class="w"> </span>-W<span class="w"> </span>not-completed
</pre></div>
</div>
<p>También pueden listarse los trabajos ya completados (<code class="docutils literal notranslate"><span class="pre">completed</span></code>) o ambos
(<code class="docutils literal notranslate"><span class="pre">all</span></code>). Se puede añadir la opción <code class="docutils literal notranslate"><span class="pre">-o</span></code> para sólo mostrar los trabajos de
una impresora. Por ejemplo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>lpstat<span class="w"> </span>-W<span class="w"> </span>all<span class="w"> </span>-o<span class="w"> </span>PDF
</pre></div>
</div>
<p>Cuando no se especifica usuario, se sobrentiende que los trabajos son los
propios del usuario que ejecuta la orden. Puede añadirse <code class="docutils literal notranslate"><span class="pre">-u</span></code> para mostrar los
de otros usuarios:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>lpstat<span class="w"> </span>-W<span class="w"> </span>all<span class="w"> </span>-o<span class="w"> </span>PDF<span class="w"> </span>-u<span class="w"> </span>usuario,root
</pre></div>
</div>
<p>Si lo queremos es cancelar trabajos de la cola antes de que la impresora los
cancele, podemos usar :command:<code class="docutils literal notranslate"><span class="pre">cancel</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cancel<span class="w"> </span>PDF-4
</pre></div>
</div>
<p>También se pueden cancelar todos los trabajos pendientes de un usuario:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cancel<span class="w"> </span>-u<span class="w"> </span>usuario
</pre></div>
</div>
<p>aunque sólo podremos cancelar los del usuario propio si no somos el
administrador. Este, además, puede limpiar por completo la cola de pendientes:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cancel<span class="w"> </span>-a
</pre></div>
</div>
</section>
</section>
</section>
<section id="comparticion">
<h2><span class="section-number">6.5.3. </span>Compartición<a class="headerlink" href="#comparticion" title="Link to this heading">¶</a></h2>
</section>
<section id="profundizacion">
<h2><span class="section-number">6.5.4. </span>Profundización<a class="headerlink" href="#profundizacion" title="Link to this heading">¶</a></h2>
<p>Las impresoras requieren recibir los datos para su impresión escritos en un
<abbr title="Printer Description Language">PDL</abbr>, esto es, un <a class="reference external" href="https://es.wikipedia.org/wiki/Lenguaje_de_descripci%C3%B3n_de_p%C3%A1ginas">lenguaje de descripción de páginas</a>,
como <abbr title="Printer Command Language">PCL</abbr> (cuya versión 6 suele referirse como <em>PXL</em>) o <a class="reference external" href="https://es.wikipedia.org/wiki/PostScript">PostScript</a>. Los programas (editores y
procesadores de texto, visores de <abbr title="Portable Document Format">PDF</abbr>, etc.), por su parte, generan una salida
hacia impresión <em>PostScript</em> junto a las opciones de impresión seleccionadass, que
recoge <strong class="program">cups</strong>. Este servidor de impresión, gracias a las reglas
contenidas en el driver <abbr title="PostScript Printer Description">PPD</abbr> se encarga de componer los datos que se envía a la
impresora oara lo cual:</p>
<ol class="arabic">
<li><p>Añade al comienzo de los datos las opciones de impresión mediante
instrucciones <abbr title="Printer Job Language">PJL</abbr>. Por ejemplo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">@PJL SET COPIES=2</span>
</pre></div>
</div>
<p>le indica a la impresora que debe sacar dos copias del documento, lo cual es
una traducción de la opción <code class="docutils literal notranslate"><span class="pre">-n</span></code> de <strong class="command">lp</strong>.</p>
</li>
<li><p>Tras la cabecera se incluye el documento en el <abbr title="Printer Description Language">PDL</abbr> que soporte la
impresora. Si este es <em>PostScript</em>, no será necesaria hacer ninguna
transformación. Si en cambio es otro, como <abbr title="Printer Command Language">PCL</abbr> (<em>PXL</em> en particular),
entonces el <abbr title="PostScript Printer Description">PPD</abbr> indicará a <strong class="program">cups</strong> que haga uso de <strong class="command">gs</strong>
(<em>ghostscript</em>), para llevar a cabo la transformación.</p></li>
</ol>
<p>Estas acciones que determina hacer el driver <abbr title="PostScript Printer Description">PPD</abbr> son las que se denominan
<em class="dfn">filtros</em>  y propician la creación del archivo final que se envía a la
impresora.</p>
<p class="rubric">tea4cups</p>
<p><a class="reference external" href="http://www.pykota.com/software/tea4cups">tea4cups</a> es un <em>wrapper</em> para los
drivers de <strong class="program">cups</strong>, que permite interceptar la orden de impresión
después de que se hayan aplicado los <em>filtros</em> del controlador <kbd class="kbd docutils literal notranslate">.ppd</kbd> y
antes de que el fichero sea enviado a la impresora.</p>
<p>El esquema de funcionamiento es el siguiente:</p>
<img alt="Esquema de funcionamiento de cups" src="../../_images/tea4cups.png" />
<p>Como puede verse, al actuar <strong class="program">tea4cups</strong>, el driver ya ha manipulado
sobre el fichero <em>postscript</em> que originariamente había enviado el servidor<a class="footnote-reference brackets" href="#id14" id="id8" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a>.</p>
<p><strong class="program">tea4cups</strong> proporciona tres herramientas para manipular la impresión:</p>
<ul class="simple">
<li><p><cite>filter</cite>, que es la primera que actúa y que únicamente permite alterar el
flujo de datos. Debe ser un programa que tome por la entrada estándar
los datos de impresión y devuelva por la salida estándar los datos
modificados de impresión. No hay más acceso que al contenido de los datos.</p></li>
<li><p><cite>prehook</cite>, ganchos que actúan a continuación del filtro anterior y antes de
que se envíen datos a la impresora. Hay disponibles algunas variables de
ambiente y si acaba con un error 255, cancela la impresión. Es útil para
hacer una manipulación de última hora sobre los datos que se mandan a la
impresora (el contenido del archivo <span class="var">$TEADATAFILE</span>).</p></li>
<li><p><cite>posthook</cite>, ganchos que actúan después de que se haya dado la orden de impresión.</p></li>
</ul>
<p>Para utilizar el programa son necesarias dos acciones:</p>
<ol class="arabic">
<li><p>Indicar qué impresora lo usará. Esto puede hacerse consultando cuál es el
dispositivo asociado a la impresora:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>lpstat<span class="w"> </span>-v<span class="w"> </span>RICOH
<span class="go">dispositivo para RICOH: socket://172.16.1.241</span>
</pre></div>
</div>
<p>y modificando su expresión, de modo que se preceda con el prefijo
«<kbd class="kbd docutils literal notranslate">tea4cups:</kbd>:»:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>lpadmin<span class="w"> </span>-p<span class="w"> </span>RICOH<span class="w"> </span>-v<span class="w"> </span><span class="s1">&#39;tea4cups:socket://172.16.1.241&#39;</span>
</pre></div>
</div>
</li>
<li><p>Incluir en el archivo de configuración <code class="file docutils literal notranslate"><span class="pre">/etc/cups/tea4cups.conf</span></code> qué
filtros y ganchos se desea utilizar (consulte el propio archivo para más
información). Por ejemplo, añadiendo las líneas:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">[RICOH]</span>
<span class="go">prehook_insertcode: /usr/local/bin/insertcode.sh</span>
</pre></div>
</div>
<p>donde el gancho es un <em>script</em> de la <em>shell</em> que hemos creado para manipular
los datos que se envían a la impresora <span class="var">$TEADATAFILE</span>.</p>
</li>
</ol>
<div class="admonition seealso">
<p class="admonition-title">Ver también</p>
<p>Para ilustrar su uso se facilita el script
<a class="reference download internal" download="" href="../../_downloads/a36fbbf1cef72d4dca27e1ca164e5a74/pedir_codigo.sh"><code class="xref download docutils literal notranslate"><span class="pre">pedir_codigo.sh</span></code></a> que:</p>
<ul class="simple">
<li><p>Instala <strong class="program">tea4cups</strong> en caso de no estar instalado en el sistema.</p></li>
<li><p>Instala, si es necesario, el gancho <code class="file docutils literal notranslate"><span class="pre">insercode.sh</span></code> que permite
introducir justo antes de la impresión el código de usuario con que se
configuran algunas impresoras para controlar las impresiones de sus
usuarios.</p></li>
<li><p>Permite seleccionar de entre las instaladas las impresoras con las que se
quiere usar <em>tea4cups</em> aplicando este gancho.</p></li>
</ul>
</div>
<p class="rubric">Notas al pie</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id9" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>Se muestra el uso del comando como administrador, pero bien podría ser
usando por otro usuario que perteneciera al grupo <strong>lpadmin</strong>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>/usr/sbin/lpinfo<span class="w"> </span>-v
</pre></div>
</div>
</aside>
<aside class="footnote brackets" id="id10" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>Si se usa además la opción <code class="docutils literal notranslate"><span class="pre">-l</span></code> (antes, no después de <code class="docutils literal notranslate"><span class="pre">-v</span></code>), no
sólo se listarán los dispositivos, sino también la identificación y
características del mismo (la misma información que obtiene la detección por
interfaz web y que le permite mostrar no sólo la conexión, sino también de
qué modelo de impresora se trata):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>lpinfo<span class="w"> </span>-l<span class="w"> </span>-v
</pre></div>
</div>
</aside>
<aside class="footnote brackets" id="id11" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">3</a><span class="fn-bracket">]</span></span>
<p>La <kbd class="kbd docutils literal notranslate">-E</kbd> debe situarse <strong>después</strong> de la opción <kbd class="kbd docutils literal notranslate">-p</kbd>, no antes;
y podría, además, haberse usado en la orden de instalación anterior.
También podríamos hacer:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>cupsenable<span class="w"> </span>PDFVirtual
<span class="gp"># </span>cupsaccept<span class="w"> </span>PDFVirtual
</pre></div>
</div>
</aside>
<aside class="footnote brackets" id="id12" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">4</a><span class="fn-bracket">]</span></span>
<p>… o no. Véase <a class="reference internal" href="#impr-predeterminada"><span class="std std-ref">qué pasa con lpoptions</span></a>.</p>
</aside>
<aside class="footnote brackets" id="id13" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id7">5</a><span class="fn-bracket">]</span></span>
<p>De hecho, si probáramos a pasarle el código <abbr title="HyperText Markup Language">HTML</abbr>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>wget<span class="w"> </span>-qO<span class="w"> </span>-<span class="w"> </span>http://www.google.es<span class="w"> </span><span class="p">|</span><span class="w"> </span>lp
</pre></div>
</div>
<p>lo que obtendríamos es la impresión del código fuente.</p>
</aside>
<aside class="footnote brackets" id="id14" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id8">6</a><span class="fn-bracket">]</span></span>
<p>El fichero a imprimir se almacena en <code class="file docutils literal notranslate"><span class="pre">/var/spool/cups/</span></code> y su nombre
completo se almacena en la variable <em>TEADATAFILE</em>. Hay otra variable
llamada <em>TEAINPUTFILE</em> que contiene el nombre del fichero original, pero
no en todos los drivers está disponible.</p>
</aside>
</aside>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../index.html">Tabla de contenido</a></h3>
    <ul>
<li><a class="reference internal" href="#">6.5. Impresión</a><ul>
<li><a class="reference internal" href="#configuracion-inicial">6.5.1. Configuración inicial</a><ul>
<li><a class="reference internal" href="#instalacion">6.5.1.1. Instalación</a></li>
<li><a class="reference internal" href="#ficheros">6.5.1.2. Ficheros</a></li>
<li><a class="reference internal" href="#permisos">6.5.1.3. Permisos</a></li>
<li><a class="reference internal" href="#manejo">6.5.1.4. Manejo</a></li>
</ul>
</li>
<li><a class="reference internal" href="#administracion">6.5.2. Administración</a><ul>
<li><a class="reference internal" href="#impresoras">6.5.2.1. Impresoras</a><ul>
<li><a class="reference internal" href="#busqueda">6.5.2.1.1. Búsqueda</a></li>
<li><a class="reference internal" href="#id3">6.5.2.1.2. Instalación</a></li>
<li><a class="reference internal" href="#gestion">6.5.2.1.3. Gestión</a></li>
<li><a class="reference internal" href="#opciones">6.5.2.1.4. Opciones</a></li>
</ul>
</li>
<li><a class="reference internal" href="#trabajos">6.5.2.2. Trabajos</a><ul>
<li><a class="reference internal" href="#id6">6.5.2.2.1. Impresión</a></li>
<li><a class="reference internal" href="#gestion-de-colas">6.5.2.2.2. Gestión de colas</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#comparticion">6.5.3. Compartición</a></li>
<li><a class="reference internal" href="#profundizacion">6.5.4. Profundización</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Tema anterior</h4>
    <p class="topless"><a href="../05.directorio/06.samba/06.print/index.html"
                          title="capítulo anterior"><span class="section-number">6.4.2.6. </span>Impresión</a></p>
  </div>
  <div>
    <h4>Próximo tema</h4>
    <p class="topless"><a href="../../07.serre/index.html"
                          title="próximo capítulo"><span class="section-number">7. </span>Servicios de red</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/06.infraestructura/10.impresion/index.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Ir a" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="../../07.serre/index.html" title="7. Servicios de red"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="../05.directorio/06.samba/06.print/index.html" title="6.4.2.6. Impresión"
             >anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" ><span class="section-number">6. </span>Servicios de infraestructura</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">6.5. </span>Impresión</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright CC BY 4.0, 2016-2024, José Miguel Sánchez Alés.
      Creado usando <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    </div>
  </body>
</html>