

<!DOCTYPE html>

<html lang="es" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>6.2.3. bind &#8212; documentación de Linuxnomicón - rolling</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="../../_static/classic.css?v=514cf933" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    
    <script src="../../_static/documentation_options.js?v=a621b78a"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/translations.js?v=efdbd0b9"></script>
    
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../search.html" />
    <link rel="next" title="6.2.4. dnsmasq" href="04.dnsmasq.html" />
    <link rel="prev" title="6.2.2. Clientes" href="02.clientes.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="04.dnsmasq.html" title="6.2.4. dnsmasq"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="02.clientes.html" title="6.2.2. Clientes"
             accesskey="P">anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" ><span class="section-number">6. </span>Servicios de infraestructura</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U"><span class="section-number">6.2. </span>DNS</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">6.2.3. </span><strong class="program">bind</strong></a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="bind">
<span id="id1"></span><h1><span class="section-number">6.2.3. </span><strong class="program">bind</strong><a class="headerlink" href="#bind" title="Link to this heading">¶</a></h1>
<p>El servidor <strong class="program">bind</strong> es el estándar de facto para el servicio <abbr title="Domain Name Server">DNS</abbr>. Está patrocinado por el <abbr title="Internet Systems Consortium">ISC</abbr> y permite hacer configuraciones complejas</p>
<section id="preliminares">
<span id="bind-inst"></span><h2><span class="section-number">6.2.3.1. </span>Preliminares<a class="headerlink" href="#preliminares" title="Link to this heading">¶</a></h2>
<p>Antes de meternos de lleno en la configuración de zonas, es preciso instalar y preparar el servidor.</p>
<section id="instalacion">
<h3><span class="section-number">6.2.3.1.1. </span>Instalación<a class="headerlink" href="#instalacion" title="Link to this heading">¶</a></h3>
<p><em>Debian</em> trae su propio paquete para instalar el servidor:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>apt<span class="w"> </span>install<span class="w"> </span>bind9
</pre></div>
</div>
<p>La instalación es plenamente funcional:</p>
<ul class="simple">
<li><p>No hay definida ninguna zona propia (no es servidor <em>autoritario</em>), pero
funciona perfectamente como servidor recursivo.</p></li>
<li><p>Utiliza para sus consultas recursivas los servidores raíz.</p></li>
</ul>
<p>Podemos probar el servidor con <a class="reference internal" href="02.clientes.html#host"><span class="std std-ref">host</span></a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>host<span class="w"> </span>www.iescastillodeluna.es<span class="w"> </span>localhost
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>En este caso, tenemos que especificar que queremos usar nuestro
propio servidor, porque no hemos tocado el archivo <code class="file docutils literal notranslate"><span class="pre">/etc/resolv.conf</span></code>.
Recuerde que <a class="reference internal" href="../../02.conbas/09.admbasica/11.red.html#bas-resolv-conf"><span class="std std-ref">hay que editar este archivo para indicar qué servidor DNS
desea usarse</span></a>. A partir de ahora supondremos que se ha
editado este archivo para evitar el tedio de indicar explícitamente que se
está usando nuestor propio <strong class="program">bind</strong>.</p>
<p>Tenga, además, presente que, si durante sus pruebas alguna de las interfaces
de su servidor tiene configuración dinámica, el cliente <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> alterará el
contenido de <code class="file docutils literal notranslate"><span class="pre">/etc/resolv.conf</span></code> cada vez que reciba una configuración
de red. Para evitarlo, puede utilizar <a class="reference internal" href="../05.directorio/06.samba/01.prologo/index.html#disable-dhclient-resolv"><span class="std std-ref">este truco</span></a>.</p>
</div>
</section>
<section id="archivos-de-configuracion">
<h3><span class="section-number">6.2.3.1.2. </span>Archivos de configuración<a class="headerlink" href="#archivos-de-configuracion" title="Link to this heading">¶</a></h3>
<p>Toda la configuración se encuentra dentro del directorio <code class="file docutils literal notranslate"><span class="pre">/etc/bind</span></code>. El
archivo básico de configuración es <code class="file docutils literal notranslate"><span class="pre">named.conf</span></code>, pero mediante sentencias
<code class="docutils literal notranslate"><span class="pre">include</span></code> <em>Debian</em> ha dividido sus contenidos en otros dos<a class="footnote-reference brackets" href="#id5" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>. Nos
centraremos en los siguientes archivos:</p>
<dl class="simple">
<dt><code class="file docutils literal notranslate"><span class="pre">named.conf.options</span></code></dt><dd><p>Define algunos parámetros de configuración. Nos interesa fundamentalmente el
bloque <code class="docutils literal notranslate"><span class="pre">forwarders</span></code> que define los servidores que usará nuestro servidor
para realizar búsquedas recursivas. Al encontrarse deshabilitado, recurre
directamente a los servidores raíz.</p>
</dd>
<dt><code class="file docutils literal notranslate"><span class="pre">named.conf.local</span></code></dt><dd><p>Está destinado a la declaración de las zonas que se definirán en nuestro
servidor. Siempre que definamos una zona, deberemos incluir aquí una
referencia.</p>
</dd>
<dt><code class="file docutils literal notranslate"><span class="pre">db.empty</span></code></dt><dd><p>Es un archivo que nos sirve como plantilla para la creación de archivos de
zona.</p>
</dd>
</dl>
</section>
<section id="enjaulamiento">
<h3><span class="section-number">6.2.3.1.3. </span>Enjaulamiento<a class="headerlink" href="#enjaulamiento" title="Link to this heading">¶</a></h3>
<p>El servicio <abbr title="Domain Name Server">DNS</abbr> es tristemente célebre por sus repetidos problemas de
seguridad. Por ello, es muy recomendable enjaular el servidor dentro de un
directorio que llamaremos <code class="file docutils literal notranslate"><span class="pre">/var/lib/chroot-dns</span></code>. Comenzemos por parar el
servicio:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>invoke-rc.d<span class="w"> </span>bind9<span class="w"> </span>stop
</pre></div>
</div>
<p>y preparar los directorios necesarios:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/var/lib/chroot-dns/<span class="o">{</span>etc,dev,var/<span class="o">{</span>cache,run<span class="o">}}</span>
</pre></div>
</div>
<p>Poblemos ahora <code class="file docutils literal notranslate"><span class="pre">dev/</span></code> con los archivos especiales que necesita el
servidor:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>mknod<span class="w"> </span>-m666<span class="w"> </span>/var/lib/chroot-dns/dev/null<span class="w"> </span>c<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">3</span>
<span class="gp"># </span>mknod<span class="w"> </span>-m666<span class="w"> </span>/var/lib/chroot-dns/dev/random<span class="w"> </span>c<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">8</span>
</pre></div>
</div>
<p>Movemos los directorios necesarios dentro de la jaula:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>mv<span class="w"> </span>/etc/bind<span class="w"> </span>/var/lib/chroot-dns/etc
<span class="gp"># </span>ln<span class="w"> </span>-s<span class="w"> </span>/var/lib/chroot-dns/etc/bind<span class="w"> </span>/etc
<span class="gp"># </span>mv<span class="w"> </span>/var/cache/bind<span class="w"> </span>/var/lib/chroot-dns/var/cache
<span class="gp"># </span>ln<span class="w"> </span>-s<span class="w"> </span>/var/lib/chroot-dns/var/cache/bind<span class="w"> </span>/var/cache
<span class="gp"># </span>mv<span class="w"> </span>/var/run/named<span class="w"> </span>/var/lib/chroot-dns/var/run
<span class="gp"># </span>ln<span class="w"> </span>-s<span class="w"> </span>/var/lib/chroot-dns/var/run/named<span class="w"> </span>/var/run
</pre></div>
</div>
<p>Y hacemos propietario al usuario <em>bind</em> de todo el contenido:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>chown<span class="w"> </span>-R<span class="w"> </span>bind:bind<span class="w"> </span>/var/lib/chroot-dns/*
</pre></div>
</div>
<p>Metemos dentro de la jaula también el registro:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;$AddUnixListenSocket /var/lib/chroot-dns/dev/log&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>/etc/rsyslog.d/dns-chroot.conf
<span class="gp"># </span>invoke-rc.d<span class="w"> </span>rsyslog<span class="w"> </span>restart
</pre></div>
</div>
<p>Por último, para rematar podemos modificar la versión que comunica nuestro
servidor para que un posible atacante no la conozca de antemano. Esto se hace
editando <code class="file docutils literal notranslate"><span class="pre">/etc/bind/named.conf.options</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>version<span class="w"> </span><span class="s2">&quot;3.1416&quot;</span>
</pre></div>
</div>
<p>Con esto ya podemos indicar al demonio que arranque enjaulado, para lo cual
editamos <code class="file docutils literal notranslate"><span class="pre">/etc/default/bind</span></code> y dejamos las opciones del siguiente modo:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">OPTIONS</span><span class="o">=</span><span class="s2">&quot;-u bind -t /var/lib/chroot-dns&quot;</span>
</pre></div>
</div>
<p>E iniciamos de nuevo el servidor:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>invoke-rc.d<span class="w"> </span>bind9<span class="w"> </span>start
</pre></div>
</div>
</section>
<section id="configuracion-inicial">
<h3><span class="section-number">6.2.3.1.4. </span>Configuración inicial<a class="headerlink" href="#configuracion-inicial" title="Link to this heading">¶</a></h3>
<p>Básicamente consiste en editar <code class="file docutils literal notranslate"><span class="pre">named.conf.options</span></code> y ajustarlo a nuestro
gusto. No introduciremos demasiadas opciones.</p>
<p>Al comienzo, el archivo contiene una línea:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">directory &quot;/var/cache/bind&quot;;</span>
</pre></div>
</div>
<p>que identifica el directorio donde tendremos que almacenar los archivos de
definición de las zona que gestionemos. Conviene que lo recordemos.</p>
<p>Más adelante, mediante el bloque <kbd class="kbd docutils literal notranslate">forwarders</kbd>, se puede configurar cómo el
servidor hará sus propias consultas recursivas para resolver dominios ajenos. De
forma predeterminada, el servidor no hace consultas recursivas (el bloque está
comentado), sino que los resuelve utilizando <a class="reference internal" href="01.desc.html#dns-resolucion"><span class="std std-ref">consultas iterativas</span></a> a partir de los servidores raíz. Para agilizar estas  consultas
es mejor recurrir a consultas recursivas a otros servidores <abbr title="Domain Name Server">DNS</abbr> de internet
que las permitan. Por ejemplo<a class="footnote-reference brackets" href="#id6" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">forwarders {  // Servidores de Cloudflare</span>
<span class="go">   1.1.1.1;</span>
<span class="go">   1.0.0.1;</span>
<span class="go">   //194.179.1.100;</span>
<span class="go">};</span>
</pre></div>
</div>
<p>Por último, como no usaremos <abbr title="Domain Name Server SECurity extensions">DNSSEC</abbr> debemos dejar la línea:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">dnssec-validation no;</span>
</pre></div>
</div>
<p id="bind-recursion">Un aspecto muy importante de nuestro servidor y al que tenemos que atender, es
si pensamos permitir las consultas recursivas o no. En un servidor local que
ofrecerá servicio a las máquinas de la red es obvio que sí. En cambio, si
montamos un servidor autoritario público, lo mejor es impedirlas. En el archivo
no hay configuración al respecto, así que se usa la predeterminada que es:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">recursion yes;</span>
<span class="go">allow-recursion { localnets; localhost; };</span>
</pre></div>
</div>
<p>que significa que sí se permite, pero sólo a la lista de clientes proporcionada
por <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">allow</kbd>-<kbd class="kbd docutils literal notranslate">recursion</kbd></kbd> que es la propia máquina local y las máquinas que
pertenecen a las redes a las que directamente esté conectada el servidor.</p>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Por defecto, <strong class="program">bind</strong> permite a cualquier máquina la
transferencia completa de la zona. Puede hacer la prueba con:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>dig<span class="w"> </span>iescastillodeluna.es<span class="w"> </span>AXFR
</pre></div>
</div>
<p>Esto puede no parecernos buena idea, sobre todo si nuestro servidor está
expuesto a internet. Para evitarlo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">allow-transfer { none; };</span>
</pre></div>
</div>
<p>Pero téngase presente que los servidores esclavos deben poder recibir la
transferencia de zona. La sentencia anterior lo impide.</p>
</div>
</section>
<section id="comprobacion">
<h3><span class="section-number">6.2.3.1.5. </span>Comprobación<a class="headerlink" href="#comprobacion" title="Link to this heading">¶</a></h3>
<p>Una vez que hayamos hecho una configuración, tenemos distintas herramientas para
validarla:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>named-checkconf<span class="w"> </span>archivo_configuracion
</pre></div>
</div>
<p>que comprueba errores en los archivos de configuración como
<code class="file docutils literal notranslate"><span class="pre">named.conf.options</span></code> o <code class="file docutils literal notranslate"><span class="pre">named.conf.local</span></code>. Por otra parte:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>named-checkzone<span class="w"> </span>zona<span class="w"> </span>archivo_de_zona
</pre></div>
</div>
<p>comprueba errores en la definición de la zona incluida en el archivo que se
proporciona (nosotros los almacenaremos en <code class="file docutils literal notranslate"><span class="pre">/var/cache/bind</span></code>). Estos
archivos no los hemos visto aún, pero los escribiremos a partir del próximo
epígrafe.</p>
<p>Por supuesto, también podemos iniciar el servidor y consultar los registros
en búsqueda de errores, haciendo uso de <a class="reference internal" href="../../04.servidor/08.monitorizacion/01.logs/02.journalctl.html#journalctl"><span class="std std-ref">journalctl</span></a>. Por
ejemplo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>journalctl<span class="w"> </span>-u<span class="w"> </span>named<span class="w"> </span>-n30
</pre></div>
</div>
<p>que nos muestra las últimas treinta líneas del registro.</p>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Iniciar (o reiniciar) este servidor no muestra ningún error,
aunque lo haya habido y el servidor ni siquiera haya podido arrancar.</p>
</div>
</section>
<section id="cacheo">
<span id="rndc"></span><h3><span class="section-number">6.2.3.1.6. </span>Cacheo<a class="headerlink" href="#cacheo" title="Link to this heading">¶</a></h3>
<p>Nuestro servidor cachea las resoluciones que realiza, por lo que también es
interesante saber cómo manejarlas. Para ello podemos echar mano de la orden
<strong class="command">rndc</strong>. Un primer uso, nos permite eliminar toda la caché:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>rndc<span class="w"> </span>flush
</pre></div>
</div>
<p>aunque podemos restringir la eliminación a un nombre particular:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>rndc<span class="w"> </span>flushname<span class="w"> </span>www.google.com
</pre></div>
</div>
<p>o a un dominio y todo su contenido:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>rndc<span class="w"> </span>flushtree<span class="w"> </span>google.com
</pre></div>
</div>
<p>También podemos volcar los registros que se encuentran en la caché al archivo
<code class="file docutils literal notranslate"><span class="pre">/var/cache/bind/named_dump.db</span></code> para consultarlos:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>rndc<span class="w"> </span>dumpdb<span class="w"> </span>-cache
</pre></div>
</div>
<p>La orden tiene otros muchos más usos. Más adelante indicaremos algunos
referentes a las zonas.</p>
</section>
</section>
<section id="dns-directo">
<span id="bind-resolucion-directa"></span><h2><span class="section-number">6.2.3.2. </span>DNS directo<a class="headerlink" href="#dns-directo" title="Link to this heading">¶</a></h2>
<p>Ya sabemos cómo hacer la configuración inicial de <strong class="program">bind</strong> y cómo
convertirlo en un servidor para consultas recursivas. Nuestra intención a partir
de ahora es exponer cómo hacerlo un servidor autoritario para las zonas que
decidamos y cómo crear los registros dentro de tales zonas. Para la exposición
pongamos que la zona que queremos definir es «iescastillodeluna.es» como venimos
haciendo hasta ahora.</p>
<p>En principio, hay dos posibilidades:</p>
<ol class="arabic simple">
<li><p><strong>Servidor de internet</strong>: nuestro servidor <abbr title="Domain Name Server">DNS</abbr> resuelve una zona pública,
esto es, una zona con máquinas expuestas a internet, por lo que las
resoluciones de nombres dirigen a <abbr title="Internet Protocol">IP</abbr> públicas. En este caso:</p>
<ul class="simple">
<li><p>Habremos pagado a un agente registrador para que incluya el registro
<kbd class="kbd docutils literal notranslate">NS</kbd> correspondiente en el <abbr title="Top-Level Domain">TLD</abbr> «es».</p></li>
<li><p>El agente registrador es muy probable que nos ofrezca la posibilidad de
usar un servidor <abbr title="Domain Name Server">DNS</abbr> suyo para gestionar el dominio con lo que nos
proporcionará una interfaz web sencilla para añadir, modificar y eliminar
registros. En este caso, no tenemos que aprender más: con saber
<a class="reference internal" href="01.desc.html#dns-registros"><span class="std std-ref">cuáles son y para qué sirven los distintos tipos de registros</span></a> nos basta. Pero a nosotros no nos interesa este caso,
porque buscamos aprender a configurar el servidor <abbr title="Domain Name Server">DNS</abbr>, sino aquel otro en
que nosotros mismos lo montamos.</p></li>
<li><p>Necesitamos indicarle al agente registrador que refiera un servidor de
nuestra propiedad que disponga de <abbr title="Internet Protocol">IP</abbr> pública como servidor <abbr title="Domain Name Server">DNS</abbr> en el
<abbr title="Top-Level Domain">TLD</abbr>. Este será el servidor <abbr title="Domain Name Server">DNS</abbr> que configuremos. A menos que este
servidor <abbr title="Domain Name Server">DNS</abbr> disponga de un nombre de máquina resoluble, además deberá
incluirse un <a class="reference internal" href="01.desc.html#glue-record"><span class="std std-ref">glue record</span></a>, ya que el servidor tendrá un
nombre del propio dominio «iescastillodeluna.es».</p></li>
<li><p>Habitualmente, no se nos obligará a que haya redundancia de servidores,
así que necesitaremos al menos otro servidor con <abbr title="Internet Protocol">IP</abbr> pública que, como en
el punto anterior, deberemos facilitar al agente registrador para que pida
su adición al <abbr title="Top-Level Domain">TLD</abbr> «es». Este servidor a diferencia del primero, será un
<em>servidor esclavo</em>, así que <a class="reference internal" href="#bind-esclavo"><span class="std std-ref">tendremos que definirlo de distinta forma</span></a>.</p></li>
<li><p>Lo más lógico es que el servidor no se dedique a hacer resoluciones
recursivas para terceras máquinas (véase <a class="reference internal" href="#bind-recursion"><span class="std std-ref">cómo limitar la recursión</span></a>).</p></li>
<li><p>No podemos definir <a class="reference internal" href="#bind-resolucion-inversa"><span class="std std-ref">resolución inversa</span></a>, ya que las
redes públicas pertenecen a <abbr title="Internet Service Provider">ISP</abbr> o grandes empresas de servicios en la
nube. Si necesitamos que alguna de nuestras <abbr title="Internet Protocol">IP</abbr>s públicas resuelva a un
nombre determinado necesitaremos contactar con el <abbr title="Internet Service Provider">ISP</abbr> o la empresa para
que haga tal cambio en sus servidores <abbr title="Domain Name Server">DNS</abbr>.</p></li>
</ul>
</li>
<li><p><strong>Servidor interno</strong>: en este caso montamos el servidor para dotar de nombres
a las máquinas de una red privada:</p>
<ul class="simple">
<li><p>No necesitamos que el dominio exista fuera de nuestra propia red, por lo
que no nos es necesario registrarlo.</p></li>
<li><p>No necesitamos redundancia de servidores con lo que podríamos no tener que
configurar ningún servidor esclavo.</p></li>
<li><p>El servidor sí realizará resoluciones recursivas, ya que las máquinas de la
red lo usarán también para resolver nombres de servidores externos.</p></li>
<li><p>La red privada sí será nuestra, por lo que haremos <a class="reference internal" href="#bind-resolucion-inversa"><span class="std std-ref">resolución inversa</span></a>.</p></li>
<li><p>Como existirá un servicio <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr>, es probable que nos interese un <a class="reference internal" href="#bind-ddns"><span class="std std-ref">DNS
dinámico</span></a>, esto es, que las máquinas que reciben una configuración
<abbr title="Internet Protocol">IP</abbr> también reciban un nombre automático.</p></li>
</ul>
</li>
</ol>
<p>Por supuesto, también cabe la posibilidad de que tengamos que hacer ambas cosas:
un servidor que dispone de una interfaz pública con la cual implementamos el
primer caso; y una interfaz interna con la cual implementamos la segunda
posibilidad.</p>
<section id="definicion-de-zona">
<span id="bind-definicion-zona"></span><h3><span class="section-number">6.2.3.2.1. </span>Definición de zona<a class="headerlink" href="#definicion-de-zona" title="Link to this heading">¶</a></h3>
<p>Para definir una zona debemos hacer dos cosas:</p>
<ul class="simple">
<li><p>Declararla en <code class="file docutils literal notranslate"><span class="pre">named.conf.local</span></code>.</p></li>
<li><p>Definirla propiamente en su archivo correspondiente.</p></li>
</ul>
<p>Para lo primero debemos añadir un bloque a <code class="file docutils literal notranslate"><span class="pre">named.conf.local</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">zone &quot;iescastillodeluna.es&quot; {</span>
<span class="go">   type master;</span>
<span class="go">   file &quot;db.iescastillodeluna.es&quot;;</span>
<span class="go">};</span>
</pre></div>
</div>
<p>En él definimos el servidor como maestro para la zona e indicamos cuál es el
archivo en el que declararemos los registros  que la componen. Como no indicamos
ruta, el archivo debe ubicarse en <code class="file docutils literal notranslate"><span class="pre">/var/cache/bind</span></code>.</p>
<p>Ahora entramos de lleno en la configuración propiamente de la zona. Para ello,
lo mejor es copiar la plantilla <code class="file docutils literal notranslate"><span class="pre">db.empty</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>cp<span class="w"> </span>/etc/bind/db.empty<span class="w"> </span>/var/cache/bin/db.iescastillodeluna.es
</pre></div>
</div>
<p>y editarla para dejarla más o menos así:</p>
<div class="highlight-none notranslate" id="dns-ej-zona-directa"><div class="highlight"><pre><span></span>;
; Zona IESCASTILLODELUNA.ES
;
@  IN SOA   ns1 hostmaster (
               1     ; Serial
          604800     ; Refresh
           86400     ; Retry
         2419200     ; Expire
           86400 )   ; Negative Cache TTL
;
@        IN    TXT   &quot;Ejemplo de definición de la zona IESCASTILLODELUNA.ES&quot;
               NS    ns1
               NS    ns2
               MX    10 mail
ns1      IN    A     80.80.80.81
ns2      IN    A     80.80.80.91
mail     IN    A     194.179.100.201
;
$TTL  300
;
smtp     IN    CNAME mail
pop3     IN    CNAME mail
imap     IN    CNAME mail
www      IN    A     80.80.80.80
ftp      IN    CNAME www
*        IN    CNAME www
</pre></div>
</div>
<p>Sin entrar en el detalle de cada  registro (porque esto se hizo <a class="reference internal" href="01.desc.html#dns-registros"><span class="std std-ref">al
explicarlos</span></a>):</p>
<ul>
<li><p>Como se está definiendo la zona «iescastillodeluna.es», los nombres que no
acaban en punto añaden este dominio automáticamente.</p></li>
<li><p>No hay ningún registro con un <abbr title="Time To Live">TTL</abbr> específico, de modo que el <abbr title="Time To Live">TTL</abbr>  viene
dado por el especificado en el registro <abbr title="Start Of Authority">SOA</abbr>. Sin embargo, hacia la mitad del
archivo existe la directiva:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>TTL<span class="w"> </span><span class="m">300</span>
</pre></div>
</div>
<p>que afecta a todos los registros definidos a continuación<a class="footnote-reference brackets" href="#id7" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>.</p>
</li>
<li><p>El ejemplo define una zona de máquinas públicas, no un dominio privado, y eso
está en consonancia con que se definan dos servidores de dominio para la zona:
«ns1» y «ns2». El primero debe de ser el servidor primario, puesto que así se
deduce del registro <abbr title="Start Of Authority">SOA</abbr> y el segundo un servidor esclavo. De lo que se deduce
que estamos escribiendo este archivo en la máquina «ns1».</p></li>
<li><p>Los nombres de los servidores <abbr title="Domain Name Server">DNS</abbr> pertenecen al propio dominio, lo que
provoca que existan dos registros <kbd class="kbd docutils literal notranslate">A</kbd> que  indiquen cuál es su dirección
<abbr title="Internet Protocol">IP</abbr> y que deduzcamos que en el <abbr title="Top-Level Domain">TLD</abbr> superior existan, además de los dos
registros <kbd class="kbd docutils literal notranslate">NS</kbd> que provocan la delegación, dos <em>glue records</em> con sus
direcciones <abbr title="Internet Protocol">IP</abbr>. Por consiguiente, en el <abbr title="Top-Level Domain">TLD</abbr> «es», que no controlamos, pero
a cuyo <abbr title="Network Information Center">TTL</abbr> hemos pagado a través de un agente para que lo haga, habrá estos
registros:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">iescastillodeluna.es.       IN       NS       ns1.iescastillodeluna.es.</span>
<span class="go">iescastillodeluna.es.       IN       NS       ns2.iescastillodeluna.es.</span>
<span class="go">; Estos son los glue records</span>
<span class="go">ns1.iescastillodeluna.es.   IN        A       80.80.80.81</span>
<span class="go">ns2.iescastillodeluna.es.   IN        A       80.80.80.91</span>
</pre></div>
</div>
<p>Recuerdese, no obstante, que esto no es obligatorio. El servidor <abbr title="Domain Name Server">DNS</abbr> puede
tener un nombre en un dominio distinto. Por ejemplo, en nuestro servidor la
definición dentro de <code class="file docutils literal notranslate"><span class="pre">db.iescastillodeluna.es</span></code> podría haber sido ésta:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">@                           IN       NS       dns1.example.org.</span>
<span class="go">                                     NS       dns2.example.org.</span>
</pre></div>
</div>
<p>En este caso, el <abbr title="Top-Level Domain">TLD</abbr> superior, obviamente, no tendría <em>glue records</em>, ya
que las direcciones <abbr title="Internet Protocol">IP</abbr> de esos dos servidores estarían recogidas en la
definición de la zona «example.org».</p>
<p>Hay otro aspecto importante de este registro. Ya hemos deducido a través del
registro <abbr title="Start Of Authority">SOA</abbr> que «n1» es la máquina en la que estoy escribiendo estos
registros. Pero, entonces, ¿qué máquina es «n2» que también es servidor de
nombres según el registro? «n2» es un <a class="reference internal" href="#bind-esclavo"><span class="std std-ref">servidor esclavo que
configuraremos más adelante</span></a>.</p>
</li>
<li><p>Hay definido un servidor para gestionar el correo del dominio («mail»).</p></li>
<li><p>Hay un registro <kbd class="kbd docutils literal notranslate">TXT</kbd> bastante inútil que únicamente ilustra su
uso: los registros <kbd class="kbd docutils literal notranslate">TXT</kbd> suelen incluirse con algún fin
específico  para que algún programa los consulte y haga uso de información.</p></li>
<li><p>Hay un <em class="dfn">registro comodín</em>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">*      IN       CNAME    www</span>
</pre></div>
</div>
<p>que implica que cualquier nombre (excepto los definidos implícitamente) sean
alias de «www». Por eso «smtp», por ejemplo, es alias de «mail».
Estos comodines no se limitan a este tipo de registros: también pueden
definirse con <kbd class="kbd docutils literal notranslate">MX</kbd>, <kbd class="kbd docutils literal notranslate">A</kbd>, <kbd class="kbd docutils literal notranslate">SRV</kbd>, etc.</p>
</li>
</ul>
<p>¿Qué ocurriría si la zona se definiera para una red privada? En realidad, no habría muchos cambios:</p>
<ul class="simple">
<li><p>No se habría necesitado registrar el dominio en el <abbr title="Top-Level Domain">TLD</abbr> «es».</p></li>
<li><p>Las <abbr title="Internet Protocol">IP</abbr> que aparecen en el archivo deberían ser privadas.</p></li>
<li><p>Probablemente nos sobraría el servidor esclavo.</p></li>
<li><p>También probablemente nos gustaría implementar <a class="reference internal" href="#bind-resolucion-inversa"><span class="std std-ref">la resolución inversa</span></a>.</p></li>
</ul>
<p>Antes de acabar, podemos retomar la orden <a class="reference internal" href="#rndc"><span class="std std-ref">rndc</span></a>, porque tambien nos
sirve para que <strong class="program">bind</strong> actualice la zona después de haber hecho un
cambio en  el archivo sin necesidad de reiniciar el servidor:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>rndc<span class="w"> </span>reload<span class="w"> </span>iescastillodeluna.es
<span class="gp"># </span>rndc<span class="w"> </span>reload
</pre></div>
</div>
<p>La primera orden nos permite recargar exclusivamente la zona
«iescastillodeluna.es», mientras que la segunda recarga todas las zonas que
gestione el servidor.</p>
</section>
<section id="delegacion">
<span id="bind-delegacion"></span><h3><span class="section-number">6.2.3.2.2. </span>Delegación<a class="headerlink" href="#delegacion" title="Link to this heading">¶</a></h3>
<p>La <em class="dfn">delegación</em> se produce cuando un servidor <abbr title="Domain Name Server">DNS</abbr> delega en otro (u
otros) una porción de su espacio de nombres. Por ejemplo, la zona
«sede1.iescastillodeluna.es» la desgajamos de «iescastillodeluna.es» para
gestionar mediante un servidor distinto. La delegación es, de hecho, la base de
la <a class="reference internal" href="01.desc.html#dns-jerarquia"><span class="std std-ref">organización jerárquica</span></a> del servicio.</p>
<p>Para delegar tenemos que tocar tanto la configuración del propio servidor como
la definición del archivo de zona.</p>
<dl>
<dt><strong>Servidor delegante</strong></dt><dd><p>Necesitamos hacer dos cosas:</p>
<ul>
<li><p>Modificar ligeramente el bloque de la zona en archivo <code class="file docutils literal notranslate"><span class="pre">named.conf.local</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">zone &quot;iescastillodeluna.es&quot; {</span>
<span class="go">   type master;</span>
<span class="go">   file &quot;db.iescastillodeluna.es&quot;;</span>
<span class="hll"><span class="go">   forwarders {};</span>
</span><span class="go">};</span>
</pre></div>
</div>
<p>La línea debe añadirse, porque la zona «sede1.iescastillodeluna.es» no está
definida en este servidor, y, consecuentemente, si se pregunta a este
servidor alguna resolución del subdominio recurrirá a los servidores
definidos en el bloque <code class="docutils literal notranslate"><span class="pre">forwarders</span></code>. Con esta línea, lo evitamos.</p>
</li>
<li><p>Incluir en el archivo de zona «iescastillodeluna.es» la delegación de la
subzona añadiendo estas líneas:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">;</span>
<span class="go">; Delegación de la zona sede1.iescastillodeluna.es</span>
<span class="go">;</span>
<span class="gp">$</span>ORIGIN<span class="w"> </span>sede1.iescastillodeluna.es.
<span class="go">@               IN       NS    ns1</span>
<span class="go">                         NS    ns2</span>
<span class="go">; Esto son glue records</span>
<span class="go">ns1             IN        A    110.111.112.113</span>
<span class="go">ns2             IN        A    110.111.112.114</span>
</pre></div>
</div>
<p>En el código hemos usado otra directiva <kbd class="kbd docutils literal notranslate">$ORIGIN</kbd> que nos permite
cambiar el dominio de referencia que usan los nombres: así nos hemos
ahorrado incluir la palabra «sede1» en todos ellos.</p>
<p>Nótese que seguimos utilizando como nombres del servidor, nombres del
propio dominio que gestionan por lo que debemos incluir los <em>glue
records</em>.</p>
</li>
</ul>
</dd>
<dt><strong>Servidor delegado</strong></dt><dd><p>En principio no hay que hacer nada especial que no sea definir la zona
«sede1.iescastillodeluna.es» tal como <a class="reference internal" href="#bind-definicion-zona"><span class="std std-ref">ya explicamos para
«iescastillodeluna.es»</span></a>.</p>
<p>Ahora bien, si este servidor lo pretendemos usar también para realizar
búsquedas recursivas y el dominio superior («iescastillodeluna.es» en este
caso) es un dominio privado que no está registrado en el <abbr title="Top-Level Domain">TLD</abbr> «es», entonces
debemos buscar la forma de forzar que consulte al servidor delegante el
dominio «iescastillodeluna.es». La forma más sencilla es usar a dicho
servidor como <em>forwarder</em>. Por tanto, bastará con modificar el bloque en
<code class="file docutils literal notranslate"><span class="pre">named.conf.options</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">forwarders {</span>
<span class="go">   ip.del.dns.superior;</span>
<span class="go">}</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="servidor-esclavo">
<span id="bind-esclavo"></span><h3><span class="section-number">6.2.3.2.3. </span>Servidor esclavo<a class="headerlink" href="#servidor-esclavo" title="Link to this heading">¶</a></h3>
<p>La configuración de un esclavo tiene dos partes diferenciadas:</p>
<ol class="arabic simple">
<li><p>Declararlo como tal en el servidor <em>maestro</em>.</p></li>
<li><p>Configurarlo en sí el servidor <em>esclavo</em>.</p></li>
</ol>
<dl>
<dt><strong>Servidor maestro</strong></dt><dd><p>Para que un servidor maestro notifique cambios en la zona a un servidor
esclavo, basta con que éste este referido en un registro <kbd class="kbd docutils literal notranslate">NS</kbd> en el archivo de zona.
En nuestro ejemplo, referimos una máquina «ns2»:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">@           IN          NS    ns1</span>
<span class="go">                        NS    ns2</span>
</pre></div>
</div>
<p>así que hemos complido con ello.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Existe una directiva <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">also</kbd>-<kbd class="kbd docutils literal notranslate">notify</kbd></kbd> que podemos incluir en el bloque <kbd class="kbd docutils literal notranslate">zone</kbd>
del archivo <code class="file docutils literal notranslate"><span class="pre">named.conf.local</span></code>, que nos permite referir una lista
de máquinas a las que notificar los cambios:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">zone &quot;iescastillodeluna.es&quot; {</span>
<span class="go">   type master;</span>
<span class="go">   file &quot;db.iescastillodeluna.es&quot;;</span>
<span class="go">   also-notify { 10.10.10.10; 10.10.10.11; };</span>
<span class="go">};</span>
</pre></div>
</div>
<p>Sin embargo, si se encuentra la máquina referida a través del registro
<kbd class="kbd docutils literal notranslate">NS</kbd> es redundante; y, si no lo está, tal servidor sería un servidor esclavo fantasma,
que no aparecería como servidor autoritario cuando un cliente hiciera la consulta:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>host<span class="w"> </span>-tns<span class="w"> </span>iescastillodeluna.es
</pre></div>
</div>
<p>lo cual no parece muy recomendable.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Al servidor esclavo le debe estar permitida la transferencia
completa de la zona. Si la hemos prohibido de modo universal con
<code class="code docutils literal notranslate"><span class="pre">allow-transfer</span> <span class="pre">{</span> <span class="pre">none;</span> <span class="pre">};</span></code>, entonces tendremos que habilitarla expresamente para la zona:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">zone &quot;iescastillodeluna.es&quot; {</span>
<span class="go">   type master;</span>
<span class="go">   file &quot;db.iescastillodeluna.es&quot;;</span>
<span class="go">   allow-transfer { 80.80.80.91; };  // Esta es la IP de ns2, el</span>
<span class="go">   esclavo.</span>
<span class="go">};</span>
</pre></div>
</div>
</div>
</dd>
<dt><strong>Servidor esclavo</strong></dt><dd><p>La configuración del servidor esclavo («ns2» en nuestro caso) es muy
sencilla, ya que no hay que crearle ningún archivo de definición de zona.
Basta con declarar en él que «iescastillodeluna.es» es una zona que él
gestionará como esclavo e indicarle cuál es el servidor maestro.
Consecuentemente, basta con añadir a <code class="file docutils literal notranslate"><span class="pre">named.conf.options</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">zone &quot;iescastillodeluna.es&quot; {</span>
<span class="go">   type slave;</span>
<span class="go">   masters { 80.80.80.81; };  // Esta es la IP de ns1, el maestro.</span>
<span class="go">};</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="vistas">
<span id="bind-view"></span><h3><span class="section-number">6.2.3.2.4. </span>Vistas<a class="headerlink" href="#vistas" title="Link to this heading">¶</a></h3>
<p>Una <em class="dfn">vista</em> es la perspectiva que el servidor <abbr title="Domain Name Server">DNS</abbr> ofrece de sí a los
clientes que lo consultan. Por ejemplo, si tuviéramos un servidor con dos
interfaces, una externa a la que se puede acceder desde internet, y una interna
para la red local, podría interesarnos proporcionar diferentes resoluciones.</p>
<img alt="../../_images/red-dns.png" src="../../_images/red-dns.png" />
<p>En este caso, para el exterior todos los nombres de todos los servidores deben
resolverse con la misma dirección <abbr title="Internet Protocol">IP</abbr>: <code class="docutils literal notranslate"><span class="pre">80.35.60.114</span></code>. En cambio, para los
clientes de la red interna cada servidor tiene una <abbr title="Internet Protocol">IP</abbr> privada distinta.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Servidor</p></th>
<th class="head"><p>Vista externa</p></th>
<th class="head"><p>Vista interna</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ns.iescastillodeluna.es</p></td>
<td><p>80.35.60.114</p></td>
<td><p>192.168.255.1</p></td>
</tr>
<tr class="row-odd"><td><p>mail.iescastillodeluna.es</p></td>
<td><p>80.35.60.114</p></td>
<td><p>192.168.255.10</p></td>
</tr>
<tr class="row-even"><td><p>www.iescastillodeluna.es</p></td>
<td><p>80.35.60.114</p></td>
<td><p>192.168.255.20</p></td>
</tr>
</tbody>
</table>
<p><strong class="program">bind</strong> permite definir múltiples vistas para las cuales no sólo se
pueden cambiar las definiciones de los registros, sino también la
configuración. Por ejemplo, en una vista se pueden admitir las consultas
recursivas, pero en otra no.</p>
<p>Una <em>vista</em> se define con la siguiente estructura:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>view &quot;nombre_de_la_vista&quot; {

      // directivas que definan quién ve esta vista.
      // opciones particulares de la vista.

      // bloques &quot;zone&quot; pertinentes...

}
</pre></div>
</div>
<p>Hay que tener en cuenta, además, que cuando se definen vistas, no pueden haber
bloques <kbd class="kbd docutils literal notranslate">zone</kbd> definidos fuera de ella.</p>
<p>Para ilustrarlo, definamos en nuestra configuración las dos vistas anteriores,
Para ello debemos hacer primero unos cambios en <code class="file docutils literal notranslate"><span class="pre">named.conf</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">include &quot;/etc/bind/named.conf.options&quot;;</span>
<span class="go">//include &quot;/etc/bind/named.conf.local&quot;;</span>
<span class="go">//include &quot;/etc/bind/named.conf.default-zones&quot;;</span>

<span class="go">include &quot;/etc/bind/named.conf.view.interna&quot;;</span>
<span class="go">include &quot;/etc/bind/named.conf.view.externa&quot;;</span>
</pre></div>
</div>
<p>Con ello cargamos dos archivos: uno nos servirá para definir la vista interna y
otro la externa. Es importante, además, tener presente que <strong class="program">bind</strong> lee
en orden los bloques y aplica el primero con el que la solicitud concuerde,
desechando los que se encuentran a continuación.</p>
<p>El primer archivo es éste:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>view {
   match-clients { localnets; localhost; };
   recursion yes;

   zone &quot;iescastillodeluna.es&quot; {
      type master;
      file &quot;interna/db.iescastillodeluna.es&quot;;
   }

   include &quot;/etc/bind/named.conf.default-zones&quot;;
}
</pre></div>
</div>
<p>Y éste el segundo:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>view {
   match-clients { any; };
   recursion no;

   zone &quot;iescastillodeluna.es&quot; {
      type master;
      file &quot;externa/db.iescastillodeluna.es&quot;;
   }

   //include &quot;/etc/bind/named.conf.default-zones&quot;;
}
</pre></div>
</div>
<p>Esta configuración implica lo siguiente:</p>
<ul>
<li><p>Quiénes ven cada vista se logra a través de la cláusula <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">match</kbd>-<kbd class="kbd docutils literal notranslate">clients</kbd></kbd>,
que comprueba cuál es la dirección <abbr title="Internet Protocol">IP</abbr> de origen de las consultas.</p></li>
<li><p>Las máquinas de redes directamente conectadas verán la vista <em>interna</em>,
mientras que el resto la <em>externa</em>. Nótese que si la red local fuera más
compleja y existieran otras redes no directamente conectadas al servidor,
entonces no bastaría <kbd class="kbd docutils literal notranslate">localnets</kbd> y habría que enumerarlas explícitamente.
Lo más limpio sería utilizar un bloque <kbd class="kbd docutils literal notranslate">acl</kbd> en <code class="file docutils literal notranslate"><span class="pre">named.conf</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">include &quot;/etc/bind/named.conf.options&quot;;</span>

<span class="hll"><span class="go">acl &quot;privadas&quot; {</span>
</span><span class="hll"><span class="go">    10.0.0.0/8;</span>
</span><span class="hll"><span class="go">    172.16.0.0/12;</span>
</span><span class="hll"><span class="go">    192.168.0.0/16;</span>
</span><span class="hll"><span class="go">};</span>
</span>
<span class="go">include &quot;/etc/bind/named.conf.view.interna&quot;;</span>
<span class="go">include &quot;/etc/bind/named.conf.view.externa&quot;;</span>
</pre></div>
</div>
<p>y usar esta definición en las cláusulas <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">match</kbd>-<kbd class="kbd docutils literal notranslate">clients</kbd></kbd>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">match-clients { privadas; localhost; };</span>
</pre></div>
</div>
</li>
<li><p>En la vista interna están permitidas las consultas recursivas y en la externa,
no.</p></li>
<li><p>El archivo <code class="file docutils literal notranslate"><span class="pre">named.conf.default-zones</span></code> contiene algunas definiciones
relativas a la resolución de la dirección «localhost» (que de todos modos ya
debería estar resuelta en <code class="file docutils literal notranslate"><span class="pre">/etc/hosts</span></code>), pero también es la que permite
la realización de consultas iterativas sin usar los <em>forwarders</em>. No puede
dejarse en el archivo named.conf (o sea, fuera de los bloques <kbd class="kbd docutils literal notranslate">view</kbd>),
porque contiene declaración de zonas, así que es necesario meter  el
<kbd class="kbd docutils literal notranslate">include</kbd> en todas las vistas. En nuestro ejemplo, en la vista externa lo
hemos dejado comentado porque en realidad es algo que nunca se usaría, ya que
desde fuera no permitimos a los clientes consultas recursivas.</p></li>
</ul>
<p>Antes de acabar, añadamos dos puntualizaciones:</p>
<ul class="simple">
<li><p><kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">match</kbd>-<kbd class="kbd docutils literal notranslate">clients</kbd></kbd> no es la única cláusula para filtrar clientes. También
puede usarse sola o en conjunción con ella <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">match</kbd>-<kbd class="kbd docutils literal notranslate">destinations</kbd></kbd> que
comprueba la direcció <abbr title="Internet Protocol">IP</abbr> de destino de la consulta, en vez de la de origen.</p></li>
<li><p>Si tenemos un servidor maestro con varias vistas y un servidor esclavo que
debe sincronizarse con éste. ¿Cómo hacemos para que sea capaz de sincronizar
todas las vistas? En principio, dependiendo de su <abbr title="Internet Protocol">IP</abbr> sólo será capaz de ver
una. Esto se resuelve con <abbr title="Transaction Signature">TSIG</abbr> e incluyendo en <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">match</kbd>-<kbd class="kbd docutils literal notranslate">clients</kbd></kbd> la
referencia a la clave. En <a class="reference external" href="https://www.cyberciti.biz/faq/unix-linux-bind-named-configuring-tsig/">este artículo</a> se
explica cómo crear una clave, aunque se usa para permitir transferencias de
zona y no en vistas, pero el concepto es el mismo.</p></li>
</ul>
</section>
</section>
<section id="dns-inverso">
<span id="bind-resolucion-inversa"></span><h2><span class="section-number">6.2.3.3. </span>DNS inverso<a class="headerlink" href="#dns-inverso" title="Link to this heading">¶</a></h2>
<p>La <em class="dfn">resolución inversa</em> de direcciones consiste en devolver el nombre en
la red que tiene una determinada dirección <abbr title="Internet Protocol">IP</abbr>. Se realiza mediante la
inclusión de registros <kbd class="kbd docutils literal notranslate">PTR</kbd>. Ahora bien, del mismo modo que para incluir
registros para la <em>resolución directa</em> necesitamos poder gestionar el dominio,
para incluir registros <kbd class="kbd docutils literal notranslate">PTR</kbd>, necesitamos poder gestionar redes total o
parcialmente (subredes). Esto sólo es posible en el caso de una red privada, ya
que las públicas las gestionan <abbr title="Internet Service Provider">ISP</abbr>s o empresas de servicios en la nube.</p>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>En consecuencia, sólo será posible la configuración de la
resolución inversa, si nuestro servicio <abbr title="Domain Name Server">DNS</abbr> se configura para la gestión de
una red local. Si tenemos algún servidor con <abbr title="Internet Protocol">IP</abbr> pública y nos es imperativo
que la resolución inversa de su <abbr title="Internet Protocol">IP</abbr> devuelva su nombre, tendremos que
ponernos en contacto con el gestor de esa <abbr title="Internet Protocol">IP</abbr> (el <abbr title="Internet Service Provider">ISP</abbr>, por ejemplo) para
que él lleve el cambio a efecto.</p>
</div>
<p>Antes de meternos en harina es necesario precisar que a efectos de <abbr title="Domain Name Server">DNS</abbr> una
dirección <abbr title="Internet Protocol">IP</abbr> <code class="docutils literal notranslate"><span class="pre">192.168.3.25</span></code> se nota con el nombre
«25.3.168.192.in-addr.arpa» esto es con un nombre en que la dirección se escribe
puesta del revés y dentro del subdominio «in-addr.arpa». En consecuencia un
registro <kbd class="kbd docutils literal notranslate">PTR</kbd> tendrá este aspecto:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">30.255.168.192.in-addr.arpa.       IN       PTR      sobremesa.red.local.</span>
</pre></div>
</div>
<p>Además, si tomamos como referencia este archivo de resolución directa:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>;
; Zona IESCASTILLODELUNA.ES
;
@  IN SOA   ns1 hostmaster (
               1     ; Serial
          604800     ; Refresh
           86400     ; Retry
         2419200     ; Expire
           86400 )   ; Negative Cache TTL
;
@        IN    TXT   &quot;Ejemplo de definición de la zona IESCASTILLODELUNA.ES&quot;
               NS    ns1
               NS    ns2
               MX    10 mail
ns1      IN    A     192.168.255.1
mail     IN    A     192.168.255.10
smtp     IN    CNAME mail
pop3     IN    CNAME mail
imap     IN    CNAME mail
www      IN    A     192.168.255.20
; La máquina externo.iescastillodeluna.es está en otra red
externo  IN    A     80.80.80.80
ftp      IN    CNAME www
*        IN    CNAME www
</pre></div>
</div>
<p>el de resolución inversa quedará así:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>@  IN SOA   ns1.iescastillodeluna.es. hostmaster.iescastillodeluna.es. (
               1     ; Serial
          604800     ; Refresh
           86400     ; Retry
         2419200     ; Expire
           86400 )   ; Negative Cache TTL
;
@     IN NS    ns1.iescastillodeluna.es.
         NS    ns2.iescastillodeluna.es.
1     IN PTR   ns1.iescastillodeluna.es.
2     IN PTR   ns1.iescastillodeluna.es.
10    IN PTR   mail.iescastillodeluna.es.
20    IN PTR   www.iescastillodeluna.es.
</pre></div>
</div>
<section id="redes-con-clase">
<h3><span class="section-number">6.2.3.3.1. </span>Redes con clase<a class="headerlink" href="#redes-con-clase" title="Link to this heading">¶</a></h3>
<p>Son las redes completas de clase <strong>A</strong>, <strong>B</strong> o <strong>C</strong>. Por ejemplo, la <code class="docutils literal notranslate"><span class="pre">10.0.0.0</span></code>
(se sobrentiende que <code class="docutils literal notranslate"><span class="pre">/8</span></code>), <code class="docutils literal notranslate"><span class="pre">172.22.16.0</span></code> (se sobrentiende que <code class="docutils literal notranslate"><span class="pre">/16</span></code>) o
<code class="docutils literal notranslate"><span class="pre">192.168.255.0</span></code> (se sobrentiende que <code class="docutils literal notranslate"><span class="pre">/24</span></code>). Para estas redes, el nombre de
la zona sigue el patrón indicado anteriormente para una <abbr title="Internet Protocol">IP</abbr>, aunque se incluye
sólo la parte de red. Por tanto, en nuestro ejemplo, la zona es
«255.168.192.in-addr.arpa».</p>
<p>Sabido esto ya podemos configurar la resolución inversa de manera análoga a como
hacemos la directa:</p>
<ul>
<li><p>Añadimos la declaración de la zona en <code class="file docutils literal notranslate"><span class="pre">named.conf.local</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">zone &quot;255.168.192.in-addr.arpa&quot; {</span>
<span class="go">   type master;</span>
<span class="go">   file &quot;db.192.168.255&quot;;</span>
<span class="go">};</span>
</pre></div>
</div>
</li>
<li><p>Creamos el archivo <code class="file docutils literal notranslate"><span class="pre">/var/cache/bind/db.192.168.255</span></code> con los registros:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>;
; Zona IESCASTILLODELUNA.ES
;
@  IN SOA   ns1.iescastillodeluna.es hostmaster.iescastillodeluna.es (
               1     ; Serial
          604800     ; Refresh
           86400     ; Retry
         2419200     ; Expire
           86400 )   ; Negative Cache TTL
;
@        IN    NS    ns1.iescastillodeluna.es.
1        IN   PTR    ns1.iescastillodeluna.es.
10       IN   PTR    mail.iescastillodeluna.es.
20       IN   PTR    www.iescastillodeluna.es.
</pre></div>
</div>
<p>Hagamos algunas precisiones:</p>
<ul class="simple">
<li><p>El dominio de referencia para los nombres incluidos en los registros es
«255.168.192.in-addr.arpa».</p></li>
<li><p>Cada <abbr title="Internet Protocol">IP</abbr> sólo puede tener un nombre.</p></li>
</ul>
</li>
</ul>
</section>
<section id="redes-sin-clase">
<h3><span class="section-number">6.2.3.3.2. </span>Redes sin clase<a class="headerlink" href="#redes-sin-clase" title="Link to this heading">¶</a></h3>
</section>
</section>
<section id="dns-dinamico">
<span id="bind-ddns"></span><h2><span class="section-number">6.2.3.4. </span>DNS dinámico<a class="headerlink" href="#dns-dinamico" title="Link to this heading">¶</a></h2>
<p class="rubric">Notas al pie</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id5" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">1</a><span class="fn-bracket">]</span></span>
<p>Tres en realidad, pero el tercero no lo tocaremos.</p>
</aside>
<aside class="footnote brackets" id="id6" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">2</a><span class="fn-bracket">]</span></span>
<p><code class="docutils literal notranslate"><span class="pre">194.179.1.100</span></code> era un arcaico servidor <abbr title="Domain Name Server">DNS</abbr> de <a class="reference external" href="https://www.telefonica.com">Telefónica</a> de los tiempos de
<a class="reference external" href="https://es.wikipedia.org/wiki/InfoV%C3%ADa">Infovía</a>. Su inclusión en la lista es meramente sentimental. De hecho, está
comentado, porque ni siquiera funciona.</p>
</aside>
<aside class="footnote brackets" id="id7" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">3</a><span class="fn-bracket">]</span></span>
<p>No hay ninguna razón técnica para cambiar el <abbr title="Time To Live">TTL</abbr> de los registros
siguientes. Se ha hecho, simplemente, para ilustrar la existencia de esta
directiva.</p>
</aside>
</aside>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../index.html">Tabla de contenido</a></h3>
    <ul>
<li><a class="reference internal" href="#">6.2.3. <strong class="program">bind</strong></a><ul>
<li><a class="reference internal" href="#preliminares">6.2.3.1. Preliminares</a><ul>
<li><a class="reference internal" href="#instalacion">6.2.3.1.1. Instalación</a></li>
<li><a class="reference internal" href="#archivos-de-configuracion">6.2.3.1.2. Archivos de configuración</a></li>
<li><a class="reference internal" href="#enjaulamiento">6.2.3.1.3. Enjaulamiento</a></li>
<li><a class="reference internal" href="#configuracion-inicial">6.2.3.1.4. Configuración inicial</a></li>
<li><a class="reference internal" href="#comprobacion">6.2.3.1.5. Comprobación</a></li>
<li><a class="reference internal" href="#cacheo">6.2.3.1.6. Cacheo</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dns-directo">6.2.3.2. DNS directo</a><ul>
<li><a class="reference internal" href="#definicion-de-zona">6.2.3.2.1. Definición de zona</a></li>
<li><a class="reference internal" href="#delegacion">6.2.3.2.2. Delegación</a></li>
<li><a class="reference internal" href="#servidor-esclavo">6.2.3.2.3. Servidor esclavo</a></li>
<li><a class="reference internal" href="#vistas">6.2.3.2.4. Vistas</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dns-inverso">6.2.3.3. DNS inverso</a><ul>
<li><a class="reference internal" href="#redes-con-clase">6.2.3.3.1. Redes con clase</a></li>
<li><a class="reference internal" href="#redes-sin-clase">6.2.3.3.2. Redes sin clase</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dns-dinamico">6.2.3.4. DNS dinámico</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Tema anterior</h4>
    <p class="topless"><a href="02.clientes.html"
                          title="capítulo anterior"><span class="section-number">6.2.2. </span>Clientes</a></p>
  </div>
  <div>
    <h4>Próximo tema</h4>
    <p class="topless"><a href="04.dnsmasq.html"
                          title="próximo capítulo"><span class="section-number">6.2.4. </span><strong class="program">dnsmasq</strong></a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/06.infraestructura/03.dns/03.isc.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Ir a" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="04.dnsmasq.html" title="6.2.4. dnsmasq"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="02.clientes.html" title="6.2.2. Clientes"
             >anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" ><span class="section-number">6. </span>Servicios de infraestructura</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" ><span class="section-number">6.2. </span>DNS</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">6.2.3. </span><strong class="program">bind</strong></a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright CC BY 4.0, 2016-2024, José Miguel Sánchez Alés.
      Creado usando <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>