


<!DOCTYPE html>

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>6.2.1. Protocolo &#8212; documentación de Linuxnomicón - rolling</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/classic.css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/translations.js"></script>
    
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../search.html" />
    <link rel="next" title="6.2.2. Clientes" href="02.clientes.html" />
    <link rel="prev" title="6.2. DNS" href="index.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="02.clientes.html" title="6.2.2. Clientes"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="index.html" title="6.2. DNS"
             accesskey="P">anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" ><span class="section-number">6. </span>Servicios de infraestructura</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U"><span class="section-number">6.2. </span>DNS</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">6.2.1. </span>Protocolo</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="protocolo">
<span id="dns-proto"></span><h1><span class="section-number">6.2.1. </span>Protocolo<a class="headerlink" href="#protocolo" title="Enlazar permanentemente con este título">¶</a></h1>
<p>Ya hemos contando <a class="reference internal" href="index.html#dns"><span class="std std-ref">cómo fue históricamente el primer sistema de resolución
de nombres</span></a>: un simple archivo local que las escasas máquinas conectadas a
Internet intercambiaban. Cuando su número lo hizo inviable se adopto una
estrategia distinta: jerarquizar los nombres.</p>
<section id="nombres">
<h2><span class="section-number">6.2.1.1. </span>Nombres<a class="headerlink" href="#nombres" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Así, este ejemplo:</p>
<img alt="../../_images/nombrecualificado.png" src="../../_images/nombrecualificado.png" />
<p>es el <em>nombre cualificado</em> de una máquina llamada «www». Dicha máquina se
encuentra dentro de un dominio llamado «iescastillodeluna.es» que a su vez se
encuentra dentro de un dominio llamado «es». Si lo repasamos al revés:</p>
<ul>
<li><p>Hay un dominio de primer nivel, de nivel superior o <abbr title="Top-Level Domain">TLD</abbr> por sus siglas en
inglés. La autoridad encargada de aprobar cuáles son todos estos dominios es
la <abbr title="Internet Corporation for Assigned Names and Numbers">ICANN</abbr>, cuya gestión delega en una organización que recibe el
nombre genérico de <abbr title="Network Information Center">NIC</abbr>. A este nivel pertenecen:</p>
<ul class="simple">
<li><p>Los dominios <strong>geográficos</strong>, que usan los códigos de pais de dos letras
asignados en la <a class="reference external" href="https://es.wikipedia.org/wiki/ISO_3166-1">ISO 3166-1</a>
como «es» para España o «pt» para Portugal.</p></li>
<li><p>Los dominios <strong>genéricos</strong>, que tienen más de dos letras («com», «net», «info», etc.).</p></li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">Ver también</p>
<p>El artículo de <em>Wikipedia</em> <a class="reference external" href="https://es.wikipedia.org/wiki/Dominio_de_nivel_superior_gen%C3%A9rico">Dominio de nivel superior</a>
profundiza  bastante más en los distintos tipos de dominios de primer
nivel.</p>
</div>
</li>
<li><p>Hay un dominio de segundo nivel, registrado dentro de un dominio de primer
nivel. En el ejemplo «iescastillodeluna.es» es un dominio de segundo nivel
registrado dentro del dominio de primer nivel «es». Por lo general, los
dominios de segundo nivel pertenecen a organizaciones (una
empresa, un organismo público, una persona particular) que lo utiliza para
registrar dentro de él nombres de máquina, como es el caso del ejemplo puesto.
No obstante, pueden definirse dominios de tercer nivel y dentro de este de
cuarto y así hasta el infinito, según el propietario del dominio decida
segmentar los nombres de su organización.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>En ocasiones, el <abbr title="Network Information Center">NIC</abbr> de un dominio de primer nivel se reserva la gestión
de dominios de segundo nivel como es el caso de algunos <abbr title="Network Information Center">NIC</abbr> geográficos que han
reproducido dentro de su dominio, algunos de los dominios de primer nivel
definidos por la <abbr title="Internet Corporation for Assigned Names and Numbers">ICANN</abbr>. Por ejemplo, en el dominio «es» los dominios
«com.es», «org.es» o «edu.es» están reservados por el <abbr title="Network Information Center">NIC</abbr> con la intención de que
las organizaciones particulares adquieran dominios de tercer nivel dentro
de ellos (p.e. el dominio «larioja.edu.es» lo tiene adquirido la
Consejería de Educación de La Rioja con fines educativos).</p>
</div>
</li>
<li><p>Hay, finalmente, un nombre de máquina. La expresión completa del nombre junto
al dominio recibe el nombre de <em class="dfn">nombre cualificado</em> (o <abbr title="Full Qualified Domain Name">FQDN</abbr>). En el ejemplo, pues,
el nombre de la máquina es «www» y su nombre cualificado «www.iescastillodeluna.es».</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Por lo general, la contratación de un dominio al <abbr title="Network Information Center">NIC</abbr> gestor por
parte de un particular sólo está supeditada a que tal dominio esté libre. Por
ejemplo, si deseáramos contratar el dominio «pericodelospalotes.es» el único
requisito es que tal dominio esté disponible, esto es, que otro particular no
lo haya contratado antes. Sin embargo, existen dominios en que la
contratación está restringida y la petición sólo se hace efectiva si el
organismo regulador la aprueba. Por ejemplo, para que el <abbr title="Network Information Center">NIC</abbr>.es acepte
una solicitud de un subdominio dentro de «edu.es», el solicitante debe
acreditar que es un organismo educativo o investigador.</p>
</div>
</section>
<section id="jerarquia">
<h2><span class="section-number">6.2.1.2. </span>Jerarquía<a class="headerlink" href="#jerarquia" title="Enlazar permanentemente con este título">¶</a></h2>
<p>¿Cómo se implementa esta jerarquía de nombres? Mediante un conjunto de
servidores de nombres (<abbr title="Domain Name Server">DNS</abbr>) también jerarquizados:</p>
<img alt="../../_images/estructura_jerarquica.png" src="../../_images/estructura_jerarquica.png" />
<p>La <abbr title="Internet Corporation for Assigned Names and Numbers">ICANN</abbr> se encarga de gestionar los denominados servidores raíz, 13 en
total. Estos servidores son los encargados de indicar cuáles son los servidores
encargados de gestionar los <abbr title="Top-Level Domain">TLD</abbr>, por lo que podríamos considerarlos como los
servidores de nivel <strong>0</strong>. Todos contienen la misma información y la existencia
de varios responde a una necesidad de redundancia. Si el servidor fuera único,
toda la resolución de nombres dependería de un único servidor, por lo que un
fallo en él, sería catastrófico. Esta redundancia existe también en los
servidores <abbr title="Domain Name Server">DNS</abbr> del resto de niveles. En la figura, sin embargo, hemos evitado
mostrar la redundancia para simplificar el esquema.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Para la implementación de la redundancia (al menos en servidores
por debajo de los <abbr title="Top-Level Domain">TLD</abbr>), se define un <em class="dfn">servidor maestro</em> (también
llamado <em class="dfn">servidor primario</em>) en el que se hace la definición de
resoluciones del dominio y uno o varios servidores llamado (<em class="dfn">servidor
esclavo</em> o <em class="dfn">servidor secundario</em>) que se sincroniza con éste cada cierto
tiempo copiando sus definiciones.</p>
</div>
<p>Cada <abbr title="Top-Level Domain">TLD</abbr>, a cargo de un <abbr title="Network Information Center">NIC</abbr> por su parte, refiere los servidores <abbr title="Domain Name Server">DNS</abbr> que
gestionan los dominios de segundo nivel que jerárquicamente depende de él. Por
ejemplo, como se ilustra en la figura, el <abbr title="Top-Level Domain">TLD</abbr> de «es» referirá, entre otros
muchos, cuáles son los servidores <abbr title="Domain Name Server">DNS</abbr> que gestionan los dominios
«iescastillodeluna.es», «moncloa.es» o «uca.es». Si existieran dominios de nivel
inferior (tercer nivel), los servidores que los gestionan se refieren en el
<abbr title="Domain Name Server">DNS</abbr> que gestiona en el nivel correspondiente inmediatamente superior.</p>
<p>Todos los servidores que se han ilustrado en la figura son <em class="dfn">servidores DNS
autoritarios</em> para su dominio correspondiente, esto es, son los servidores
<abbr title="Domain Name Server">DNS</abbr> en los que están hechas las definiciones para la resolución de los nombres
de ese dominio.</p>
<p>Por tanto, a diferencia de cómo originalmente se resolvían nombres, donde todas
las definiciones estaban concentradas en un mismo sitio (un archivo), en el
sistema <abbr title="Domain Name Server">DNS</abbr> la base de datos está distribuida, de modo que cada servidor
autoritario contienen únicamente las resoluciones referentes a su dominio.</p>
<p>Aunque la obtención de un subdominio exige su contratación con el <abbr title="Network Information Center">NIC</abbr> gestor
del <abbr title="Top-Level Domain">TLD</abbr>, porque es éste el encargado de añadir su registro en el servidor
<abbr title="Domain Name Server">DNS</abbr> correspondiente, lo habitual es que el particular haga la contratación a
través de un intermediario acreditado que recibe el nombre de <em class="dfn">agente
registrador</em><a class="footnote-reference brackets" href="#id8" id="id1">1</a>. Aunque la función principal del agente registrador sea la
de intermediar con el <abbr title="Network Information Center">NIC</abbr> para las tareas relacionadas con el dominio
(contratación, traspaso, renovación, etc.), suele ofrecer a sus clientes
servicios <em>adicionales</em>:</p>
<ul class="simple">
<li><p>Un servidor <abbr title="Domain Name Server">DNS</abbr> para alojar los registros del dominio contratado. Esto
ahorra al cliente el mantenimiento de un servidor <abbr title="Domain Name Server">DNS</abbr> propio.</p></li>
<li><p>Un servidor de correo básico con al menos una cuenta definida.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Un servidor <abbr title="Domain Name Server">DNS</abbr> no tiene por qué gestionar un único dominio. De
hecho, lo habitual es que los dominios de segundo nivel contratados por
particulares estén gestionados por el servidor <abbr title="Domain Name Server">DNS</abbr><a class="footnote-reference brackets" href="#id9" id="id2">2</a> del <em>agente
registrado</em> que haya usado como intermediario para la contratación.</p>
</div>
</section>
<section id="resolucion">
<h2><span class="section-number">6.2.1.3. </span>Resolución<a class="headerlink" href="#resolucion" title="Enlazar permanentemente con este título">¶</a></h2>
<p>En principio, partiendo de la jerarquía anterior, para resolver el nombre
«www.iescastillodeluna.es», el cliente:</p>
<ol class="arabic simple">
<li><p>Consulta a alguno de los servidores raíz, cuáles son los <abbr title="Top-Level Domain">TLD</abbr> del dominio
«es», a lo cual responderá uno de los raíz con la lista de todos ellos.</p></li>
<li><p>Volverá a realizar otra consulta, esta vez a alguno de los <abbr title="Top-Level Domain">TLD</abbr> facilitados
para que le facilite las direcciones <abbr title="Internet Protocol">IP</abbr> de los servidores que gestionan el
dominio «iescastillodeluna.es».</p></li>
<li><p>De la respuesta, escogerá uno de ellos para consultar cuál es la <abbr title="Internet Protocol">IP</abbr> de
la máquina «www.iescastillodeluna.es».</p></li>
</ol>
<p>Para ilustrar esto, podemos hacer la siguiente consulta<a class="footnote-reference brackets" href="#id10" id="id3">3</a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>dig +trace www.iescastillodeluna.es
</pre></div>
</div>
<p>Esto, no obstante, es poco eficiente: el cliente tiene que hacer varias
peticiones para obtener la resolución que desea y, además, todos los clientes
tendrían que hacer consultas a los servidores raíz lo que podría sobrecargarlos
de tráfico. En la práctica existen repartidos por internet muchos <em class="dfn">servidores
DNS recursivos</em> cuya misión es aceptar las peticiones de los clientes que a
ellos se dirijan, averiguar la dirección <abbr title="Internet Protocol">IP</abbr> del nombre requerido haciendo
consultas a los servidores autoritarios correspondientes siguiendo la
descripción expuesta arriba, y cachear el resultado el tiempo que el propietario
del nombre haya establecido. De este modo, si otro cliente (o el mismo cliente)
repiten la consulta dentro del tiempo de vigencia del registro, devolverán
directamente el resultado, sin volver a preguntar a los servidores autoritarios:</p>
<img alt="../../_images/dnscache.png" id="consulta-recursiva" src="../../_images/dnscache.png" />
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>En un cliente debe usarse como servidor <abbr title="Domain Name Server">DNS</abbr> un servidor recursivo, no
un servidor autoritario. De hecho, éste último servidor normalmente tiene
deshabilitadas las consultas recursivas, pro lo que sólo sirve para hacerle
consultas sobre nombres de su propio dominio..</p>
</div>
<p>Hay muchos servidores recursivos:</p>
<ul class="simple">
<li><p>Los del propio <abbr title="Internet Service Provider">ISP</abbr>.</p></li>
<li><p>Los de <a class="reference external" href="https://developers.google.com/speed/public-dns">Google</a>: 8.8.8.8 y 8.8.4.4.</p></li>
<li><p>Los de <a class="reference external" href="quad9.net/">Quad9</a>: 9.9.9.9 y 149.112.112.112.</p></li>
<li><p>Los de <a class="reference external" href="https://www.opendns.com/">OpenDNS</a>: 208.67.222.222 y 208.67.220.220.</p></li>
<li><p>Los de <a class="reference external" href="https://www.cloudflare.com/es-es/dns/">Cloudflare</a>: 1.1.1.1 y 1.0.0.1.</p></li>
<li><p>etc.</p></li>
</ul>
</section>
<section id="puertos">
<h2><span class="section-number">6.2.1.4. </span>Puertos<a class="headerlink" href="#puertos" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Los servidores <abbr title="Domain Name Server">DNS</abbr> escuchan en los puertos 53/<abbr title="User Datagram Protocol">UDP</abbr> y 53/<abbr title="Transmission Control Protocol">TCP</abbr>. El tráfico
<abbr title="User Datagram Protocol">UDP</abbr> se deja para consultas cuya respuesta es corta (512 <em>bytes</em> que es la
cantidad de datos efectivos que puede albergar un paquete <abbr title="User Datagram Protocol">UDP</abbr> de <abbr title="Domain Name Server">DNS</abbr>). Si la
respuesta es larga, el servidor obliga al cliente a hacer la consulta usando
<abbr title="Transmission Control Protocol">TCP</abbr>. El problema es que, según se han ido añadiendo funcionalidades al
protocolo (como <a class="reference internal" href="../../08.redes/99.ataques/02.tecnicas/01.dns.html#dnssec"><span class="std std-ref">DNSSEC</span></a>), el tamaño de las respuestas ha ido
creciendo.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>En 1999 se propuso <abbr title="Extension Mechanisms for DNS">EDNS</abbr>, que permite ampliar a 4KB el tamaño de
paquete, pero no se ha implementado de forma universal.</p>
</div>
<p><abbr title="Domain Name Server">DNS</abbr> es un protocolo antiguo por lo que es totalmente inseguro y cualquier
interceptor de la comunicación puede saber qué consultas se están haciendo. Para
paliar esto surgió:</p>
<ul>
<li><p><abbr title="Domain Name Server">DNS</abbr> mediante <abbr title="Transport Layer Security">TLS</abbr>, también conocido como <abbr title="DNS over TLS">DoT</abbr>, que cifra el tráfico <abbr title="Domain Name Server">DNS</abbr>
gracias al <a class="reference internal" href="../../98.apendice/01.cryto/03.aplicaciones/04.ssl.html#ssl"><span class="std std-ref">protocolo TLS</span></a>. Los servidores escuchan en el puerto
853/<abbr title="Transmission Control Protocol">TCP</abbr>. Algunos servidores <abbr title="Domain Name Server">DNS</abbr>, lo soportan:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>dig www.iescastillodeluna.es +tls @9.9.9.9
</pre></div>
</div>
</li>
<li><p><abbr title="Domain Name Server">DNS</abbr> mediante <abbr title="HyperText Transfer Protocol">HTTP</abbr>s, también conocido como <abbr title="DNS over HTTPs">DoH</abbr>, que encapsula el
tráfico <abbr title="Domain Name Server">DNS</abbr> dentro de tráfico <abbr title="HyperText Transfer Protocol">HTTP</abbr>s. Obviamente, los servidores escuchan
en el puerto 443/<abbr title="Transmission Control Protocol">TCP</abbr>. La ventaja de este metodo es que su tráfico es
indistinguible del tráfico <abbr title="HyperText Transfer Protocol">HTTP</abbr>s legítimo. También algunos servidor <abbr title="Domain Name Server">DNS</abbr>
recursivos, lo soportan:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>dig www.iescastillodeluna.es +https @9.9.9.9
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Obviamente, usar estos protocolos seguros implica que el dispositivo
del cliente los soporte. En principio, los navegadores modernos como <a class="reference external" href="https://www.mozilla.org/es-ES/firefox/">Firefox</a>
o los derivados de <a class="reference external" href="https://www.chromium.org">Chromium</a> soportan la posibilidad en su configuración.
También es posible instalar un servidor proxy en la máquina que escuche en el
puerto <strong>53</strong> de la interfaz local y haga peticiones seguras mediante <abbr title="Transport Layer Security">TLS</abbr> o
<abbr title="HyperText Transfer Protocol">HTTP</abbr>s. Un ejemplo de ello, con  paquete en <em>Debian</em>, es  <a class="reference external" href="https://blitiri.com.ar/git/r/dnss/b/next/t/f=README.md.html">dnss</a>.</p>
</div>
</section>
<section id="registros">
<span id="dns-registros"></span><h2><span class="section-number">6.2.1.5. </span>Registros<a class="headerlink" href="#registros" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Los <em>servidores autoritarios</em> de un dominio incluyen las definiciones de
resolución para tal dominio. A este respecto más que de dominio se habla de
«zona», ya que también definirse resoluciones para una red (resoluciones
inversas). Las definiciones toman la forma de registros: cada registro es una
definición distinta y se escribe con una línea de este aspecto:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;nombre_registro&gt;  [&lt;TTL&gt;]  IN     &lt;tipo_registro&gt;  &lt;valor_registro&gt;
</pre></div>
</div>
<p>La definición de una zona se compone de una lista de registros de distinto tipo
como la de arriba, algunos son obligatorios y otros opcionales.</p>
<p><abbr title="Time To Live">TTL</abbr> es el tiempo de vida del registro, esto es, el tiempo máximo que el
registro puede ser cacheado por algún <em>servidor recursivo</em>, que haya consultado
la resolución. Puede no especificarse y, en ese caso, el <abbr title="Time To Live">TTL</abbr> del registro será
el que se haya definido para la zona entera.</p>
<p>El nombre del registro y su valor dependen de cuál sea el tipo y, por último,
éste puede ser:</p>
<dl>
<dt><strong>SOA</strong></dt><dd><p>Es un registro obligatorio (toda zona tiene definido uno y solamente
uno) que describe algunas características de la propia zona y del resto de
registros. Un registro <abbr title="Start Of Authority">SOA</abbr> típico tiene el siguiente aspecto:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">@   IN    SOA   ns1  hostmaster.iescastillodeluna.es. (</span>
<span class="go">                     1   ; Serial</span>
<span class="go">                604800   ; Refresh</span>
<span class="go">                 86400   ; Retry</span>
<span class="go">               2419200   ; Expire</span>
<span class="go">               86400     ; Negative Cache TTL</span>
<span class="go">)</span>
</pre></div>
</div>
<p>Téngase presente en esta definición:</p>
<ul>
<li><p>El nombre es «&#64;» que significa <em>esta zona</em> o <em>este dominio</em>. Si
estuviéramos definiendo la zona del dominio «iescastillodeluna.es», la «&#64;»
equivale a «iescastillodeluna.es.».</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Obsérvese el punto con que acaba la expresión el dominio. No es
una errata. Al definir una zona, el <em>software</em> de servidor (<a class="reference internal" href="03.isc.html#bind"><span class="std std-ref">bind</span></a> al menos) añade a los nombres siempre la expresión del dominio.
El punto indica que no queremos añadirlo. Por tanto, escribir
«iescastillodeluna.es» sin punto equivale a haber escrito
«iescastillodeluna.es.iescastillodeluna.es.».</p>
</div>
</li>
<li><p>El valor se compone de tres miembros:</p>
<ul class="simple">
<li><p>El <em>nombre</em> de la máquina que contiene el archivo: «ns1» en este caso que
como no tiene punto se convierte en «ns1.iescastillodeluna.es».</p></li>
<li><p>El <em>correo electrónico</em> del encargado de mantener el archivo, aunque
sustituida «&#64;» por un punto. Por tanto, el correo sería
«<a class="reference external" href="mailto:hostmaster&#37;&#52;&#48;iescastillodeluna&#46;es">hostmaster<span>&#64;</span>iescastillodeluna<span>&#46;</span>es</a>»</p></li>
<li><p>Parámetros de configuración que se escriben entre paréntesis porque se
han usado varias líneas por claridad:</p>
<ul>
<li><p>La <em>versión</em> del archivo. Algunos administradores gustan de utilizar como
número la fecha de actualización del archivo (p.e. 20221002, si se
actualizó el 2 de octubre de 2022).</p></li>
<li><p>El <em>tiempo de refresco</em> que es el periodo de tiempo que deja trascurrir
un servidor esclavo entre dos solicitudes de transferencia al servidor
maestro para sincronizarse.</p></li>
<li><p>El <em>tiempo de reintento</em> que el tiempo que deja pasar un servidor
esclavo para repetir una solicitud de transferencia, en caso de que la
anterior fallara.</p></li>
<li><p>El <em>tiempo de expiración</em> que es el tiempo durante el cual se considera
válida la información que proporciona un servidor esclavo que no puede
sincronizarse con el maestro. Si este tiempo vence, el esclavo dejará
de atender peticiones de clientes para la zona que no ha podido
sincronizar.</p></li>
<li><p><abbr title="Time To Live">TTL</abbr> de todos los registros definidos dentro de la zona para los que
expresamente no se haya definido uno.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</dd>
<dt><strong>A</strong></dt><dd><p>Define cuál es la dirección <abbr title="Internet Protocol">IP</abbr> que corresponde a un nombre. Por ejemplo, el
registro:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">www                  IN    A     80.81.82.83</span>
</pre></div>
</div>
<p>establece que la máquina «www.iescastillodeluna.es» tiene la <abbr title="Internet Protocol">IP</abbr> arriba
indicada (recuérdese el efecto de no acabar los nombres con un punto).</p>
</dd>
<dt><strong>NS</strong></dt><dd><p>Define cuál es el servidor de nombres para el dominio que se especifique en
el nombre del registro. Por ejemplo, en el <abbr title="Top-Level Domain">TLD</abbr> de «es» debe de haber registro
parecido a este:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">iescastillodeluna    IN    NS    ns1023.ui-dns.de.</span>
</pre></div>
</div>
<p>ya que en la definición de la zona de un dominio deben referirse los
servidores <abbr title="Domain Name Server">DNS</abbr> en los que se delega la gestión de los subdominios. En
realidad, nunca hay un único servidor <abbr title="Domain Name Server">DNS</abbr> para resolver una zona, sino
varios (un maestro  y al menos un esclavo), por lo que en la zona «es» lo que
habrá más bien es esto<a class="footnote-reference brackets" href="#id11" id="id4">4</a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">iescastillodeluna    IN    NS    ns1023.ui-dns.de.</span>
<span class="go">                           NS    ns1037.ui-dns.org.</span>
<span class="go">                           NS    ns1045.ui-dns.com.</span>
<span class="go">                           NS    ns1025.ui-dns.biz.</span>
</pre></div>
</div>
<p>O sea, en un servidor maestro y tres esclavos<a class="footnote-reference brackets" href="#id12" id="id5">5</a>. Obsérvense dos cosas:</p>
<ul class="simple">
<li><p>El valor de estos registros es también un nombre de máquina, no
directamente una <abbr title="Internet Protocol">IP</abbr>.</p></li>
<li><p>En este caso, la definición de la zona «iescastillodeluna.es» se encuentra
en unos servidores <abbr title="Domain Name Server">DNS</abbr> dedicados a gestionar muchas zonas distintas,
como ocurre habitualmente con los dominios que pertenecen a
particulares, a los que proporciona este servicio el agente registrador.
¿Cuáles son las <abbr title="Internet Protocol">IP</abbr> de estos servidores? Las que se definan en las zonas
correspondientes: «ui-dns.de», «ui-dns.org», etc.</p></li>
</ul>
<p>Centrándonos en esta última particularidad, cabría otra posibilidad como la
que ocurre con el dominio «google.com» definido en el <abbr title="Top-Level Domain">TLD</abbr> de «com»:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>dig -tns google.com +short
<span class="go">ns2.google.com.</span>
<span class="go">ns3.google.com.</span>
<span class="go">ns1.google.com.</span>
<span class="go">ns4.google.com.</span>
</pre></div>
</div>
<p>Los servidores de nombres de la zona «google.com» tienen nombres del propio
dominio «google.com». Por ejemplo, «ns1.google.com». Bien, necesito conocer
su dirección <abbr title="Internet Protocol">IP</abbr> para poder usarlo. Pero esa dirección <abbr title="Internet Protocol">IP</abbr> está definida…
en el propio «ns1.google.com», así que ¿cómo la averiguo? Esta referencia
circular se soluciona incluyendo, además de la definición del registro
<kbd class="kbd docutils literal notranslate">NS</kbd>, la definición del registro :kbd.`A` correspondiente. Este registro
<kbd class="kbd docutils literal notranslate">A</kbd> definido en la zona superior («com» en este caso), complementando al
registro <kbd class="kbd docutils literal notranslate">NS</kbd>, se conoce como <em class="dfn">glue record</em>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">google      IN          NS    ns1.google</span>
<span class="go">ns1.google  IN           A    216.239.32.10</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Es importante llegar a entender dos cosas:</p>
<ul class="simple">
<li><p>La jerarquización de los nombres en dominios y subdominos se logra
gracias a este tipo de registro <kbd class="kbd docutils literal notranslate">NS</kbd>. Así, que se delegue la
gestión del subdominio «iescastillodeluna.es» en un servidor se logra
gracias a la inclusión de un registro <kbd class="kbd docutils literal notranslate">NS</kbd> en la definición de la
zona «es».</p></li>
<li><p>&quot;Comprar&quot; un dominio es, simplemente, adquirir el derecho a que el
<abbr title="Network Information Center">NIC</abbr> correspondiente incluya el registro <kbd class="kbd docutils literal notranslate">NS</kbd> en el <abbr title="Top-Level Domain">TLD</abbr> que
gestiona. Y, en realidad, la <em>compra</em> no es tal compra, sino más bien un
alquiler, ya que el derecho se paga por un plazo de tiempo determinado
(un años, dos años, cinco años), pasado el cual o se renueva tal derecho
o el <abbr title="Network Information Center">NIC</abbr> borrará el registro.</p></li>
</ul>
</div>
</dd>
<dt><strong>MX</strong></dt><dd><p>Registro que indica cuál es el servidor de correo del dominio. Obsérvese que
una dirección de correo es de la forma <code class="docutils literal notranslate"><span class="pre">usuario&#64;dominio</span></code>, por lo que en
ella no se expresa cuál es el servidor al que debe remitirse el mensaje
cuando se usa como destinatario. Quien define cuál es ese servidor es este
registro <kbd class="kbd docutils literal notranslate">MX</kbd>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">@           IN          MX    1 mail</span>
</pre></div>
</div>
<p>En este caso el servidor de correo (<kbd class="kbd docutils literal notranslate">MX</kbd>) del domio
«iescastillodeluna.es» es la máquina «mail.iescastillodeluna.es». El valor,
no obstante, tiene dos componentes: el nombre de la máquina y la prioridad
(<strong>1</strong> en este caso). Cuanto menor sea este número natural, mayor la
prioridad. Obviamente, si el nombre de la máquina pertenece al dominio.
habrá de añadirse un registro <kbd class="kbd docutils literal notranslate">A</kbd> para defiinir la dirección <abbr title="Internet Protocol">IP</abbr>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mail        IN          A     80.81.82.84</span>
</pre></div>
</div>
</dd>
<dt><strong>CNAME</strong></dt><dd><p>Permite definir un nombre alternativo para una máquina:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">smtp        IN          CNAME mail</span>
</pre></div>
</div>
<p>En este caso  «smtp» es un alias de la máquina «mail», cuya dirección habrá
tenido que definirse antes mediante  un registro <kbd class="kbd docutils literal notranslate">A</kbd>.</p>
</dd>
<dt><strong>TXT</strong></dt><dd><p>Almacena en su valor información arbitraria<a class="footnote-reference brackets" href="#id13" id="id6">6</a> de texto que puede usarse para
distintos fines. Un ejemplo son los <a class="reference internal" href="../../07.serre/03.mail/02-smtp/05-dns.html#spf"><span class="std std-ref">registros SPF</span></a> para evitar el
<em>spam</em> en el correo electrónico:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>dig -ttxt gmail.com +noall +answer
<span class="go">gmail.com.              282     IN      TXT   &quot;v=spf1 redirect=_spf.google.com&quot;</span>
<span class="go">gmail.com.              282     IN      TXT   &quot;globalsign-smime-dv=CDYX+XFHUw2wml6/Gb8+59BsH31KzUr6c1l2BPvqKX8=&quot;</span>
</pre></div>
</div>
</dd>
<dt><strong>SRV</strong></dt><dd><p>Este tipo de registros sirv para declarar qué máquinas albergan detérminados
servidos (de ahí su nombre <strong>S</strong>e<strong>RV</strong>ice), además de para establecer
una preferencia entre ellas para el caso de que existan varias dedicadas al
mismo servicio. Puede entenderse, por tanto, como una generalización del
registro <kbd class="kbd docutils literal notranslate">MX</kbd>, que solo sirve para correo electrónico.</p>
<p>Tienen este aspecto (lo definimos para el servicio <abbr title="HyperText Transfer Protocol">HTTP</abbr>):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">_http._tcp.www   IN   SRV  0   2   80     www</span>
<span class="go">                      SRV  0   1   80     www2</span>
<span class="go">                      SRV  1   1   8080   w3</span>
</pre></div>
</div>
<p>En estas líneas:</p>
<ul>
<li><p>El <em>nombre</em> del registro especifica que se pide a la <abbr title="Uniform Resource Locator">URL</abbr>
«www.iescastillodeluna.es» el servicio <abbr title="HyperText Transfer Protocol">HTTP</abbr> de la capa de transporte
<abbr title="Transmission Control Protocol">TCP</abbr>.</p></li>
<li><p>El <em>valor</em> tiene, a su vez, cuatro campos:</p>
<ul class="simple">
<li><p>La <em>prioridad</em> (cuanto más baja, mayor).</p></li>
<li><p>El <em>peso</em> dentro de una misma prioridad.</p></li>
<li><p>El puerto de escucha.</p></li>
<li><p>El nombre de la máquina que proporciona el servicio.</p></li>
</ul>
<p>El ejemplo en concreto significa: consulta prioritariamente las máquinas
«www.iescastillodeluna.es» y «www2.iescastillodeluna.es» por el puerto
<strong>80</strong>, la primera el doble de veces que la segunda; y sólo en caso de que
estas estén inaccesibles, consulta por el puerto <strong>8080</strong> la máquina
«w3.iescastillodeluna.es».</p>
</li>
</ul>
<p>Estos registros, aunque pueden definirse para cualquiera, no se usan en todos
los servicios (de hecho, es imposible si la especificación del servicio es
anterior a la introducción del tipo de registro<a class="footnote-reference brackets" href="#id14" id="id7">7</a>). De hecho, <abbr title="HyperText Transfer Protocol">HTTP</abbr> es
uno de esos servicios en los que no se usa, aunque se haya puesto de
ejemplo.</p>
<div class="admonition seealso">
<p class="admonition-title">Ver también</p>
<p>Para más información sobre este registro, consulte <a class="reference external" href="https://docstore.mik.ua/orelly/networking_2ndEd/dns/ch16_06.htm#INDEX-2436">esta
documentación</a>.</p>
</div>
</dd>
<dt><strong>PTR</strong></dt><dd><p>Es el registro inverso a <kbd class="kbd docutils literal notranslate">A</kbd>. Por tanto, permite asociar un nombre a una
dirección <abbr title="Internet Protocol">IP</abbr>. Estos registros se encuentran en las zonas de resolución
inversa (o sea, en las que pretenden definir la resolución en una red y no en
un dominio). Por ejemplo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">25.0              IN     PTR    oki-printer.iescdl.es.</span>
</pre></div>
</div>
<p>supuesto que esté en el archivo que define las resoluciones en la red
<code class="docutils literal notranslate"><span class="pre">172.22.0.0/16</span></code>, define que la <abbr title="Internet Protocol">IP</abbr> <code class="docutils literal notranslate"><span class="pre">172.22.0.25</span></code> tiene por nombre
«oki-printer.iescdl.es».</p>
</dd>
<dt><strong>RRSIG</strong>/<strong>DS</strong>/<strong>DNSKEY</strong>/<strong>NSEC</strong>/<strong>NSEC3</strong>/<strong>CDNKEY</strong>/<strong>CDS</strong></dt><dd><p>Son registros relacionados con la implementación de <abbr title="Domain Name Server SECurity extensions">DNSSEC</abbr>.</p>
</dd>
</dl>
</section>
<section id="dnssec">
<span id="dns-dnssec"></span><h2><span class="section-number">6.2.1.6. </span><abbr title="Domain Name Server SECurity extensions">DNSSEC</abbr><a class="headerlink" href="#dnssec" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="admonition seealso">
<p class="admonition-title">Ver también</p>
<p>Consulte el <a class="reference internal" href="../../08.redes/99.ataques/02.tecnicas/01.dns.html#dnssec"><span class="std std-ref">epígrafe dedicado a definirlo</span></a>.</p>
</div>
</section>
<section id="glosario">
<h2><span class="section-number">6.2.1.7. </span>Glosario<a class="headerlink" href="#glosario" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Para terminar referiremos algunas definiciones, gran parte de las cuáles ya están recogidas bajo los epígrafes anteriores:</p>
<dl class="simple">
<dt><em class="dfn">Servidor autoritario</em></dt><dd><p>Es el servidor con información sobre una determinada zona. En cambio, es no
autoritario si para proporcionar cierta información a un cliente necesita
preguntársela a otro servidor.</p>
</dd>
<dt><em class="dfn">Consulta recursiva</em></dt><dd><p>Es la consulta que un servidor realiza repetidamente a otros con el fin de
poder dar respuesta a una resolución requerida por un cliente. La razón de
que se denomine recursiva se observa muy bien <a class="reference internal" href="#consulta-recursiva"><span class="std std-ref">en la figura que ilustra
una</span></a>.</p>
</dd>
<dt><em class="dfn">Servidor maestro</em></dt><dd><p>Es el <em>servidor autoritario</em> en el que originariamente se registra la información sobre una zona.</p>
</dd>
<dt><em class="dfn">Servidor esclavo</em></dt><dd><p>Es el <em>servidor autoritario</em> que replica la información de zona facilitada
por el servidor maestro, gracias a que periódicamente se sincroniza con
éste.</p>
</dd>
<dt><em class="dfn">Resolución directa</em></dt><dd><p>Es la resolución que permite obtener una dirección <abbr title="Internet Protocol">IP</abbr> a partir de un nombre de máquina.</p>
</dd>
<dt><em class="dfn">Resolución inversa</em></dt><dd><p>Es la resolución que permite obtener un nombre de máquina a partir de una dirección <abbr title="Internet Protocol">IP</abbr>.</p>
</dd>
</dl>
<p class="rubric">Notas al pie</p>
<dl class="footnote brackets">
<dt class="label" id="id8"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Por ejemplo, <a class="reference external" href="https://www.dominios.es/es/agentes-registradores/nuestros-agentes-registradores">esta es la lista de agentes registradores para dominios
dependientes de NIC.es</a>.</p>
</dd>
<dt class="label" id="id9"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>En realidad, el agente registrados dispondrá varios servidor <abbr title="Domain Name Server">DNS</abbr>, pero
no porque tenga que gestionar muchos dominios, sino porque se necesita, como
ya explicamos, redundancia.</p>
</dd>
<dt class="label" id="id10"><span class="brackets"><a class="fn-backref" href="#id3">3</a></span></dt>
<dd><p>No parece funcionar correctamente en la versión <em>9.18</em>.</p>
</dd>
<dt class="label" id="id11"><span class="brackets"><a class="fn-backref" href="#id4">4</a></span></dt>
<dd><p>No es que seamos muy listos, es que hemos hecho previamente la consulta:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>dig -tns iescastillodeluna.es +noall +answer
</pre></div>
</div>
</dd>
<dt class="label" id="id12"><span class="brackets"><a class="fn-backref" href="#id5">5</a></span></dt>
<dd><p>¿Cuál es el maestro de los cuatro? No es realmente importante saberlo,
pero si somos curiosos, podemos consultar el registro <abbr title="Start Of Authority">SOA</abbr> a ver en qué
máquina se encuentra la definición de la zona:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>dig -tsoa iescastillodeluna.es +short
<span class="go">ns1037.ui-dns.org. hostmaster.1und1.com. 2017060116 28800 7200 604800 600</span>
</pre></div>
</div>
<p>Por lo que parece, el servidor maestro es «ns1037.ui-dns.org».</p>
</dd>
<dt class="label" id="id13"><span class="brackets"><a class="fn-backref" href="#id6">6</a></span></dt>
<dd><p>La información <em>puede</em> ser arbitraria. Normalmente, responde a algún fin.</p>
</dd>
<dt class="label" id="id14"><span class="brackets"><a class="fn-backref" href="#id7">7</a></span></dt>
<dd><p>El registro se introdujo a través  del <span class="target" id="index-0"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2052.html"><strong>RFC 2052</strong></a> a finales de
1996, aunque su formulación actual es del año 2000 (<span class="target" id="index-1"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2782.html"><strong>RFC 2782</strong></a>).</p>
</dd>
</dl>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../index.html">Tabla de contenido</a></h3>
    <ul>
<li><a class="reference internal" href="#">6.2.1. Protocolo</a><ul>
<li><a class="reference internal" href="#nombres">6.2.1.1. Nombres</a></li>
<li><a class="reference internal" href="#jerarquia">6.2.1.2. Jerarquía</a></li>
<li><a class="reference internal" href="#resolucion">6.2.1.3. Resolución</a></li>
<li><a class="reference internal" href="#puertos">6.2.1.4. Puertos</a></li>
<li><a class="reference internal" href="#registros">6.2.1.5. Registros</a></li>
<li><a class="reference internal" href="#dnssec">6.2.1.6. <abbr title="Domain Name Server SECurity extensions">DNSSEC</abbr></a></li>
<li><a class="reference internal" href="#glosario">6.2.1.7. Glosario</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Tema anterior</h4>
    <p class="topless"><a href="index.html"
                          title="capítulo anterior"><span class="section-number">6.2. </span>DNS</a></p>
  </div>
  <div>
    <h4>Próximo tema</h4>
    <p class="topless"><a href="02.clientes.html"
                          title="próximo capítulo"><span class="section-number">6.2.2. </span>Clientes</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/06.infraestructura/03.dns/01.desc.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Ir a" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="02.clientes.html" title="6.2.2. Clientes"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="index.html" title="6.2. DNS"
             >anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" ><span class="section-number">6. </span>Servicios de infraestructura</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" ><span class="section-number">6.2. </span>DNS</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">6.2.1. </span>Protocolo</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Derechos de autor CC BY 4.0, 2016-2022, José Miguel Sánchez Alés.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.5.0.
    </div>
  </body>
</html>