

<!DOCTYPE html>

<html lang="es" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>3.6.2. Tratamiento de argumentos &#8212; documentación de Linuxnomicón - rolling</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/classic.css?v=514cf933" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    
    <script src="../../_static/documentation_options.js?v=a621b78a"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/translations.js?v=efdbd0b9"></script>
    
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../search.html" />
    <link rel="next" title="3.6.3. Preevaluación de órdenes" href="02.eval.html" />
    <link rel="prev" title="3.6.1. Detección de la shell" href="00.deteccion.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="02.eval.html" title="3.6.3. Preevaluación de órdenes"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="00.deteccion.html" title="3.6.1. Detección de la shell"
             accesskey="P">anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" ><span class="section-number">3. </span>Programación de <em>scripts</em></a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U"><span class="section-number">3.6. </span>Otros aspectos</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">3.6.2. </span>Tratamiento de argumentos</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="tratamiento-de-argumentos">
<span id="sh-gnu-args"></span><h1><span class="section-number">3.6.2. </span>Tratamiento de argumentos<a class="headerlink" href="#tratamiento-de-argumentos" title="Link to this heading">¶</a></h1>
<p>Ya se explicó <a class="reference internal" href="../02.io.html#sh-args"><span class="std std-ref">cómo acceder a los argumentos</span></a> de un <em>script</em>. Sin
embargo, si se quiere escribir uno en que estos argumentos sean variados y
algunos opcionales, usar argumentos posicionales es absolutamente
desaconsejable. Lo más apropiado es crear <em>scripts</em> que usen para sus argumentos
el <a class="reference internal" href="../../02.conbas/01.preliminares/index.html#ordenar"><span class="std std-ref">estilo POSIX</span></a>. Por ejemplo, algo así:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>./args.sh<span class="w"> </span>-h
<span class="go">args.sh [opciones] arg1 [arg2 ...]</span>
<span class="go">  Ilustra el procesamiento de las opciones de un script.</span>

<span class="go">Opciones:</span>
<span class="go"> -h, --help                      Muestra esta misma ayuda.</span>
<span class="go"> -f, --file &lt;FICHERO&gt;            Fichero de entrada...</span>
<span class="go"> -p, --password &lt;PASSWORD&gt;       Permite indicar la contraseña.</span>
<span class="go"> -v, --verbose                   Ofrece información adicional</span>
</pre></div>
</div>
<p>donde vemos que hay algunas opciones con y sin argumento adicional y uno o
varios argumentos no asociados a ninguna opción (<kbd class="kbd docutils literal notranslate">arg1</kbd>, <kbd class="kbd docutils literal notranslate">arg2</kbd>, etc.)</p>
<p id="index-0"><span id="getopts"></span>El estándar<a class="footnote-reference brackets" href="#id5" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> proporciona la orden interna <strong class="command">getopts</strong>, que tiene
algunas limitaciones:</p>
<ol class="arabic simple">
<li><p>Sólo permite manejar opciones cortas, no largas (por tanto, en nuestro ejemplo
no podremos soportar <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">-</kbd>-<kbd class="kbd docutils literal notranslate">file</kbd></kbd> ni <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">-</kbd>-<kbd class="kbd docutils literal notranslate">password</kbd></kbd>).</p></li>
<li><p>No es trivial soportar que los argumentos no asociados a opciones se
antepongan a éstas, esto es, que permitamos escribir, por ejemplo,
<code class="code docutils literal notranslate"><span class="pre">args.sh</span> <span class="pre">arg1</span> <span class="pre">-farchivo</span></code> en vez de <code class="code docutils literal notranslate"><span class="pre">args.sh</span> <span class="pre">-farchivo</span> <span class="pre">arg1</span></code>.</p></li>
</ol>
<p>La primera, en especial, es bastante frustante, si queremos darle cierto aire de
profesionalidad a nuestro <em>script</em>. En cualquier caso, expongamos cómo se usa.
Recibe dos argumentos:</p>
<ul class="simple">
<li><p>La cadena que declara cuáles son las opciones (cortas) admisibles y si
requieren argumento.</p></li>
<li><p>Un nombre para la variable que almacenará el nombre de la opción.</p></li>
</ul>
<p>En el ejemplo ilustrativo <strong class="command">getopts</strong> se podría usar así:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">getopts &quot;:hvf:p:&quot; opt</span>
</pre></div>
</div>
<p>Como los dos puntos (<code class="docutils literal notranslate"><span class="pre">:</span></code>) indican que la opción requiere argumento, resulta
que declaramos dos opciones (<code class="docutils literal notranslate"><span class="pre">-h</span></code> y <code class="docutils literal notranslate"><span class="pre">-v</span></code>) que no necesitan ninguno; y otras
dos opciones (<code class="docutils literal notranslate"><span class="pre">-f</span></code> y <code class="docutils literal notranslate"><span class="pre">-p</span></code>) que sí lo necesitan. Los dos puntos con que se
abre la cadena, le indican a <strong class="command">getopts</strong> que no muestre mensajes de error
cuando procesa los argumentos.</p>
<p>Ante este orden <strong class="command">getopts</strong> comienza a analizar <code class="docutils literal notranslate"><span class="pre">$&#64;</span></code> y parará su
análisis cuando encuentre la primera opción. Por ejemplo, si escribimos:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>args.sh<span class="w"> </span>-v<span class="w"> </span>-f<span class="w"> </span>fichero.txt<span class="w"> </span>-p<span class="w"> </span>password
</pre></div>
</div>
<p>hallará la opción <code class="docutils literal notranslate"><span class="pre">-v</span></code> y como esta no requiere argumento parará.
<strong class="command">getopts</strong> almacena en la variable <code class="docutils literal notranslate"><span class="pre">OPTIND</span></code> cuál es el próximo
parámetro posicional que debe analizar. Antes del análisis era <strong>1</strong> y, después
de ejecutarse, valdrá <strong>2</strong>. Además, almacena en la variable que le hemos pasado
(<code class="docutils literal notranslate"><span class="pre">opt</span></code>) el nombre de la variable (<em>v</em>, en esta pasada) y en la variable
<code class="docutils literal notranslate"><span class="pre">OPTARG</span></code>, el valor del argumento, que en este caso no tiene sentido porque
<code class="docutils literal notranslate"><span class="pre">-v</span></code> no admite argumento. Si queremos seguir analizando, debemos volver a
ejecutar otra vez la orden:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">getopts &quot;:hvf:p:&quot; opt</span>
</pre></div>
</div>
<p>Ahora, lo que <strong class="command">getopts</strong> encuentra es <code class="docutils literal notranslate"><span class="pre">-f</span></code>, pero como tal opción
requiere un argumento toma también el siguiente parámetro posicional
(<em>fichero.txt</em>), con lo que <code class="docutils literal notranslate"><span class="pre">opt</span></code> valdrá <em>f</em>, <code class="docutils literal notranslate"><span class="pre">OPTARG</span></code> <em>fichero.txt</em> y
<code class="docutils literal notranslate"><span class="pre">OPTIND</span></code> <strong>4</strong>. Mientras <strong class="command">getopts</strong> encuentra opciones (sean o no
válidas) devuelve <strong>0</strong> y solamente deja de devolverlo cuando:</p>
<ol class="arabic simple">
<li><p>Se llega al final de <code class="docutils literal notranslate"><span class="pre">$&#64;</span></code> (o sea, se acaban los argumentos del programa).</p></li>
<li><p>Se encuentra con el argumento <code class="docutils literal notranslate"><span class="pre">--</span></code>, que significa en el estándar que ya no
hay más opciones y todo lo que venga a continuación debe entenderse como
argumento no asociado a opciones.</p></li>
<li><p>Se encuentra con un argumento que no está asociado a ninguna opción, por lo
que en la orden <code class="code docutils literal notranslate"><span class="pre">$</span> <span class="pre">args.sh</span> <span class="pre">-v</span> <span class="pre">hola</span> <span class="pre">-f</span> <span class="pre">fichero.txt</span> <span class="pre">-p</span> <span class="pre">password</span></code> no
devolverá <strong>0</strong> al toparse con <em>hola</em>.</p></li>
</ol>
<p>En cambio, cuando <strong class="command">getopts</strong> encuentra algo que no se ajusta a la
sintaxis que hemos definido, no genera error ni devuelve algo distinto de <strong>0</strong>,
sino que juega con los valores de <kbd class="kbd docutils literal notranslate">opt</kbd> (o como quiera que la hayamos
llamado) y <kbd class="kbd docutils literal notranslate">OPTARG</kbd> para hacérnoslo notar:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Error</p></th>
<th class="head"><p><kbd class="kbd docutils literal notranslate">opt</kbd></p></th>
<th class="head"><p><kbd class="kbd docutils literal notranslate">OPTARG</kbd></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>La opción no existe</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">?</span></code></p></td>
<td><p>Opción</p></td>
</tr>
<tr class="row-odd"><td><p>Falta argumento de la opción</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">:</span></code></p></td>
<td><p>Opción</p></td>
</tr>
</tbody>
</table>
<p>Sabido esto, el análisis de los argumentos puede hacerse así:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">while</span><span class="w"> </span><span class="nb">getopts</span><span class="w"> </span><span class="s2">&quot;:hv:f:p:&quot;</span><span class="w"> </span>opt<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">   </span><span class="k">case</span><span class="w"> </span><span class="nv">$opt</span><span class="w"> </span><span class="k">in</span>
<span class="w">      </span>h<span class="o">)</span>
<span class="w">         </span><span class="nb">help</span><span class="w">  </span><span class="c1"># Función &quot;help&quot; que tenemos definida antes.</span>
<span class="w">         </span><span class="nb">exit</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">;;</span>
<span class="w">      </span>v<span class="o">)</span><span class="w"> </span><span class="nv">VERBOSE</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="p">;;</span>
<span class="w">      </span>f<span class="o">)</span><span class="w"> </span><span class="nv">ENTRADA</span><span class="o">=</span><span class="nv">$OPTARG</span><span class="w"> </span><span class="p">;;</span>
<span class="w">      </span>p<span class="o">)</span><span class="w"> </span><span class="nv">PASSWORD</span><span class="o">=</span><span class="nv">$OPTARG</span><span class="w"> </span><span class="p">;;</span>
<span class="w">      </span><span class="se">\?</span><span class="o">)</span>
<span class="w">         </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;-</span><span class="nv">$OPTARG</span><span class="s2">: La opción no existe&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="w">         </span><span class="nb">exit</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="p">;;</span>
<span class="w">      </span>:<span class="o">)</span>
<span class="w">         </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;-</span><span class="nv">$OPTARG</span><span class="s2"> requiere argumento&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="w">         </span><span class="nb">exit</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="p">;;</span>
<span class="w">   </span><span class="k">esac</span>
<span class="k">done</span>
<span class="nb">shift</span><span class="w"> </span><span class="k">$((</span><span class="nv">OPTIND</span><span class="o">-</span><span class="m">1</span><span class="k">))</span>
<span class="c1"># En $@ quedan los argumentos no asociados a opciones.</span>
</pre></div>
</div>
<p>Así, de forma relativamente sencilla, el programa generará un error y saldrá con código
<strong>2</strong>, si no se introdujeron bien los parámetros; o, en caso contrario,
tendremos disponible en distintas variables (<code class="docutils literal notranslate"><span class="pre">ENTRADA</span></code>, <code class="docutils literal notranslate"><span class="pre">PASSWORD</span></code> y
<code class="docutils literal notranslate"><span class="pre">VERBOSE</span></code>)<a class="footnote-reference brackets" href="#id6" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a> la información que introdujo el usuario. Además, el último
<strong class="command">shift</strong> elimina todos los parámetros revisados por <strong class="command">getopts</strong> con lo
que en <code class="docutils literal notranslate"><span class="pre">$&#64;</span></code> quedarán los argumentos no asociados a opciones.</p>
<p class="rubric">Parcheando getopts</p>
<p>Si nos basta con esto, <strong class="command">getopts</strong> es una buena solución. Si deseamos dar
soporte a opciones largas, podemos definir una función que usa la argucia<a class="footnote-reference brackets" href="#id7" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>
de añadir como opción válida el guión y que este requira argumento. De este modo
todas las opciones largas se identificarán con la opción corta <code class="docutils literal notranslate"><span class="pre">--</span></code><a class="footnote-reference brackets" href="#id8" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>patch_lo<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">   </span><span class="nb">local</span><span class="w"> </span><span class="nv">LO</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="nv">_OPT</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
<span class="w">   </span><span class="nb">shift</span><span class="w"> </span><span class="m">2</span>

<span class="w">   </span><span class="nb">eval</span><span class="w"> </span><span class="s2">&quot;[ \$</span><span class="nv">$_OPT</span><span class="s2"> = &#39;-&#39; ] || return 0&quot;</span>

<span class="w">   </span><span class="nb">local</span><span class="w"> </span><span class="nv">o</span><span class="o">=</span><span class="si">${</span><span class="nv">OPTARG</span><span class="p">%%=*</span><span class="si">}</span>
<span class="w">   </span><span class="nb">eval</span><span class="w"> </span><span class="nv">$_OPT</span><span class="o">=</span><span class="se">\$</span>o

<span class="w">   </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LO</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-qw<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$o</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span><span class="w">  </span><span class="c1"># La opción no existe</span>
<span class="w">      </span><span class="nb">eval</span><span class="w"> </span><span class="nv">$_OPT</span><span class="o">=</span><span class="s1">&#39;\?&#39;</span>
<span class="w">      </span><span class="nv">OPTARG</span><span class="o">=</span>-<span class="nv">$o</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">   </span><span class="k">fi</span>

<span class="w">   </span><span class="nv">OPTARG</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$OPTARG</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-s<span class="w"> </span>-d<span class="o">=</span><span class="w"> </span>-f2-<span class="k">)</span><span class="w">  </span><span class="c1"># Suponiendo --opcion=valor</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LO</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;\&lt;</span><span class="nv">$o</span><span class="s2">:&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span><span class="w">  </span><span class="c1"># La opción requiere argumento</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$OPTARG</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span><span class="w">  </span><span class="c1"># Se debió escribir --opcion valor</span>
<span class="w">         </span><span class="nb">eval</span><span class="w"> </span><span class="nv">OPTARG</span><span class="o">=</span><span class="se">\$</span><span class="k">$((</span><span class="nv">OPTIND</span><span class="k">))</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$OPTARG</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span><span class="w">  </span><span class="c1"># No se facilitó argumento</span>
<span class="w">            </span><span class="nb">eval</span><span class="w"> </span><span class="nv">$_OPT</span><span class="o">=</span><span class="s2">&quot;:&quot;</span>
<span class="w">            </span><span class="nv">OPTARG</span><span class="o">=</span>-<span class="nv">$o</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">         </span><span class="k">fi</span>
<span class="w">         </span><span class="nv">OPTIND</span><span class="o">=</span><span class="k">$((</span><span class="nv">OPTIND</span><span class="o">+</span><span class="m">1</span><span class="k">))</span>
<span class="w">      </span><span class="k">fi</span>
<span class="w">   </span><span class="k">elif</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$OPTARG</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span><span class="w">  </span><span class="c1"># No requiere argumento, pero se ha añadido uno.</span>
<span class="w">      </span><span class="c1"># Se elimina el argumento</span>
<span class="w">      </span><span class="nv">OPTARG</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="w">   </span><span class="k">fi</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Con <strong class="program">dash</strong> sólo es posible usar la forma
<kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">-</kbd>-<kbd class="kbd docutils literal notranslate">opt=valor</kbd></kbd> y no <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">-</kbd>-<kbd class="kbd docutils literal notranslate">opt</kbd> <kbd class="kbd docutils literal notranslate">valor</kbd></kbd></p>
</div>
<p>Su uso no difiere mucho del que ya hemos visto:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="k">while</span><span class="w"> </span><span class="nb">getopts</span><span class="w"> </span><span class="s2">&quot;:hvf:p:-:&quot;</span><span class="w"> </span>opt<span class="p">;</span><span class="w"> </span><span class="k">do</span>
</span><span class="hll"><span class="w">   </span>patch_lo<span class="w"> </span><span class="s2">&quot;help verbose file:password:&quot;</span><span class="w"> </span>opt<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
</span><span class="w">   </span><span class="k">case</span><span class="w"> </span><span class="nv">$opt</span><span class="w"> </span><span class="k">in</span>
<span class="w">      </span>h<span class="p">|</span><span class="nb">help</span><span class="o">)</span>
<span class="w">         </span><span class="nb">help</span>
<span class="w">         </span><span class="nb">exit</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">;;</span>
<span class="w">      </span>v<span class="p">|</span>verbose<span class="o">)</span><span class="w"> </span><span class="nv">VERBOSE</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="p">;;</span>
<span class="w">      </span>f<span class="p">|</span>file<span class="o">)</span><span class="w"> </span><span class="nv">FICHERO</span><span class="o">=</span><span class="nv">$OPTARG</span><span class="w"> </span><span class="p">;;</span>
<span class="w">      </span>p<span class="p">|</span>password<span class="o">)</span><span class="w"> </span><span class="nv">PASSWORD</span><span class="o">=</span><span class="nv">$OPTARG</span><span class="w"> </span><span class="p">;;</span>
<span class="w">      </span><span class="se">\?</span><span class="o">)</span>
<span class="w">         </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;-</span><span class="nv">$OPTARG</span><span class="s2">: Opción inválida.&quot;</span>
<span class="w">         </span><span class="nb">exit</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="p">;;</span>
<span class="w">      </span>:<span class="o">)</span>
<span class="w">         </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;-</span><span class="nv">$OPTARG</span><span class="s2"> requiere un argumento&quot;</span>
<span class="w">         </span><span class="nb">exit</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="p">;;</span>
<span class="w">   </span><span class="k">esac</span>
<span class="k">done</span>
<span class="nb">shift</span><span class="w"> </span><span class="k">$((</span><span class="nv">OPTIND</span><span class="o">-</span><span class="m">1</span><span class="k">))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Obsérvese que a la declaración en <strong class="command">getopts</strong> de las opciones
cortas se ha añadido «<code class="code docutils literal notranslate"><span class="pre">-:</span></code>».</p>
</div>
<p>El ejemplo completo del programa de prueba hecho con <strong class="command">getopts</strong>, se
<a class="reference download internal" download="" href="../../_downloads/7010bfad07a5040f59b455c780141590/args.sh"><code class="xref download docutils literal notranslate"><span class="pre">puede</span> <span class="pre">descargar</span> <span class="pre">también</span></code></a>.</p>
<p class="rubric" id="sh-argmanual">Solución artesanal</p>
<p>La limitación casi intolerable de <strong class="command">getopts</strong> es que sólo admite opciones
cortas y, si se quiere dar soporte a opciones largas, es necesario escribir una
función con abundante código. Otro modo de abordar el problema es prescindir de
él e implementar una solución nosotros mismos, mientras seamos capaces:</p>
<ul class="simple">
<li><p>De no complicar en exceso el código.</p></li>
<li><p>De mantener el mayor número de características del estándar POSIX.</p></li>
</ul>
<p>¿Es posible? Lo cierto es que sí. <a class="reference download internal" download="" href="../../_downloads/b7ff0502837ec394f13901beecf2ed79/args_artesanal.sh"><code class="xref download docutils literal notranslate"><span class="pre">Del</span> <span class="pre">código</span> <span class="pre">completo</span> <span class="pre">del</span> <span class="pre">ejemplo</span></code></a> las líneas que tratan directamente los argumentos son
estas:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">{</span><span class="w"> </span><span class="c1">### Análisis de las opciones.</span>
<span class="w">   </span><span class="nv">opts</span><span class="o">=</span><span class="s2">&quot;hp:f:v&quot;</span><span class="w">  </span><span class="c1"># Como en getopts, &quot;:&quot; significa que requiere argumento propio</span>

<span class="hll"><span class="w">   </span><span class="nv">post</span><span class="o">=</span><span class="m">0</span><span class="w">  </span><span class="c1"># Cantidad de argumentos pospuestos no asociados a ninguna opción</span>
</span><span class="hll"><span class="w">   </span><span class="k">while</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$#</span><span class="w"> </span>-gt<span class="w"> </span><span class="nv">$post</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
</span><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<span class="w">         </span>-h<span class="p">|</span>--help<span class="o">)</span><span class="w">  </span><span class="c1"># Ayuda</span>
<span class="w">            </span><span class="nb">help</span>
<span class="w">            </span><span class="nb">exit</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">;;</span>
<span class="w">         </span>-f<span class="p">|</span>--file<span class="o">)</span>
<span class="w">            </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2"> requiere argumento&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">2</span>
<span class="w">            </span><span class="nv">ARCHIVO</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="nb">shift</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="p">;;</span>
<span class="w">         </span>-p<span class="p">|</span>--password<span class="o">)</span>
<span class="w">            </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2"> requiere argumento&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">2</span>
<span class="w">            </span><span class="nv">PASSWORD</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="nb">shift</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="p">;;</span>
<span class="w">         </span>-v<span class="p">|</span>--verbose<span class="o">)</span>
<span class="w">            </span><span class="nv">VERBOSE</span><span class="o">=</span><span class="m">1</span>
<span class="w">            </span><span class="nb">shift</span><span class="w"> </span><span class="p">;;</span>
<span class="hll"><span class="w">         </span>--<span class="o">)</span><span class="w">  </span><span class="c1"># Final de las opciones</span>
</span><span class="hll"><span class="w">            </span><span class="nb">shift</span>
</span><span class="hll"><span class="w">            </span><span class="k">break</span><span class="w"> </span><span class="p">;;</span>
</span><span class="hll"><span class="w">         </span>--??*<span class="o">=</span>*<span class="o">)</span><span class="w">  </span><span class="c1">#1 --opt=value</span>
</span><span class="hll"><span class="w">            </span><span class="nv">arg</span><span class="o">=</span><span class="si">${</span><span class="nv">1</span><span class="p">%%=*</span><span class="si">}</span>
</span><span class="hll"><span class="w">            </span><span class="nv">value</span><span class="o">=</span><span class="si">${</span><span class="nv">1</span><span class="p">#*=</span><span class="si">}</span>
</span><span class="hll"><span class="w">            </span><span class="nb">shift</span>
</span><span class="hll"><span class="w">            </span><span class="nb">set</span><span class="w"> </span>--<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$arg</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$value</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">;;</span>
</span><span class="hll"><span class="w">         </span>--?*<span class="p">|</span>-?<span class="o">)</span>
</span><span class="hll"><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">: Opción desconocida&quot;</span>
</span><span class="hll"><span class="w">            </span><span class="nb">exit</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="p">;;</span>
</span><span class="hll"><span class="w">         </span>-??*<span class="o">)</span><span class="w">  </span><span class="c1">#2 Fusión de opciones cortas</span>
</span><span class="hll"><span class="w">            </span><span class="nv">rarg</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">1</span><span class="p">#-?</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>
</span><span class="hll"><span class="w">            </span><span class="nv">arg</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">1</span><span class="p">%</span><span class="nv">$rarg</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class="hll"><span class="w">            </span><span class="nb">shift</span>
</span><span class="hll"><span class="w">            </span><span class="c1"># Si &quot;arg&quot; no necesita argumento, rarg no es su argumento, sino otra opción</span>
</span><span class="hll"><span class="w">            </span>expr<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$opts</span><span class="s2">&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;.*</span><span class="si">${</span><span class="nv">arg</span><span class="p">#-</span><span class="si">}</span><span class="s2">:&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nv">rarg</span><span class="o">=</span><span class="s2">&quot;-</span><span class="nv">$rarg</span><span class="s2">&quot;</span><span class="w"> </span>
</span><span class="hll"><span class="w">            </span><span class="nb">set</span><span class="w"> </span>--<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$arg</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$rarg</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">;;</span>
</span><span class="hll"><span class="w">         </span>*<span class="o">)</span><span class="w">  </span><span class="c1">#3 Argumentos no asociados a opciones no puestos al final</span>
</span><span class="hll"><span class="w">            </span><span class="nv">arg</span><span class="o">=</span><span class="nv">$1</span>
</span><span class="hll"><span class="w">            </span><span class="nb">shift</span>
</span><span class="hll"><span class="w">            </span><span class="nb">set</span><span class="w"> </span>--<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$arg</span><span class="s2">&quot;</span>
</span><span class="hll"><span class="w">            </span><span class="nv">post</span><span class="o">=</span><span class="k">$((</span><span class="nv">post</span><span class="o">+</span><span class="m">1</span><span class="k">))</span><span class="w"> </span><span class="p">;;</span>
</span><span class="w">      </span><span class="k">esac</span>
<span class="w">   </span><span class="k">done</span>
<span class="w">   </span><span class="c1"># $@ contiene los argumentos no asociados a opciones.</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Básicamente, un <kbd class="kbd docutils literal notranslate">while</kbd> que va recorriendo los argumentos posicionales e
identificándolos dentro de una sentencia <kbd class="kbd docutils literal notranslate">case</kbd>. Los primeros ítem de tal
sentencia tratan los argumentos del program particular y los últimos son los que
obran la magia de dar soporte a las funcionalidades no triviales (fusión de
opciones cortas, etc.). El código es algo más complejo que usar directamente
<strong class="command">getopts</strong>, pero desde luego más sencillo que si se le intenta dar
soporte con la función <code class="docutils literal notranslate"><span class="pre">patch_lo</span></code> que hemos propuesto. En conclusión:</p>
<dl class="simple">
<dt><em>Ventajas</em></dt><dd><ul class="simple">
<li><p>Soporta opciones cortas.</p></li>
<li><p>Soporta la fusión de opciones cortas.</p></li>
<li><p>Soporta opciones largas.</p></li>
<li><p>Soporta ambas sintaxis para opciones largas (<kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">-</kbd>-<kbd class="kbd docutils literal notranslate">opcion</kbd> <kbd class="kbd docutils literal notranslate">valor</kbd></kbd> y
<kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">-</kbd>-<kbd class="kbd docutils literal notranslate">opcion=valor</kbd></kbd>).</p></li>
<li><p>No es obligado que los argumentos no asociados a opciones se encuentren al
final de la orden.</p></li>
<li><p>Las líneas que añaden el soporte extra (las resaltadas) no dependen de las
opciones concretas y, por tanto, basta con copiarlas en cualquier otro
<em>script</em>.</p></li>
<li><p>Si alguno de los soportes no nos interesa, podemos eliminarlo, eliminando
el ítem del <kbd class="kbd docutils literal notranslate">case</kbd> correspondiente (p.e. si no nos interesa dar
soporte a la sintaxis <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">-</kbd>-<kbd class="kbd docutils literal notranslate">option=valor</kbd></kbd>), podemos eliminar <code class="code docutils literal notranslate"><span class="pre">--??*=*)</span></code>.</p></li>
<li><p>Como es más artesanal, es una solución más versátil.</p></li>
</ul>
</dd>
<dt><em>Desventajas</em></dt><dd><ul class="simple">
<li><p>Alteramos el <kbd class="kbd docutils literal notranslate">$&#64;</kbd> original, que pasará a contener únicamente los argumentos
no asociados a opciones. Esto no suele ser un problema, porque si ya hemos
analizado la línea de órdenes, ¿para qué conservar <kbd class="kbd docutils literal notranslate">$&#64;</kbd>?</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notas al pie</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id5" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>Hay un tutorial interesante en <a class="reference external" href="http://wiki.bash-hackers.org/howto/getopts_tutorial">bash-hackers.org</a>.</p>
</aside>
<aside class="footnote brackets" id="id6" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>Es obvio que si no nos importa usar extensiones de <strong class="command">bash</strong>, lo más
conveniente es usar un diccionario: <code class="docutils literal notranslate"><span class="pre">${params['entrda']}</span></code>,
<code class="docutils literal notranslate"><span class="pre">${params['password']}</span></code>, etc.</p>
</aside>
<aside class="footnote brackets" id="id7" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">3</a><span class="fn-bracket">]</span></span>
<p>Argucia tomada de <a class="reference external" href="https://stackoverflow.com/a/7680682">esta respuesta en stackoverflow</a></p>
</aside>
<aside class="footnote brackets" id="id8" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">4</a><span class="fn-bracket">]</span></span>
<p>Recuérdese que, como se soporta la fusión, <code class="code docutils literal notranslate"><span class="pre">--opción-larga</span></code> equivale
a <code class="code docutils literal notranslate"><span class="pre">--</span> <span class="pre">opcion-larga</span></code>, si es que <code class="docutils literal notranslate"><span class="pre">--</span></code> es una opción con argumento, como
se ha definido.</p>
</aside>
</aside>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h4>Tema anterior</h4>
    <p class="topless"><a href="00.deteccion.html"
                          title="capítulo anterior"><span class="section-number">3.6.1. </span>Detección de la shell</a></p>
  </div>
  <div>
    <h4>Próximo tema</h4>
    <p class="topless"><a href="02.eval.html"
                          title="próximo capítulo"><span class="section-number">3.6.3. </span>Preevaluación de órdenes</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/03.scripts/06.misc/01.args.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Ir a" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="02.eval.html" title="3.6.3. Preevaluación de órdenes"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="00.deteccion.html" title="3.6.1. Detección de la shell"
             >anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" ><span class="section-number">3. </span>Programación de <em>scripts</em></a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" ><span class="section-number">3.6. </span>Otros aspectos</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">3.6.2. </span>Tratamiento de argumentos</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright CC BY 4.0, 2016-2024, José Miguel Sánchez Alés.
      Creado usando <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>