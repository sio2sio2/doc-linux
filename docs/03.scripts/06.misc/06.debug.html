


<!DOCTYPE html>

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3.6.7. Depuración &#8212; documentación de Linuxnomicón - rolling</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/translations.js"></script>
    
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../search.html" />
    <link rel="next" title="3.6.8. Bitácora de sucesos" href="07.logs.html" />
    <link rel="prev" title="3.6.6. Script molones" href="05.whiptail.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="07.logs.html" title="3.6.8. Bitácora de sucesos"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="05.whiptail.html" title="3.6.6. Script molones"
             accesskey="P">anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" ><span class="section-number">3. </span>Programación de <em>scripts</em></a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U"><span class="section-number">3.6. </span>Otros aspectos</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">3.6.7. </span>Depuración</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="depuracion">
<span id="sh-debug"></span><h1><span class="section-number">3.6.7. </span>Depuración<a class="headerlink" href="#depuracion" title="Enlazar permanentemente con este título">¶</a></h1>
<p><strong class="command">sh</strong>/<strong class="command">bash</strong> no es el mejor lenguaje del mundo a la hora de
depurar. Es más, su tipado débil es una fuente permanente de errores triviales
que a veces cuesta encontrar, como el de equivocarse en la digitalización del
nombre de una variable. En cualquier caso, para facilitar la depuración (además
de los supuestos orden, claridad y sencillez en la escritura del código),
podemos usar las siguientes técnicas:</p>
<dl>
<dt><code class="code docutils literal notranslate"><span class="pre">set</span> <span class="pre">-u</span></code></dt><dd><p>Colocar esta sentencia al principio del <em>script</em> provoca que el intérprete
genere un error cuando se usa una variable a la que no se ha asignado valor
previamente. Por ejemplo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nv">num</span><span class="o">=</span><span class="m">1</span>
<span class="gp">$</span> <span class="nb">echo</span> <span class="k">$((</span>num+1<span class="k">))</span>
<span class="go">2</span>
<span class="gp">$</span> <span class="nb">echo</span> <span class="k">$((</span>nun+1<span class="k">))</span>  <span class="c1"># Pero si digitalizamos mal, bash se calla</span>
<span class="go">1</span>
<span class="gp">$</span> <span class="nb">set</span> -u           <span class="c1"># Ahora sin embargo, no</span>
<span class="gp">$</span> <span class="nb">echo</span> <span class="k">$((</span>nun+1<span class="k">))</span>
<span class="go">-bash: nun: variable sin asignar</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Para que el intérprete revierta el efecto, puede escribirse lo
mismo, pero con el signo «<em>+</em>» en vez de el «<em>-</em>«:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">set</span> +u
</pre></div>
</div>
<p>Tal cosa es aplicable a las demás técnicas que vemos a continuación.</p>
</div>
</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">set</span> <span class="pre">-e</span></code></dt><dd><p>Provoca que el intérprete cancele la ejecución del programa nada más
ejecutar una orden que devuelve error (o sea, un valor distinto de 0).</p>
</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">set</span> <span class="pre">-v</span></code></dt><dd><p>Hace un eco en pantalla de todos las ordenes que se ejecutan. Esto puede
servirnos en un programa para ver qué órdenes está realmente ejecutando
el programa:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nv">a</span><span class="o">=</span><span class="m">5</span>
<span class="gp">$</span> <span class="nb">set</span> -v
<span class="gp">$</span> <span class="nb">echo</span> <span class="nv">$a</span>
<span class="go">echo $a</span>
<span class="go">5</span>
</pre></div>
</div>
<p>Es de prever que al depurar un error sepamos la zona por la que se encuentra
el error. En ese caso, podríamos usar la sentencia justamente antes de que
empiece el código problemático y revertir el efecto cuando ya sepamos que tal
código ha pasado.</p>
</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">set</span> <span class="pre">-x</span></code>:</dt><dd><p>Muestra también la orden ejecutada, pero con las sustituciones ya hechas:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nv">a</span><span class="o">=</span><span class="m">5</span>
<span class="gp">$</span> <span class="nb">set</span> -x
<span class="gp">$</span> <span class="nb">echo</span> <span class="nv">$a</span>
<span class="go">+ echo 5</span>
<span class="go">5</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Pueden aplicarse <kbd class="kbd docutils literal notranslate">-x</kbd> y <kbd class="kbd docutils literal notranslate">-v</kbd> a la vez lo que propiciará
que se nos muestre la orden original y la orden con sustituciones:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nv">a</span><span class="o">=</span><span class="m">5</span>
<span class="gp">$</span> <span class="nb">set</span> -vx
<span class="gp">$</span> <span class="nb">echo</span> <span class="nv">$a</span>
<span class="go">echo $a</span>
<span class="go">+ echo 5</span>
<span class="go">5</span>
</pre></div>
</div>
</div>
</dd>
<dt><strong class="command">shellcheck</strong></dt><dd><p>Es un analizador estático de código. Por ejemplo, para el código:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>

<span class="k">function</span> foobar<span class="o">()</span> <span class="o">{</span>
   <span class="nb">echo</span> <span class="s2">&quot;Esta función no está declarada según el estándar&quot;</span>
   <span class="nv">n</span><span class="o">=</span><span class="m">4</span>
   <span class="nb">echo</span> <span class="k">$((</span>n <span class="o">+</span> <span class="m">1</span>.5<span class="k">))</span>
<span class="o">}</span>

foobar
</pre></div>
</div>
<p>devolvería lo siguiente:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ shellcheck script.sh
In /tmp/caca.sh line 5:
function foobar() {
^-- SC2112: &#39;function&#39; keyword is non-standard. Delete it.


In /tmp/caca.sh line 8:
   echo $((n + 1.5))
               ^-- SC2079: (( )) doesn&#39;t support decimals. Use bc or awk.
</pre></div>
</div>
</dd>
<dt><strong>Ejecución paso a paso</strong></dt><dd><p>Para emular la ejecución paso a paso de los depuradores típicos de otros
lenguajes, debemos recurrir a <strong class="command">bash</strong> aprovechando que permite
<a class="reference internal" href="03.trap.html#bash-trap"><span class="std std-ref">usar el argumento DEBUG con trap</span></a><a class="footnote-reference brackets" href="#id3" id="id1">1</a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># debugger.sh: funciones para depuración de código</span>
debug<span class="o">()</span> <span class="o">{</span>
   <span class="o">[</span> <span class="nv">$__untrap</span> -eq <span class="m">1</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> 
   <span class="nb">echo</span> <span class="s2">&quot;Línea </span><span class="nv">$1</span><span class="s2">: </span><span class="nv">$BASH_COMMAND</span><span class="s2">&quot;</span>
   <span class="k">while</span> true<span class="p">;</span> <span class="k">do</span>
      <span class="nb">read</span> -p <span class="s2">&quot;&gt; &quot;</span> comm
      <span class="o">[</span> -z <span class="s2">&quot;</span><span class="nv">$comm</span><span class="s2">&quot;</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$comm</span><span class="s2">&quot;</span> <span class="o">=</span> <span class="s2">&quot;n&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="k">return</span>
      <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$comm</span><span class="s2">&quot;</span> <span class="o">=</span> <span class="s2">&quot;c&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nv">__untrap</span><span class="o">=</span><span class="m">1</span> <span class="o">&amp;&amp;</span> <span class="k">return</span>
      <span class="nb">eval</span> <span class="nv">$comm</span>
   <span class="k">done</span>
<span class="o">}</span>

breakpoint<span class="o">()</span> <span class="o">{</span>
   <span class="nv">__untrap</span><span class="o">=</span><span class="m">0</span>
   <span class="nb">trap</span> <span class="s1">&#39;debug $LINENO&#39;</span> DEBUG
<span class="o">}</span>

<span class="k">continue</span> <span class="o">{</span>
   <span class="nb">trap</span> <span class="s1">&#39;&#39;</span> DEBUG
<span class="o">}</span>
</pre></div>
</div>
<p>Si incorporamos temporalemente estas tres funciones a nuestro código (lo más
cómodo es dejarlas en un fichero aparte e cargarlas con <a class="reference internal" href="../../02.conbas/07.avanzada/08.interpretaciones.html#source"><span class="std std-ref">source</span></a>), no necesitamos más que añadir la sentencia <strong class="command">breakpoint</strong>
allá donde queramos crear un punto de ruptura y que empiece la ejecucuon paso
a paso y <strong class="command">continue</strong> a partir de allí donde queramos que la ejecución
prosiga de forma normal.</p>
<p>Al pararse la ejecución, podemos:</p>
<ul class="simple">
<li><p>Presionar, simplemente, «<kbd class="kbd docutils literal notranslate">Enter</kbd>» o escribir «<kbd class="kbd docutils literal notranslate">n</kbd>» para ejecutar
la línea y avanzar a la siguiente.</p></li>
<li><p>Escribir «<kbd class="kbd docutils literal notranslate">c</kbd>» para que la ejecución continúe sin más paradas hasta el
próximo <em>breakpoint</em><a class="footnote-reference brackets" href="#id4" id="id2">2</a>.</p></li>
<li><p>Evaluar cualquier órden, sin avanzar en absoluto.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">Ver también</p>
<p>En la fase de depuración (o incluso en la de producción para
realizar comprobaciones) puede intersarnos definir <a class="reference internal" href="99.consejos.html#sh-verbose-simulate"><span class="std std-ref">la función execute</span></a>.</p>
</div>
<p class="rubric">Notas al pie</p>
<dl class="footnote brackets">
<dt class="label" id="id3"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Aunque pretenemos hacer un <em>script</em> compatible con el
estándar <em>POSIX</em>, vernos obligados a usar para esta tarea <strong class="command">bash</strong> no
es un gran incoveniente, a menos claro está que nos encontremos en un sistema
sin <strong class="command">bash</strong></p>
</dd>
<dt class="label" id="id4"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>En realidad, dentro de la función <em>debug</em> no podemos modificar limpiar el
evento <em>DEBUG</em>, por lo que pulsar «<em>c</em>» no evita que para las siguientes
líneas regresemos a dicha función. Por ese motivo, usamos la argucia de usar
una variable para ver si entramos en el <em>entorno</em> de depuración o no.</p>
</dd>
</dl>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Tema anterior</h4>
  <p class="topless"><a href="05.whiptail.html"
                        title="capítulo anterior"><span class="section-number">3.6.6. </span><em>Script</em> molones</a></p>
  <h4>Próximo tema</h4>
  <p class="topless"><a href="07.logs.html"
                        title="próximo capítulo"><span class="section-number">3.6.8. </span>Bitácora de sucesos</a></p>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/03.scripts/06.misc/06.debug.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Ir a" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="07.logs.html" title="3.6.8. Bitácora de sucesos"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="05.whiptail.html" title="3.6.6. Script molones"
             >anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" ><span class="section-number">3. </span>Programación de <em>scripts</em></a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" ><span class="section-number">3.6. </span>Otros aspectos</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">3.6.7. </span>Depuración</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Derechos de autor CC BY 4.0, 2016-2021, José Miguel Sánchez Alés.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.5.4.
    </div>
  </body>
</html>