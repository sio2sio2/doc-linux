


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="es">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>3.7. Ejercicios sobre scripts &#8212; documentación de ServidorLinux - 0.1.0</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Índice" href="../genindex.html" />
    <link rel="search" title="Búsqueda" href="../search.html" />
    <link rel="next" title="4. Gestión del servidor" href="../04.servidor/index.html" />
    <link rel="prev" title="3.6.10. Trucos y consejos" href="06.misc/99.consejos.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="../04.servidor/index.html" title="4. Gestión del servidor"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="06.misc/99.consejos.html" title="3.6.10. Trucos y consejos"
             accesskey="P">anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">documentación de ServidorLinux - 0.1.0</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">3. Programación de <em>scripts</em></a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="ejercicios-sobre-scripts">
<h1>3.7. Ejercicios sobre scripts<a class="headerlink" href="#ejercicios-sobre-scripts" title="Enlazar permanentemente con este título">¶</a></h1>
<div class="section" id="ejercicios-minimos">
<h2>3.7.1. Ejercicios mínimos<a class="headerlink" href="#ejercicios-minimos" title="Enlazar permanentemente con este título">¶</a></h2>
<ol class="arabic">
<li><p class="first">Escriba un programa que pida una frase y la repita en mayúsculas.</p>
</li>
<li><p class="first">Lo mismo pero el programa seguirá pidiendo una frase hasta que se escriba
«fin».</p>
</li>
<li><p class="first">Escriba un programa que imprima los 100 primeros números impares.</p>
</li>
<li><p class="first">Escriba una función que compruebe si el parámetro suministrado
es un número entero.</p>
</li>
<li><p class="first">Escriba un programa que pida dos números enteros posiitivos y los sume.</p>
</li>
<li><p class="first">Escriba un programa que pida dos números enteros, una operación básica
(sumar, restar, multiplicar o dividir) y realize la operación.</p>
</li>
<li><p class="first">Escriba un función que indique si un año es bisiesto o no.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Son bisiestos los años múltiplos de 4, excepto los múltiplos de
100, si no son múltiplos de 400.</p>
</div>
</li>
<li><p class="first">Escriba una función que devuelva un número al azar entre dos dados
cualesquiera.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">A menos que usemos la variable no estándar <em>RANDOM</em>, la generación
de números aleatorios en la <em>shell</em> no es trivial. Puede usar, no obstante,
el código de ejemplo incluido al <a class="reference internal" href="03.control.html#sh-while"><span class="std std-ref">explicar los bucles</span></a>.
Observe que la función <em>random</em> incluido en él permite obtener números
hexadecimales de cualquier tamaño simplemente indicándo de cuántos bytes
es tal número.</p>
</div>
</li>
</ol>
</div>
<div class="section" id="ejercicios">
<h2>3.7.2. Ejercicios<a class="headerlink" href="#ejercicios" title="Enlazar permanentemente con este título">¶</a></h2>
<ol class="arabic">
<li><p class="first">Pida un usuario y una contraseña por pantalla, tras lo cual muestre el
mensaje «<em>Ha escogido para identificarse NOMBRE_USUARIO/CONTRASEÑA</em>»,
donde <em>NOMBRE_USUARIO</em> y <em>CONTRASEÑA</em> es lo tecleado.</p>
<p class="sol-script"><a class="reference download internal" download="" href="../_downloads/c7da4190cb8b6626d09d73e750762525/ejB-01.sh"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p class="first">Pida lo mismo; pero, en vez de mostrar el mensaje por pantalla,
guarde ambos datos dentro del fichero <code class="file docutils literal notranslate"><span class="pre">vpasswd</span></code> en el formato:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">NOMBRE_USUARIO:CONTRASEÑA</span>
</pre></div>
</div>
<p>Hágalo de forma que, si se vuelve a ejecutar el <em>script</em>, no se borren
los usuarios ya almacenados.</p>
<p>En cuanto al directorio en que debe alojarse <code class="file docutils literal notranslate"><span class="pre">vpasswd</span></code>.</p>
<ul class="simple">
<li>Suponga que no preocupa al escribir el código. ¿Dónde acabará
almacenado?</li>
<li>Suponga que quiere almacenarlo en el directorio personal del usuario.</li>
<li>Suponga que quiere almacenarlo en el directorio en que se encuentra el
propio ejecutable. Esto aún no sabe resolverlo, si no ha visto cómo tratar
los argumentos pasados al <em>script</em>, así que vuelva a esta pregunta más
adelante.</li>
</ul>
<p class="sol-script"><a class="reference download internal" download="" href="../_downloads/0555fc0503dd1ca0ae368a0c57af754c/ejB-02.sh"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p class="first">Repita el ejercicio anterior, pero la contraseña no debe almacenarse
en claro sino codificada tal y como aparece en el fichero
<code class="file docutils literal notranslate"><span class="pre">/etc/shadow</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p>Para codificar la contraseña puede usar <strong class="command">openssl</strong>:</p>
<div class="last highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> openssl passwd -1 -salt a contraseña
</pre></div>
</div>
</div>
<p class="sol-script"><a class="reference download internal" download="" href="../_downloads/e783cb9727fb75b746064062e74c44a3/ejB-03.sh"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p class="first">Añada la posibilidad de que la contraseña se cifre o no, mediante la
inclusión de un argumento en la línea de órdenes. Si se hace:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ./script.sh
</pre></div>
</div>
<p>La contraseña no estará cifrada; si se hace:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ./script.sh c
</pre></div>
</div>
<p>si lo estará. Si se escribe cualquier otro argumento el programa
debe fallar devolviendo un <strong>2</strong> al sistema.</p>
<p class="sol-script"><a class="reference download internal" download="" href="../_downloads/5cad8939f995ec1fb9094ad3fd27f3d4/ejB-04.sh"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p class="first">Mejore el <em>script</em> anterior para que se compruebe si no se escribe
nada al pedir el usuario; y se pregunte una segunda vez la contraseña
y se compruebe que en ambos casos es la misma. Si no se cumple esto,
el programa debe acabar con un <strong>1</strong>.</p>
<p class="sol-script"><a class="reference download internal" download="" href="../_downloads/75b4ecdbf8b1acdaaeecbe6ae79904d8/ejB-05.sh"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p class="first">Vuelva a escribir el mismo programa pero:</p>
<ul class="simple">
<li>Se insiste hasta que el nombre de usuario no esté vacío.</li>
<li>Se insiste hasta que las dos contraseñas son iguales.</li>
</ul>
<p class="sol-script"><a class="reference download internal" download="" href="../_downloads/3081e82210008ac2bd56e675e6a27fd2/ejB-06.sh"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p class="first">Como en el caso anterior, pero las insistencias se limitan a <strong>3</strong>.</p>
<p class="sol-script"><a class="reference download internal" download="" href="../_downloads/688b433876f108939d70f9f23c13de1b/ejB-07.sh"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p class="first">Tomando toda la casuística del supuesto anterior, use el fichero
<code class="file docutils literal notranslate"><span class="pre">vpasswd</span></code> del siguiente modo:</p>
<ul class="simple">
<li>La contraseña siempre se almacenará cifrada (con lo que puede prescindir
del análisis del parámetro <code class="docutils literal notranslate"><span class="pre">c</span></code>).</li>
<li>Si el fichero ya existe, se pide el usuario mostrando el que había
almacenado y, si el usuario lo deja en blanco, se conserva el usuario
antiguo.</li>
<li>Si la contraseña se deja en blanco y el usuario no cambió, la contraseña
tampoco varía. Si el usuario cambió, entonces no se conserva la contraseña,
aunque se deje en blanco.</li>
<li>Se actualiza el fichero para que almacene exclusivamente el nuevo usuario y
contraseña.</li>
</ul>
<p class="sol-script"><a class="reference download internal" download="" href="../_downloads/80a3ac464001e9daf6e383fbbd8256ed/ejB-08.sh"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p class="first">Se desea crear un script para automatizar la creación de usuarios para el
servidor <abbr title="File Transfer Protocol">FTP</abbr>, de manera que:</p>
<ul class="simple">
<li>Los usuarios son usuarios reales (aparecen en <code class="file docutils literal notranslate"><span class="pre">/etc/passwd</span></code>).</li>
<li>Sus directorios personales son <code class="file docutils literal notranslate"><span class="pre">/srv/ftp/NOMBRE_USUARIO</span></code>.</li>
<li>Su grupo principal es <em>ftpusers</em>.</li>
<li>Si el usuario ya existe, se genera un error.</li>
</ul>
<p>Además, si se añade el argumento <code class="docutils literal notranslate"><span class="pre">--no-password</span></code>, no se pide contraseña
y el usuario se crea con la contraseña deshabilitada.</p>
<p class="sol-script"><a class="reference download internal" download="" href="../_downloads/ae724a38a39f8997b9fc45f2e9d18ef5/ejB-09.sh"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p class="first">Modifique el ejercicio anterior para que ee cree con contraseña deshabilitada
cuando se deja en blanco al pedirla.</p>
</li>
<li><p class="first">Enriquezca el ejercicio anterior para que se admita como primer
argumento el nombre de usuario y como segundo la contraseña, pero
ambos argumentos son opcionales. El programa preguntará de modo
interactivo sólo aquellos datos que no se le han pasado como argumentos.</p>
</li>
<li><p class="first">Defina una función llamada <em>netaddr</em> que calcula la dirección de red a partir
de cualquier dirección de equipo expresada en notación <abbr title="">CIDR</abbr>.
Deberá poder usarse así:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>netaddr <span class="m">192</span>.168.25.4/23
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">El estándar <em>POSIX</em> define la <a class="reference external" href="http://pubs.opengroup.org/onlinepubs/9699919799/utilities/bc.html">calculadora bc</a> que
le puede servir para hacer cambios de base muy fácilmente. Sin embargo,
esta orden no tiene por qué estar disponible en el sistema. En <em>debian</em> no
forma parte de la instalación mínima y <strong class="program">busybox</strong> no tiene la
implementada.</p>
</div>
<p class="sol-script"><a class="reference download internal" download="" href="../_downloads/9af49b1a887a8807961489907cf8b11c/netaddr.sh"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p class="first">Modifique el ejecicio anterior para que:</p>
<ul>
<li><p class="first">Cuando no se incluye la máscara, se sobreentienda que es la predeterminada.</p>
</li>
<li><p class="first">La función, además, de admitir un único argumento (<abbr title="Internet Protocol">IP</abbr> en notación CIDR),
admita dos que representen respectivamente la dirección y la máscara (en
forma de dirección <abbr title="Internet Protocol">IP</abbr>):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>netaddr <span class="m">192</span>.168.25.4 <span class="m">255</span>.255.254.0
</pre></div>
</div>
</li>
</ul>
<p class="sol-script"><a class="reference download internal" download="" href="../_downloads/1dc39d4f10efe31b5c8f17f435d1bfcf/netaddr.v2.sh"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p class="first">Un servidor <abbr title="Security SHell">SSH</abbr> tiene dos tipos de usuarios:</p>
<ol class="arabic simple">
<li>Usuarios normales que pueden utilizar el servidor sin restricciones
especiales.</li>
<li>Unos usuarios a los que se les permite exclusivamente el uso del servidor
<abbr title="Security SHell">SSH</abbr> para la transferencia de ficheros. Estos usuarios, además, estarán
enjaulados en su propio directorio personal.</li>
</ol>
<p>Para llevar a cabo lo anterior se ha decidido:</p>
<ul class="simple">
<li>Los usuarios normales se darán de alta en el sistema de modo que se creará
un grupo exclusivo con su mismo nombre, su información <em>gecos</em> coincidirá
con su nombre de usuario y su directorio será el habitual
(<code class="file docutils literal notranslate"><span class="pre">/home/$usuario</span></code>)</li>
<li>Los usuario cuyo acceso se restringe a la transferencia de ficheros tendrá
todos como grupo principal «losdelftp» y no un grupo exclusivo, su
información <em>gecos</em> será «nombre_usuario (FTP)» y su directorio habitual
será (<code class="file docutils literal notranslate"><span class="pre">/home/ftp/$usuario</span></code>).</li>
</ul>
<p>Desarrolle un <em>script</em> que permita dar de alta estos dos tipos de usuarios.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Por cuestiones de seguridad, <abbr title="Security SHell">SSH</abbr> sólo permite enjaular usuarios
dentro de un directorio si todos los directorios que forman parte de la
ruta de la jaula pertenecen a <em>root</em> y el usuario
enjaulado no tiene permisos de escritura sobre ellos. Deberá tener en
cuenta esto al crear los usuarios y, además, para el caso de un usuario
restringido a la transferencia crear un subdirectorio «incoming» dentro de
su directorio personal en el que tengan permisos de escritura a fin de que
pueda subir ficheros.</p>
</div>
<p class="sol-script"><a class="reference download internal" download="" href="../_downloads/d1dec6e197b0e0af05f1b18e57496653/crear_usuario.sh"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p class="first">En el servidor de un centro con un ciclo medio de Sistemas Microinformáticos
y Redes, el profesor encargado de mantenerlo quiere a principios de
septiembre hacer la transición del curso pasado al actual.</p>
<p>El servidor está organizado de la siguiente forma:</p>
<ul class="simple">
<li>Los alumnos de primero tienen como grupo principal <em>smr1</em>.</li>
<li>Los alumnos de segundo tienen como grupo principal <em>smr2</em>.</li>
<li>Los alumnos con módulos de primero matriculados en alguno de segundo
tienen como grupo principal <em>smr1</em> y pertenecen a <em>smr2</em>.</li>
</ul>
<p>El profesor encargado parte de la configuración del curso pasado y, a la
vista de las nuevas matriculaciones, debe actualizar la situación de usuarios
y grupos. Para ello recibe un fichero con la siguiente pinta:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Nombre Real1;DNI1;1
Nombre Real2;DNI2;1+
Nombre Real3;DNI3;2
</pre></div>
</div>
<p>donde aparece los alumnos actualmente matriculados y «1» significa que el
alumno sólo cursa primero, «2» que sólo cursa segundo y «1+ que está entre
primero y segundo. El nick del alumno en el sistema se obtiene tomando la
inicial de su primer nombre, las tres letras iniciales de los dos apellidos y
las tres últimas cifras del DNI (p.e. Manuel Jesús Vázquez Montalbán pasa
a mvazmonNNN).</p>
<p>Se pide crear un programa que tome el listado y</p>
<ul class="simple">
<li>Limpie del sistema los alumno que ya no se encuentren matriculados (bien
por abandono, bien porque hayan acabado). Bórrese también su directorio de
usuario.</li>
<li>Actualice la pertenencia a grupos de los alumnos que ya existieran en el
sistema.</li>
<li>Añada los nuevos alumnos matriculados.</li>
</ul>
<p>Sintaxis:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> matriculacion.sh fichero
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Nota: En la información gecos debe añadirse el nombre real del
alumno (no su DNI) y si repite añadirse tras el nombre la palabra
«repetidor» entre paréntesis.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Haga el programa para manipular usuarios locales, pero escriba el
programa de modo que sea fácil cambiar a otro tipo de usuarios.</p>
</div>
<p class="sol-script"><a class="reference download internal" download="" href="../_downloads/c4956bdfb15d05ef50dbb0d2a1940a78/matriculacion.sh"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p class="first">Se desea crear un <em>script</em> que gestione los ejercicios de programación de
scripts que han realizados los alumnos con un determinado grupo primario. La
gestión consistirá en dos posibles tareas, diferentes entre sí:</p>
<ol class="arabic simple">
<li>Generación de un informe que resuma los scripts que han realizado
los alumnos desde la última vez que se generó informe.</li>
<li>Listado de los scripts realizados por un determinado alumno y recogidos en
el último informe, así como la comprobación de que el alumno no ha
hecho modificaciones posteriores.</li>
</ol>
<p>La sintaxis de ejecución del script será la siguiente:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./vigilante.sh -c alumno|-g grupo</span>
</pre></div>
</div>
<p>Las opciones son excluyentes entre sí y, al menos, debe expresarse una de
ellas. La opcion «-g» provoca que el script realice la primera tarea y la
opción «-c» que realice la segunda. El script está pensado para ejecutarse
como «root».</p>
<p><strong>Descripción de 1ª tarea</strong></p>
<p>Dentro del subdirectorio «Informes» de root, deberán guardarse los informes
con el nombre «grupo_fechaEjecucion.txt». El fichero deberá al menos contener
lo siguiente (los comentarios no forman parte del formato y sólo sirven para
aclarar la línea):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>%                        # Separador de usuarios.
usuario1                 # El nick del usuario del que se obtienen scripts
/path/absoluto/script1   # Lista de scripts posteriores al último informe.
/path/absoluto/script2
... más scripts ...
%
usuario2
/path/absoluto/script1
/path/absoluto/script2
... más scripts ...
... resto de usuarios del grupo ...
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Es obvio que deberá incluir algo más dentro del informe para poder
saber si los <em>scripts</em> han cambiado al realizar este <em>script</em> la segunda
tarea. Es su tarea determinar qué añade.</p>
</div>
<p>Se considerará que los usuarios que deben incluirse en el informe son aquellos
que tiene como grupo principal el grupo que se expresa con <kbd class="kbd docutils literal notranslate">-g</kbd>.</p>
<p>Los scripts realizados por el usuario se encontrarán siempre dentro de su
propio directorio personal (lo cual incluiye subdirectorios).</p>
<p><strong>Descripción de 2ª tarea</strong></p>
<p>Consiste en listar los <em>scripts</em> de un usuario que el último informe emitido
recogió. Junto al nombre debe incluirse la leyenda:</p>
<ul class="simple">
<li><em>Correcto</em>: si el <em>script</em> no se ha modificado posteriormente</li>
<li><em>Modificado</em>: si el <em>script</em> se modificó posteriormente. Al darse esta
circunstancia, el <em>script</em> debe finalizar inmediatamente sin seguir revisando
más <em>scripts</em> e imprimir la leyenda: «El alumno ha intentado hacer trampas».</li>
<li><em>Borrado</em>: Si el <em>script</em> no se encuentra.</li>
</ul>
<p>Por ejemplo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> ./vigilante.sh -c alumno1
<span class="go">/path/absoluto/script1       Correcto</span>
<span class="go">/path/absoluto/script2       Correcto</span>
<span class="go">/path/absoluto/script3       Borrado</span>
<span class="go">/path/absoluto/script4       Correcto</span>
<span class="go">/path/absoluto/script5       Modificado</span>

<span class="go">El alumno &#39;alumno1&#39; ha intentado hacer trampas.</span>
</pre></div>
</div>
<p><em>Bonus track</em>: Añadir la opción -s NUM, de modo que si NUM=0 se revisa el
último script; si NUM=1, se revisa el penúltimo y así sucesivamente. No
indicar la opción, implica NUM=0.</p>
<p class="sol-script"><a class="reference download internal" download="" href="../_downloads/b80890e3a040901654dd930ece16e2d1/vigilante.sh"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
</ol>
</div>
<div class="section" id="ejercicios-practicos">
<h2>3.7.3. Ejercicios prácticos<a class="headerlink" href="#ejercicios-practicos" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Esta tanda de ejercicios requiere la puesta en práctica de conocimientos sobre
el sistema y las herramientas que existen en él.</p>
<ol class="arabic">
<li><p class="first">Retomando la última versión del <em>script</em> para crear usuarios de <abbr title="File Transfer Protocol">FTP</abbr>,
modifíquelo para que se creen usuarios reales (lo ya hecho) o virtuales
legibles con el módulo <a class="reference internal" href="../04.servidor/09.autenticacion/pam_modules/14.pam_userdb.html#pam-userdb"><span class="std std-ref">pam_userdb</span></a>.</p>
</li>
<li><p class="first">Se desea vigilar si alguno de los sistemas de ficheros del servidor
superan el 90% de ocupación para que, si es así, se envíe un mensaje a la
dirección de correo del administrador. Disponga todo lo necesario
para que se haga la comprobación una vez al día.</p>
<p class="sol-script"><a class="reference download internal" download="" href="../_downloads/67801f6a749e525438f0d81ef6043f89/diskmonitor.sh"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p class="first">Cree un <em>script</em> que permita hacer copias de seguridad de los datos contenidos
dentro del directorio personal, de manera que:</p>
<ul>
<li><p class="first">La sintaxis del script será:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">copion [-r referencia] [listado]</span>
</pre></div>
</div>
</li>
<li><p class="first">Aquellos ficheros y directorios que se quiera que formen parte de la copia
se incluirán dentro de un fichero de listado, uno por línea. Incluir un
directorio, significa incluirlo a él y a todo su contenido.</p>
</li>
<li><p class="first">Las rutas relativas de los ficheros se entenderán relativas al directorio
personal.</p>
</li>
<li><p class="first">Si no se especifica fichero de listado o el fichero de listado es -, se
esperará tomar la lista de la entrada estándar.</p>
</li>
<li><p class="first">Si se incluye una referencia temporal, y el fichero de referencia:</p>
<ul class="simple">
<li>No existe, se copiarán todos los ficheros del listado, y al final de
la copia se creará tal fichero de referencia temporal para usos
posteriores del <em>script</em>.</li>
<li>Si existe, sólo se guardarán en la copia los ficheros del listado más
recientes que esa referencia temporal; y al final de la copia, se
actualizará la fecha de la referencia para usos posteriores del <em>script</em>.</li>
</ul>
</li>
<li><p class="first">Si no se incluye una referencia temporal, se copiarán todos los ficheros
del listado y no se creará referencia alguna al finalizar.</p>
</li>
<li><p class="first">El fichero de backup que se cree deberá nombrarse como
<code class="file docutils literal notranslate"><span class="pre">nombre_usuario_AAAA-MM-DD.tar.xz</span></code>, donde <em>AAAA-MM-DD</em> es la fecha de
creación de la copia de seguridad y la extensión se corresponde con el
formato real del fichero.</p>
</li>
</ul>
</li>
<li><p class="first">Para un determinado módulo de Formación Profesional el profesor entrega a los
alumnos un disco duro virtual con un sistema linux que servirá de base para
la realización de gran parte de las prácticas del curso. La intención es que
en cada una de ellas el alumno coja una copia de este disco y haga en ella
las instalaciones y configuraciones necesarias para la realización de la
práctica. Como el disco virtual es muy pesado (en torno a 1GB), el profesor
ha pensado que, dado que se parte siempre de un mismo sistema base, lo único
que necesita para recoger la práctica es que cada alumno le pase las
diferencias. Por ello decide diseñar un <em>script</em> para incluirlo dentro del
sistema base, que pase a un fichero de copia sólo los ficheros que han
sufrido alguna modificación o han sido instalados, ya que al volcar dicha
copia sobre otro sistema base, obtendrá el estado en que quedó el sistema del
alumno al completar la práctica. Las características de esta copia son las
siguientes:</p>
<ul class="simple">
<li>Sólo incluye ficheros modificados o no incluidos en el sistema base.</li>
<li>Adicionalmente se quiere que se pueda añadir un límite de tiempo, de manera
que si un fichero fue modificado a añadido antes de él, no se incluirá en
la copia, aunque cumpla el precepto anterior. Por ejemplo, si al ejecutar
el <em>script</em> se establece un límite de 2 horas, cualquier modificación o
adición que se produjera antes de las dos horas anteriores a la ejecución
del <em>script</em> no aparecerá en la copia.</li>
<li>La copia nunca incluirá ficheros que se encuentren en directorios cuyos
cambios o cuyo contenido se consideren irrelevantes para el propósito de la
copia. Por ejemplo, /proc o /dev. Decida usted cuáles son.</li>
<li>Es posible indicar una lista de ficheros que se incluirán en todo caso, a
pesar de que no cumplan los dos primeros preceptos.</li>
<li>El nombre de la copia debe ser de la forma backup_nombre_AAAA-MM-DD.tar.xz,
donde AAAA-MM-DD es la fecha en la que se ejecuta el script y «nombre» es
un nombre que se facilita al ejecutar el <em>script</em>. Si no se facilita
ninguno, se toma el nombre de la máquina.</li>
</ul>
<p class="sol-script"><a class="reference download internal" download="" href="../_downloads/eeaf4ffbd32f79e3be69005d28d881a6/backup.sh"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
<li><p class="first">En un centro educativo se desea vigilar qué ordenadores de la red se
quedan encendidos por la noche, con el fin de amonestar a los alumnos
despistados. Para ello se desea lanzar un <em>script</em> desde el servidor que
inspeccione la red y obtenga las direcciones <abbr title="Media Access Control">MAC</abbr> de los equipos
encendidos y haga llegar la lista de tales equipos mediante correo
electrónico al administrador. Si ningún equipo quedó encendido, no se enviará
mensaje.</p>
<p>Escriba el <em>script</em> y explique cómo ejercutarlo para llevar a término el
objetivo propuesto.</p>
<p><strong>Solución propuesta</strong>: Vea el ejercicio siguiente.</p>
</li>
<li><p class="first">Mejore el <em>script</em> para que:</p>
<ul class="simple">
<li>Haya un listado de equipos existentes que asocie a cada <abbr title="Media Access Control">MAC</abbr> un nombre
identificativo (p.e. el nombre del alumno que lo usa habitualmente).
En el mensaje al administrador, se enviará no sólo la <abbr title="Media Access Control">MAC</abbr>, sino también
este nombre.</li>
<li>Puedan existir equipos a los que se les permita permanecer encendidos (p.e.
una impresora de red) y, por tanto, que deban ser excluidas del listado de
equipos encendidos.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Tiene total libertad para establecer el formato de este listado y
la forma en la que notará cuáles deben ser excluidos del informe de
encendidos.</p>
</div>
<p class="sol-script"><a class="reference download internal" download="" href="../_downloads/88ac10c5aee6ec5e16f3407d71a0ad27/discover.sh"><code class="xref download docutils literal notranslate"><span class="pre">Solución</span> <span class="pre">propuesta</span></code></a></p>
</li>
</ol>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">3.7. Ejercicios sobre scripts</a><ul>
<li><a class="reference internal" href="#ejercicios-minimos">3.7.1. Ejercicios mínimos</a></li>
<li><a class="reference internal" href="#ejercicios">3.7.2. Ejercicios</a></li>
<li><a class="reference internal" href="#ejercicios-practicos">3.7.3. Ejercicios prácticos</a></li>
</ul>
</li>
</ul>

  <h4>Tema anterior</h4>
  <p class="topless"><a href="06.misc/99.consejos.html"
                        title="capítulo anterior">3.6.10. Trucos y consejos</a></p>
  <h4>Próximo tema</h4>
  <p class="topless"><a href="../04.servidor/index.html"
                        title="próximo capítulo">4. Gestión del servidor</a></p>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/03.scripts/07.ejercicios.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Ir a" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="../04.servidor/index.html" title="4. Gestión del servidor"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="06.misc/99.consejos.html" title="3.6.10. Trucos y consejos"
             >anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">documentación de ServidorLinux - 0.1.0</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >3. Programación de <em>scripts</em></a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Derechos de autor 2016, José Miguel Sánchez Alés.
      Creado con <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>