Extensiones
***********
:program:`iptables` dispone de algunas extensiones que amplían enormemente las
posibilidades del cortafuegos. Repasaremos las más interesantes

.. _iptables-limit:

limit
=====
En general, las extensiones de limitación (*limit*, *connlimit*, *haslimit*)
permiten establecer límites en el flujo de paquetes.

.. table:: 
   :class: iptables-ext

   +-----------+--------------------------------------------------------------------------------------------------------------------+
   | Extensión | Opción                                                                                                             |
   +===========+====================================================================================================================+
   | limit     | Límita el flujo de paquetes.                                                                                       |
   |           +-------------------+------------------------------------------------------------------------------------------------+
   |           | --limit           | Ratio máximo admisible.                                                                        |
   |           +-------------------+------------------------------------------------------------------------------------------------+
   |           | --limit-burst     | Ráfaga mayor admisible.                                                                        |
   |           |                   +------------------------------------------------------------------------------------------------+
   |           |                   | iptables -A FORWARD -i eth0 -p tcp --syn -m limit --limit 5/s --limit-burst 10 -j ACCEPT       |
   +-----------+-------------------+------------------------------------------------------------------------------------------------+
   | hashlimit | Limita el flujo de paquetes considerando el origen y el destino.                                                   |
   |           +-------------------+------------------------------------------------------------------------------------------------+
   |           | --hashlimit-mode  | Qué parámetros se consideran para definir la condición entre *srcip*, *srcport*, *dstip* y     |
   |           |                   | *dstport*. Si no se especifica, el módulo se comporta como ``limit``.                          |
   |           +-------------------+------------------------------------------------------------------------------------------------+
   |           | --hashlimit-upto  | Ratio máximo admisible.                                                                        |
   |           +-------------------+------------------------------------------------------------------------------------------------+
   |           | --hashlimit-burst | Ráfaga maypr admisible.                                                                        |
   |           |                   +------------------------------------------------------------------------------------------------+
   |           |                   | iptables -A FORWARD -m conntrack --ctstate DNAT -m hashlimit  --hashlimit-upto 5/s             |
   |           |                   | --hashlimit-burst 10 --haslimit-mode srcip,dstip -j ACCEPT                                     |
   +-----------+-------------------+------------------------------------------------------------------------------------------------+
   | connlimit | Límite de conexiones simultáneas.                                                                                  |
   |           +-------------------+------------------------------------------------------------------------------------------------+
   |           | --connlimit-upto  | Número máximo de conexiones simultáneas con un mismo cliente.                                  |
   |           |                   +------------------------------------------------------------------------------------------------+
   |           |                   | iptables -A FORWARD -m conntrack --ctstate DNAT -m connlimit --connlimit-upto 3 -j ACCEPT      |
   +-----------+-------------------+------------------------------------------------------------------------------------------------+

*limit* y *hashlimit* funcionan de forma semenjante: se establece un ratio medio
(``--limit``, ``--hashlimit-upto``) y un límite máximo para las ráfagas
(``--limit-burst``, ``--hashlimit-burst``) y el sistema funciona de forma
semejante a como lo haría un embudo:

.. image:: files/limit.png

El ratio representa el caudal de desagüe, pero el embudo posee un vaso que
permite verter puntualmente más agua hasta un límite máximo. Cada paquete viene
representado en el dibujo por una bolita, de modo que se pueden acomular como
máximo el número de paquetes indicado con ``--limit-burst``, lo que permite
absorber una ráfaga intensa.

.. seealso:: Una aplicación práctica del uso de este módulo puede verse bajo el
   :ref:`epígrafe dedicado a ataques DoS <dos-limit>`.

.. _ipt-ipset:

set
===

.. _iptables-recent:

recent
======

.. _iptables-log:

Registro
========

.. Logs alternativos:
   https://unix.stackexchange.com/questions/342855/how-to-customize-the-format-of-iptable-log-info
   https://wiki.wireshark.org/CaptureSetup/NFLOG
   http://www.luispa.com/archivos/704

.. Extraer de 00.dos iptables-limit.
