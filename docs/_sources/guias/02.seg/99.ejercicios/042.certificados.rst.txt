.. _ej-cert-dig:

Ejercicios sobre certificados digitales
=======================================

Sobre **certificados de servidor**:

#. Como para generar un certificado de servidor mediante el :ref:`desafío HTTP
   <desafios-acme>` es necesario tener una máquina directamente accesible desde
   internet, cree una máquina virtual que disponga de |IP| pública. Ilustre todo el
   proceso qye ha llevado ha cabo para lograrlo, incluido el proceso de alta, si
   ha tenido que darse de alta en algún servicio. Las características de las
   máquina deben ser las siguientes:

   + La mínima posible (1 procesador y 512 MiB de |RAM|).
   + Puerto **22** abierto.
   + Acceso |SSH| mediante usuario/contraseña.

#. Prepare la máquina virtual convenientemente, lo cual incluye:

   a. Acceso mediante |SSH| y :ref:`autenticación mediante clave pública
      <ssh-auth-claves>`.
   #. Abrir el acceso a la máquina por los puertos  **80** y **443**.

#. Créese un dominio virtual gratuito en `freenom
   <https://www.freenom.com/es/index.html?lang=es>`_ (escoja el que más le guste)
   y en la definición de la zona asocie el nombre ``www`` a la máquina virtual
   anterior.

   .. note:: Entre que haga la definición y que el nombre sea resoluble, puede
      pasar algún tiempo.

#. Instale acme.sh_ en la máquina virtual, preferiblemente mediante la creación
   previa de un paquete de *Debian*, como :ref:`se explica en el manual
   <nginx-https>`.

#. Instale y configure mínimamente un :ref:`servidor nginx <n-ginx>`. A pesar de
   la abundante documentación, se le exponen aquí los pasos de instalación para
   que el servidor quede funcionando en modo no seguro:

   a. Instalar el paquete **nginx-light**.
   #. Sustituir el contenido de :file:`/etc/nginx/sites-available/default` por
      este otro:

      .. code-block:: nginx

         server {
            listen 80;

            server_name _;

            root /srv/www/default;
            try_files $uri $uri/ =404;
         }

   #. Cree el directorio :file:`/srv/www/default`,
   #. Incluya dentro del directorio anterior un fichero :file:`index.html` con
      cualquier código |HTML|.
   #. Reinicie el servicio::

         # invoke-rc.d nginx restart

   #. Pruebe desde un navegador a conectar con el servidor web para ver la
      página.

#. Genere para su nombre de servidor un certificado `Let's Encrypt`_ según se
   :ref:`expone en los apuntes <nginx-https>` e instálelo.

#. Compruebe que acme.sh_ lista el certificado.

#. Modifique la configuración del servidor para atender al tráfico seguro.

#. Accede por |HTTP|\ s al servidor y cerciórese de que el certificado es
   válido.

Sobre **certificados personales**:

.. todo:: Crear una práctica que implique:

   + Sacar el certificado de la |FNMT|.
   + Exportar el certificado.
   + Comprobar su validez consultando el servicio de la |FNMT|.

.. _acme.sh: https://github.com/acmesh-official/acme.sh
.. _Let's Encrypt: https://letsencrypt.org/es/

.. |HTML| replace:: :abbr:`HTML (HyperText Markup Language)`
.. |RAM| replace:: :abbr:`RAM (Random Access Memory)`
.. |FNMT| replace:: :abbr:`FNMT (Fábrica Nacional de Moneda y Timbre)`
