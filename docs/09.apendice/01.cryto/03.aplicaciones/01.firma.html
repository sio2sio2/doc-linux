


<!DOCTYPE html>

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>9.1.3.1. Firma digital &#8212; documentación de Linuxnomicón - rolling</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/translations.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Índice" href="../../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../../search.html" />
    <link rel="next" title="9.1.3.2. Cifrado de discos" href="02.discos.html" />
    <link rel="prev" title="9.1.3. Aplicaciones de la criptografía" href="../03.aplicaciones.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="02.discos.html" title="9.1.3.2. Cifrado de discos"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="../03.aplicaciones.html" title="9.1.3. Aplicaciones de la criptografía"
             accesskey="P">anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" ><span class="section-number">9. </span>Apéndices</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" ><span class="section-number">9.1. </span>Criptografía</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../03.aplicaciones.html" accesskey="U"><span class="section-number">9.1.3. </span>Aplicaciones de la criptografía</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">9.1.3.1. </span>Firma digital</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="firma-digital">
<span id="id1"></span><h1><span class="section-number">9.1.3.1. </span>Firma digital<a class="headerlink" href="#firma-digital" title="Enlazar permanentemente con este título">¶</a></h1>
<p>Una <em>firma digital</em> es al mundo digital lo que la firma manuscrita al papel, la
cual certifica la identidad de quien firma y que se está de acuerdo con los
términos de lo firmado.</p>
<p>Para llevar a cabo la <em>firma digital</em> de unos datos (un fichero o un mensaje de
correo, por ejemplo) se obra del siguiente modo:</p>
<ul class="simple">
<li><p>Se obtiene un resumen de los datos mediante una función <em>hash</em>.</p></li>
<li><p>Se cifra tal resumen con la clave privada del firmante.</p></li>
<li><p>Se envían los datos (o se almacena el fichero) junto al resumen cifrado.</p></li>
</ul>
<p>Ante esto, un tercero (por ejemplo, el destinatario de un mensaje de correo
firmado), es capaz de certificar que el origen es quien dice ser, ya que
descifrará el resumen con la clave pública de éste y, por otra parte, podrá
comprobar si los datos conservan su integridad gracias al propio resumen
descifrado.</p>
<p>Conceptualmente, pues, es bastante sencillo y podemos ilustrar los pasos
anteriores haciendo uso de la <a class="reference internal" href="../02.algo.html#gnupg-1"><span class="std std-ref">orden gpg</span></a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;Este es el contenido del fichero que firmo&quot;</span> &gt; fichero.txt
<span class="gp">$</span> gpg --detach-sign --default-key mi_cuenta@example.com -o fichero.sig fichero.txt
</pre></div>
</div>
<p>De esta manera tenemos un fichero original (<code class="file docutils literal notranslate"><span class="pre">fichero.txt</span></code>) y su resumen
cifrado digitalmente con nuestra clave privada en <code class="file docutils literal notranslate"><span class="pre">fichero.sign</span></code>. Si
analizamos el fichero de firma:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --list-packets fichero.sign
<span class="go">:signature packet: algo 1, keyid 53175AA29C972B7B</span>
<span class="go">        version 4, created 1543050622, md5len 0, sigclass 0x00</span>
<span class="go">        digest algo 10, begin of digest 04 9e</span>
<span class="go">        hashed subpkt 33 len 21 (issuer fpr v4 040968BBC05C39A4DD2A43BD53175AA29C972B7B)</span>
<span class="go">        hashed subpkt 2 len 4 (sig created 2018-11-24)</span>
<span class="go">        hashed subpkt 28 len 23 (signer&#39;s user ID)</span>
<span class="go">        subpkt 16 len 8 (issuer key ID 53175AA29C972B7B)</span>
<span class="go">        data: [3071 bits]</span>
</pre></div>
</div>
<p>veremos algunas características de la firma, como:</p>
<ul>
<li><p>qué algoritmo de clave simétrica se usó, el <strong>1</strong>, que se corresponde con una
clave asimétrica <abbr title="Rivest, Shamir y Adleman">RSA</abbr>, válida tanto para firma como para cifrado. El
significado de los códigos puede encontrarse en el <span class="target" id="index-0"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc4880.html"><strong>RFC 4880</strong></a>, y en concreto
en la <a class="reference external" href="https://tools.ietf.org/html/rfc4880#section-9.1">sección 9.1</a>.</p></li>
<li><p>qué clave se usó: la <em>53175AA29C972B7B</em>, que efectivamente es la nuestra:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --keyid-format long -list-keys
<span class="go">/home/usuario/.gnupg/pubring.kbx</span>
<span class="go">--------------------------------</span>
<span class="hll"><span class="go">pub   rsa3072/53175AA29C972B7B 2018-11-21 [SC] [expires: 2020-11-20]</span>
</span><span class="go">      040968BBC05C39A4DD2A43BD53175AA29C972B7B</span>
<span class="go">uid                 [ unknown] Soy el que soy &lt;mi_cuenta@example.com&gt;</span>
<span class="go">      sub   rsa3072/4B1F09C9B84F038E 2018-11-21 [E] [expires: 2020-11-20]</span>
</pre></div>
</div>
</li>
<li><p>con qué algoritmo se resumió el fichero, el <strong>10</strong>, que es <em>SHA512</em> según
<a class="reference external" href="https://tools.ietf.org/html/rfc4880#section-9.4">la sección 9.4</a> del
<span class="target" id="index-1"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc4880.html"><strong>RFC 4880</strong></a>.</p></li>
</ul>
<p>Si hacemos llegar <strong>ambos</strong> archivos a un tercero, y éste posee nuestra clave
pública, podrá verificar nuestra identidad gracias al cifrado de la firma y la
integridad del fichero gracias al resumen que contiene esta:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --verify fichero.sign fichero.txt
<span class="go">[...]</span>
<span class="go">Primary key fingerprint: 0409 68BB C05C 39A4 DD2A  43BD 5317 5AA2 9C97 2B7B</span>
<span class="gp">$</span> <span class="nb">echo</span> <span class="nv">$?</span>
<span class="go">0</span>
</pre></div>
</div>
<p>Todo parece perfecto… pero hay un pequeño problema. ¿Cómo está seguro el
tercero de que la clave pública que posee es realmente de quien dice ser y no
otro que suplanta su identidad? Para subsanar este último escollo existen los
<em>certificados digitales</em>.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Retenga el adagio de que la clave pública del destinatario se usa para
cifrar, y la clave privada del emisor para firmar.</p>
</div>
<div class="section" id="correo-electronico">
<h2><span class="section-number">9.1.3.1.1. </span>Correo electrónico<a class="headerlink" href="#correo-electronico" title="Enlazar permanentemente con este título">¶</a></h2>
<p>La firma digital es muy usada en el correo electrónico, ya que si se firma el
conjunto de las cabeceras del mensaje, el cuerpo y los adjuntos, y finalmente
esa firma se adhiere al propio mensaje como adjunto adicional, el destinatario
puede tener seguridad al recibir un mensaje de que éste fue escrito por quien
dice y que no ha sido modificado por el camino.</p>
<p>Lo habitual es que se usen claves <abbr title="Pretty Good Privacy">PGP</abbr> un estándar desarrollado para el cifrado
y firma de mensajes de correos electrónicos, cuya generación, importación y
exportación de claves se <a class="reference internal" href="../02.algo.html#gpg-pgp"><span class="std std-ref">practicamos al tratar el cifrado asimétrico</span></a>. Obviamente, el proceso de firma de un mensaje no exige la
elaboración <em>artesanal</em> de la firma, sino que los clientes de correo como
<a class="reference internal" href="../../../07.serre/03.mail/04-misc/02-cliente/05-mua.html#mutt"><span class="std std-ref">mutt</span></a> o <a class="reference external" href="https://www.thunderbird.net">Thunderbird</a> suelen incorporar esa funcionalidad para que
el proceso sea muy sencillo.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>También es posible firmar y cifrar mensajes con determinados servicios
de <em>webmail</em> y la extensión adecuada del navegador. Por ejemplo, en
<strong class="program">Chrome</strong> existe la extensión <a class="reference external" href="https://www.mailvelope.com/en">Mailenvelope</a> que permite el cifrado de
mensajes para los principales sitios de webmail (<a class="reference external" href="https://gmail.google.com">Gmail</a>, <a class="reference external" href="https://mail.yahoo.com">Yahoo</a>, <a class="reference external" href="https://www.outlook.com">Outlook</a>,
etc.).</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">Ver también</p>
<p>Para ver cómo firmar mensajes de correo en <a class="reference internal" href="../../../07.serre/03.mail/04-misc/02-cliente/05-mua.html#mutt"><span class="std std-ref">mutt</span></a> con
el certificado de la <abbr title="Fábrica Nacional de Moneda y Timbre">FNMT</abbr>, puede consultar <a class="reference internal" href="../../../07.serre/03.mail/04-misc/02-cliente/05-mua.html#mutt-fnmt"><span class="std std-ref">este epígrafe</span></a>.</p>
</div>
</div>
<div class="section" id="certificado-digital">
<span id="cert-digital"></span><h2><span class="section-number">9.1.3.1.2. </span>Certificado digital<a class="headerlink" href="#certificado-digital" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Tratamos los <em>certificados digitales de clave pública</em>, por lo que a
partir de ahora hablaremos, simplemente, de <em>certificados digitales</em>.</p>
</div>
<p>Un <em class="dfn">certificado digital</em> es un documento firmado digitalmente por una
<em>autoridad de certificación</em> que asocia unos datos de identificación con una
clave pública. Esto, pues, resuelve el problema de suplantación: sabemos que la
clave pública pertenece a quien dice pertenecer, porque un tercero, la autoridad
de certificación (<abbr title="Certification Authority">CA</abbr>), en el que tenemos absoluta confianza, lo acredita y ha firmado
para ello. Suelen basarse en el <a class="reference external" href="https://www.ssl.com/faqs/what-is-an-x-509-certificate/">estándar X.509</a> definido en el
<span class="target" id="index-2"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc5280.html"><strong>RFC 5280</strong></a>.</p>
<img alt="../../../_images/certificado.png" src="../../../_images/certificado.png" />
<p>Esquematizando, pues, un <em>certificado digital</em> se compone:</p>
<ul class="simple">
<li><p>Una pareja de claves.</p></li>
<li><p>La identidad del propietario de dichas claves.</p></li>
<li><p>La firma digital de una autoridad de certificación sobre la clave pública y
los datos identificativos.</p></li>
</ul>
<p>Así pues, cuando se firma con un certificado digital el receptor del mensaje
puede, además de comprobar la integridad del mensaje saber con total seguridad
que la clave publica que ha usado pata tal comprobación pertenece a quien parece
pertenece.</p>
<p>Así todo queda resuelto. Ahora bien, ¿quién es esta autoridad de certificación y
por qué es digna de confianza? Una <em class="dfn">autoridad de certificación</em> (a partir
de ahora, <abbr title="Certification Authority">CA</abbr>) es aquella entidad de confianza encargada de emitir (y revocar)
certificados digitales.  Para llevar a cabo esta tarea la propia <abbr title="Certification Authority">CA</abbr> dispone de
un certificado, de manera que con su clave privada firma los certificados que
emite. La estructura es jerárquica y el certificado de una <abbr title="Certification Authority">CA</abbr> puede estar
avalado por la firma de otro <abbr title="Certification Authority">CA</abbr> de rango superior. Sin embargo, en la cúspide
se encuentran las <abbr title="Certification Authority">CA</abbr> raíz, cuyos certificados son autofirmado, lo que
significa que nadie certifica digitalmente la identidad de la <abbr title="Certification Authority">CA</abbr>. La garantía
de estos certificados viene avalada porque los propios sistemas operativos y
navegadores web incorporan los certificados raíz de estas autoridades, que
habrán avalado de algún modo su identidad. Por ejemplo, <em>Debian</em>, incluye el
paquete <a class="reference external" href="https://packages.debian.org/search?keywords=ca-certificates">ca-certificates</a>, que las
contiene.</p>
<p>Un ejemplo de esta jerarquía es el <a class="reference internal" href="../../../07.serre/02.web/02.nginx/02.avanz/07.https.html#nginx-https"><span class="std std-ref">certificado gratuito para servidores
web</span></a> emitido por <a class="reference external" href="https://letsencrypt.org/">Let’s Encrypt</a>, cuyo certificado a
su vez esta firmado por <a class="reference external" href="https://www.identrust.com/">Digital Signature Trust</a>, que sí es una <abbr title="Certification Authority">CA</abbr> raíz:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> openssl x509 -in letsencrypt.cer -subject -issuer -noout
<span class="go">subject=C = US, O = Let&#39;s Encrypt, CN = R3</span>
<span class="go">issuer=O = Digital Signature Trust Co., CN = DST Root CA X3</span>
</pre></div>
</div>
<p>Sea como sea, las <abbr title="Certification Authority">CA</abbr> generan certificados finales:</p>
<ul class="simple">
<li><p>Para otra <abbr title="Certification Authority">CA</abbr> subordinada.</p></li>
<li><p>Para una persona física.</p></li>
<li><p>Para una aplicación de <em>software</em></p></li>
<li><p>Para un servidor.</p></li>
</ul>
<p>Los certificados, no obstante, no son eternos: la <abbr title="Certification Authority">CA</abbr> los acredita por un
tiempo determinado, por lo que son sólo válidos entre una fecha inicial
(normalmente la fecha en que se generan) y una fecha final que varía según
el tiempo de validez por el que se certifiquen. Ambas fechas se incluyen dentro
de los datos identificativos.</p>
<div class="section" id="certificados-personales">
<h3><span class="section-number">9.1.3.1.2.1. </span>Certificados personales<a class="headerlink" href="#certificados-personales" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El proceso típico de emisión de un certificado personal es el siguiente:</p>
<ol class="arabic simple">
<li><p>El interesado realiza una solicitud a la <abbr title="Certification Authority">CA</abbr>, por lo general a través de
un servicio web, en que se recogen los datos identificativos y se genera una
pareja de claves. Ahora bien, como la identidad del interesado no ha podido
verificarse, la <abbr title="Certification Authority">CA</abbr> genera una petición <abbr title="Certificate Signing Request">CSR</abbr>.</p></li>
<li><p>El interesado se acerca físicamente a la oficina de una <abbr title="Registration Authority">RA</abbr> (autoridad de
registro) a fin de confirmar ante ésta que es quien dice ser.</p></li>
<li><p>La <abbr title="Registration Authority">RA</abbr> notifica a la <abbr title="Certification Authority">CA</abbr> tal verificación, con lo que esta pone a
disposición del interesado (p.e. a través del servicio web que utilizó
primeramente) el certificado solicitado.</p></li>
<li><p>El interesado obtiene el certificado y lo instala en su sistema (navegador,
cliente de correo, etc).</p></li>
</ol>
<img alt="../../../_images/certificados.png" src="../../../_images/certificados.png" />
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>En España la autoridad de certificación que usan la inmensa mayoría de
las administraciones públicas es la <a class="reference external" href="http://www.cert.fnmt.es">Fábrica Nacional de Moneda y Timbre</a>.  Muchas particulares españoles también usan esta
autoridad para sus certificados personales, gracias a una <a class="reference external" href="http://mapaoficinascert.appspot.com/">extensa red de
oficinas de registro</a> (<abbr title="Registration Authority">RA</abbr>) que
incluye oficinas de la seguridad social, de la agencia tributaria o
ayuntamientos.</p>
</div>
<p>Por último, es necesario señalar que, para asegurar la validez de un
certificado, no basta sólo con comprobar si el certificado no ha caducado y
hacer uso de la firma pública de la <abbr title="Certification Authority">CA</abbr>. Un certificado puede haberse revocado
antes de caducar y, en consecuencia, dejar de ser válido antes de tiempo. Por
eso, las <abbr title="Certification Authority">CA</abbr> deben ofrecer un servicio para la comprobación de estas
revocaciones. Por ejemplo, la <abbr title="Fábrica Nacional de Moneda y Timbre">FNMT</abbr> ofrece este servicio de forma gratuita<a class="footnote-reference brackets" href="#id7" id="id2">1</a> mediante el protocolo estándar <abbr title="Online Certificate Status Protocol">OCSP</abbr> descrito en el <span class="target" id="index-3"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc6960.html"><strong>RFC 6960</strong></a>.</p>
<div class="admonition seealso">
<p class="admonition-title">Ver también</p>
<p>Ëchele un ojo a la <a class="reference external" href="http://blog.marcnuri.com/ocsp-validar-estado-de-revocacion-de-certificados-fnmt-mediante-protocolo-ocsp-y-openssl/">entrada de este blog donde habla del
asunto</a>
y se cuenta cómo verificar los certificados emitidos por la <abbr title="Fábrica Nacional de Moneda y Timbre">FNMT</abbr> usando
<strong class="command">openssl</strong>.</p>
</div>
</div>
<div class="section" id="certificados-de-servidor">
<h3><span class="section-number">9.1.3.1.2.2. </span>Certificados de servidor<a class="headerlink" href="#certificados-de-servidor" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Estos certificados avalan que una determinada máquina (o conjunto de máquinas, si
el servidor es distribuido) tienen un determinado nombre en internet. Así,
cuando conectamos a la <a class="reference external" href="https://educacionyfp.gob.es">página oficial de Ministerio de Educación</a>, el certificado de servidor avala que la máquina
con la que conectamos es <kbd class="kbd docutils literal notranslate">educacionyfp.gob.es</kbd>. En este caso, existen
distintos niveles de acreditación, pero en el más básico es posible que la
autoridad teleacredite al servidor. Échele un ojo al <a class="reference internal" href="../../../07.serre/02.web/02.nginx/02.avanz/07.https.html#nginx-https"><span class="std std-ref">procedimiento para
obtener certificados mediante el protocolo ACME</span></a>.</p>
</div>
<div class="section" id="formatos-de-certificados-x-509">
<h3><span class="section-number">9.1.3.1.2.3. </span>Formatos de certificados X.509<a class="headerlink" href="#formatos-de-certificados-x-509" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Los certificados digitales se presentan en distintos formatos de archivo que
conviene conocer, porque en ocasiones para hacer una determinada operación o
utilizarlo con cierta aplicación lo necesitaremos en uno concreto. Además, de la
descripción de estos formatos incluimos, a modo de vademécum, las órdenes más
comunes con <strong class="program">openssl</strong> para transformar del formato <abbr title="Private Enhanced Mail">PEM</abbr> (el estándar
común en el <em>software</em> libre) al resto de formatos y viceversa<a class="footnote-reference brackets" href="#id8" id="id3">2</a>:</p>
<dl>
<dt><abbr title="Private Enhanced Mail">PEM</abbr></dt><dd><p>Es el estándar desarrollado por los <span class="target" id="index-4"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc1421.html"><strong>RFC 1421</strong></a>, <span class="target" id="index-5"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc1422.html"><strong>RFC 1422</strong></a>, <span class="target" id="index-6"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc1423.html"><strong>RFC 1423</strong></a> y
<span class="target" id="index-7"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc1424.html"><strong>RFC 1424</strong></a> y muy usado por aplicaciones de <em>software</em> libre (p.e. los
certificados de servidor de <a class="reference internal" href="../../../07.serre/02.web/02.nginx/index.html#n-ginx"><span class="std std-ref">nginx</span></a> o <strong class="program">apache</strong> se
almacenan usando este estándar). Cuando se cifra, sólo se cifra la parte
privada. Da lugar a distintos tipos de archivos que pueden contener el
certificado privado, el público y el certificado (o los certificados) de la
autoridad de certificación.</p>
<p>Este estándar genera archivos imprimibles (está codificado en <a class="reference external" href="https://es.wikipedia.org/wiki/Base64">Base64</a>) y
suele presentarse bajo estas extensiones:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.pem</span></code> tanto cuando contienen sólo el certificado público (y,
opcionalmente, también los de la autoridad de certificación) como cuando
contienen además el privado.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.key</span></code> cuando el fichero contiene sólo la parte privada.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.cer</span></code> y <code class="docutils literal notranslate"><span class="pre">.crt</span></code> cuando contiene sólo la parte pública. Frecuentemente,
sin embargo, el formato de este fichero no es <abbr title="Private Enhanced Mail">PEM</abbr> sino <abbr title="Distinguished Encoding Rules">DER</abbr>.</p></li>
</ul>
<p>Algunas operaciones habituales con este tipo de certificado son:</p>
<ol class="arabic">
<li><p>Ver los datos del certificado público:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> openssl x509 -in CERTIFICADO.pem -text -noout
</pre></div>
</div>
</li>
<li><p>Transformar el certificado público <abbr title="Private Enhanced Mail">PEM</abbr> a formato <abbr title="Distinguished Encoding Rules">DER</abbr>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> openssl x509 -inform pem -in CERTIFICADO.pem -outform der -out CERTIFICADO.crt
</pre></div>
</div>
</li>
<li><p>Trasformar la clave privada <abbr title="Private Enhanced Mail">PEM</abbr> al formato <abbr title="Distinguished Encoding Rules">DER</abbr>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> openssl rsa -inform pem -in CERTIFICADO.key -outform der -out CERTIFICADO.key.der
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>El formato resultante no estará cifrado y, por tanto, la
clave privada estará totalmente desprotegida.</p>
</div>
</li>
<li><p>Generar un archivo <code class="docutils literal notranslate"><span class="pre">.p12</span></code> a partir de los archivos <code class="docutils literal notranslate"><span class="pre">.pem</span></code> y <code class="docutils literal notranslate"><span class="pre">,key</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> openssl pkcs12 -export -out CERTIFICADO.p12 -in CERTIFICADO.pem -inkey CERTIFICADO.pem
</pre></div>
</div>
<p>Si el archivo <code class="docutils literal notranslate"><span class="pre">.pem</span></code> contiene ambas partes pública y privada, basta con
incluir este único fichero como argumento de <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate"></kbd>-<kbd class="kbd docutils literal notranslate">in</kbd></kbd> y prescindir de
<kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate"></kbd>-<kbd class="kbd docutils literal notranslate">inkey</kbd></kbd>.  La archivo con la parte pública debe contener al menos la
clave pública del certificado, pero también puede contener la de la
autoridad de certificación. Si la clave de la autoridad está en archivo
distinto pero se quiere incluirla dentro del resultado puede referirse
este tercer archivo mediante la opción <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate"></kbd>-<kbd class="kbd docutils literal notranslate">CAfile</kbd></kbd>.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Como se necesita introducir una clave para descifrar el
contenido de <code class="file docutils literal notranslate"><span class="pre">CERTIFCADO.key</span></code> y otra para cifrar
<code class="file docutils literal notranslate"><span class="pre">CERTIFICADO.p12</span></code><a class="footnote-reference brackets" href="#id9" id="id4">3</a> se pedirán interactivamente las dos claves. Si
se quieren pasarlas por la línea de órdenes utilice las opciones
<kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate"></kbd>-<kbd class="kbd docutils literal notranslate">passin</kbd></kbd> y <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate"></kbd>-<kbd class="kbd docutils literal notranslate">passout</kbd></kbd> y consulte la sección «Pass Plhare
Options» de <em class="manpage"><a class="manpage reference external" href="https://manpages.debian.org/openssl(1)">openssl(1)</a></em>.</p>
</div>
</li>
<li><p>Transformar el certificado público <abbr title="Private Enhanced Mail">PEM</abbr> al formato <abbr title="Public-Key Cryptography Standards">PKCS</abbr> #7:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> openssl crl2pkcs7 -nocrl  -certfile CERTIFICADO.pem -out CERTIFICADO.p7b
</pre></div>
</div>
</li>
</ol>
</dd>
<dt><abbr title="Distinguished Encoding Rules">DER</abbr></dt><dd><p>Es un formato de certificado binario (o sea, no imprimible) muy usando en los
sistemas <em>Windows</em>. O contiene la parte privada o la pública, pero no ambas.
Suele encontrase en archivos con extensión:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.der</span></code>, que generalmente contiene una u otra parte.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.cer</span></code> o <code class="docutils literal notranslate"><span class="pre">.crt</span></code>, cuando contiene sólo la parte pública. La forma más
simple de distinguir si un fichero con esta extensión es <abbr title="Private Enhanced Mail">PEM</abbr> o <abbr title="Distinguished Encoding Rules">DER</abbr> es
mirar su contenido con <a class="reference internal" href="../../../02.conbas/02.informacion/03.ficheros.html#cat"><span class="std std-ref">cat</span></a> y ver si contiene caracteres
imprimibles o no.</p></li>
</ul>
<p>Operaciones habituales:</p>
<ol class="arabic">
<li><p>Ver los datos del certificado público:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> openssl x509 -inform der -in CERTIFICADO.crt -text -noout
</pre></div>
</div>
</li>
<li><p>Trasformar un certificado público <abbr title="Distinguished Encoding Rules">DER</abbr> al formato <abbr title="Private Enhanced Mail">PEM</abbr>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> openssl x509 -inform der -in CERTIFICADO.crt -outform pem -out CERTIFICADO.pem
</pre></div>
</div>
</li>
<li><p>Trasformar la clave pública <abbr title="Distinguished Encoding Rules">DER</abbr> al formato <abbr title="Private Enhanced Mail">PEM</abbr> (y proteger la
clave con un cifrado <abbr title="Advanced Encryption Standard">AES</abbr>256):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> openssl rsa -inform der -in CERTIFICADO.key.der -outform pem -aes256 -out CERTIFICADO.key
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Consulte <em class="manpage"><a class="manpage reference external" href="https://manpages.debian.org/openssl-rsa(1)">openssl-rsa(1)</a></em> para ver qué otros parámetros
cifran la clave con algoritmos distintos.</p>
</div>
</li>
</ol>
</dd>
<dt><abbr title="Public-Key Cryptography Standards">PKCS</abbr> #12 (<code class="docutils literal notranslate"><span class="pre">.p12</span></code> o, a veces, <code class="docutils literal notranslate"><span class="pre">.pfx</span></code>)</dt><dd><p>Formato originario de <a class="reference external" href="https://www.microsoft.com">Microsoft</a> que se acabó estandarizando mediante el
<span class="target" id="index-8"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc7292.html"><strong>RFC 7292</strong></a> y contiene tanto la clave pública como la privada del
certificado. En este formato toda la información contenida esta cifrada con
una clave simétrica (a diferencia del <abbr title="Private Enhanced Mail">PEM</abbr> que sólo cifra la privada) y es
el que suelen usar los navegadores para exportar e importar los certificados
personales de los usuarios.</p>
<p>Operaciones habituales:</p>
<ol class="arabic">
<li><p>Convertir el archivo <code class="docutils literal notranslate"><span class="pre">.p12</span></code> al formato <abbr title="Private Enhanced Mail">PEM</abbr> en un sólo archivo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> openssl pkcs12 -in CERTIFICADO.p12 -out CERTIFICADO.pem
</pre></div>
</div>
</li>
<li><p>Ídem pero separando en dos archivos la clave pública y la privada:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> openssl pkcs12 -in CERTIFICADO.p12 -nocerts -out CERTIFICADO.key
<span class="gp">#</span> openssl pkcs12 -in CERTIFICADO.p12 -nokeys -out CERTIFICADO.pem
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Al generar el <abbr title="Private Enhanced Mail">PEM</abbr> con el certificado público se puede querer
no incluir los certificados públicos de las autoridades de
certificación (añadiendo <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate"></kbd>-<kbd class="kbd docutils literal notranslate">clcerts</kbd></kbd>) o, justo lo contrario, y sólo
incluir los certificados públicos de <abbr title="Certification Authority">CA</abbr> (añadiendo <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate"></kbd>-<kbd class="kbd docutils literal notranslate">cacerts</kbd></kbd>).</p>
</div>
</li>
<li><p>Ver los datos del certificado público (no hay forma directa, así que hay
que traducir a <abbr title="Private Enhanced Mail">PEM</abbr> y obtener la información de la traducción):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> openssl pkcs12 -in CERTIFICADO.p12 -clcerts -nokeys <span class="p">|</span> openssl x509 -text -noout
</pre></div>
</div>
</li>
</ol>
</dd>
<dt><abbr title="Public-Key Cryptography Standards">PKCS</abbr> #7 (<code class="docutils literal notranslate"><span class="pre">.p7b</span></code>)</dt><dd><p>Formato estandarizado a través del <span class="target" id="index-9"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc2315.html"><strong>RFC 2315</strong></a> que sólo contiene la parte
pública del certificado. Suele usarse en sistemas <em>Windows</em> y aplicaciones
escritas en Java.</p>
<p>Operaciones habituales:</p>
<ol class="arabic">
<li><p>Consultar los datos del certificado:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> openssl pkcs7 -in CERTIFICADO.p7b -print_certs -text -noout
</pre></div>
</div>
</li>
<li><p>Transformar el certificado <abbr title="Public-Key Cryptography Standards">PKCS</abbr> #7 al formato <abbr title="Private Enhanced Mail">PEM</abbr>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> openssl pkcs7 -in certificate.p7b -print_certs -out certificate.cer
</pre></div>
</div>
</li>
</ol>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">Ver también</p>
<p>Como referencia para este apartado se ha usado la <a class="reference external" href="https://serverfault.com/questions/9708/what-is-a-pem-file-and-how-does-it-differ-from-other-openssl-generated-key-file">extensa
respuesta a una pregunta formulada en serverfault</a></p>
</div>
</div>
<div class="section" id="destripando-certificados">
<span id="info-cert"></span><h3><span class="section-number">9.1.3.1.2.4. </span>Destripando certificados<a class="headerlink" href="#destripando-certificados" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Ya se ha establecido que un certificado consta de:</p>
<ul class="simple">
<li><p>Una <strong>parte pública</strong> compuesta por unos datos identificativos y una clave pública
firmada por una <abbr title="Certification Authority">CA</abbr>.</p></li>
<li><p>Una <strong>parte privada</strong> constituida por una clave privada, cifrada o no por una
clave simétrica.</p></li>
</ul>
<p>Consultar la información contenida en la parte pública puede proporcionar datos
muy jugosos sobre el propio certificado y eso es lo que haremos con
<strong class="command">openssl</strong>, ya que aunque el formato <abbr title="Private Enhanced Mail">PEM</abbr> sea imprimible la información
está codificada en base64, por lo que un <a class="reference internal" href="../../../02.conbas/02.informacion/03.ficheros.html#cat"><span class="std std-ref">cat</span></a> es de poca ayuda. La
orden ya se encuentra escrita en el epígrafe anterior:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> openssl x509 -in CERTFICADO.pem -text -noout
</pre></div>
</div>
<p>Si aplicamos esta orden sobre, por ejemplo, un certificado de servidor emitido por  <a class="reference external" href="https://letsencrypt.org/">Let’s
Encrypt</a> obtendremos lo siguiente:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            03:0f:0a:5a:7a:49:c4:c1:e3:77:a3:ae:0f:7b:94:db:6d:c5
        Signature Algorithm: sha256WithRSAEncryption
        Issuer: C = US, O = Let&#39;s Encrypt, CN = R3
        Validity
            Not Before: Jan 18 10:03:44 2021 GMT
            Not After : Apr 18 10:03:44 2021 GMT
        Subject: CN = lets2.iescdl.es
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                RSA Public-Key: (2048 bit)
                Modulus:
                    00:e0:ba:dd:c2:58:8e:93:81:8c:72:62:8a:93:44:
                    7f:46:42:bd:88:33:b8:56:be:7a:6b:3c:2f:dd:9f:
                    f6:50:8f:9e:ff:d4:08:67:4b:20:f5:45:57:33:6e:
                    26:21:bb:25:cc:6a:69:8b:7b:92:ce:a6:ae:8b:2f:
                    46:31:8c:ab:03:b5:9b:c1:31:5b:81:4d:d0:e9:69:
                    cd:92:a8:28:15:de:db:39:4c:5a:12:19:d0:95:f7:
                    13:bb:8c:a8:af:9c:7f:b4:b1:ff:c2:8a:e8:72:61:
                    40:5e:12:32:f6:3a:c4:c9:5c:d1:fd:7a:8a:ba:d5:
                    48:58:a8:4f:b9:e7:e7:ad:7b:cb:47:5a:18:5a:fd:
                    9b:5b:fc:c4:0f:4d:c8:1c:d4:5c:4f:26:4d:6b:cb:
                    9d:39:f0:c2:67:2a:9a:1e:33:3c:e1:b9:e5:82:88:
                    8c:02:63:f9:02:be:09:ed:07:5e:86:de:5c:20:16:
                    38:64:d9:82:99:31:ca:59:28:db:10:55:bb:87:a8:
                    65:ec:78:87:87:cf:a0:77:a5:fa:4a:a6:56:18:00:
                    18:3d:4f:d1:8e:49:30:64:5f:46:34:ae:51:73:1c:
                    51:5e:18:ca:1a:4c:0c:3b:d2:0a:95:9f:20:1d:83:
                    69:95:1d:b2:b8:7b:a3:56:c5:11:f8:87:11:97:d3:
                    12:c3
                Exponent: 65537 (0x10001)
        X509v3 extensions:
            X509v3 Key Usage: critical
                Digital Signature, Key Encipherment
            X509v3 Extended Key Usage: 
                TLS Web Server Authentication, TLS Web Client Authentication
            X509v3 Basic Constraints: critical
                CA:FALSE
            X509v3 Subject Key Identifier: 
                E4:0B:D3:2C:DA:89:8A:80:4A:7A:76:AD:D1:9B:1C:32:5A:D2:82:C8
            X509v3 Authority Key Identifier: 
                keyid:14:2E:B3:17:B7:58:56:CB:AE:50:09:40:E6:1F:AF:9D:8B:14:C2:C6

            Authority Information Access: 
                OCSP - URI:http://r3.o.lencr.org
                CA Issuers - URI:http://r3.i.lencr.org/

            X509v3 Subject Alternative Name: 
                DNS:azure.iescdl.es, DNS:lets.iescdl.es, DNS:lets2.iescdl.es
            X509v3 Certificate Policies: 
                Policy: 2.23.140.1.2.1
                Policy: 1.3.6.1.4.1.44947.1.1.1
                  CPS: http://cps.letsencrypt.org

            CT Precertificate SCTs: 
                Signed Certificate Timestamp:
                    Version   : v1 (0x0)
                    Log ID    : 94:20:BC:1E:8E:D5:8D:6C:88:73:1F:82:8B:22:2C:0D:
                                D1:DA:4D:5E:6C:4F:94:3D:61:DB:4E:2F:58:4D:A2:C2
                    Timestamp : Jan 18 11:03:44.729 2021 GMT
                    Extensions: none
                    Signature : ecdsa-with-SHA256
                                30:45:02:20:1E:02:B9:E3:8E:72:85:FF:85:E6:33:63:
                                1E:52:BA:7C:91:01:BE:F1:C8:BC:9B:45:99:0F:4C:3A:
                                BB:7F:16:FB:02:21:00:EC:18:54:D9:86:65:63:B7:53:
                                C9:8B:62:C3:AA:9E:D8:95:1E:64:CB:EA:D7:B9:E0:71:
                                C0:72:CF:78:16:ED:F6
                Signed Certificate Timestamp:
                    Version   : v1 (0x0)
                    Log ID    : F6:5C:94:2F:D1:77:30:22:14:54:18:08:30:94:56:8E:
                                E3:4D:13:19:33:BF:DF:0C:2F:20:0B:CC:4E:F1:64:E3
                    Timestamp : Jan 18 11:03:44.723 2021 GMT
                    Extensions: none
                    Signature : ecdsa-with-SHA256
                                30:46:02:21:00:EA:A9:7C:3A:2E:5D:76:CE:E9:F8:C9:
                                4B:0D:7C:2C:48:DB:C9:3B:2A:3D:DA:06:3C:17:C4:33:
                                BA:E7:0D:FA:1C:02:21:00:BC:6B:0D:C1:4F:A3:F6:64:
                                E5:FC:9A:C9:24:61:83:0B:D2:9B:4D:35:2C:51:BA:E9:
                                93:43:6E:57:5D:31:F8:84
    Signature Algorithm: sha256WithRSAEncryption
         64:d5:bb:73:b6:45:9e:36:1e:92:53:bc:2a:82:1e:35:51:f3:
         ae:96:6c:62:25:55:cf:3a:21:67:2b:09:3f:da:f3:81:34:7a:
         b7:f7:07:72:db:6f:0b:d1:4f:d6:1e:6f:1a:8c:8c:a3:1d:09:
         29:4b:ac:b2:c9:65:4a:a6:9c:ab:49:60:54:e9:22:22:f1:39:
         33:09:1b:eb:95:bd:70:ff:fc:5f:6e:42:a2:5e:b5:63:35:4a:
         b1:fa:4f:4e:ed:34:a2:2d:35:78:3a:67:0d:f7:82:bb:03:bb:
         f1:d6:05:38:40:d5:2f:3f:34:51:9f:39:9b:a1:e1:10:a5:a8:
         07:21:71:fa:1f:1a:de:e7:8d:22:44:59:e9:8f:0a:d5:6a:f7:
         9d:35:80:54:a2:38:10:9d:b3:cb:3d:6e:e1:41:61:1c:60:9c:
         07:a0:bb:9d:f5:c0:04:6a:4f:4c:c7:50:70:4e:7f:1d:12:08:
         9e:8c:7b:ac:a8:cb:e8:7a:21:36:dd:da:e3:00:0b:a5:91:ff:
         5f:2d:23:47:b9:22:34:96:0d:80:ca:0d:16:8f:72:5f:88:68:
         c2:8c:fe:90:e4:82:b6:7b:30:10:87:46:64:28:17:cc:9b:db:
         96:e2:e5:cf:ca:22:93:ef:3e:ba:bf:15:61:fc:bc:88:03:dd:
         cd:03:c5:e1
</pre></div>
</div>
<p>Observando la salida se distinguen dos partes:</p>
<ul class="simple">
<li><p>Los datos en sí (<kbd class="kbd docutils literal notranslate">Data</kbd>).</p></li>
<li><p>La firma de tales datos (<kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Signature</kbd> <kbd class="kbd docutils literal notranslate">Algorithm</kbd></kbd>) para lo cual han usado
como <a class="reference internal" href="../02.algo.html#hash"><span class="std std-ref">función hash el algoritmo sha256</span></a>.</p></li>
</ul>
<p>Dento de los datos podemos distinguir:</p>
<ul class="simple">
<li><p>Datos propiamente identificativos como su número de serie o la identidad del
propietario del certificado (<code class="docutils literal notranslate"><span class="pre">Subject</span></code>).</p></li>
<li><p>Datos referentes al propio certificado como su validez o quién es el firmante
(<code class="docutils literal notranslate"><span class="pre">Issuer</span></code>)<a class="footnote-reference brackets" href="#id10" id="id5">4</a>.</p></li>
<li><p>La clave pública del certificado (<code class="docutils literal notranslate"><span class="pre">Subject</span> <span class="pre">Public</span> <span class="pre">Key</span> <span class="pre">Info</span></code>).</p></li>
</ul>
<p>Uno de los campos (<code class="docutils literal notranslate"><span class="pre">X509v3</span> <span class="pre">extensions</span></code>) contiene campos adicionales con
información de cualquiera de los tres tipos anteriores. Algunos de estos campos
ofrecen información interesante como:</p>
<ul class="simple">
<li><p>La <abbr title="Uniform Resource Locator">URL</abbr> en la que comprobar si el certificado está revocado (<code class="docutils literal notranslate"><span class="pre">Authority</span>
<span class="pre">Information</span> <span class="pre">Acces</span></code>).</p></li>
<li><p>Un identificador para el propio certificado (<code class="docutils literal notranslate"><span class="pre">X509v3</span> <span class="pre">Subject</span> <span class="pre">Key</span> <span class="pre">Identifier</span></code>).</p></li>
<li><p>El identificador para el certificado con que la <abbr title="Certification Authority">CA</abbr> firmó (<code class="docutils literal notranslate"><span class="pre">X509v3</span> <span class="pre">Authority</span>
<span class="pre">Key</span> <span class="pre">Identifier</span></code>).</p></li>
</ul>
<p>La opción <code class="docutils literal notranslate"><span class="pre">-text</span></code> de <strong class="command">openssl</strong> devuelve toda la información, pero
podemos afinar (véase <em class="manpage"><a class="manpage reference external" href="https://manpages.debian.org/openssl-x509(1)">openssl-x509(1)</a></em>):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> openssl x509 -in CERTIFICADO.pem -subject -noout
<span class="go">subject=CN = lets2.iescdl.es</span>
<span class="gp">#</span> openssl x509 -in CERTIFICADO.pem -dates -noout
<span class="go">notBefore=Jan 18 10:03:44 2021 GMT</span>
<span class="go">notAfter=Apr 18 10:03:44 2021 GM</span>
<span class="gp">#</span> openssl x509 -in CERTIFICADO.pem -issuer -noout
<span class="go">issuer=C = US, O = Let&#39;s Encrypt, CN = R3</span>
<span class="gp">#</span> openssl x509 -in CERTIFICADO.pem -pubkey -noout
<span class="go">-----BEGIN PUBLIC KEY-----</span>
<span class="go">MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA4LrdwliOk4GMcmKKk0R/</span>
<span class="go">RkK9iDO4Vr56azwv3Z/2UI+e/9QIZ0sg9UVXM24mIbslzGppi3uSzqauiy9GMYyr</span>
<span class="go">A7WbwTFbgU3Q6WnNkqgoFd7bOUxaEhnQlfcTu4yor5x/tLH/worocmFAXhIy9jrE</span>
<span class="go">yVzR/XqKutVIWKhPuefnrXvLR1oYWv2bW/zED03IHNRcTyZNa8udOfDCZyqaHjM8</span>
<span class="go">4bnlgoiMAmP5Ar4J7Qdeht5cIBY4ZNmCmTHKWSjbEFW7h6hl7HiHh8+gd6X6SqZW</span>
<span class="go">GAAYPU/RjkkwZF9GNK5RcxxRXhjKGkwMO9IKlZ8gHYNplR2yuHujVsUR+IcRl9MS</span>
<span class="go">wwIDAQAB</span>
<span class="go">-----END PUBLIC KEY-----</span>
</pre></div>
</div>
<p>La campos propios de la extensión también pueden obtenerse, aunque hay que
recurrir a <em class="manpage"><a class="manpage reference external" href="https://manpages.debian.org/x509v3_config(5)">x509v3_config(5)</a></em> para saber cuáles son sus nombres:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> openssl x509 -in CERTIFICADO.pem -ext authorityInfoAccess -noout
<span class="go">Authority Information Access:</span>
<span class="go">    OCSP - URI:http://r3.o.lencr.org</span>
<span class="go">    CA Issuers - URI:http://r3.i.lencr.org</span>
</pre></div>
</div>
<p>En este caso, el campo nos indica cuál es la <abbr title="Uniform Resource Locator">URL</abbr> con el servicio <abbr title="Online Certificate Status Protocol">OCSP</abbr> donde
podemos comprobar si el certificado está revocado y dónde se encuentra el
certificado con el que firmo este certificado. No obstante lo anterior
<strong class="command">openssl</strong> ya ofrece una opción para obtener directamente la <abbr title="Uniform Resource Locator">URL</abbr> con
el servicio <abbr title="Online Certificate Status Protocol">OCSP</abbr>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> openssl x509 -in CERTIFICADO.pem -ocsp_uri -noout
<span class="go">http://r3.o.lencr.org</span>
</pre></div>
</div>
</div>
<div class="section" id="verificacion">
<span id="verif-cert"></span><h3><span class="section-number">9.1.3.1.2.5. </span>Verificación<a class="headerlink" href="#verificacion" title="Enlazar permanentemente con este título">¶</a></h3>
<p><strong class="command">openssl</strong> proporciona la suborden <code class="docutils literal notranslate"><span class="pre">verify</span></code> para verificar la validez
de un certificado en lo referente a las fechas y a la firma de la <abbr title="Certification Authority">CA</abbr>. Aún, sin
embargo, faltaría comprobar si el certificado está revocado para lo cual hay que
consultar a la propia <abbr title="Certification Authority">CA</abbr> a través de <abbr title="Online Certificate Status Protocol">OCSP</abbr>.</p>
<p>Supongamos que tenemos el certificado <code class="file docutils literal notranslate"><span class="pre">CERTIFICADO.pem</span></code> del epigrafe
anterior emitido por <a class="reference external" href="https://letsencrypt.org/">Let’s Encrypt</a>, la orden ::</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> openssl verify CERTIFICADO.pem
</pre></div>
</div>
<p>comprobará si el certificado es válido utilizando las certificados raíz
instalados en el sistema (en una <em>Debian</em> en <code class="file docutils literal notranslate"><span class="pre">/etc/ssl/certs</span></code>). Sin
embargo, en este caso el certificado firmante de <a class="reference external" href="https://letsencrypt.org/">Let’s Encrypt</a> no es un
certificado raíz, ya que esta actúa como una <abbr title="Certification Authority">CA</abbr> subordinada. Por tal motivo,
fallará y requeriremos obtener también el certificado firmante. Es probable que
<code class="file docutils literal notranslate"><span class="pre">CERTIFICADO.pem</span></code> también contenga el de <cite>Let’s Encrypt</cite><a class="footnote-reference brackets" href="#id11" id="id6">5</a>, pero si no
fuera el caso, podríamos obtenerlo muy fácilmente de la  <abbr title="Uniform Resource Locator">URL</abbr>
<a class="reference external" href="http://r3.i.lencr.org">http://r3.i.lencr.org</a> según nos informa el propio
certificado. Con ambos certificados podríamos reintentar la verificación con:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span>  openssl verify -CAfile FIRMANTE.pem CERTIFICADO.pem
</pre></div>
</div>
<p>Esta comprobación ya funcionará, porque el certificado firmante sí está firmado
a su vez por un certificado raíz que posee el sistema. Si no fuera así,
podríamos ir añadiendo los sucesivos certificados de las <abbr title="Certification Authority">CA</abbr> intermedias dentro
de <code class="file docutils literal notranslate"><span class="pre">FIRMANTE.pem</span></code>.</p>
<p>Hay algunas variamtes interesantes a esta orden:</p>
<ul>
<li><p>La opción <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate"></kbd>-<kbd class="kbd docutils literal notranslate">no</kbd>-<kbd class="kbd docutils literal notranslate">CApath</kbd></kbd> evita que se usen los certificados raiz instalados
en el sistema. La verificación obligaría, pues, a incluir en
<code class="file docutils literal notranslate"><span class="pre">FIRMANTE.pem</span></code> también el certificado raíz de la <abbr title="Certification Authority">CA</abbr> pertinente.</p></li>
<li><p>La opción <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate"></kbd>-<kbd class="kbd docutils literal notranslate">partial_chain</kbd></kbd> permite hacer la verificación aunque no se
tenga la cadena completa de <abbr title="Certification Authority">CA</abbr>. Por consiguiente:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> openssl verify -no-CApath -partial_chain -CAfile FIRMANTE.pem CERTIFICADO.pem
</pre></div>
</div>
<p>podría verificar el certificado, aunque <code class="file docutils literal notranslate"><span class="pre">FIRMANTE.pem</span></code> no contuviera
también el certificado raíz.</p>
</li>
</ul>
<p>Lo anterior, no obstante, no puede verificar si el certificado ha sido revocado
y, por tanto, es a pesar de todo inválido. Para ello hay que recurrir a la <abbr title="Certification Authority">CA</abbr>
y en el caso de <cite>Let’s Encrypt</cite> la verificación es sencilla porque ofrece el
servicio a través del estándar <abbr title="Online Certificate Status Protocol">OCSP</abbr>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> openssl ocsp -url <span class="s2">&quot;</span><span class="k">$(</span>openssl x509 -in CERTIFICADO.pem -ocsp_uri -noout<span class="k">)</span><span class="s2">&quot;</span> <span class="se">\</span>
     -issuer FIRMANTE.pem -cert CERTIFICADO.pem
<span class="go">WARNING: no nonce in response</span>
<span class="go">Response verify OK</span>
<span class="go">azure.pem: good</span>
<span class="go">        This Update: Jan 21 11:00:00 2021 GMT</span>
<span class="go">        Next Update: Jan 28 11:00:00 2021 GMT</span>
</pre></div>
</div>
<p>Obsérvese que hay que proporcionar la <abbr title="Uniform Resource Locator">URL</abbr> con el servicio, el certificado que
se desea comprobar y el certificado firmante.</p>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>En el caso del <abbr title="Private Enhanced Mail">PEM</abbr> con el certificado firmante, cerciórese de que
no está incluido el propio certificado u obtendrá un <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Unauthorized</kbd> <kbd class="kbd docutils literal notranslate">(6)</kbd></kbd>.</p>
</div>
<p class="rubric">Notas al pie</p>
<dl class="footnote brackets">
<dt class="label" id="id7"><span class="brackets"><a class="fn-backref" href="#id2">1</a></span></dt>
<dd><p>Gratuito actualmente. Durante mucho el servicio fue de pago y
restringido.</p>
</dd>
<dt class="label" id="id8"><span class="brackets"><a class="fn-backref" href="#id3">2</a></span></dt>
<dd><p>Las órdenes sólo exponen cómo hacer conversiones entre formatos y ver ls
datos del certificado. Por supuesto, se hay otras operaciones
interesantes como crear certificados o verificar su validez.</p>
</dd>
<dt class="label" id="id9"><span class="brackets"><a class="fn-backref" href="#id4">3</a></span></dt>
<dd><p>La opción <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate"></kbd>-<kbd class="kbd docutils literal notranslate">nodes</kbd></kbd> deja la clave privada sin cifrar, pero
posiblemente no sea una buena idea.</p>
</dd>
<dt class="label" id="id10"><span class="brackets"><a class="fn-backref" href="#id5">4</a></span></dt>
<dd><p>En un certificado autofirmado <code class="docutils literal notranslate"><span class="pre">Subject</span></code> e <code class="docutils literal notranslate"><span class="pre">Issuer</span></code> coincidirán.</p>
</dd>
<dt class="label" id="id11"><span class="brackets"><a class="fn-backref" href="#id6">5</a></span></dt>
<dd><p>Basta con hacer un <a class="reference internal" href="../../../02.conbas/02.informacion/03.ficheros.html#cat"><span class="std std-ref">cat</span></a> y ver si hay uno o dos certificados
en el archivo.</p>
</dd>
</dl>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../../index.html">Tabla de contenido</a></h3>
  <ul>
<li><a class="reference internal" href="#">9.1.3.1. Firma digital</a><ul>
<li><a class="reference internal" href="#correo-electronico">9.1.3.1.1. Correo electrónico</a></li>
<li><a class="reference internal" href="#certificado-digital">9.1.3.1.2. Certificado digital</a><ul>
<li><a class="reference internal" href="#certificados-personales">9.1.3.1.2.1. Certificados personales</a></li>
<li><a class="reference internal" href="#certificados-de-servidor">9.1.3.1.2.2. Certificados de servidor</a></li>
<li><a class="reference internal" href="#formatos-de-certificados-x-509">9.1.3.1.2.3. Formatos de certificados X.509</a></li>
<li><a class="reference internal" href="#destripando-certificados">9.1.3.1.2.4. Destripando certificados</a></li>
<li><a class="reference internal" href="#verificacion">9.1.3.1.2.5. Verificación</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Tema anterior</h4>
  <p class="topless"><a href="../03.aplicaciones.html"
                        title="capítulo anterior"><span class="section-number">9.1.3. </span>Aplicaciones de la criptografía</a></p>
  <h4>Próximo tema</h4>
  <p class="topless"><a href="02.discos.html"
                        title="próximo capítulo"><span class="section-number">9.1.3.2. </span>Cifrado de discos</a></p>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/09.apendice/01.cryto/03.aplicaciones/01.firma.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Ir a" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="02.discos.html" title="9.1.3.2. Cifrado de discos"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="../03.aplicaciones.html" title="9.1.3. Aplicaciones de la criptografía"
             >anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" ><span class="section-number">9. </span>Apéndices</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" ><span class="section-number">9.1. </span>Criptografía</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../03.aplicaciones.html" ><span class="section-number">9.1.3. </span>Aplicaciones de la criptografía</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">9.1.3.1. </span>Firma digital</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Derechos de autor CC BY 4.0, 2016-2021, José Miguel Sánchez Alés.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.4.3.
    </div>
  </body>
</html>