


<!DOCTYPE html>

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>9.1.2. Técnicas criptográficas &#8212; documentación de Linuxnomicón - rolling</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/translations.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../search.html" />
    <link rel="next" title="9.1.3. Aplicaciones de la criptografía" href="03.aplicaciones.html" />
    <link rel="prev" title="9.1.1. Introducción" href="01.intro.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="03.aplicaciones.html" title="9.1.3. Aplicaciones de la criptografía"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="01.intro.html" title="9.1.1. Introducción"
             accesskey="P">anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" ><span class="section-number">9. </span>Apéndices</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U"><span class="section-number">9.1. </span>Criptografía</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">9.1.2. </span>Técnicas criptográficas</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tecnicas-criptograficas">
<span id="tecnicas-crypto"></span><h1><span class="section-number">9.1.2. </span>Técnicas criptográficas<a class="headerlink" href="#tecnicas-criptograficas" title="Enlazar permanentemente con este título">¶</a></h1>
<p>Estudiaremos bajo este epígrafe tres actividades propies de la criptografía:</p>
<ul class="simple">
<li><p>Resumen criptográfico, gracias a las funciones <em>hash</em>.</p></li>
<li><p>El cifrado y cuáles son los algoritmos que se usan para ello.</p></li>
<li><p>La firma digital.</p></li>
</ul>
<p>Remataremos con un apéndice práctico que indique cómo llevar a cabo estas tareas
en un sistema <em>Linux</em>.</p>
<div class="section" id="resumen-critografico">
<span id="hash"></span><h2><span class="section-number">9.1.2.1. </span>Resumen critográfico<a class="headerlink" href="#resumen-critografico" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Las <em class="dfn">funciones hash</em> o <em class="dfn">funciones digest</em> o <em class="dfn">funciones resumen</em>
son funciones que dada una entrada generan siempre una salida de la misma
longitud (el llamado <em class="dfn">resumen</em>). Se caracterizan por:</p>
<ul class="simple">
<li><p>ser <em>deterministas</em>, esto es, para una misma entrada siempre generar la
misma salida.</p></li>
<li><p>minimizar las <em>colisiones</em>, esto es, minimizar la posibilidad de obtener
una misma salida para dos entradas distintas.</p></li>
<li><p>generar, sea cual sea la entrada, resúmenes del mismo tamaño. cuya
consecuencia inmediata es que operan en un solo sentido, esto es, a partir del
original obtenemos su resumen, pero a partir del resumen es imposible
averiguar cuál era la información de partida.</p></li>
</ul>
<p>La actividad de resumir criptográficamente la información está relacionada con
el <a class="reference internal" href="01.intro.html#crypto-objetivos"><span class="std std-ref">objetivo de la integridad</span></a>, ya que dadas las
propiedades de las funciones <em>hash</em>, es extremadamente improbable que un
contenido que no ha cambiado su resumen, haya cambiado.</p>
<p>Entre las funciones de <em>hash</em> más conocidas se encuentran:</p>
<dl class="simple">
<dt><abbr title="Message Digest Algorithm 5">MD5</abbr></dt><dd><p>Genera un resumen de 128 <em>bits</em> representado habitualmente por 32 dígitos
hexadecimales. Es muy común usarlo como comprobación de la integridad de
ficheros. Su seguridad está en entredicho, ya que presenta problemas de
colisiones.</p>
</dd>
<dt><abbr title="sechure Hash Algorithm">SHA</abbr></dt><dd><p>Es una familia de funciones <em>hash</em>  que ha ido sufriendo diversas revisiones:
<abbr title="sechure Hash Algorithm">SHA</abbr>-0, <abbr title="sechure Hash Algorithm">SHA</abbr>-1, <abbr title="sechure Hash Algorithm">SHA</abbr>-2 y <abbr title="sechure Hash Algorithm">SHA</abbr>-3. Tanto <abbr title="sechure Hash Algorithm">SHA</abbr>-0 como <abbr title="sechure Hash Algorithm">SHA</abbr>-1
generan resúmenes de 160 <em>bits</em>. Ambas se consideran inseguras y se
desaconseja su uso para paliar esto, se desarrolló <abbr title="sechure Hash Algorithm">SHA</abbr>-2, que implementa
funciones <em>hash</em> de 224, 256, 364 y 512 <em>bits</em>. Se las conoce habitualmente
como <abbr title="sechure Hash Algorithm">SHA</abbr>-224, <abbr title="sechure Hash Algorithm">SHA</abbr>-256, <abbr title="sechure Hash Algorithm">SHA</abbr>-364 y <abbr title="sechure Hash Algorithm">SHA</abbr>-512. <abbr title="sechure Hash Algorithm">SHA</abbr>-3, por su
parte, cambia internamente los algoritmos, pero está pensada para generar
resúmenes de la misma longitud que <abbr title="sechure Hash Algorithm">SHA</abbr>-2.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">Ver también</p>
<p>Más adelante, puede consultar <a class="reference internal" href="#md5sum"><span class="std std-ref">cómo hacer resúmenes
criptográficos en Linux</span></a>.</p>
</div>
</div>
<div class="section" id="cifrado">
<h2><span class="section-number">9.1.2.2. </span>Cifrado<a class="headerlink" href="#cifrado" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Por <em class="dfn">cifrado</em> nos referimos particularmente a la acción de ofuscar cierta
información con el objeto de que pueda ser posteriormente desofuscada.
Si deshacer la ofuscación no puede hacerla un tercero no autorizado, entonces
el cifrado se encamina a la <em>privacidad</em> y tenemos propiamente aquello que se
refiere como <em>cifrado</em>. En cambio, si cualquier tercero puede desofuscar, el
propósito no es la privacidad, sino la <em>autenticidad</em>, y entraríamos en el
terreno de la <a class="reference internal" href="#firma-digital"><span class="std std-ref">firma digital</span></a>, que trataremos más adelante.</p>
<p>Ya se ha comentado que los algoritmos modernos de cifrado se basan en el
secreto de la clave y no en el secreto del propio algoritmo, por lo que nos
centraremos en los algoritmos basados en clave. Atendiendo a ella hay dos tipos
de algoritmos.</p>
<dl class="simple">
<dt><strong>De clave simétrica</strong></dt><dd><p>También conocidos como <em class="dfn">de clave privada</em> o de <em class="dfn">clave única</em>. Son
aquellos en que se usa la misma clave para cifrar y descifrar.</p>
</dd>
<dt><strong>De clave asimétrica</strong></dt><dd><p>También conocidos como <em class="dfn">de clave pública</em> o <em class="dfn">de doble clave</em>. Son
aquellos que emplean una pareja de claves, de manera que si una se usa para
cifrar la otra sirve para descifrar los mensajes cifrados con la primera.</p>
</dd>
</dl>
<p>Es común, además, que las técnicas de cifrado usen una combinación de un
algoritmo de clave simétrica y otro de clave asimétrica, lo cual se conoce como
<a class="reference internal" href="#hibrido"><span class="std std-ref">cifrado híbrido</span></a>.</p>
<div class="section" id="cifrado-simetrico">
<h3><span class="section-number">9.1.2.2.1. </span>Cifrado simétrico<a class="headerlink" href="#cifrado-simetrico" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En este tipo de cifrado se usa la misma clave tanto para cifrar como para
descifrar. Cuando las dos partes se encuentran alejadas, ese, precisamente, es
su punto débil, ya que exige que la clave se encuentre en ambos extremos con
anterioridad a la comunicación, lo cual sólo puede lograrse:</p>
<ul class="simple">
<li><p>Encontrándose físicamente las ambas partes para intercambiar en mano la clave.</p></li>
<li><p>Transmitiendo la clave en claro, lo cual puede provocar que se intercepte y
sea inútil el cifrado posterior.</p></li>
</ul>
<p>Obviando lo anterior, el factor decisivo en la robustez de la clave es su
longitud: cuanto más larga sea, más difícil es averiguarla por fuerza bruta.
Por ejemplo, una clave de <strong>8</strong> <em>bits</em> sólo puede tener 2<sup>8</sup>, o sea,
<strong>256</strong> valores distintos, lo que implica que podría adivinarse con un máximo
de <strong>256</strong> intentos.</p>
<p>Algunos algoritmos de cifrado simétrico muy conocidos son:</p>
<dl class="simple">
<dt><abbr title="Data Encryption Standard">DES</abbr></dt><dd><p>Considerado actualmente inseguro para la capacidad computacional de los
ordenadores modernos, ya que tiene una longitud de sólo <strong>56</strong> <em>bits</em>.
Su sucesor directo es el 3<abbr title="Data Encryption Standard">DES</abbr> (Triple <abbr title="Data Encryption Standard">DES</abbr>) que usa el triple de
longitud para la clave (<strong>168</strong> bits), aunque también se ha ido desplazando
en favor de otros algoritmos.</p>
</dd>
<dt><abbr title="Advanced Encryption Standard">AES</abbr></dt><dd><p>Sustituyó al algoritmo anterior y tiene una longitud de <strong>256</strong> <em>bits</em>. Es
más rápido y, además, no se le conocen vulnerabilidades. Es uno de los
algoritmos más ampliamente utilizados.</p>
</dd>
</dl>
<p>Existen otros algoritmos como <a class="reference external" href="https://es.wikipedia.org/wiki/Twofish">Twofish</a>
o <a class="reference external" href="https://es.wikipedia.org/wiki/Blowfish">Blowfish</a>.</p>
</div>
<div class="section" id="cifrado-asimetrico">
<span id="asimetrico"></span><h3><span class="section-number">9.1.2.2.2. </span>Cifrado asimétrico<a class="headerlink" href="#cifrado-asimetrico" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Se basa en el uso de una pareja de claves relacionadas entre sí, de modo que lo
que se haya cifrado con una es posible descifrarlo con la otra, pero no con
ella misma. Los algoritmos están diseñados para que el interesado genere una de
estas parejas de claves, de manera que cada una de ellas realice un papel
diferente:</p>
<ul class="simple">
<li><p>Una es la clave <strong>privada</strong> que debe mantenerla en secreto su propietario.</p></li>
<li><p>Otra es la clave <strong>pública</strong>, pensada para que el propietario la comunique
a los demás.</p></li>
</ul>
<p>De este modo, cuando se desea enviar un mensaje secreto a un destinatario, lo
que se hace es usar la clave <em>pública</em> de éste, ya que tal mensaje sólo podrá
ser descifrado usando su clave <em>privada</em> correspondiente, que sólo está en
posesión del destinatario. El cifrado con la clave <em>pública</em>, pues garantiza
la privacidad.</p>
<p>Por otra parte, si un emisor usa su clave <strong>privada</strong> para cifrar, el mensaje
podrá descifrase con su clave <em>pública</em> correspondiente. Como la clave
<em>pública</em> es, eso, pública, no sirve para salvaguardar ninguna privacidad,
pero sí para asegurar que el emisor del mensaje es el dueño de las claves.
Afinaremos esto más adelante.</p>
<p>Los algoritmos más conocidos de cifrado asimétrico son:</p>
<dl>
<dt><abbr title="Rivest, Shamir y Adleman">RSA</abbr></dt><dd><p>Es el primer sistema criptográfico de clave asimétrica y aún se considera
válido (esto es, suficientemente seguro) tanto para cifrar y como firmar
digitalmente. Por lo general, utiliza claves con una longitud entre 1024 y
4096 <em>bits</em>.</p>
</dd>
<dt><abbr title="Digital Signature Algorithm">DSA</abbr></dt><dd><p>Es otro sistema criptográfico de clave asimétrica que en la actualidad se
considera débil, por lo que se desaconseja su uso para cifrar información<a class="footnote-reference brackets" href="#id16" id="id1">1</a>. Sus claves tienen una longitud entre 512 y 1024 <em>bits</em>.</p>
<p>Variantes de este sistema que mejoran la fortaleza de las claves y, por
tanto permiten su uso para cifrado, son:</p>
<ul class="simple">
<li><p><abbr title="Elliptic Curve Digital Signature Algorithm">ECDSA</abbr>, que usa <a class="reference external" href="https://es.wikipedia.org/wiki/Criptograf%C3%ADa_de_curva_el%C3%ADptica">criptografía de curva elíptica</a>.</p></li>
<li><p><abbr title="Edwards-curve Curve Digital Signature Algorithm">EdDSA</abbr>, que usa también criptografía de curva elíptica. y se desarrolló
para mejorar la velocidad de cifrado sin sacrificar velocidad. Un tipo
particular de este sistema es <em>Ed22519</em>, que permiten usar las últimas
versiones de <strong class="program">openssh</strong>.</p></li>
</ul>
</dd>
</dl>
<p>La desventaja fundamental del cifrado asimétrico frente al simétrico es su costo
computacional: para un mismo nivel de seguridad requiere claves más largas y,
además, para una misma longitud de clave es más costoso en tiempo.</p>
</div>
<div class="section" id="cifrado-hibrido">
<span id="hibrido"></span><h3><span class="section-number">9.1.2.2.3. </span>Cifrado híbrido<a class="headerlink" href="#cifrado-hibrido" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El <em class="dfn">cifrado híbrido</em> consiste en el uso de técnicas de cifrado simétrico y
asimétrico para sortear:</p>
<ul class="simple">
<li><p>La debilidad intrínseca de tener que la clave simétrica en ambos extremos de
la comunicación.</p></li>
<li><p>El mayor costo computacional del cifrado asimétrico.</p></li>
</ul>
<p>Para ello realiza una primera fase de la comunicación utilizando cifrado
asimétrico que sirve estrictamente para intercambiar una clave simétrica de
forma segura, que se denomina <em class="dfn">clave de sesión</em>. Una vez que la clave se
encuentra en ambos extremos se pasa a realizar un cifrado simétrico usando esta
clave de sesión.</p>
</div>
<div class="section" id="conclusiones">
<h3><span class="section-number">9.1.2.2.4. </span>Conclusiones<a class="headerlink" href="#conclusiones" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Lo adecuado al cifrar es usar:</p>
<ol class="loweralpha simple">
<li><p>Cifrado <strong>simétrico</strong> sobre:</p>
<ul class="simple">
<li><p>Información que no se requiere transmitir (p.e. cifrado de disco).</p></li>
<li><p>Información que se transmite siempre que la clave simétrica se transmita
cifrada asimétricamente, lo cual ya hemos definido como cifrado <strong>híbrido</strong>.</p></li>
</ul>
</li>
<li><p>Cifrado <strong>asimétrico</strong> sobre:</p>
<ul class="simple">
<li><p>Una clave simétrica que se desea transmitir, que es el complemento del
cifrado <em>híbrido</em> que se acaba de citar. Para cifrar la clave simétrica
se utiliza la clave pública de aquel a quien se desea transmitirla, puesto
que sólo él será capaz de descifrarla.</p></li>
<li><p>Un resumen generado con una función <em>hash</em>. Este acción de cifrado, sin
embargo, es parte de la <em>firma digital</em>.</p></li>
</ul>
</li>
</ol>
</div>
</div>
<div class="section" id="firma-digital">
<span id="id2"></span><h2><span class="section-number">9.1.2.3. </span>Firma digital<a class="headerlink" href="#firma-digital" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Una <em class="dfn">firma digital</em> es al mundo digital lo que la firma manuscrita al
papel, esto es, algo que certifica que los términos expresados en un texto
son ratificados por la persona firmante.</p>
<p>La <em>firma digital</em> no es un acción atómica como las dos anteriores (resumir y
cifrar), sino un conjunto de acciones de resumen y cifrado que permiten
asegurar la identidad del emisor y la integridad del mensaje. Esquemáticamente,
firmar consiste en:</p>
<ul class="simple">
<li><p>Obtener <a class="reference internal" href="#hash"><span class="std std-ref">un resumen</span></a> de los datos mediante una función <em>hash</em>.</p></li>
<li><p>Cifrar tal resumen con la clave privada del firmante.</p></li>
<li><p>Transmitir los datos (o almacenarlos) junto al resumen cifrado (la firma).</p></li>
</ul>
<p>Ante esto, un tercero (por ejemplo, el destinatario de un mensaje de correo
firmado), es capaz de certificar que el origen es quien dice ser, ya que
descifrará el resumen con la clave pública de éste y, por otra parte, podrá
comprobar si los datos conservan su integridad gracias al propio resumen
descifrado.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Aunque conceptualmente una firma no es más que un resumen cifrado con
clave privada, en la práctica es necesario añadir metainformación sobre quién
firmó o cuándo lo hizo.</p>
</div>
</div>
<div class="section" id="apendice-practico">
<h2><span class="section-number">9.1.2.4. </span>Apéndice práctico<a class="headerlink" href="#apendice-practico" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Trataremos bajo este epúgrafe algunas herramientas criptográficas muy
habituales en sistemas <em>Linux</em> que implementan los conceptos tratados hasta
ahora: <abbr title="GNU Provacy Guard">GnuPG</abbr>, más enfocado a implementar el estándar <a class="reference external" href="https://www.openpgp.org/">OpenPGP</a><a class="footnote-reference brackets" href="#id17" id="id3">2</a>, y Open<abbr title="Secure Socket Layer">SSL</abbr>. La segunda herramienta
(incluida en el paquete homónimo) es más que probable que ya se encuentre
instalada en el sistema. Para la primera, en cambio, sí conviene hacer
precisiones.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>En caso de que hagamos pruebas en una máquina virtual es conveniente
aumentar la entropía del sistema para mejorar y acelerar la creación de
claves asimétricas. Para lograrlo puede obrarse del siguiente<a class="footnote-reference brackets" href="#id18" id="id4">3</a> modo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> cat /proc/sys/kernel/random/entropy_avail  <span class="c1"># Entropía inicial</span>
<span class="go">234</span>
<span class="gp">#</span> apt install rng-tools
<span class="gp">#</span> <span class="nb">echo</span> <span class="s1">&#39;HRNGDEVICE=/dev/urandom&#39;</span> &gt;&gt; /etc/default/rng-tools
<span class="gp">#</span> <span class="nb">echo</span> <span class="s1">&#39;RNGDOPTIONS=&quot;--fill-watermark=90%&quot;&#39;</span> &gt;&gt; /etc/default/rng-tools
<span class="gp">#</span> invoke-rc.d rng-tools start
<span class="gp">#</span> cat /proc/sys/kernel/random/entropy_avail
<span class="go">2159</span>
</pre></div>
</div>
</div>
<p class="rubric" id="gnupg-1">Instaslación de <abbr title="GNU Provacy Guard">GnuPG</abbr></p>
<p>La instalación es sumamente sencilla:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> apt install gnupg
</pre></div>
</div>
<p>Como configuración podemos usar la siguiente:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> mkdir -m <span class="m">700</span> ~/.gnupg
<span class="gp">$</span> cat &gt; ~/.gnupg/gpg.conf
<span class="gp">#</span>keyserver hkps://sks-keyservers.net:443
<span class="go">keyserver hkp://pool.sks-keyservers.net</span>
<span class="go">no-greeting</span>
<span class="go">armor</span>

<span class="go">personal-digest-preferences SHA512</span>
<span class="go">cert-digest-algo SHA512</span>
<span class="go">default-preference-list SHA512 SHA384 SHA256 SHA224 AES256 AES192 AES CAST5 ZLIB BZIP2 ZIP Uncompressed</span>
<span class="go">personal-cipher-preferences AES256 TWOFISH CAMELLIA256 3DES</span>
</pre></div>
</div>
<p>Con la que seleccionamos cuáles son nuestros algoritmos de cifrado y <em>hash</em>
preferidos. Además, con <kbd class="kbd docutils literal notranslate">armor</kbd> guardamos el texto cifrado como caracteres
imprimibles.</p>
<p>Si ejecutamos la orden:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --version
</pre></div>
</div>
<p>podremos consultar cuáles son los algoritmos de cifrado, <em>hash</em> y compresión que
usa el programa.</p>
<span class="target" id="index-0"></span><div class="section" id="resumenes">
<span id="shasum"></span><span id="md5sum"></span><span id="index-1"></span><h3><span class="section-number">9.1.2.4.1. </span>Resúmenes<a class="headerlink" href="#resumenes" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Para la generación de resúmenes <em>hash</em> de ficheros y flujos de texto, existen
dos órdenes fundamentales: <strong class="command">md5sum</strong> y la familia de comandos
<strong class="program">shasum</strong> (<strong class="command">sha256sum</strong>, <strong class="command">sha384sum</strong>,
<strong class="command">sha512sum</strong>), que comparten una misma interfaz, con lo que es
indiferente ilustrar el uso de una u otra orden. Suelen encontrarse todas
instaldas en el sistema.</p>
<p>La generación del resumen puede hacerse del siguiente modo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;Hola, caracola&quot;</span> &gt; saludo1.txt
<span class="gp">$</span> md5sum saludo1.txt
<span class="go">b18a245aba5384920d7f6a488d725181  saludo1.txt</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Si se incluyen varios ficheros como argumento, se calculará el resumen
de cada uno de ellos.</p>
</div>
<p>También es posible calcular el resumen de un flujo de datos:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;Hola, caracola&quot;</span> <span class="p">|</span> sha256sum
<span class="go">d261be2aa264d38cad717fa8493dacc0b3f33f949869d39ecf7611689fb617ad  -</span>
</pre></div>
</div>
<p>Habitualmente, los resúmenes generados se almacenan, a fin de que puedan servir
más adelante para comprobar la integridad de los ficheros:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> md5sum saludo1.txt saludo2.txt &gt; saludos.md5
</pre></div>
</div>
<p>Con posterioridad, podrá comprobarse la integridad del siguiente modo<a class="footnote-reference brackets" href="#id19" id="id5">4</a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nv">LC_ALL</span><span class="o">=</span>C md5sum -c saludos.md5
<span class="go">saludo1.txt: OK</span>
<span class="go">saludo2.txt: OK</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Si se almacenó el resumen de un flujo de datos (obsérvese que aparece
un «-«, en vez de el nombre del fichero), puede comprobarse que otro flujo es
el mismo pasándolo a través de la entrada estándar:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;Hola, caracola&quot;</span> <span class="p">|</span> md5sum &gt;  flujo.md5
<span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;Hola, caracola&quot;</span> <span class="p">|</span> <span class="nv">LC_ALL</span><span class="o">=</span>C md5sum -c flujo.md5
<span class="go">-: OK</span>
</pre></div>
</div>
</div>
<p>También es posible utilizar para este fin (aunque no es lo habitual) las
herramientas que usaremos después para ilustrar el cifrado y la firma digital:</p>
<ul>
<li><p><a class="reference internal" href="#gnupg-1"><span class="std std-ref">GnuPG</span></a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --print-md sha512 fichero.txt
</pre></div>
</div>
<p>e incluso hay una opción que calcula los resúmenes según todos los algoritmos
disponibles:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --print-mds fichero.txt
</pre></div>
</div>
</li>
<li><p><a class="reference internal" href="#openssl"><span class="std std-ref">OpenSSL</span></a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> openssl dgst -sha512 fichero.txt
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="openssl">
<span id="id6"></span><h3><span class="section-number">9.1.2.4.2. </span>Open<abbr title="Secure Socket Layer">SSL</abbr><a class="headerlink" href="#openssl" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Open<abbr title="Secure Socket Layer">SSL</abbr> es la herramienta de cifrado por antonomasia en sistemas <em>Linux</em>.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Volveremos sobre esta herramienta al introducir los <a class="reference internal" href="03.aplicaciones/01.certdig.html#cert-digital"><span class="std std-ref">certificados
digitales</span></a>.</p>
</div>
<div class="section" id="id7">
<h4><span class="section-number">9.1.2.4.2.1. </span>Cifrado simétrico<a class="headerlink" href="#id7" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Una forma de llevarlo a cabo es esta:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> openssl enc -aes256 -pbkdf2 -a -in fichero.txt -out fichero.txt.enc
</pre></div>
</div>
<p>que utiliza <abbr title="Advanced Encryption Standard">AES</abbr>-256 para el proceso y genera un cifrado en <a class="reference external" href="https://es.wikipedia.org/wiki/Base64">base64</a> gracias a la opción <cite>-a</cite>. Para
descifrar basta con añadir la opción <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate"></kbd>-<kbd class="kbd docutils literal notranslate">d</kbd></kbd> y, obviamente, utilizar como
entrada el texto cifrado:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> openssl enc -aes256 -a -d -in fichero.txt.enc -out fichero-recuperado.txt
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Tanto <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate"></kbd>-<kbd class="kbd docutils literal notranslate">in</kbd></kbd> como <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate"></kbd>-<kbd class="kbd docutils literal notranslate">out</kbd></kbd> son opcionales y, si no se
especifican, se entenderá que la entrada es la entrada estándar y la salida
la salida estándar.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>La clave simétrica para el cifrado/descifrado se pide de forma
interactiva. Puede proporcionarse en la propia orden incluyendo la opción
<kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate"></kbd>-<kbd class="kbd docutils literal notranslate">pass</kbd></kbd>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> openssl enc -aes256 -pbkdf2 -a -pass pass:clave-secreta -in fichero.txt -out fichero.txt.enc
</pre></div>
</div>
</div>
</div>
<div class="section" id="id8">
<h4><span class="section-number">9.1.2.4.2.2. </span>Cifrado asimétrico<a class="headerlink" href="#id8" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Llevarlo a cabo requiere generar un par de claves (<abbr title="Rivest, Shamir y Adleman">RSA</abbr> en concreto):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> openssl genrsa -aes128 -out privkey.pem <span class="m">4096</span>
<span class="gp">#</span> openssl rsa -in privkey.pem -pubout -out pubkey.pem
</pre></div>
</div>
<p>Las órdenes generan un par de claves <abbr title="Rivest, Shamir y Adleman">RSA</abbr> (<code class="file docutils literal notranslate"><span class="pre">privkey.pem</span></code> y
<code class="file docutils literal notranslate"><span class="pre">pubkey.pem</span></code>) de 4096 <em>bits</em>. Para proteger la clave privada con una
contraseña (esto es, con una clave simétrica) hemos usado la opción
<kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate"></kbd>-<kbd class="kbd docutils literal notranslate">aes128</kbd></kbd>. Esto último es un simple mecanismo de seguridad para que sea
imposible usar la clave privada sin conocer esta contraseña. Así, en caso de
robo, el ladrón aún deberá averiguar la contraseña.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Las claves que se piden interactivamente pueden pasarse a través de
las opciones <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate"></kbd>-<kbd class="kbd docutils literal notranslate">passin</kbd></kbd> o <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate"></kbd>-<kbd class="kbd docutils literal notranslate">passout</kbd></kbd> (vease <em class="manpage"><a class="manpage reference external" href="https://manpages.debian.org/openssl(1ssl)">openssl(1ssl)</a></em>
para más información)</p>
</div>
<p>Con ellas podemos cifrar y descifrar pequeños ficheros. Usando la clave pública
para cifrar y la privada para descifrar:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> <span class="nb">echo</span> <span class="s2">&quot;Hola&quot;</span> &gt; saludo.txt
<span class="gp">#</span> openssl rsautl -encrypt -inkey pubkey.pem -pubin -in saludo.txt -out saludo.enc
<span class="gp">#</span> openssl rsautl -decrypt -inkey privkey.pem -in saludo.enc
<span class="go">Hola</span>
</pre></div>
</div>
<p>¿Podemos cifrar con la privada y descifrar con la pública? Teóricamente sí,
aunque tal como lo hacemos ahora no tenga mucho sentido (porque obrar así es
propio del acto de firmar):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> openssl rsautl -sign -inkey privkey.pem -in saludo.txt -out saludo.enc
<span class="gp">#</span> openssl rsautl -verify -inkey pubkey.pem -pubin -in saludo.enc
<span class="go">Hola</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Si en vez de un un simple par de claves, tenemos un <a class="reference internal" href="03.aplicaciones/01.certdig.html#cert-digital"><span class="std std-ref">certificado
digital</span></a>, aún podremos realizar estas operaciones sustituyendo
<kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate"></kbd>-<kbd class="kbd docutils literal notranslate">pubin</kbd></kbd> por <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate"></kbd>-<kbd class="kbd docutils literal notranslate">certin</kbd></kbd></p>
</div>
</div>
<div class="section" id="id9">
<h4><span class="section-number">9.1.2.4.2.3. </span>Firma digital<a class="headerlink" href="#id9" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Partiendo de las claves <abbr title="Rivest, Shamir y Adleman">RSA</abbr> ya generadas en el apartado anterior
(<code class="file docutils literal notranslate"><span class="pre">privkey.pem</span></code>, <code class="file docutils literal notranslate"><span class="pre">pubkey.pem</span></code>), podemos hacer una primera
aproximación tomando la <a class="reference internal" href="#firma-digital"><span class="std std-ref">descripción de lo que es la firma digital</span></a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;Este es el contenido del fichero que firmo&quot;</span> &gt; fichero.txt
<span class="gp">$</span> sha256sum fichero.txt <span class="p">|</span> tee /dev/tty <span class="p">|</span> openssl rsautl -sign -inkey privkey.pem -out fichero.sign
<span class="go">47ebcc00b179c0f1fc8f45fec4a3e6a55fbb1aeddd8a5bb6ee52c5d7f57d1d3a  fichero.txt</span>
</pre></div>
</div>
<p>Ya tenemos el archivo original (<code class="file docutils literal notranslate"><span class="pre">fichero.txt</span></code>) y la firma
(<code class="file docutils literal notranslate"><span class="pre">fichero.sign</span></code>) generada con la clave privada. Con ellos dos y la clave
publica correspondiente, podemos comprobar integridad e identidad:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sha256sum fichero.txt
<span class="go">47ebcc00b179c0f1fc8f45fec4a3e6a55fbb1aeddd8a5bb6ee52c5d7f57d1d3a  fichero.txt</span>
<span class="gp">$</span> openssl rsautl -verify -inkey pubkey.pem -pubin -in fichero.sign
<span class="go">47ebcc00b179c0f1fc8f45fec4a3e6a55fbb1aeddd8a5bb6ee52c5d7f57d1d3a  fichero.txt</span>
</pre></div>
</div>
<p>Dado que coincide el resumen del archivo con la firma descifrada con la clave
pública, podemos concluir que el archivo no ha cambiado y que lo certificó el
propietario de la clave.</p>
<p>En realidad, para firmar con más comodidad aunque nos abstraigamos del
concepto:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> openssl dgst -sha256 -sign privkey.pem -out fichero.sign fichero.txt
</pre></div>
</div>
<p>Y para verificar la firma:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> openssl dgst -sha256 -verify pubkey.pem -signature fichero.sign fichero.txt
<span class="go">Verified OK</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Cuando lo que se tiene no es un simple par de claves, sino un
<a class="reference internal" href="03.aplicaciones/01.certdig.html#cert-digital"><span class="std std-ref">certificado digital</span></a> aún puede hacerse este proceso
extrayendo previamente la clave pública del certificaddo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> openssl x509 -in micert.pem -pubkey -nooout &gt; pubkey.pem
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="gnupg">
<h3><span class="section-number">9.1.2.4.3. </span><abbr title="GNU Provacy Guard">GnuPG</abbr><a class="headerlink" href="#gnupg" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Aunque el próposito final del programa es la implementación del estándar
Open<abbr title="Pretty Good Privacy">PGP</abbr>, podemos utilizarlo para ilustrar los conceptos anteriores.</p>
<div class="section" id="id10">
<h4><span class="section-number">9.1.2.4.3.1. </span>Cifrado simétrico<a class="headerlink" href="#id10" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Podemos utilizarlos para cifrar un archivo determinado:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">echo</span> <span class="s1">&#39;Hola, caracola!!!&#39;</span> &gt; /tmp/saludo.txt
<span class="gp">$</span> gpg -c /tmp/saludo.txt
</pre></div>
</div>
<p>La orden genera el fichero cifrado <code class="file docutils literal notranslate"><span class="pre">/tmp/saludo.txt.asc</span></code> con esta pinta<a class="footnote-reference brackets" href="#id20" id="id11">5</a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">-----BEGIN PGP MESSAGE-----</span>

<span class="go">jA0ECQMCgmqtVcUnh0H80lAB2H6YjrKdXR2P2I9a0JRDKpoQhEJc//dnzA550ged</span>
<span class="go">Q2DYgVpYgaL3Se26CAwii54xhZfUijWnGg7pPSKc7Zd81TLvQm75MA6IbsDPGHEN</span>
<span class="go">eQ==</span>
<span class="go">=5YjK</span>
<span class="go">-----END PGP MESSAGE-----</span>
</pre></div>
</div>
<p>El fichero podría haberse enviado a otro fichero usando la opción <code class="docutils literal notranslate"><span class="pre">--output</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg -c -o /tmp/otrofichero.asc /tmp/saludo.txt
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Si se usa como nombre de fichero <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate"></kbd>-<kbd class="kbd docutils literal notranslate"></kbd></kbd>, la salida será la estándar.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>El formato del fichero cifrado, sigue el estándar marcado por
<em>OpenPGP</em>, pero también podríamos haber generado un fichero cifrado que use
caracteres no imprimibles habiendo añadido <code class="docutils literal notranslate"><span class="pre">--no-armor</span></code>. En este caso, la
extensión añadida es <code class="docutils literal notranslate"><span class="pre">.gpg</span></code> en vez de <code class="docutils literal notranslate"><span class="pre">.asc</span></code>.</p>
</div>
<p>Si hemos ejecutado las ordenes anteriores, habremos comprobado que se pide de
forma interactiva la clave simétrica de cifrado. Si queremos ejecutar la orden
de forma no interactiva podemos hacer lo siguiente:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --batch --passphrase <span class="s1">&#39;contraseñadificil&#39;</span> -c /tmp/saludo.txt
</pre></div>
</div>
<p>o bien:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">printf</span> <span class="s1">&#39;contraseñadificil&#39;</span> <span class="p">|</span> gpg --batch --passphrase-fd <span class="m">0</span> -c /tmp/saludo.txt
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Aunque recordemos que eso guardará en el historial la contraseña y
es muy discutible su seguridad, por lo que al menos deberíamos asegurarnos de
que tal cosa no sucede.</p>
</div>
<p>Para descifrar, podemos no usar la opción <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate"></kbd>-<kbd class="kbd docutils literal notranslate">d</kbd></kbd>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg -qd /tmp/saludo.txt.asc
<span class="go">Hola, caracola!!!</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>La opción <code class="docutils literal notranslate"><span class="pre">-q</span></code> ejecuta la orden en modo silencioso.</p>
</div>
<p>Hay algo, sin embargo, extraño: ¿por qué no se nos pide la clave anteriormente
suministrada durante la operación de cifrado para descifrar?  La razón es que
<strong class="command">gpg</strong> levanta automáticamente un demonio que se encarga de recordar
claves. Si por alguna razón se desea pararlo, puede hacerse:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpgconf --kill gpg-agent
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Si nuestra intención es consultar cuáles es el cifrado sin descifrar
en absoluto, podemos hacer:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --list-only -d saludo.txt.asc
</pre></div>
</div>
</div>
</div>
<div class="section" id="gpg-pgp">
<span id="id12"></span><h4><span class="section-number">9.1.2.4.3.2. </span>Cifrado asimétrico<a class="headerlink" href="#gpg-pgp" title="Enlazar permanentemente con este título">¶</a></h4>
<p>La implementación de este tipo de cifrado está determinado por el propósito de
la orden (el estádar Open<abbr title="Pretty Good Privacy">PGP</abbr>), por lo que hay muchos aspectos que vienen
determinados por ello. Sea como sea, cifrar asimétricamente requiere previamente
generar una pareja de claves:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --gen-key --default-new-key-algo rsa3072
</pre></div>
</div>
<p>que nos pedirá el nombre de su propietario y la dirección de correo electrónico,
que se usará como identificador para las claves generadas. Además, se nos pedirá
una clave simétrica con la que cifrar la clave privada. Esta contraseña deberá
consignarse cada vez que la clave privada tenga que usarse y es una simple
medida de seguridad para evitar que, si la clave privada cae en manos ajenas, el
ladrón tenga fácil usurpar la identidad del legítimo propietario. Se han
añadido, además, dos datos relevantes: el tiempo de vigencia de la clave (un
año), que de forma predeterminada es eterno, y el tipo de algoritmo<a class="footnote-reference brackets" href="#id21" id="id13">6</a>. La
orden no sólo genera las claves, sino que las almacena en el anillo de claves
(todo dentro de <code class="file docutils literal notranslate"><span class="pre">~/.gnupg</span></code>), con lo que podremos consultar su existencia
listando cuáles son las claves públicas almacenadas:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --list-keys --keyid-format short
<span class="go">/home/usuario/.gnupg/pubring.kbx</span>
<span class="go">--------------------------------</span>
<span class="go">pub   rsa3072/B0B83042 2019-11-08 [SC] [caduca: 2021-11-07]</span>
<span class="go">      F08A6107385FE48775100943E3DCBB0AB0B83042</span>
<span class="go">uid      [  absoluta ] Licenciado Cebadilla (cuenta de pruebas) &lt;xxxx@gmail.com&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Obsérvese que la clave, tal como se ha generado, sólo sirve para
firmar y no para cifrar (no aparece <kbd class="kbd docutils literal notranslate">E</kbd> dentro de los corchetes). Si
nuestra intención es usarla <a class="reference internal" href="#gnupg-cif-asi"><span class="std std-ref">también para cifrar</span></a>
entonces deberemos añadir una subclave para cifrado:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg  --quick-add-key F08A6107385FE48775100943E3DCBB0AB0B83042
</pre></div>
</div>
</div>
<p>También podemos comprobar las claves privadas:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --list-secret-keys
</pre></div>
</div>
<p>Por ahora sólo veremos una y una respectivamente. Lo habitual es que
dispongamos de una única clave privada y muchas públicas, ya que podemos importar
a nuestro repositorio claves públicas ajenas.</p>
<p>En versiones modernas  de <strong class="command">gpg</strong> existe la opción <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate"></kbd>-<kbd class="kbd docutils literal notranslate"></kbd>-<kbd class="kbd docutils literal notranslate">full</kbd>-<kbd class="kbd docutils literal notranslate">gen</kbd>-<kbd class="kbd docutils literal notranslate">key</kbd></kbd> que
pregunta interactivamente otras opciones como el propio algoritmo o el tiempo de
vigencia. En cualquier caso, si se quiere alterar algún parámetro, como el
tiempo de vigencia, puede usarse la opción <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate"></kbd>-<kbd class="kbd docutils literal notranslate"></kbd>-<kbd class="kbd docutils literal notranslate">edit</kbd>-<kbd class="kbd docutils literal notranslate">key</kbd></kbd>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --edit-key xxxx@gmail.com
</pre></div>
</div>
<p class="rubric">Importación/exportación local de claves</p>
<p>Como debemos compartir nuestra clave pública con el resto de usuarios y, a su
vez, recibir de éstos sendas claves públicas, <a class="reference external" href="https://www.gnupg.org/">GnuPG</a> provee de mecanismos para
la importación y exportación de claves.</p>
<p>Para exportar una clave pública del repositorio, podemos hacer:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --export xxxx@gmail.com &gt; clave.asc
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>La selección de la clave puede hacerse con cualquier parte
de la identificación que se usó al crear la clave (el correo electrónico
es una de ellas). Si no especificamos ninguna clave en concreto, se
exportarán todas.</p>
</div>
<p>Si, además, queremos exportar la clave privada, podemos añadirla al fichero
anterior:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --export-secret-keys xxxx@gmail.com &gt;&gt; clave.asc
</pre></div>
</div>
<p>El proceso inverso de importar claves es también sencillo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --import clave.asc
</pre></div>
</div>
<p>orden que importará todas las claves contenidas en el fichero<a class="footnote-reference brackets" href="#id22" id="id14">7</a>.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Si la importación se hace del siguiente modo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --import --import-options import-show --dry-run clave.asc
</pre></div>
</div>
<p>se muestran los datos de la clave o claves que se importarán, pero
al incluir también <code class="docutils literal notranslate"><span class="pre">-dry-run</span></code> no se hará efectiva la importación,
con lo que el resultado es que tenemos un método para consultar las
claves contenidas en un fichero.</p>
</div>
<p class="rubric">Importación/Exportación remota de claves</p>
<p>Hasta ahora, hemos importado y exportado claves a o desde ficheros. Ahora bien,
existen <strong>servidores</strong> <abbr title="Pretty Good Privacy">PGP</abbr> que almacenan claves públicas y que permiten
importarlas lo que facilita el intercambio de claves. Dependiendo de cuál sea
el servidor Puede accederse a través de distintos protocolos. El fichero de
configuración de configuración define un servidor que soporta un protocolo
seguro por el puerto <strong>443</strong> (lo que puede ayudarnos si estamos dentro de una
red que restringe el acceso a internet):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --send-keys B0B83042
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>En versiones modernas, para poder hacer esta exportación remota es
necesario que se encuentre instalado el paquete <em>dirmngr</em>.</p>
</div>
<p>La importación de claves, por su parte, puede hacerse así:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --recv-keys <span class="m">00188366</span>
</pre></div>
</div>
<p>si se conoce el <strong>ID</strong> y, si no es así. es posible buscar la clave usando alguna
porción de la cadena de identificación (p.e. el correo electrónico):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --search-keys xxxx@gmail.com
</pre></div>
</div>
<p class="rubric">Revocación</p>
<p>Es posible que deseemos anular una clave antes de que esta expire por algún
motivo. Para ello debemos generar una revocación e importarla a nuestro
anillo de claves:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --gen-revoke xxxx@gmail.com <span class="p">|</span> gpg --import

<span class="go">[...]</span>
</pre></div>
</div>
<p>Para revocar también esta clave en el servidor público al que exportamos esta
clave con anterioridad, basta con exportar la clave ahora revocada de nuevo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --send-keys B0B83042
</pre></div>
</div>
<p class="rubric" id="gnupg-cif-asi">Cifrado</p>
<p>Para cifrar un mensaje con la clave pública de alguien a fin de que sólo éste
sea capaz de descifrarlo puede hacerse:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg -er su_correo@dominio.com -o - fichero.txt &gt; fichero.txt.asc
</pre></div>
</div>
<p>o bien, si se desea codificar lo remitido por la entrada estándar:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;Esto es un secreto&quot;</span> <span class="p">|</span> gpg -er su_correo@dominio.com &gt; secreto.asc
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p><code class="code docutils literal notranslate"><span class="pre">-o</span> <span class="pre">-</span></code> permite que la salida cifrada vaya a la salida estándar,
ya que de lo contrario se escribirá en un fichero que se llamará igual que el
original adjuntando el prefijo <code class="docutils literal notranslate"><span class="pre">.asc</span></code> (o <code class="docutils literal notranslate"><span class="pre">.gpg</span></code> si se usa la opción
<code class="docutils literal notranslate"><span class="pre">--no-armor</span></code>). Si el mensaje original procedía de la entrada estándar, se
dirige directamente a la salida estándar y, en consecuencia, no es necesario.</p>
</div>
<p>Para descifrar la clave en un sistema que tenga disponible la clave privada
correspondiente a la pública con la que se firmó, basta con:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg -qd secreto.asc
<span class="go">Esto es un secreto</span>
</pre></div>
</div>
</div>
<div class="section" id="id15">
<h4><span class="section-number">9.1.2.4.3.3. </span>Firma digital<a class="headerlink" href="#id15" title="Enlazar permanentemente con este título">¶</a></h4>
<p><abbr title="GNU Provacy Guard">GnuPG</abbr> lleva a cabo la firma de archivos mediante el estándar Open<abbr title="Pretty Good Privacy">PGP</abbr>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;Este es el contenido del fichero que firmo&quot;</span> &gt; fichero.txt
<span class="gp">$</span> gpg --detach-sign --default-key mi_cuenta@example.com -o fichero.sig fichero.txt
</pre></div>
</div>
<p>De esta manera tenemos un fichero original (<code class="file docutils literal notranslate"><span class="pre">fichero.txt</span></code>) y su resumen
cifrado digitalmente con nuestra clave privada en <code class="file docutils literal notranslate"><span class="pre">fichero.sign</span></code>. Si
analizamos el fichero de firma:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --list-packets fichero.sign
<span class="go">:signature packet: algo 1, keyid 53175AA29C972B7B</span>
<span class="go">        version 4, created 1543050622, md5len 0, sigclass 0x00</span>
<span class="go">        digest algo 10, begin of digest 04 9e</span>
<span class="go">        hashed subpkt 33 len 21 (issuer fpr v4 040968BBC05C39A4DD2A43BD53175AA29C972B7B)</span>
<span class="go">        hashed subpkt 2 len 4 (sig created 2018-11-24)</span>
<span class="go">        hashed subpkt 28 len 23 (signer&#39;s user ID)</span>
<span class="go">        subpkt 16 len 8 (issuer key ID 53175AA29C972B7B)</span>
<span class="go">        data: [3071 bits]</span>
</pre></div>
</div>
<p>veremos algunas características de la firma, como:</p>
<ul>
<li><p>qué algoritmo de clave asimétrica se usó, el <strong>1</strong>, que se corresponde con una
clave asimétrica <abbr title="Rivest, Shamir y Adleman">RSA</abbr>, válida tanto para firma como para cifrado. El
significado de los códigos puede encontrarse en el <span class="target" id="index-2"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc4880.html"><strong>RFC 4880</strong></a>, y en concreto
en la <a class="reference external" href="https://tools.ietf.org/html/rfc4880#section-9.1">sección 9.1</a>.</p></li>
<li><p>qué clave se usó: la <em>53175AA29C972B7B</em>, que efectivamente es la nuestra:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --keyid-format long -list-keys
<span class="go">/home/usuario/.gnupg/pubring.kbx</span>
<span class="go">--------------------------------</span>
<span class="hll"><span class="go">pub   rsa3072/53175AA29C972B7B 2018-11-21 [SC] [expires: 2020-11-20]</span>
</span><span class="go">      040968BBC05C39A4DD2A43BD53175AA29C972B7B</span>
<span class="go">uid                 [ unknown] Soy el que soy &lt;mi_cuenta@example.com&gt;</span>
<span class="go">      sub   rsa3072/4B1F09C9B84F038E 2018-11-21 [E] [expires: 2020-11-20]</span>
</pre></div>
</div>
</li>
<li><p>con qué algoritmo se resumió el fichero, el <strong>10</strong>, que es <em>SHA512</em> según
<a class="reference external" href="https://tools.ietf.org/html/rfc4880#section-9.4">la sección 9.4</a> del
<span class="target" id="index-3"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc4880.html"><strong>RFC 4880</strong></a>.</p></li>
</ul>
<p>Si hacemos llegar <strong>ambos</strong> archivos a un tercero, y éste posee nuestra clave
pública, podrá verificar nuestra identidad gracias a descifrar la firma y la
integridad del fichero gracias al resumen que contiene esta:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --verify fichero.sign fichero.txt
<span class="go">[...]</span>
<span class="go">Primary key fingerprint: 0409 68BB C05C 39A4 DD2A  43BD 5317 5AA2 9C97 2B7B</span>
<span class="gp">$</span> <span class="nb">echo</span> <span class="nv">$?</span>
<span class="go">0</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">Ver también</p>
<p>Hay un extenso tutorial del uso de <a class="reference external" href="https://www.gnupg.org/">GnuPG</a> en la <a class="reference external" href="https://wiki.archlinux.org/index.php/GnuPG_(Espa%C3%B1ol)">wiki de Archlinux</a>.</p>
</div>
<p class="rubric">Notas al pie</p>
<dl class="footnote brackets">
<dt class="label" id="id16"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>De hecho, <a class="reference external" href="https://www.openssh.com/">OpenSSH</a>, para su versión 7,
<a class="reference external" href="https://www.gentoo.org/support/news-items/2015-08-13-openssh-weak-keys.html">deshabilitó el uso de DSA</a>.</p>
</dd>
<dt class="label" id="id17"><span class="brackets"><a class="fn-backref" href="#id3">2</a></span></dt>
<dd><p>Se fuerza a que la orden se ejecute en inglés, para que el resultado se
exprese como <em>OK</em> o <em>FAILED</em>. En castellano, la leyenda se expresa de forma
muy farragosa.</p>
</dd>
<dt class="label" id="id18"><span class="brackets"><a class="fn-backref" href="#id4">3</a></span></dt>
<dd><p>Trataremos este estándar al hablar sobre <a class="reference internal" href="03.aplicaciones/03.correo.html#email-seguro"><span class="std std-ref">correo electronico</span></a>.</p>
</dd>
<dt class="label" id="id19"><span class="brackets"><a class="fn-backref" href="#id5">4</a></span></dt>
<dd><p>Usar, sin embargo, el propio kernel para la generación de la
entropía no es muy recomendable. Debería usarse el dispositivo
hardware (/dev/hwrng), pero en la máquina virtual es posible que
no esté. Para <strong class="program">qemu</strong> véase
<a class="reference external" href="https://wiki.qemu.org/Features/VirtIORNG">su wiki</a>.</p>
</dd>
<dt class="label" id="id20"><span class="brackets"><a class="fn-backref" href="#id11">5</a></span></dt>
<dd><p>El archivo cifrado es imprimible gracias a que incluimos <kbd class="kbd docutils literal notranslate">armor</kbd> en
el archivo de configuración.</p>
</dd>
<dt class="label" id="id21"><span class="brackets"><a class="fn-backref" href="#id13">6</a></span></dt>
<dd><p>El algoritmo elegido utiliza una clave <abbr title="Rivest, Shamir y Adleman">RSA</abbr> de 2048 <em>bits</em> tanto para
cifrado como para firmado. Otro posible algoritmo es <em>ed25519</em>.</p>
</dd>
<dt class="label" id="id22"><span class="brackets"><a class="fn-backref" href="#id14">7</a></span></dt>
<dd><p>En nuestro caso, sería una clave pública y su correspondiente privada.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Tabla de contenido</a></h3>
  <ul>
<li><a class="reference internal" href="#">9.1.2. Técnicas criptográficas</a><ul>
<li><a class="reference internal" href="#resumen-critografico">9.1.2.1. Resumen critográfico</a></li>
<li><a class="reference internal" href="#cifrado">9.1.2.2. Cifrado</a><ul>
<li><a class="reference internal" href="#cifrado-simetrico">9.1.2.2.1. Cifrado simétrico</a></li>
<li><a class="reference internal" href="#cifrado-asimetrico">9.1.2.2.2. Cifrado asimétrico</a></li>
<li><a class="reference internal" href="#cifrado-hibrido">9.1.2.2.3. Cifrado híbrido</a></li>
<li><a class="reference internal" href="#conclusiones">9.1.2.2.4. Conclusiones</a></li>
</ul>
</li>
<li><a class="reference internal" href="#firma-digital">9.1.2.3. Firma digital</a></li>
<li><a class="reference internal" href="#apendice-practico">9.1.2.4. Apéndice práctico</a><ul>
<li><a class="reference internal" href="#resumenes">9.1.2.4.1. Resúmenes</a></li>
<li><a class="reference internal" href="#openssl">9.1.2.4.2. Open<abbr title="Secure Socket Layer">SSL</abbr></a><ul>
<li><a class="reference internal" href="#id7">9.1.2.4.2.1. Cifrado simétrico</a></li>
<li><a class="reference internal" href="#id8">9.1.2.4.2.2. Cifrado asimétrico</a></li>
<li><a class="reference internal" href="#id9">9.1.2.4.2.3. Firma digital</a></li>
</ul>
</li>
<li><a class="reference internal" href="#gnupg">9.1.2.4.3. <abbr title="GNU Provacy Guard">GnuPG</abbr></a><ul>
<li><a class="reference internal" href="#id10">9.1.2.4.3.1. Cifrado simétrico</a></li>
<li><a class="reference internal" href="#gpg-pgp">9.1.2.4.3.2. Cifrado asimétrico</a></li>
<li><a class="reference internal" href="#id15">9.1.2.4.3.3. Firma digital</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Tema anterior</h4>
  <p class="topless"><a href="01.intro.html"
                        title="capítulo anterior"><span class="section-number">9.1.1. </span>Introducción</a></p>
  <h4>Próximo tema</h4>
  <p class="topless"><a href="03.aplicaciones.html"
                        title="próximo capítulo"><span class="section-number">9.1.3. </span>Aplicaciones de la criptografía</a></p>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/09.apendice/01.cryto/02.algo.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Ir a" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="03.aplicaciones.html" title="9.1.3. Aplicaciones de la criptografía"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="01.intro.html" title="9.1.1. Introducción"
             >anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" ><span class="section-number">9. </span>Apéndices</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" ><span class="section-number">9.1. </span>Criptografía</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">9.1.2. </span>Técnicas criptográficas</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Derechos de autor CC BY 4.0, 2016-2021, José Miguel Sánchez Alés.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.4.3.
    </div>
  </body>
</html>