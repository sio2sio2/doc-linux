


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="es">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>9.1.2. Algoritmos de cifrado &#8212; documentación de ServidorLinux - 0.1.0</title>
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../search.html" />
    <link rel="next" title="9.1.3. Aplicaciones de la criptografía" href="03.aplicaciones.html" />
    <link rel="prev" title="9.1.1. Introducción" href="01.intro.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="03.aplicaciones.html" title="9.1.3. Aplicaciones de la criptografía"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="01.intro.html" title="9.1.1. Introducción"
             accesskey="P">anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de ServidorLinux - 0.1.0</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >9. Apéndice</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">9.1. Criptografía</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="algoritmos-de-cifrado">
<h1>9.1.2. Algoritmos de cifrado<a class="headerlink" href="#algoritmos-de-cifrado" title="Enlazar permanentemente con este título">¶</a></h1>
<p>Ya se ha comentado que los algoritmos modernos de cifrado se basan en el
secreto de la clave y no en el secreto del propio algoritmo, por lo que nos
centraremos en los algoritmos basados en clave. Atendiendo a ella hay dos tipos
de algoritmos.</p>
<dl class="docutils">
<dt><strong>De clave simétrica</strong></dt>
<dd>También conocidos como <em class="dfn">de clave privada</em> o de <em class="dfn">clave única</em>. Son
aquellos en que se usa la misma clave para cifrar y descifrar.</dd>
<dt><strong>De clave asimétrica</strong></dt>
<dd>También conocidos como <em class="dfn">de clave pública</em> o <em class="dfn">de doble clave</em>. Son
aquellos que emplean una pareja de claves, de manera que si una se usa para
cifrar. la otra sirve para descifrar los mensajes cifrados con la primera.</dd>
</dl>
<p>Es común, además, que las técnicas de cifrado usen una combinación de un
algoritmo de clave simétrica y otro de clave asimétrica, lo cual se conoce como
<a class="reference internal" href="#hibrido"><span class="std std-ref">cifrado híbrido</span></a>.</p>
<div class="section" id="cifrado-simetrico">
<h2>9.1.2.1. Cifrado simétrico<a class="headerlink" href="#cifrado-simetrico" title="Enlazar permanentemente con este título">¶</a></h2>
<p>En este tipo de cifrado se usa la misma clave tanto para cifrar como para
descifrar. Cuando las dos partes se encuentran alejadas, ese, precisamente, es
su punto débil, ya que exige que la clave su encuentre en ambos extremos con
anterioridad a la comunicación, lo cual sólo puede lograrse:</p>
<ul class="simple">
<li>Encontrándose físicamente la ambas partes para intercambiar en mano la clave.</li>
<li>Transmitiendo la clave en claro, lo cual puede provocar que se intercepte y
sea inútil el cifrado posterior.</li>
</ul>
<p>Obviando lo anterior, eL factor decisivo en la robustez de la clave es su
longitud: cuanto más larga sea, más dificil es averiguarla por fuerza bruta.
Por ejemplo, una clave de <strong>8</strong> <em>bits</em> sólo puede tener 2<sup>8</sup>, o sea,
<strong>256</strong> valores distintos, lo que implica que podría adivinarse con un máximo
de <strong>256</strong> intentos.</p>
<p>Algunos algoritmos de cifrado simétrico muy conocidos son:</p>
<dl class="docutils">
<dt><abbr title="Data Encryption Standard">DES</abbr></dt>
<dd>Considerado actualmente inseguro para la capacidad computacional de los
ordenadores modernos, ya que tiene una longitud de sólo <strong>56</strong> <em>bits</em>.
Su sucesor directo es el 3<abbr title="Data Encryption Standard">DES</abbr> (Triple <abbr title="Data Encryption Standard">DES</abbr>) que usa el triple de
longitud para la clave (<strong>168</strong> bits), aunque también se ha ido desplazando
en favor de otros algoritmos.</dd>
<dt><abbr title="Advanced Encryption Standard">AES</abbr></dt>
<dd>Sustituyó al algoritmo anterior y tiene una longitud de <strong>256</strong> <em>bits</em>. Es
más rápido y, además, no se le conocen vulneralidades. Es uno de los
algoritmos más ampliamente utilizados.</dd>
</dl>
<p>Existen otros algoritmos como <a class="reference external" href="https://es.wikipedia.org/wiki/Twofish">Twofish</a>
o <a class="reference external" href="https://es.wikipedia.org/wiki/Blowfish">Blowfish</a>.</p>
</div>
<div class="section" id="cifrado-asimetrico">
<span id="asimetrico"></span><h2>9.1.2.2. Cifrado asimétrico<a class="headerlink" href="#cifrado-asimetrico" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Se basa en el uso de una pareja de claves relacionadas entre sí, de modo que lo
que se haya cifrado con una es posible descifrarlo con la otra, pero no con
ella misma. Los algoritmos está diseñados para que el interesado genere una de
estas parejas de claves, de manera que cada una de ellas realice un papel
diferente:</p>
<ul class="simple">
<li>Una es la clave <strong>privada</strong> que debe mantenerla en secreto su propietario.</li>
<li>Otra es la clave <strong>pública</strong>, pensada para que el propietario la comunique
a los demás.</li>
</ul>
<p>De este modo, cuando se desea enviar un mensaje secreto a un destinatario, lo
que se hace es usar la clave <em>pública</em> de éste, ya que tal mensaje sólo podrá
ser descifrado usando su clave <em>privada</em> correspondiente que sólo está en
posesión del destinatario. El cifrado con la clave <em>pública</em>, pues. garantiza
la privacidad.</p>
<p>Por otra parte, si un emisor usa su clave <strong>privada</strong> para cifrar, el mensaje
podrá descifrase con su clave <em>pública</em> correspondiente. Como la clave
<em>pública</em> es, eso, pública, no sirve para salvarguardar ninguna privacidad,
pero sí para asegurar que el emisor del mensaje es el dueño de las claves.
Afinaremos esto más adelante.</p>
<p>Los algoritmos más conocidos de cifrado asimétrico son:</p>
<dl class="docutils">
<dt><abbr title="Rivest, Shamir y Adleman">RSA</abbr></dt>
<dd>Es el primer sistema criptográfico de clave asimétrica y aún se considera
válido (esto es, suficientemente seguro) tanto para cifrar y como firmar
digitalmente. Por lo general, utiliza claves con una longitud entre 1024 y
4096 <em>bits</em>.</dd>
<dt><abbr title="Digital Signature Algorithm">DSA</abbr></dt>
<dd><p class="first">Es otro sistema criptográfico de clave asimétrica que en la actualidad se
considera débol, por lo que se desaconseja su uso para cifrar información<a class="footnote-reference" href="#id9" id="id1">[1]</a>. Sus claves tiene una longitud entre 512 y 1024 <em>bits</em>.</p>
<p>Variantes de este sistema que mejoran la fortaleza de las claves y, por
tanto permiten su uso para cifrado, son:</p>
<ul class="last simple">
<li><abbr title="Elliptic Curve Digital Signature Algorithm">ECDSA</abbr>, que usa <a class="reference external" href="https://es.wikipedia.org/wiki/Criptograf%C3%ADa_de_curva_el%C3%ADptica">criptografía de curva elíptica</a>.</li>
<li><abbr title="Edwards-curve Curve Digital Signature Algorithm">EdDSA</abbr>, que usa también criptografía de curva elíptica. y se desarrolló
para mejorar la velocidad de cifrado sin sacrificar velocidad. Un tipo
particular de este sistema es <em>Ed22519</em>, que permiten usar las últimas
versiones de:program:<cite>openssh</cite>.</li>
</ul>
</dd>
</dl>
<p>La desventaja fundamental del cifrado asimétrico frente al simétrico es su costo
computacional: para un mismo nivel de seguridad requiere claves más largas y,
además, para una misma longitud de clave es más costoso en tiempo.</p>
</div>
<div class="section" id="cifrado-hibrido">
<span id="hibrido"></span><h2>9.1.2.3. Cifrado híbrido<a class="headerlink" href="#cifrado-hibrido" title="Enlazar permanentemente con este título">¶</a></h2>
<p>El <em class="dfn">cifrado híbrido</em> consiste en el uso de técnicas de cifrado simétrico y
asimétrico para sortear:</p>
<ul class="simple">
<li>La debilidad intrínseca de tener que la clave simétrica en ambos extremos de
la comunicación.</li>
<li>El mayor costo computacional del cifrado asimétrico.</li>
</ul>
<p>Para ello realiza una primera fase de la comunicación utilizando cifrado
asimétrico que sirve estrictamente para intercambiar una clave simétrica de
forma segura, que se denomina <em class="dfn">clave de sesión</em>. Una vez que la clave se
encuentra en ambos extremos se pasa a realizar un cifrado simétrico usando esta
clave de sesión.</p>
</div>
<div class="section" id="funciones-hash">
<span id="hash"></span><h2>9.1.2.4. Funciones <em>hash</em><a class="headerlink" href="#funciones-hash" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Las <em class="dfn">funciones hash</em> o <em class="dfn">funciones digest</em> o <em class="dfn">funciones resumen</em>
son funciones que dada una entrada generan siempre una salida de la misma
longitud. Lo deseable, a efectos de nuestro tema, es que:</p>
<ul class="simple">
<li>sean <em>deterministas</em>, esto es, que para una misma entrada siempre generen la
misma salida.</li>
<li>minimicen las <em>colisiones</em>, esto es, que minimicen la posibilidad de obtener
una misma salida para dos entradas distintas.</li>
<li>sean de un solo sentido, esto es, que, dada una salida, sea difícil encontrar
una entrada cuya salida sea la especificada.</li>
</ul>
<p>Entre las funciones de <em>hash</em> más conocidas se encuentran:</p>
<dl class="docutils">
<dt><abbr title="Message Digest Algorithm 5">MD5</abbr></dt>
<dd>Genera un resumen de 128 <em>bits</em> representado habitualmente por 32 dígitos
hexadecimanels. Es muy común usarlo como comprobación de la integridad de
ficheros. Su seguridad está en entredicho, ya que presenta problemas de
colisiones.</dd>
<dt><abbr title="sechure Hash Algorithm">SHA</abbr></dt>
<dd>Es una familia de funciones <em>hash</em>  que ha ido sufriendo diversas revisiones:
<abbr title="sechure Hash Algorithm">SHA</abbr>-0, <abbr title="sechure Hash Algorithm">SHA</abbr>-1, <abbr title="sechure Hash Algorithm">SHA</abbr>-2 y <abbr title="sechure Hash Algorithm">SHA</abbr>-3. Tanto <abbr title="sechure Hash Algorithm">SHA</abbr>-0 como <abbr title="sechure Hash Algorithm">SHA</abbr>-1
generan resúmenes de 160 <em>bits</em>. Ambas se consideran inseguras y se
desaconseja su uso. para paliar esto, se desarrolló <abbr title="sechure Hash Algorithm">SHA</abbr>-2, que implementa
funciones <em>hash</em> de 224, 256, 364 y 512 <em>bits</em>. Se las conoce habitualmente
como <abbr title="sechure Hash Algorithm">SHA</abbr>-224, <abbr title="sechure Hash Algorithm">SHA</abbr>-256, <abbr title="sechure Hash Algorithm">SHA</abbr>-364 y <abbr title="sechure Hash Algorithm">SHA</abbr>-512. <abbr title="sechure Hash Algorithm">SHA</abbr>-3, por su
parte, cambia internamente los algoritmos, pero esta pensada para generar
resúmenes de la misma longitud que <abbr title="sechure Hash Algorithm">SHA</abbr>-2.</dd>
</dl>
</div>
<div class="section" id="generacion-de-claves-gnupg">
<span id="gnupg-1"></span><h2>9.1.2.5. Generación de claves: <abbr title="GNU Provacy Guard">GnuPG</abbr><a class="headerlink" href="#generacion-de-claves-gnupg" title="Enlazar permanentemente con este título">¶</a></h2>
<p><a class="reference external" href="https://www.gnupg.org/">GnuPG</a> es una aplicación que implementa el estándar <a class="reference external" href="https://www.openpgp.org/">OpenPGP</a> y que, en consecuencia, muy comúnmente se usa como
<em>plugin</em> de clientes de correo para el cifrado o la firma de mensajes. Por
ahora, sin embargo, usaremos el ejecutable que proporciona, <strong class="command">pgp</strong>, para
probar la generación de claves.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p>En caso de que hagamos pruebas en una máquina virtual es conveniente
aumentar la entropía del sistema para mejorar y acelerar la creación de
claves asimétricas. Para lograrlo puede hacerse lo siguiente<a class="footnote-reference" href="#id10" id="id2">[2]</a>:</p>
<div class="last highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> cat /proc/sys/kernel/random/entropy_avail  <span class="c1"># Entropía inicial</span>
<span class="go">234</span>
<span class="gp">#</span> apt install rng-tools
<span class="gp">#</span> <span class="nb">echo</span> <span class="s1">&#39;HRNGDEVICE=/dev/urandom&#39;</span> &gt;&gt; /etc/default/rng-tools
<span class="gp">#</span> <span class="nb">echo</span> <span class="s1">&#39;RNGDOPTIONS=&quot;--fill-watermark=90%&quot;&#39;</span> &gt;&gt; /etc/default/rng-tools
<span class="gp">#</span> invoke-rc.d rng-tools start
<span class="gp">#</span> cat /proc/sys/kernel/random/entropy_avail
<span class="go">2159</span>
</pre></div>
</div>
</div>
<div class="section" id="instalacion">
<h3>9.1.2.5.1. Instalación<a class="headerlink" href="#instalacion" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Basta con instalar el paquete:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> apt install gnupg
</pre></div>
</div>
<p>Como configuración podemos usar la siguiente:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> Fichero ~/.gnugpg/gpg.conf
<span class="go">keyserver keys.gnupg.net</span>
<span class="go">no-greeting</span>
<span class="go">armor</span>

<span class="go">personal-digest-preferences SHA512</span>
<span class="go">cert-digest-algo SHA512</span>
<span class="go">default-preference-list SHA512 SHA384 SHA256 SHA224 AES256 AES192 AES CAST5</span>
<span class="go">ZLIB BZIP2 ZIP Uncompressed</span>
<span class="go">personal-cipher-preferences AES256 TWOFISH CAMELLIA256 3DES</span>
</pre></div>
</div>
<p>Con la que seleccionamos cuáles son nuestros algoritmos de cifrado y <em>hash</em>
preferidos. Además, con <code class="docutils literal notranslate"><span class="pre">armor</span></code> guardamos el texto cifrado como caracteres
imprimibles.</p>
<p>Si ejecutamos la orden:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --version
</pre></div>
</div>
<p>Podremos consultar cuáles son los algoritmos de cifrado, <em>hash</em> y compresión que
usa el programa.</p>
</div>
<div class="section" id="id3">
<h3>9.1.2.5.2. Cifrado simétrico<a class="headerlink" href="#id3" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El cifrado simétrico es muy apropiado para el cifrado de ficheros. Para cifrar
el texto, basta con lo siguiente:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">echo</span> <span class="s1">&#39;Hola, caracola!!!&#39;</span> &gt; /tmp/saludo.txt
<span class="gp">$</span> gpg -c /tmp/saludo.txt
</pre></div>
</div>
<p>La orden genera el fichero cifrado <code class="file docutils literal notranslate"><span class="pre">/tmp/saludo.txt.asc</span></code> con esta pinta:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">-----BEGIN PGP MESSAGE-----</span>

<span class="go">jA0ECQMCgmqtVcUnh0H80lAB2H6YjrKdXR2P2I9a0JRDKpoQhEJc//dnzA550ged</span>
<span class="go">Q2DYgVpYgaL3Se26CAwii54xhZfUijWnGg7pPSKc7Zd81TLvQm75MA6IbsDPGHEN</span>
<span class="go">eQ==</span>
<span class="go">=5YjK</span>
<span class="go">-----END PGP MESSAGE-----</span>
</pre></div>
</div>
<p>El fichero podría haberse enviado a otro fichero usando la opción <code class="docutils literal notranslate"><span class="pre">--output</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg -c -o /tmp/otrofichero.asc /tmp/saludo.txt
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Si se usa como nombre de fichero «-«, la salida será la estándar.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">El formato del fichero cifrado, sigue el estándar marcado por
<em>OpenPGP</em>, pero también podríamos haber generado un fichero cifrado que use
caracteres no imprimibles habiendo añadido <code class="docutils literal notranslate"><span class="pre">--no-armor</span></code>. En este caso, la
extensión añadida es <code class="docutils literal notranslate"><span class="pre">.gpg</span></code> en vez de <code class="docutils literal notranslate"><span class="pre">.asc</span></code>.</p>
</div>
<p>Si hemos ejecutado las ordenes anteriores, habremos comprobado que se pide de
forma interactiva la clave simétrica de cifrado. Si queremos ejecutar la orden
de forma no interactiva podemos hacer lo siguiente:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --batch --passphrase <span class="s1">&#39;contraseñadificil&#39;</span> -c /tmp/saludo.txt
</pre></div>
</div>
<p>o bien:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">printf</span> <span class="s1">&#39;contraseñadificil&#39;</span> <span class="p">|</span> gpg --batch --passphrase-fd <span class="m">0</span> -c /tmp/saludo.txt
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Aunque recordemos que eso guardará en el historial la contraseña y
es muy discutible su seguridad, por lo que al menos deberíamos asegurarnos de
que tal cosa no sucede.</p>
</div>
<p>Para descifrar, podemos no usar la orden sin parámetros:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg /tmp/saludo.txt.asc
</pre></div>
</div>
<p>que intentará descifrar con la contraseña que le proporcionemos interactivamente
y dejar el resultado en el fichero <code class="file docutils literal notranslate"><span class="pre">/tmp/saludo.txt</span></code>. Si añadimos la
opción <code class="docutils literal notranslate"><span class="pre">-d</span></code>, el resultado se mandará a la pantalla:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg -qd /tmp/saludo.txt.asc
<span class="go">Hola, caracola!!!</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">La opción <code class="docutils literal notranslate"><span class="pre">-q</span></code> ejecuta la orden en modo silencioso.</p>
</div>
<p>Si nuestra intención es consultar cuáles es el cifrado sin descifrar en
absoluto, podemos hacer:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --list-only -d saludo.txt.asc
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p><strong class="command">gpg</strong> levanta automáticamente un demonio que se encarga de
recordar claves. Si por alguna razón se desea para, puede hacerse:</p>
<div class="last highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpgconf --kill gpg-agent
</pre></div>
</div>
</div>
</div>
<div class="section" id="id4">
<h3>9.1.2.5.3. Cifrado asimétrico<a class="headerlink" href="#id4" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Para la generación de una pareja de claves basta hacer<a class="footnote-reference" href="#id11" id="id5">[3]</a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --gen-key --default-cert-expire 1y --default-new-key-algo rsa3072
</pre></div>
</div>
<p>que nos pedirá el nombre de su propietario y la dirección de correo electrónico,
ya que al estar este <em>software</em> orientado a la firma de mensajes de correo, esta
dirección se usará como identificador para las claves generadas. Además, se nos
pedirá una clave simétrica con la que cifrar la clave privada. Esta contraseña
deberá consignarse cada vez que la clave privada tenga que usarse y es una
simple medida de seguridad para evitar que, si la clave privada cae en manos
ajenas, el ladrón tenga fácil usurpar la identidad del legítimo propietario. Se
han añadido, además, dos datos relevantes: el tiempo de vigencia de la clave (un
año), que de forma predeterminada es eterno, y el tipo de algoritmo<a class="footnote-reference" href="#id12" id="id6">[4]</a>. La
orden no sólo genera las claves, sino que las almacena en el anillo de
claves (todo dentro de <code class="file docutils literal notranslate"><span class="pre">~/.gnupg</span></code>), con lo que podremos consultar su
existencia listando cuáles son las claves públicas almacenadas:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --list-keys
</pre></div>
</div>
<p>y cuáles las privadas:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --list-secret-keys
</pre></div>
</div>
<p>Por ahora sólo veremos una y una respectivamente. Lo habitual es que
dispongamos de una única clave privada y muchas públicas, ya que podemos importar
a nuestro repositorio claves públicas ajenas.</p>
<p class="rubric">Importación/exportación local de claves</p>
<p>Como debemos compartir nuestra clave pública con el resto de usuarios y, a su
vez, recibir de éstos sendas claves públicas, <a class="reference external" href="https://www.gnupg.org/">GnuPG</a> provee de mecanismos para
la importación y exportación de claves.</p>
<p>Para exportar una clave pública del repositorio, podemos hacer:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --export xxxx@gmail.com &gt; clave.asc
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">La selección de la clave puede hacerse con cualquier parte
de la identificación que se usó al crear la clave (el correo electrónico
es una de ellas). Si no especificamos ninguna clave en concreto, se
exportaran todas.</p>
</div>
<p>Si, además, queremos exportar la clave privada, podemos añadirla al fichero
anterior:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --export-secret-keys xxxx@gmail.com &gt;&gt; clave.asc
</pre></div>
</div>
<p>El proceso inverso de importar claves es también sencillo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --import clave.asc
</pre></div>
</div>
<p>orden que importará todas las claves contenidas en el fichero<a class="footnote-reference" href="#id13" id="id7">[5]</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p>Si la importación se hace del siguiente modo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --import --import-options import-show --dry-run clave.asc
</pre></div>
</div>
<p class="last">se muestran los datos de la clave o claves que se importarán, pero
al incluir también <code class="docutils literal notranslate"><span class="pre">-dry-run</span></code> no se hará efectiva la importación,
con lo que el resultado es que tenemos un método para consultar las
claves contenidas en un fichero.</p>
</div>
<p class="rubric">Importación/Exportación remota de claves</p>
<p>Hasta ahora, hemos importado y exportado claves a o desde ficheros. Ahora bien,
existen <strong>servidores</strong> <abbr title="Pretty Good Privacy">PGP</abbr> que almacenan claves públicas y que permiten
importarlas lo que facilita el intercambio de claves. Para exportar una clave
pública debe escogerse un servidor apropiado como <a class="reference external" href="http://www.keyserver.net/">keyservers</a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --keyserver pool.sks-keyservers.net --send-keys <span class="m">00188366</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p>En versiones modernas, para poder hacer esta exportación remota es
necesario instalar el paquete <em>dirmngr</em>:</p>
<div class="last highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> apt-get install dirmngr
</pre></div>
</div>
</div>
<p>donde el <strong>ID</strong> proporcionado a <code class="docutils literal notranslate"><span class="pre">--send-keys</span></code> puede consultarse listado las
claves:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --list-keys  --keyid-format short xxxx@gmail.com
<span class="hll"><span class="go">pub   2048R/00188366 2018-11-27 [expires: 2020-11-26]</span>
</span><span class="go">      4970D58E7E7C356DEC9EACD00B95734D00188366</span>
<span class="go">uid                  Licenciado Cebadilla (Una clave para mi cuenta de pruebas) &lt;xxxx@gmail.com&gt;</span>
<span class="go">sub   2048R/0FD7EE65 2018-11-27 [expires: 2020-11-26]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p>La conexión al servidor se hace a través del <a class="reference external" href="https://tools.ietf.org/html/draft-shaw-openpgp-hkp-00">protocolo HKP</a> por el puerto
<strong>11371</strong>. Para redes con tráfico restringido, es posible que no
se pueda realizar la conexión normalmente. En estos redes, el servidor
anterior permite la conexión tunelizando con <abbr title="Secure Socket Layer">SSL</abbr>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">gpg --keyserver https://keys.gnupg.net --send-keys 00188366</span>
</pre></div>
</div>
<p class="last"><a class="reference external" href="https://keys.gnupg.net">keys.gnupg.net</a> y <a class="reference external" href="https://hkps.pool.sks-keyservers.net">hkps.pool.sks-keyservers.net</a> son el mismo servidor.</p>
</div>
<p>La importación de claves, por su parte, puede hacerse así:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --keyserver pool.sks-keyservers.net --recv-keys <span class="m">00188366</span>
</pre></div>
</div>
<p>si se conoce el <strong>ID</strong> y, si no es así. es posible buscar la clave usado alguna
porción de la cadena de identificación (p.e. el correo electrónico):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --keyserver pool.sks-keyservers.net --search-keys xxxx@gmail.com
</pre></div>
</div>
<p class="rubric">Revocación</p>
<p>Es posible que deseemos anular una clave antes de que esta expire por algún
motivo. Para ello debemos generar una revocación e importarla a nuestro
anillo de claves:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --gen-revoke xxxx@gmail.com <span class="p">|</span> gpg --import

<span class="go">[...]</span>

<span class="gp">$</span> gpg --list-keys xxxx@gmail.com
<span class="go">pub   2048R/00188366 2018-11-27 [expires: 2020-11-26]</span>
<span class="go">      4970D58E7E7C356DEC9EACD00B95734D00188366</span>
<span class="go">uid        [revoked] Licenciado Cebadilla (Una clave para mi cuenta de pruebas) &lt;xxxx@gmail.com&gt;</span>
</pre></div>
</div>
<p>Para revocar también esta clave en el servidor público al que exportamos esta
clave con anterioridad, basta con exportar la clave ahora revocada de nuevo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --keyserver pool.sks-keyservers.net --send-keys <span class="m">00188366</span>
</pre></div>
</div>
<p class="rubric">Cifrado</p>
<p>Para cifrar un mensaje con la clave pública de alguien a fin de que sólo éste
sea capaz de descifrarlo puede hacerse:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg -er su_correo@dominio.com -o - fichero.txt &gt; fichero.txt.asc
</pre></div>
</div>
<p>o bien, si se desea codificar lo remitido por la entrada estándar:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;Esto es un secreto&quot;</span> <span class="p">|</span> gpg -er su_correo@dominio.com &gt; secreto.asc
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last"><code class="code docutils literal notranslate"><span class="pre">-o</span> <span class="pre">-</span></code> permite que la salida cifrada vaya a la salida estándar,
ya que de lo contrario se escribirá en un fichero que se llamará igual que el
original adjuntando el prefijo <code class="docutils literal notranslate"><span class="pre">.asc</span></code> (o <code class="docutils literal notranslate"><span class="pre">.gpg</span></code> si se usa la opción
<code class="docutils literal notranslate"><span class="pre">--no-armor</span></code>). Si el mensaje original procedía de la entrada estándar, se
dirige directamente a la salida estándar y, en consecuencia, no es necesario.</p>
</div>
<p>Para descifrar la clave en un sistema que tenga disponible la clave privada
corespondiente a la pública con la que se firmó, basta con:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg -qd secreto.asc
<span class="go">Esto es un secreto</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">Ver también</p>
<p class="last">Hay un extenso tutorial del uso de <a class="reference external" href="https://www.gnupg.org/">GnuPG</a> en la <a class="reference external" href="https://wiki.archlinux.org/index.php/GnuPG_(Espa%C3%B1ol)">wiki de Archlinux</a>.</p>
</div>
<span class="target" id="index-0"></span></div>
</div>
<div class="section" id="generacion-de-resumenes">
<span id="shasum"></span><span id="md5sum"></span><span id="index-1"></span><h2>9.1.2.6. Generación de resúmenes<a class="headerlink" href="#generacion-de-resumenes" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Para la generación de resúmenes <em>hash</em> de ficheros y flujos de texto, existen
dos órdenes fundamentales: <strong class="command">md5sum</strong> y la familia de comandos
<strong class="program">shasum</strong> (<strong class="command">sha256sum</strong>, <strong class="command">sha384sum</strong>,
<strong class="command">sha512sum</strong>), que comparten una misma interfaz, con lo que es
indiferente ilustrar el uso de una u otra orden.</p>
<p>La generación del resumen puede hacerse del siguiente modo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;Hola, caracola&quot;</span> &gt; saludo1.txt
<span class="gp">$</span> md5sum saludo1.txt
<span class="go">b18a245aba5384920d7f6a488d725181  saludo1.txt</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Si se incluyen varios ficheros como argumento, se calculará el resumen
de cada uno de ellos.</p>
</div>
<p>También es posible calcular el resumen de un flujo de datos:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;Hola, caracola&quot;</span> <span class="p">|</span> sha256sum
<span class="go">d261be2aa264d38cad717fa8493dacc0b3f33f949869d39ecf7611689fb617ad  -</span>
</pre></div>
</div>
<p>Habitualmente, los resúmenes generados se almacenan, a fin de que puedan servir
más adelante para comprobar la integridad de los ficheros:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> md5sum saludo1.txt saludo2.txt &gt; saludos.md5
</pre></div>
</div>
<p>Con posterioridad, podrá comprobarse la integridad del siguiente modo<a class="footnote-reference" href="#id14" id="id8">[6]</a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nv">LC_ALL</span><span class="o">=</span>C md5sum -c saludos.md5
<span class="go">saludo1.txt: OK</span>
<span class="go">saludo2.txt: OK</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p>Si se almacenó el resumen de un flujo de datos (obsérvese que aparece
un «-«, en vez de el nombre del fichero), puede comprobarse que otro flujo es
el mismo pasándolo a través de la entrada estándar:</p>
<div class="last highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;Hola, caracola&quot;</span> <span class="p">|</span> md5sum &gt;  flujo.md5
<span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;Hola, caracola&quot;</span> <span class="p">|</span> <span class="nv">LC_ALL</span><span class="o">=</span>C md5sum -c flujo.md5
<span class="go">-: OK</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p>Con <strong class="command">gpg</strong>, aunque no está pensado para ello, también pueden
obtenerse el resumen de un fichero:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --print-md sha512 fichero,txt
</pre></div>
</div>
<p>e incluso hay una opción que calcula los resúmenes según todos los algoritmos
disponibles:</p>
<div class="last highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gpg --print-mds fichero,txt
</pre></div>
</div>
</div>
<p class="rubric">Notas al pie</p>
<table class="docutils footnote" frame="void" id="id9" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>De hecho, <a class="reference external" href="https://www.openssh.com/">OpenSSH</a>, para su versión 7,
<a class="reference external" href="https://www.gentoo.org/support/news-items/2015-08-13-openssh-weak-keys.html">deshabilitó el uso de DSA</a>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>Usar, sin embargo, el propio kernel para la generación de la
entropía no es muy recomendable. Debería usarse el dispositivo
hardware (/dev/hwrng), pero en la máquina virtual es posible que
no esté. Para qemu véase
<a class="reference external" href="https://wiki.qemu.org/Features/VirtIORNG">su wiki</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id11" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[3]</a></td><td>En versiones modernas  de <strong class="command">gpg</strong> existe la opción
<code class="docutils literal notranslate"><span class="pre">--full-gen-key</span></code> que pregunta interactivamente el tiempo de vigencia y el
algoritmo.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id12" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[4]</a></td><td>El algoritmo elegido utiliza una clave <abbr title="Rivest, Shamir y Adleman">RSA</abbr> de 2048 <em>bits</em> tanto para
cifrado como para firmado. Otro posible algoritmo es <em>ed25519</em>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id13" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[5]</a></td><td>En nuestro caso, sería una clave pública y su correspondiente privada.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id14" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id8">[6]</a></td><td>Se fuerza a que la orden se ejecute en inglés, para que el resultado se
exprese como <em>OK</em> o <em>FAILED</em>. En castellano, la leyenda se expresa de forma
muy farragosa.</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">9.1.2. Algoritmos de cifrado</a><ul>
<li><a class="reference internal" href="#cifrado-simetrico">9.1.2.1. Cifrado simétrico</a></li>
<li><a class="reference internal" href="#cifrado-asimetrico">9.1.2.2. Cifrado asimétrico</a></li>
<li><a class="reference internal" href="#cifrado-hibrido">9.1.2.3. Cifrado híbrido</a></li>
<li><a class="reference internal" href="#funciones-hash">9.1.2.4. Funciones <em>hash</em></a></li>
<li><a class="reference internal" href="#generacion-de-claves-gnupg">9.1.2.5. Generación de claves: <abbr title="GNU Provacy Guard">GnuPG</abbr></a><ul>
<li><a class="reference internal" href="#instalacion">9.1.2.5.1. Instalación</a></li>
<li><a class="reference internal" href="#id3">9.1.2.5.2. Cifrado simétrico</a></li>
<li><a class="reference internal" href="#id4">9.1.2.5.3. Cifrado asimétrico</a></li>
</ul>
</li>
<li><a class="reference internal" href="#generacion-de-resumenes">9.1.2.6. Generación de resúmenes</a></li>
</ul>
</li>
</ul>

  <h4>Tema anterior</h4>
  <p class="topless"><a href="01.intro.html"
                        title="capítulo anterior">9.1.1. Introducción</a></p>
  <h4>Próximo tema</h4>
  <p class="topless"><a href="03.aplicaciones.html"
                        title="próximo capítulo">9.1.3. Aplicaciones de la criptografía</a></p>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/09.apendice/01.cryto/02.algo.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Ir a" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="03.aplicaciones.html" title="9.1.3. Aplicaciones de la criptografía"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="01.intro.html" title="9.1.1. Introducción"
             >anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de ServidorLinux - 0.1.0</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >9. Apéndice</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >9.1. Criptografía</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Derechos de autor 2016, José Miguel Sánchez Alés.
      Creado con <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>