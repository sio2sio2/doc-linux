


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="es">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>5.4.2.1.2. LVM &#8212; documentación de ServidorLinux - 0.1.0</title>
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../search.html" />
    <link rel="next" title="5.5. Gestor de arranque" href="../06.grub/index.html" />
    <link rel="prev" title="5.4.2.1.1. mdadm" href="01.mdadm.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="../06.grub/index.html" title="5.5. Gestor de arranque"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="01.mdadm.html" title="5.4.2.1.1. mdadm"
             accesskey="P">anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de ServidorLinux - 0.1.0</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >5. Gestión de discos</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">5.4. <abbr title="Redundant Array of Independent Disks">RAID</abbr>s</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="lvm">
<span id="lvmraid"></span><h1>5.4.2.1.2. <abbr title="Logical Volume Management">LVM</abbr><a class="headerlink" href="#lvm" title="Enlazar permanentemente con este título">¶</a></h1>
<p>Desde su versión 2, <abbr title="Logical Volume Management">LVM</abbr> permite la creación y gestión de dispositivos <abbr title="Redundant Array of Independent Dists">RAID</abbr>
como si de volúmenes lógicos se tratara. Usa internamente el mismo <em>driver</em> del
núcleo que <a class="reference internal" href="01.mdadm.html#mdadm"><span class="std std-ref">mdadm</span></a>, por lo que pueden contituirse los mismo niveles
de <abbr title="Redundant Array of Independent Dists">RAID</abbr>: 0, 1, 4, 5, 6 y 10. Es, pues, una buena alternativa si nuestra
intención es crear volúmenes lógicos con redundancia, en vez de crear el <abbr title="Redundant Array of Independent Dists">RAID</abbr>
y definir después sobre el dispositivo virtual resultante un grupo de volúmenes.
La gestión de volúmenes lógicos redundantes tiene su propia página de manual:
<em class="manpage"><a class="manpage reference external" href="https://manpages.debian.org/lvmraid(7)">lvmraid(7)</a></em>. Esta solución tiene algunas diferencias frente a definir
<abbr title="Logical Volume Management">LVM</abbr> sobre un <abbr title="Redundant Array of Independent Dists">RAID</abbr>:</p>
<img alt="../../_images/RAID+LVM.png" src="../../_images/RAID+LVM.png" />
<p>En este caso, la tercera partición del disco, contiene un dispositivo <abbr title="Redundant Array of Independent Dists">RAID</abbr><a class="footnote-reference" href="#id3" id="id1">[1]</a> construido con <span class="xref std std-ref">mdadm</span> que constituye todo él un grupo de volúmenes
sobre el cual se definen los volúmenes lógicos. En cambio, si creamos
dispositivos lógicos con <abbr title="Redundant Array of Independent Dists">RAID</abbr> usando <abbr title="Logical Volume Management">LVM</abbr>:</p>
<img alt="../../_images/LVMRAID.png" src="../../_images/LVMRAID.png" />
<p>La tercera partición es directamente un grupo de volúmenes dentro de los cuales
pueden crearse volúmenes lógicos, reduntantes<a class="footnote-reference" href="#id4" id="id2">[2]</a> o no. Las soluciones no son
exactamente equivalentes:</p>
<ul>
<li><p class="first">En la primera:</p>
<ul class="simple">
<li>Sólo hay un dispositivo <abbr title="Redundant Array of Independent Dists">RAID</abbr>.</li>
<li>Todos los volúmenes lógicos está en el <abbr title="Redundant Array of Independent Dists">RAID</abbr>.</li>
<li>Es aconsejable que los dispositivos que constituyen el <abbr title="Redundant Array of Independent Dists">RAID</abbr> sean
iguales. En consecuencia, replicaremos la misma estructura en todos los discos
y haremos que participen en el <abbr title="Redundant Array of Independent Dists">RAID</abbr> las terceras particiones de cada cual.</li>
</ul>
</li>
<li><p class="first">En la segunda:</p>
<ul>
<li><p class="first">Hay un dispositivo <abbr title="Redundant Array of Independent Dists">RAID</abbr> por cada volumen lógico redundante.</p>
</li>
<li><p class="first">No todos los volúmenes lógicos tienen por qué ser dispositivos <abbr title="Redundant Array of Independent Dists">RAID</abbr>.</p>
</li>
<li><p class="first">Como dentro del grupo de volúmenes hay volúmenes lógicos redundantes y
volúmenes no redundantes, los volúmenes físicos que lo constituyan no tienen
que tener igual tamaño. Por ejemplo:</p>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Por hacer</p>
<p class="last">Hacer un esquema.</p>
</div>
<p>Por tanto, podemos no replicar las tablas de particiones en los restantes
discos físicos o incluso no hacer tablas de particiones en ellos. Esto hará
no arrancable esos discos, pero la solución será interesante de todas formas
si nuestro interés está en hacer más improbable la pérdida de algunos datos
o mejorar el rendimiento en el acceso y no tanto en asegurar la
disponibilidad del sistema.</p>
</li>
<li><p class="first">Alternativamente, podríamos hacer que todos los volúmenes lógicos fueran
redundantes. En es caso, los volúmenes físicos que constituyen el <abbr title="Redundant Array of Independent Dists">RAID</abbr> sí
sería acoonsejable que fueran iguales y, por tanto, tendríamos un caso
equivalente a la primera solución. Consecuentemente, podríamos particionar
de igual manera los discos y hacerlos todos arrancables.</p>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="preliminares">
<h1>5.4.2.1.3. Preliminares<a class="headerlink" href="#preliminares" title="Enlazar permanentemente con este título">¶</a></h1>
<p>Preparemos las particiones de un disco a semejanza de como el que preparamos
para <a class="reference internal" href="01.mdadm.html#mdadm"><span class="std std-ref">mdadm</span></a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> sgdisk -a <span class="m">8</span> -n <span class="s2">&quot;0:40:2047&quot;</span> -t <span class="s2">&quot;0:0xef02&quot;</span> -c <span class="s2">&quot;0:BOOTBIOS&quot;</span> <span class="se">\</span>
         -a <span class="m">2048</span> -n <span class="s2">&quot;0:2048:+50M&quot;</span> -t <span class="s2">&quot;0:0xef00&quot;</span> -c <span class="s2">&quot;0:EFI&quot;</span> <span class="se">\</span>
                 -N <span class="m">0</span> -c <span class="s2">&quot;3:LVM&quot;</span> -t <span class="s2">&quot;3:0x8e00&quot;</span> /dev/loop0
</pre></div>
</div>
<p>Para el segundo disco, podemos hacer dos cosas:</p>
<ol class="arabic simple">
<li>Copiar la tabla si nuestra intención es crear una solución equivalente a la
hecha con <a class="reference internal" href="01.mdadm.html#mdadm"><span class="std std-ref">mdadm</span></a>. En esta solución todos los volúmenes lógicos
son redundantes.</li>
<li>Añadir directamente el segundo disco al grupo de volúmenes, poque nuestra
intención es mezclas volúmenes redundantes con volúmenes que no lo son. En
este caso, sólo el primer disco será arrancable.</li>
</ol>
<p>Ilustramos la creación y gestión de <abbr title="Redundant Array of Independent Dists">RAID</abbr>s con esta segunda solución. Por
tanto:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> pvcreate /dev/loop0p3
<span class="gp">#</span> pvcreate /dev/loop1
<span class="gp">#</span> vgcreate VGraid /dev/loop0p3 /dev/loop1
<span class="gp">#</span> vgs VGraid
<span class="go">VG     #PV #LV #SN Attr   VSize   VFree</span>
<span class="go">VGraid   2   0   0 wz--n- 940,00m 940,00m</span>
</pre></div>
</div>
<p>Tenemos casi un grupo de volúmenes de casi 1GiB de capacidad. Lo que falta es,
descontados los metadatos, el espacio que ocupan las dos particiones de arranque
del primer disco.</p>
</div>
<div class="section" id="creacion">
<span id="index-1"></span><h1>5.4.2.1.4. Creación<a class="headerlink" href="#creacion" title="Enlazar permanentemente con este título">¶</a></h1>
<p>Para crear volúmenes lógicos redundantes, basta con usar <a class="reference internal" href="../01.division/03.virt.html#lvcreate"><span class="std std-ref">lvcreate</span></a>, aunque con las opciones adecuadas. Por ejemplo, empecemos procrear
un volumen no redundante:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> lvcreate -L 100M -n uno VGdebian
<span class="gp">#</span> vgs VGraid
<span class="go">  VG     #PV #LV #SN Attr   VSize   VFree</span>
<span class="go">  VGraid   2   1   0 wz--n- 940,00m 840,00m</span>
<span class="gp">#</span> lvs VGraid
<span class="go">  LV   VG     Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert</span>
<span class="go">  uno  VGraid -wi-a----- 100,00m</span>
</pre></div>
</div>
<p>Como es natural, ahora hay 100MiB libres menos.</p>
<p class="rubric">Notas al pie</p>
<table class="docutils footnote" frame="void" id="id3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Obviamente habrá al menos otros disco idéntico para que tenga sentido
cualquier tipo de <abbr title="Redundant Array of Independent Dists">RAID</abbr>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>Entiéndase por <em class="dfn">volumen lógico redundante</em> un volumen lógico que
contituye un <abbr title="Redundant Array of Independent Dists">RAID</abbr>, incluo aunque sea de nivel 0, el cual no es redundante.</td></tr>
</tbody>
</table>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">5.4.2.1.2. <abbr title="Logical Volume Management">LVM</abbr></a></li>
<li><a class="reference internal" href="#preliminares">5.4.2.1.3. Preliminares</a></li>
<li><a class="reference internal" href="#creacion">5.4.2.1.4. Creación</a></li>
</ul>

  <h4>Tema anterior</h4>
  <p class="topless"><a href="01.mdadm.html"
                        title="capítulo anterior">5.4.2.1.1. <strong class="command">mdadm</strong></a></p>
  <h4>Próximo tema</h4>
  <p class="topless"><a href="../06.grub/index.html"
                        title="próximo capítulo">5.5. Gestor de arranque</a></p>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/05.discos/05.raid/02.lvm.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Ir a" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="../06.grub/index.html" title="5.5. Gestor de arranque"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="01.mdadm.html" title="5.4.2.1.1. mdadm"
             >anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de ServidorLinux - 0.1.0</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >5. Gestión de discos</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >5.4. <abbr title="Redundant Array of Independent Disks">RAID</abbr>s</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Derechos de autor 2016, José Miguel Sánchez Alés.
      Creado con <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>