


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="es">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>5.1.3. Volúmenes lógicos &#8212; documentación de ServidorLinux - 0.1.0</title>
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../search.html" />
    <link rel="next" title="5.2. Cuotas" href="../03.cuotas/index.html" />
    <link rel="prev" title="5.1.2. Particiones" href="02.part.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="../03.cuotas/index.html" title="5.2. Cuotas"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="02.part.html" title="5.1.2. Particiones"
             accesskey="P">anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de ServidorLinux - 0.1.0</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >5. Gestión de discos</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">5.1. División del disco</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="volumenes-logicos">
<span id="lvm"></span><h1>5.1.3. Volúmenes lógicos<a class="headerlink" href="#volumenes-logicos" title="Enlazar permanentemente con este título">¶</a></h1>
<p>A diferencia de otros como <a class="reference external" href="https://es.wikipedia.org/wiki/ZFS_(sistema_de_archivos)">zfs</a> o <a class="reference external" href="https://es.wikipedia.org/wiki/Btrfs">btrfs</a>, <em>ext4</em> no soporta nativamente la
gestión de volúmenes lógicos. Sin embargo, podemos manejar discos y particiones
virtuales, ayudándonos de un <em>software</em> adicional llamado <abbr title="Logical Volume Management">LVM</abbr>. Las
<strong>ventajas</strong> de su uso, ya se han establecido en epígrafes anteriores:</p>
<ul>
<li><p class="first">Permite agrandar indiscriminadamente el disco: basta con comprar un nuevo
disco físico e incluirlo como integrante del disco virtual.</p>
<img alt="../../_images/1+1disks.png" src="../../_images/1+1disks.png" />
</li>
<li><p class="first">Permite agrandar indiscriminadamente las particiones sin cuidarse de que el
espacio que constituye la partición deba ser contiguo. Cuando tratamos
particiones físicas, ampliar una partición es todo un engorro, sobre todo si
está encajonada entre otras dos particiones. Por ejemplo, ampliar en el
siguiente gráfico <code class="file docutils literal notranslate"><span class="pre">sda3</span></code>, implica también mover <code class="file docutils literal notranslate"><span class="pre">sda4</span></code>:</p>
<img alt="../../_images/ampl-part.png" src="../../_images/ampl-part.png" />
</li>
</ul>
<p>Logramos, por tanto, muchísima más versatilidad que usando particiones fisicas.
En contraprestación, hay una <strong>desventaja</strong> evidente: las particiones lógicas
sólo son visibles con el <em>software</em> de <abbr title="Logical Volume Management">LVM</abbr>.</p>
<p class="rubric">Definiciones</p>
<p>Antes de pasar a exponer cómo crear y manejar volúmenes lógicos, es pertinente
fijar el significado de algunos términos que se usarán en la exposición:</p>
<dl class="docutils">
<dt><strong>Volúmen físico</strong> (<abbr title="Physical Volume">PV</abbr>)</dt>
<dd>Son las particiones físicas o incluso discos físicos completos sobre las que
se definen los discos virtuales.</dd>
<dt><strong>Grupo de volúmenes</strong> (<abbr title="Volume Group">PV</abbr>)</dt>
<dd>Es el conjunto de volúmenes físicos que conforma un disco virtual.</dd>
<dt><strong>Volúmenes lógicos</strong> (<abbr title="Logical Volume">LV</abbr>)</dt>
<dd>Es el dispoitivo virtual de bloques que alberga un sistemas de ficheros, esto
es, lo que hemos venido definiendo como <em>partición virtual</em> a lo largo de
nuestra exposición.</dd>
</dl>
<p>En la tarea de constituir volúmenes lógicos:</p>
<ul class="simple">
<li>Deben definirse cuáles son los volúmenes físicos.</li>
<li>Deben definirse cómo se agrupan esos volúmenes físicos en grupos de volúmenes.
Lo habitual es que haya un grupo de volúmenes.</li>
<li>Debe particionarse cada grupo de volúmenes en volúmenes logicos.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Es importante tener presente que <abbr title="GRand Unified Bootloader">GRUB</abbr> soporta <abbr title="Logical Volume Management">LVM</abbr> y, por tanto, es
capaz de arrancar un <em>Linux</em> aunque los ficheros de su fase 3 y el kernel se
encuentren dentro de volúmenes lógicos.</p>
</div>
<p>Es muy probable que el <em>software</em> para gestionar volúmenes lógicos ya se
encuentre instalado, pero si no es así:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> apt install lvm2
</pre></div>
</div>
<div class="section" id="creacion">
<h2>5.1.3.1. Creación<a class="headerlink" href="#creacion" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Dentro del grupo de volúmenes podemos incluir todas las particiones que deseemos
crear, excepto aquellas necesarias para el arranque del disco. Por tanto, un
particionado físico del disco apropiado para crear volúmenes lógicos puede ser
el siguiente:</p>
<img alt="../../_images/part-lvm.png" src="../../_images/part-lvm.png" />
<p>que usando <a class="reference internal" href="02.part.html#sgdisk"><span class="std std-ref">sgdisk</span></a> puede realizarse de esta forma:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sgdisk -a <span class="m">8</span> -n <span class="s2">&quot;0:40:2047&quot;</span> -t <span class="s2">&quot;0:0xef02&quot;</span> -c <span class="s2">&quot;0:BOOTBIOS&quot;</span> <span class="se">\</span>
         -a <span class="m">2048</span> -n <span class="s2">&quot;0:2048:+50M&quot;</span> -t <span class="s2">&quot;0:0xef00&quot;</span> -c <span class="s2">&quot;0:EFI&quot;</span> <span class="se">\</span>
         -N <span class="m">0</span> -t <span class="s2">&quot;3:0x8e00&quot;</span> -c <span class="s2">&quot;3:LVM&quot;</span> /tmp/disco.raw
</pre></div>
</div>
<p>de forma que creamos las dos particiones necesarias para el arranque aparte,
y una tercera partición destinanda a ser el volumen físico que constituya el
grupo de volúmenes.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Por supuesto, podemos crear volúmenes lógicos partiendo también de un
particionado <abbr title="Disk Operating System">DOS</abbr></p>
</div>
<p>Como estamos particionando un fichero, no podemos acceder
directamente a sus particiones como sí sería posible si particionáramos un disco
(p.e. de <code class="file docutils literal notranslate"><span class="pre">/dev/sda</span></code> aparecerían <code class="file docutils literal notranslate"><span class="pre">/dev/sda1</span></code>, file:<cite>/dev/sda2</cite>,
etc.). Para hacerlas accesibles es necesario asegurarse de que está cargado el
módulo <em>loop</em>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> modprobe loop
</pre></div>
</div>
<p>y usar <strong class="command">losetup</strong> para asociar/desasociar el fichero a un dispositivo de
bucle:</p>
<span class="target" id="losetup"></span><div class="highlight-console notranslate" id="index-0"><div class="highlight"><pre><span></span><span class="gp">#</span> losetup /dev/loop0 /tmp/disco.raw
<span class="gp">#</span> losetup
<span class="go">NAME       SIZELIMIT OFFSET AUTOCLEAR RO BACK-FILE      DIO LOG-SEC</span>
<span class="go">/dev/loop0         0      0         0  0 /tmp/disco.raw   0     512</span>
<span class="gp">#</span> losetup -d /dev/loop0
</pre></div>
</div>
<p>Con todo, asociar el fichero al dispositivo no provoca que aparezcan las
particiones, para ello es necesario usar <strong class="command">partx</strong></p>
<span class="target" id="partx"></span><div class="highlight-console notranslate" id="index-1"><div class="highlight"><pre><span></span><span class="gp">#</span> partx -a /dev/loop0
<span class="gp">#</span> ls -1 /dev/loop0*
<span class="go">/dev/loop0</span>
<span class="go">/dev/loop0p1</span>
<span class="go">/dev/loop0p2</span>
<span class="go">/dev/loop0p3</span>
<span class="gp">#</span> partx -d /dev/loop0
<span class="gp">#</span> ls -1 /dev/loop0*
<span class="go">/dev/loop0</span>
</pre></div>
</div>
<p>Hecho el particionado y expuestas las particiones, lo primero es declarar que la
tercera partición es un volumen físico:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> pvcreate /dev/loop0p3
</pre></div>
</div>
<p>tras lo cual ya puede constituirse un grupo de volúmenes llamado «VGdebian» con
este volumen físico:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> vgcreate VGdebian /dev/loop0p3
<span class="gp">#</span> vgs VGdebian
<span class="go">  VG       #PV #LV #SN Attr   VSize    VFree</span>
<span class="go">  VGdebian   1   0   0 wz--n-  &lt;19,95g &lt;19,95g</span>
</pre></div>
</div>
<p>Esta última acción permite empezar a crear particiones lógicas con la orden
<strong class="command">lvcreate</strong>. Por ejemplo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> lvcreate -L 2G VGdebian -n primera
<span class="gp">#</span> lvcreate -L 5G VGdebian -n segunda
<span class="gp">#</span> vgs VGdebian
<span class="go">  VG       #PV #LV #SN Attr   VSize    VFree</span>
<span class="go">  VGdebian   1   0   0 wz--n-  &lt;19,95g &lt;12,95g</span>
<span class="gp">#</span> lvs VGdebian
<span class="go">  LV      VG    Attr       LSize Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert</span>
<span class="go">  primera VGxxx -wi-a----- 2,00g</span>
<span class="go">  segunda VGxxx -wi-a----- 5,00g</span>
</pre></div>
</div>
<p>Estas acciones han particionado 7 de los 20GB del grupo de volúmenes y crean dos
dispostivos virtuales, <code class="file docutils literal notranslate"><span class="pre">/dev/VGdebian/primera</span></code> y
<code class="file docutils literal notranslate"><span class="pre">/dev/VGdebian/segunda</span></code> que podemos tratar como si de particiones fisicas
se tratasen. Por ejemplo, podemos dotarlas de un sistema de ficheros:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> mkfs.ext4 -L PRIMERA /dev/VGdebian/primera
<span class="gp">#</span> mkfs.ext4 -L SEGUNDA /dev/VGdebian/primera
</pre></div>
</div>
</div>
<div class="section" id="disponibilidad">
<h2>5.1.3.2. Disponibilidad<a class="headerlink" href="#disponibilidad" title="Enlazar permanentemente con este título">¶</a></h2>
</div>
<div class="section" id="consulta">
<h2>5.1.3.3. Consulta<a class="headerlink" href="#consulta" title="Enlazar permanentemente con este título">¶</a></h2>
</div>
<div class="section" id="modificacion">
<h2>5.1.3.4. Modificación<a class="headerlink" href="#modificacion" title="Enlazar permanentemente con este título">¶</a></h2>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">5.1.3. Volúmenes lógicos</a><ul>
<li><a class="reference internal" href="#creacion">5.1.3.1. Creación</a></li>
<li><a class="reference internal" href="#disponibilidad">5.1.3.2. Disponibilidad</a></li>
<li><a class="reference internal" href="#consulta">5.1.3.3. Consulta</a></li>
<li><a class="reference internal" href="#modificacion">5.1.3.4. Modificación</a></li>
</ul>
</li>
</ul>

  <h4>Tema anterior</h4>
  <p class="topless"><a href="02.part.html"
                        title="capítulo anterior">5.1.2. Particiones</a></p>
  <h4>Próximo tema</h4>
  <p class="topless"><a href="../03.cuotas/index.html"
                        title="próximo capítulo">5.2. Cuotas</a></p>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/05.discos/01.division/03.virt.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Ir a" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="../03.cuotas/index.html" title="5.2. Cuotas"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="02.part.html" title="5.1.2. Particiones"
             >anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de ServidorLinux - 0.1.0</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >5. Gestión de discos</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >5.1. División del disco</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Derechos de autor 2016, José Miguel Sánchez Alés.
      Creado con <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>