


<!DOCTYPE html>

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>5.8. Recuperación de datos &#8212; documentación de Linuxnomicón - rolling</title>
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/translations.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../search.html" />
    <link rel="next" title="5.9. Instalación del servidor" href="../10.instalacion/index.html" />
    <link rel="prev" title="5.7. Diagnóstico" href="../07.diagn/index.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="../10.instalacion/index.html" title="5.9. Instalación del servidor"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="../07.diagn/index.html" title="5.7. Diagnóstico"
             accesskey="P">anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U"><span class="section-number">5. </span>Dispositivos de almacenamiento</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">5.8. </span>Recuperación de datos</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="recuperacion-de-datos">
<span id="rec-filesystem"></span><h1><span class="section-number">5.8. </span>Recuperación de datos<a class="headerlink" href="#recuperacion-de-datos" title="Enlazar permanentemente con este título">¶</a></h1>
<p>Divideros este epígrafe sobre recuperación de datos en tres partes:</p>
<ul class="simple">
<li><p>La recuperación de particiones.</p></li>
<li><p>La recuperación de sistemas de archivos.</p></li>
<li><p>La recuperación de archivos borrados accidentalmente.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Los dos últimos apartados los centraremos en ext4.</p>
</div>
<div class="section" id="particiones">
<span id="testdisk"></span><h2><span class="section-number">5.8.1. </span>Particiones<a class="headerlink" href="#particiones" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Por hacer</p>
<p>Tratar de la recuperación de particiones con testdisk.</p>
</div>
</div>
<div class="section" id="sistemas-de-archivos">
<h2><span class="section-number">5.8.2. </span>Sistemas de archivos<a class="headerlink" href="#sistemas-de-archivos" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Hay diversas circunstancias por las que un sistema de archivos puede quedar
dañado y es precisa su reparación:</p>
<ol class="loweralpha simple">
<li><p>Cierre sucio del sistema (p.e. un corte súbito del suministro eléctrico).</p></li>
<li><p>Daño en algún sector del disco que impida su lectura.</p></li>
</ol>
<p id="e2fsck"><span id="index-0"></span>Si el problema se debió al <strong>apagado brusco</strong>, pero el sistema dispone de
<em>journaling</em> (ext3, ext4), entonces es probable que el sistema detecte el
problema, pero se recupere automáticamente completando las operaciones
pendientes gracias precisamente al <em>journaling</em>. En ext2, que carece de él, esto
no sucedía y era preciso recurrir a la comprobación manual del sistema:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> e2fsck -p /dev/sdz5
</pre></div>
</div>
<p>suponiendo que <code class="file docutils literal notranslate"><span class="pre">/dev/sdz5</span></code> sea la partición en la que queremos hacer la
comprobación y corregir errores.</p>
<p>En cambio, cuando el problema se debe al <strong>daño de un sector físico</strong>, ese
supondrá que habremos perdido la información contenida en él y el sistema se
negará a montarse. Hay que distinguir en este caso:</p>
<ul class="simple">
<li><p>Que este daño afecte al superbloque.</p></li>
<li><p>Que este daño afecte a otros bloques.</p></li>
</ul>
<div class="section" id="bloques-danados">
<span id="bloques-datos-danados"></span><h3><span class="section-number">5.8.2.1. </span>Bloques dañados<a class="headerlink" href="#bloques-danados" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En este caso deberemos proceder a una reparación manual, aunque se puede perder
información en la operación:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> es2fsck -y /dev/sdz5
</pre></div>
</div>
<p>En esta orden, <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate"></kbd>-<kbd class="kbd docutils literal notranslate">y</kbd></kbd> asume que diremos siempre que sí a cualquier sugerencia
de corrección que se nos plantee. Tras la reparación es posible que en el
directorio <code class="file docutils literal notranslate"><span class="pre">lost+found</span></code> aparezca archivos recuperados por la operación.</p>
</div>
<div class="section" id="superbloque-danado">
<span id="id2"></span><h3><span class="section-number">5.8.2.2. </span>Superbloque dañado<a class="headerlink" href="#superbloque-danado" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Cuando el superbloque está dañado, no hay nada que hacer con el sistema de
archivos, ya que éste contiene la información necesaria para poder entender.
Afortunadamente, como esto supone una gran debilidad, al crearse el sistema de
archivos se hacen varias copias del superbloque en previsión de que éste se
dañoe, y la forma de sortear el problema es recurrir a una de estas copias.</p>
<p>Lo primero es averiguar dónde están esas copias para lo cual podemos fingir que
damos formato a la partición, pero sin llegar a hacerlo realmente (opción
<kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate"></kbd>-<kbd class="kbd docutils literal notranslate">n</kbd></kbd>):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> mke2fs -n /dev/sdz5
<span class="go">[...]</span>
<span class="go">Superblock backups stored on blocks:</span>
<span class="go">32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208</span>
</pre></div>
</div>
<p>Tras lo cual, comprobamos y corregimos el sistema con <a class="reference internal" href="#e2fsck"><span class="std std-ref">e2fsck</span></a>,
pero indicando cuál es la primera copia del superbloque:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> e2fsck -b <span class="m">32768</span> /dev/sdz5
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Este procedimiento funcionará si al crear el sistema de archivos no se
intrudujo ninguna opción que modificara las opciones predeterminadas con que
se crea (p.e. el tamaño de bloque).</p>
</div>
<div class="admonition-todo admonition" id="id3">
<p class="admonition-title">Por hacer</p>
<p>Probar <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate">mke2fs</kbd> <kbd class="kbd docutils literal notranslate"></kbd>-<kbd class="kbd docutils literal notranslate">B</kbd> <kbd class="kbd docutils literal notranslate">4k</kbd> <kbd class="kbd docutils literal notranslate">/dev/sdz5</kbd></kbd> para comprobar si se encuentra la
copia del superbloque introduciendo el tamaño del bloque.</p>
</div>
</div>
</div>
<div class="section" id="archivos-borrados">
<h2><span class="section-number">5.8.3. </span>Archivos borrados<a class="headerlink" href="#archivos-borrados" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="admonition-todo admonition" id="id4">
<p class="admonition-title">Por hacer</p>
<p>Recuperar fichero borrados accidentalmente (extundelete, ext4magic,
ext3grep)</p>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Tabla de contenido</a></h3>
  <ul>
<li><a class="reference internal" href="#">5.8. Recuperación de datos</a><ul>
<li><a class="reference internal" href="#particiones">5.8.1. Particiones</a></li>
<li><a class="reference internal" href="#sistemas-de-archivos">5.8.2. Sistemas de archivos</a><ul>
<li><a class="reference internal" href="#bloques-danados">5.8.2.1. Bloques dañados</a></li>
<li><a class="reference internal" href="#superbloque-danado">5.8.2.2. Superbloque dañado</a></li>
</ul>
</li>
<li><a class="reference internal" href="#archivos-borrados">5.8.3. Archivos borrados</a></li>
</ul>
</li>
</ul>

  <h4>Tema anterior</h4>
  <p class="topless"><a href="../07.diagn/index.html"
                        title="capítulo anterior"><span class="section-number">5.7. </span>Diagnóstico</a></p>
  <h4>Próximo tema</h4>
  <p class="topless"><a href="../10.instalacion/index.html"
                        title="próximo capítulo"><span class="section-number">5.9. </span>Instalación del servidor</a></p>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/05.discos/08.recup/index.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Ir a" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="../10.instalacion/index.html" title="5.9. Instalación del servidor"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="../07.diagn/index.html" title="5.7. Diagnóstico"
             >anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" ><span class="section-number">5. </span>Dispositivos de almacenamiento</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">5.8. </span>Recuperación de datos</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Derechos de autor CC BY 4.0, 2016-2020, José Miguel Sánchez Alés.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
  </body>
</html>