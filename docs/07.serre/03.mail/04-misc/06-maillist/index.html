


<!DOCTYPE html>

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <title>7.3.5.6. Listas de correo &#8212; documentación de Linuxnomicón - rolling</title>
    <link rel="stylesheet" href="../../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/language_data.js"></script>
    <script src="../../../../_static/translations.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Índice" href="../../../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../../../search.html" />
    <link rel="next" title="7.4. Redes VPN" href="../../../04.vpn/index.html" />
    <link rel="prev" title="7.3.5.5. Servicio de webmail" href="../04-webmail/index.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="../../../04.vpn/index.html" title="7.4. Redes VPN"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="../04-webmail/index.html" title="7.3.5.5. Servicio de webmail"
             accesskey="P">anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" ><span class="section-number">7. </span>Servicios de red</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../index.html" ><span class="section-number">7.3. </span>Correo electrónico</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" accesskey="U"><span class="section-number">7.3.5. </span>Otros aspectos</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="listas-de-correo">
<span id="mlmmj"></span><h1><span class="section-number">7.3.5.6. </span>Listas de correo<a class="headerlink" href="#listas-de-correo" title="Enlazar permanentemente con este título">¶</a></h1>
<p>Una <em class="dfn">lista de correo</em> (también <em class="dfn">lista de distribución</em>) es un uso
particular del correo electrónico que permite la distribución de mensajes
electrónicos a varios destinatarios a la vez, llamados <em class="dfn">suscriptores</em>. Con
ella, cualquier mensaje enviado a la dirección de la lista es dirigido a todas
las direcciones de los suscriptores de la misma. Es, pues, un buen método para
crear foros de debate junto a:</p>
<ul class="simple">
<li><p>Los foros <em>web</em>.</p></li>
<li><p>Los <a class="reference external" href="https://es.wikipedia.org/wiki/Grupo_de_noticias">grupos de noticias</a>,
en franco declive desde hace más de una década.</p></li>
</ul>
<p>De manera muy resumida una <em>lista de distribución</em> ofrece:</p>
<ul class="simple">
<li><p>Una dirección de correo (la dirección de la lista) a la cual se envían los
mensajes que se quiere distribuir a través de ella. Lo habitual es que los
suscriptores vean en los mensajes la dirección real del remitente.</p></li>
<li><p>Una serie de direcciones asociadas que permiten realizar tareas
relacionadas con la propia lista: suscripción, desuscripción, pedir ayuda
sobre el funcionamiento, etc.</p></li>
<li><p>Más o menos libertad para el envío de mensajes: en algunos listas sólo pueden
enviar mensajes los suscriptores, otras está moderadas y sólo distribuyen
mensajes tras la aprobación del moderador, etc.</p></li>
<li><p>Tres modos de participación a los que puede optar cada suscriptor:</p>
<ul>
<li><p>aquel en que todo mensaje es enviado individualmente al suscriptor.</p></li>
<li><p>aquel en que el suscriptor recibe un solo mensaje que contiene todos los
mensajes remitidos a la lista en un determinado periodo; modo que suele
denominarse <em>modo digest</em>.</p></li>
<li><p>aquel en que no se remite mensaje alguno. Por lo general, se habilita algún
mecanismo adicional de consulta (una página web, por ejemplo) y se espera
que el suscriptor recurra a él.</p></li>
</ul>
</li>
<li><p>Opcionalmente, un modo de consultar el archivo histórico de mensajes enviados.
Esto suele hacerse a través de una interfaz web.</p></li>
</ul>
<p>En nuestro caso, trataremos la instalación del gestor de listas <a class="reference external" href="http://mlmmj.org/">mlmmj (Mailing
List Management Made Joyful)</a>, que, aunque no es el
software más extendido<a class="footnote-reference brackets" href="#id6" id="id1">1</a>, no requiere excesivas dependecias (básicamente un
<abbr title="Simple Mail Transfer Protocol">SMTP</abbr> y la librería básica de <strong>C</strong>) y lo usa <a class="reference external" href="https://www.gentoo.org/get-involved/mailing-lists/instructions.html">la propia Gentoo para dar
soporte a sus usuarios</a>.</p>
<div class="section" id="direccion-de-la-lista">
<h2><span class="section-number">7.3.5.6.1. </span>Dirección de la lista<a class="headerlink" href="#direccion-de-la-lista" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Antes de empezar la instalación es importante dejar sentado cuáles serán las
direcciones de las listas que gestionaremos<a class="footnote-reference brackets" href="#id7" id="id2">2</a>. Obviamente, para que el
mensaje llegue a nuestro <abbr title="Simple Mail Transfer Protocol">SMTP</abbr>, la dirección de la cuenta debe pertenecer al
dominio (o dominios, si son varios) que gestione éste. Tenemos tres
posibilidades:</p>
<ol class="arabic simple">
<li><p>Dedicar un dominio exclusivo e independiente para la lista, por ejemplo,
<em>nombrelista&#64;mislistas.org</em>.</p></li>
<li><p>Dedicar un subdominio exclusivo para la lista que es, básicamente, el mismo
caso que el anterior, pero sin gastar dinero en contratar un dominio extra.
Por ejemplo: <em>nombrelista&#64;ml.mail1.org</em>.</p></li>
<li><p>Usar el mismo dominio que dedicamos a cuentas de usuario y reservar ciertas
direcciones como direcciones de lista. Lo más apropiado en este caso es que
los nombres de las direcciones de las cuentas sigan un determinado patrón.
Por ejemplo: <em>ml-nombrelista&#64;mail1.org</em>.</p></li>
</ol>
<p>Emtre el primero y el segundo caso no hay diferencia alguna de implementación, y
es ciertamente lo conveniente. El tercer caso sólo deberíamos implementarlo si
no tuviéramos posibilidad de crear subdominios en nuestro dominio propio<a class="footnote-reference brackets" href="#id8" id="id3">3</a> o
careciéramos de dinero para contratar uno exclusivo.</p>
<p>En realidad, una única lista tiene distintas direcciones de correo:</p>
<ul class="simple">
<li><p><em>test&#64;ml.mail1.org</em>, a la que se envían mensajes.</p></li>
<li><p><em>test+subscribe&#64;ml.mail1.org</em>, a la que se envían peticiones de suscripción.</p></li>
<li><p><em>test+desubscribe&#64;ml.mail1.org</em>, a la que se envían las peticiones de baja.</p></li>
<li><p><em>test+help&#64;ml.mail1.org</em>, a la que se piden las <abbr title="Frequently Answered Questions">FAQ</abbr> de la lista.</p></li>
<li><p>etc.</p></li>
</ul>
<p>Para distinguirlas se añade una palabra detrás del signo «+» y, como este signo
suele utilizarlo el servidor de correo como delimitador:</p>
<div class="highlight-apache notranslate"><div class="highlight"><pre><span></span><span class="nb">recipient_delimiter</span> = +
</pre></div>
</div>
<p>todas las direcciones está asociadas a la misma cuenta.</p>
</div>
<div class="section" id="instalacion">
<h2><span class="section-number">7.3.5.6.2. </span>Instalación<a class="headerlink" href="#instalacion" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Como disponemos de paquete en <em>debian</em>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> apt install mlmmj
</pre></div>
</div>
<p>Añadiremos, además, un usuario exclusivo para el programa que no crea
automáticamente la instalación:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> adduser --system --ingroup nogroup mlmmj
</pre></div>
</div>
</div>
<div class="section" id="integracion-en-postfix">
<h2><span class="section-number">7.3.5.6.3. </span>Integración en <strong class="program">postfix</strong><a class="headerlink" href="#integracion-en-postfix" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Debemos añadir el gestor de listas como un <em>transporte</em>, para lo cual
añadiremos al final de <code class="file docutils literal notranslate"><span class="pre">/etc/postfix/main.cf</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mlmmj   unix  -       n       n       -       -       pipe</span>
<span class="go">   flags=ORhu user=mlmmj argv=/usr/bin/mlmmj-receive -F -L /var/spool/mlmmj/$nexthop</span>
</pre></div>
</div>
<p>El último paso es hacer que los correos dirigidos a la lista usen este
transporte. La configuración diferirá ligeramente dependiendo de si hemos
separado las listas en un dominio aparte o no.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Debemos confirmar que no hemos cambiado la configuración
predeterminada:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> postconf <span class="p">|</span> grep -E <span class="s1">&#39;^(recipient_delimiter|propagate_unmatched_extensions)&#39;</span>
<span class="go">recipient_delimiter = +</span>
<span class="go">propagate_unmatched_extensions = canonical, virtual</span>
</pre></div>
</div>
</div>
<dl>
<dt>Dominio <strong>separado</strong></dt><dd><p>Basta con añadir el dominio a los dominios virtuales y aplicarle el
transporte, para lo cual editamos <code class="file docutils literal notranslate"><span class="pre">/etc/postfix/main.cf</span></code>:</p>
<div class="highlight-apache notranslate"><div class="highlight"><pre><span></span><span class="nb">mlmmj_destination_recipient_limit</span> = <span class="m">1</span>
<span class="nb">virtual_mailbox_domains</span> = ml.mail1.org
<span class="nb">transport_maps</span> = hash:/etc/postfix/tb/mlmmj-transport
<span class="c"># Para que se rechacen mensajes a @ml.mail1.org no dirigidos a las listas</span>
<span class="nb">virtual_mailbox_maps</span> = hash:/etc/postfix/tb/mlmm-transport
</pre></div>
</div>
<p>donde <code class="file docutils literal notranslate"><span class="pre">/etc/postfix/tb/mlmmj-transport</span></code> quedará ahora mismo vacío hasta
que creemos alguna lista:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> touch /etc/postfix/tb/mlmmj-transport
</pre></div>
</div>
<p>La última directiva tiene la utilidad de hacer que <strong class="program">postfix</strong>
rechace en la propia comunicación <abbr title="Simple Mail Transfer Protocol">SMTP</abbr> mensajes a cuentas del subdominio
<em>ml.mail1.org</em> que no sean las de las listas de distribución.</p>
</dd>
<dt>En el <strong>mismo</strong> dominio</dt><dd><p>Procuraremos que todas las direcciones tengan la forma
<em>ml-nombrelista&#64;mail1.org</em>, aunque no es obligatorio. La configuración es
esta, suponiendo que <em>mail1.org</em> esté incluido en <a class="reference external" href="http://www.postfix.org/postconf.5.html#mydestination">mydestination</a>:</p>
<div class="highlight-apache notranslate"><div class="highlight"><pre><span></span><span class="nb">local_recipient_maps</span> = proxy:unix:passwd.byname $alias_maps hash:/etc/postfix/tb/mlmmj-transport
<span class="nb">mlmmj_destination_recipient_limit</span> = <span class="m">1</span>
<span class="nb">transport_maps</span> = hash:/etc/postfix/tb/mlmmj-transport
</pre></div>
</div>
<p>es decir, hemos añadido las direcciones de las listas a <a class="reference external" href="http://www.postfix.org/postconf.5.html#local_recipient_maps">local_recipient_maps</a>
para que <strong class="program">postfix</strong> no considere que estas direcciones no existen y
ahora deberíamos definirlas en <code class="file docutils literal notranslate"><span class="pre">/etc/postfix/tb/mlmmj-transport</span></code> junto
al transporte que usará cada una. Por ahora dejaremos vacío el fichero:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> touch /etc/postfix/tb/mlmmj-transport
<span class="gp">#</span> postmap /etc/postfix/tb/mlmmj-transport
</pre></div>
</div>
<p>a la espera de irlo llenando según vayamos creando las listas.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Puede usarse en vez de <a class="reference external" href="http://www.postfix.org/postconf.5.html#transport_maps">transport_maps</a> la directiva
<a class="reference external" href="http://www.postfix.org/postconf.5.html#mailbox_transport_maps">mailbox_transport_maps</a>, pero en ese caso las direcciones de la columna
izquierda en <code class="file docutils literal notranslate"><span class="pre">/etc/postfix/tb/mlmmj-transport</span></code> (vea en el siguiente
epígrafe cómo es su contenido) no podrán contener el dominio, ya que en las
<a class="reference internal" href="../../02-smtp/03-entrega.html#postfix-aliases"><span class="std std-ref">tablas alias</span></a> es así. Eso supone que si gestionamos
varios dominios todas las cuentas con nombre «ml-*» estarán asociadas a las
listas con independencia del dominio que se añada a tal nombre, lo cual puede
interesar o no.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">Ver también</p>
<p>Tanto <a class="reference external" href="http://blog.tremily.us/posts/mlmmj/">este artículo de blog</a> como el <a class="reference external" href="http://mlmmj.org/docs/readme-postfix/">README oficial de mlmmj
sobre postfix</a> exponen una
configuración alternativa basada en el uso de un dominio virtual interno.</p>
</div>
</div>
<div class="section" id="creacion-de-listas">
<h2><span class="section-number">7.3.5.6.4. </span>Creación de listas<a class="headerlink" href="#creacion-de-listas" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Preparado <strong class="program">postfix</strong>, sólo queda definir la lista (o listas) que
gestionará <strong class="program">mlmmj</strong>. Suponiendo que nuestra primera lista se llame
<em>test</em>, podemos ejecutar:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> mlmmj-make-ml -L <span class="nb">test</span> -c mlmmj
</pre></div>
</div>
<p>que creará una lista de tal nombre en el directorio
<code class="file docutils literal notranslate"><span class="pre">/var/spool/mlmmj/test</span></code> y hará propietario de ésta al usuario mlmmj.</p>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Tenga en cuenta que, si usa el mismo dominio para definir listas y
usuarios y ha seguido el consejo de nombrar a las listas con el prefijo
<em>ml-</em>, la dirección de la lista será <em>ml-test&#64;mail1.org</em> y no
<em>test&#64;mail1.org</em>. Como la orden anterior sólo nos pregunta cuál es el
dominio, presupondrá que la dirección es <em>test&#64;mail1.org</em> y esa es la que
escribirá en <code class="file docutils literal notranslate"><span class="pre">/var/spool/mlmmj/test/control/listaddress</span></code>. Deberemos, a
mano, cambiar este valor.</p>
</div>
<p>Además es necesario añadir la lista a la tabla de transporte
<code class="file docutils literal notranslate"><span class="pre">/etc/postfix/tb/mlmmj-transport</span></code><a class="footnote-reference brackets" href="#id9" id="id4">4</a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> cat &gt;&gt; /etc/postfix/tb/mlmmj-transport
<span class="go">test@ml.mail1.org          mlmmj:test</span>
<span class="gp">#</span> postmap /etc/postfix/tb/mlmmj-transport
</pre></div>
</div>
<p>o bien, si no usamos un dominio exclusivo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> cat &gt;&gt; /etc/postfix/tb/mlmmj-transport
<span class="go">ml-test@mail1.org         mlmmj:test</span>
<span class="gp">#</span> postmap /etc/postfix/tb/mlmmj-transport
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>En este segundo caso, si la definición del transporte la hicimos con
<a class="reference external" href="http://www.postfix.org/postconf.5.html#mailbox_transport_maps">mailbox_transport_maps</a>, deberemos eliminar la expresión del dominio:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> cat &gt;&gt; /etc/postfix/tb/mlmmj-transport
<span class="go">ml-test         mlmmj:test</span>
<span class="gp">#</span> postmap /etc/postfix/tb/mlmmj-transport
</pre></div>
</div>
</div>
</div>
<div class="section" id="configuracion-minima">
<h2><span class="section-number">7.3.5.6.5. </span>Configuración mínima<a class="headerlink" href="#configuracion-minima" title="Enlazar permanentemente con este título">¶</a></h2>
<p>En puridad, ya está montada la lista, aunque es posible que nos resulte
conveniente modificar su configuración predeterminada ya que, en principio, es
de suscripción libre, no tiene moderados sus mensajes ni moderadores, etc. La
configuración puede modificarse añadiendo ficheros dentro del subdirectorio
<code class="file docutils literal notranslate"><span class="pre">control/</span></code> del directorio que define la lista, y se describe en <a class="reference external" href="http://mlmmj.org/docs/tunables/">la página
al respecto de la documentación de mlmmj</a>.
Una configuración adecuada puede ser la siguiente:</p>
<ol class="arabic">
<li><p>Que la lista añada al asunto de todos los mensajes enviados a ella un prefijo
identificativo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> <span class="nb">echo</span> <span class="s2">&quot;[Test] &quot;</span> &gt;&gt; /var/spool/mlmmj/test/control/prefix
</pre></div>
</div>
</li>
<li><p>Que se elimine la cabecera <em>Reply-To</em> del mensaje original, puesto que las
replicas deberían enviarse a la propia lista:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> cat &gt; /var/spool/mlmmj/test/control/delheaders
<span class="go">Reply-To:</span>
</pre></div>
</div>
</li>
<li><p>Que se añada automáticamente un campo <em>List-Id</em> que identifica la lista:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> <span class="nb">echo</span> <span class="s2">&quot;List-Id: test.ml.mail1.org&quot;</span> &gt; /var/spool/mlmmj/test/control/customheaders
</pre></div>
</div>
</li>
<li><p>Que se añada un pie a todos los mensajes enviados a la lista para que los
destinatarios conozcan cómo pueden darse de baja, etc:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> cat &gt; /var/spool/mlmmj/test/control/footer
<span class="go">--</span>
<span class="go">Para saber cómo usar la lista (darse de baja, pedir mensajes</span>
<span class="go">anteriores, etc) envíe un mensaje a test+help@ml.mail1.org</span>
</pre></div>
</div>
</li>
<li><p>Que el remitente del mensaje, no reciba una copia de su propio mensaje:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> touch /var/spool/mlmmj/test/control/notmetoo
</pre></div>
</div>
</li>
<li><p>Que solo puedan escribir a la lista, los suscritos a ella:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> touch /var/spool/mlmmj/test/control/subonlypost
</pre></div>
</div>
</li>
<li><p>Definir quién es el propietario (o propietarios) de la lista. La creación de
la lista ya debería haber preguntado por ello y esto no ser necesario:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> <span class="nb">echo</span> <span class="s1">&#39;listadmin-test@mail1.org&#39;</span> &gt;&gt; /var/spool/mlmmj/test/control/owner
</pre></div>
</div>
<p>Esta dirección es a la que se remiten los mensajes enviados a
<em>test+owner&#64;ml.mail1.org</em>. Obviamente, tiene que ser una dirección válida
(p.e. la cuenta virtual de algún usuario).</p>
</li>
</ol>
</div>
<div class="section" id="gestion">
<h2><span class="section-number">7.3.5.6.6. </span>Gestión<a class="headerlink" href="#gestion" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Creada una lista, hay tres formas de gestionarla:</p>
<ol class="arabic">
<li><p>A través de la <strong>línea de comandos</strong>, podemos dar de alta o baja usuarios.
Por ejemplo, esto suscribe a un usuario a la lista:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> /usr/bin/mlmmj-sub -L /var/spool/mlmmj/test -a interesado@yahoo.es
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Se suscribe al usuario a la modalidad en que se recibe
individualmente cada mensaje enviado a la lista. Para suscribirlo en modo
<em>digest</em>, hay una opción, pero primero sería conveniente que definiera cuál
es el intervalo de envío y el número máximo de mensajes por envío a través
de la <a class="reference external" href="http://mlmmj.org/docs/tunables/">configuración con el subdirectorio control/</a>.</p>
</div>
</li>
<li><p>A través de <strong>mensajes a la propia lista</strong>. En este caso, lo más sencillo es
enviar un mensaje a la dirección <em>test+help&#64;ml.mail1.org</em>, que nos informará
de qué es lo que se puede hacer y qué direcciones se pueden usar para cada
tarea.</p></li>
<li><p>A través de una simplicísima <strong>interfaz web</strong>, que puede instalarse con dos
paquetes:</p>
<ul class="simple">
<li><p><em>mlmmj-php-web</em>, que permite cursar suscripciones y bajas a través de una
interfaz web.</p></li>
<li><p><em>mlmmj-php-web-admin</em>, que sirve para administrar la lista via web de forma
alternativa a lo que se logra creando y borrando ficheros del subdirectorio
<code class="file docutils literal notranslate"><span class="pre">control/</span></code>.</p></li>
</ul>
</li>
</ol>
</div>
<div class="section" id="consulta-del-historico">
<h2><span class="section-number">7.3.5.6.7. </span>Consulta del histórico<a class="headerlink" href="#consulta-del-historico" title="Enlazar permanentemente con este título">¶</a></h2>
<p>En las listas de distribución es extremadamente útil poder consultar el archivo
de los mensajes para repasar antiguas discusiones. Por ello, se almacenan todos
y cada mensaje tiene un identificador númerico consecutivo (<strong>1</strong> para el primer
mensaje enviado, <strong>2</strong> paa el segundo y así sucesivamente). Mediante este
identificador es posible obtener el mensaje enviado un correo a la lista
(<em>test+get-N&#64;mail1.org</em>), pero este modo de consulta es impracticable. Lo más
cómodo es acceder al archivo a través de una interfaz web, pero desgraciadamente
<strong class="program">mlmmj</strong> no desarrolla ninguna. Hay, no obstante, alguna interfaz de
terceros como <a class="reference external" href="https://git.cryptomilk.org/projects/mlmmj-webarchiver.git">mlmmj-webarchiver</a> que, aunque
bastante deficiente, puede ayudarnos a salir del paso.</p>
<p>En el enlace facilitado puede descargarse el código fuente<a class="footnote-reference brackets" href="#id10" id="id5">5</a>, aunque hemos
preparado un <a class="reference download internal" download="" href="../../../../_downloads/ccd0d7f72420eb92fa874f64499ef056/mlmmj-webarchiver_0.2-0_amd64.deb"><code class="xref download docutils literal notranslate"><span class="pre">paquete</span> <span class="pre">deb</span></code></a>
para facilitar la instalación. Basta, pues, con:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> dpkg -i mlmmj-webarchiver_0.2-0_amd64.deb
<span class="gp">#</span> apt-get install -f
</pre></div>
</div>
<p>Para que el archivo de la lista sea accesible vía web es necesario crear un
nuevo fichero bajo <code class="file docutils literal notranslate"><span class="pre">control/</span></code> que indique cuál es el directorio raíz del
sitio:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> <span class="nb">echo</span> <span class="s2">&quot;/srv/www/mlmmj&quot;</span> &gt; /var/spool/mlmmj/test/control/webarchive
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>El archivo de la lista se almacenará bajo <code class="file docutils literal notranslate"><span class="pre">/srv/www/mlmmj/test</span></code>,
ya que el sitio web está pensado para que se puedan acceder a archivos de
varias listas distintas. Por tanto, todas las listas que queramos incluir
en esta interfaz tendrán el mismo contenido para su
<code class="file docutils literal notranslate"><span class="pre">control/webarchive</span></code>.</p>
</div>
<p>El funcionamiento del pequeño programa es simple: periódicamente un <em>script</em>
escrito en <strong class="program">bash</strong> regenera los mensajes ofrecidos por la interfaz web
tomándolos de los mensajes almacenados por <strong class="program">mlmmj</strong> dentro de
<code class="file docutils literal notranslate"><span class="pre">/var/spool/mlmmj</span></code>. El paquete ofrecido programa la ejecución de este
<em>script</em> con <a class="reference internal" href="../../../../04.servidor/07.tareas/01.cronat.html#cron"><span class="std std-ref">cron</span></a> cada hora, pero si queremos que nuestra
instalación tenga efectos inmediatos, deberemos ejecutarlo nosotros a mano:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> /usr/bin/mlmmj-webarchiver.sh
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Asegúrese de que <code class="file docutils literal notranslate"><span class="pre">/srv/www/mlmmj</span></code> <strong>no</strong> existe antes de que
lo ejecute el <em>script</em> por primera vez.</p>
</div>
<p>Por supuesto, es también necesario configurar un servidor web. Una configuración
mínima de <a class="reference internal" href="../../../02.web/02.nginx/index.html#n-ginx"><span class="std std-ref">nginx</span></a> a este efecto es la siguiente:</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="k">server</span> <span class="p">{</span>
   <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>

   <span class="kn">server_name</span> <span class="s">_</span><span class="p">;</span>

   <span class="kn">root</span> <span class="s">/srv/www/mlmmj</span><span class="p">;</span>
   <span class="kn">try_files</span> <span class="nv">$uri</span> <span class="nv">$uri/</span> <span class="p">=</span><span class="mi">404</span><span class="p">;</span>
   <span class="kn">index</span>  <span class="s">index.php</span> <span class="s">index.html</span><span class="p">;</span>

   <span class="kn">location</span> <span class="p">~</span> <span class="sr">\.php$</span> <span class="p">{</span>
      <span class="kn">include</span> <span class="s">snippets/fastcgi-php.conf</span><span class="p">;</span>
      <span class="kn">fastcgi_pass</span> <span class="s">php</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">Ver también</p>
<p>Para más información, consulte <a class="reference internal" href="../../../02.web/02.nginx/02.avanz/06.dynamic.html#nginx-php"><span class="std std-ref">cómo configurar nginx para
ejecutar código PHP</span></a>.</p>
</div>
<p class="rubric">Notas al pie</p>
<dl class="footnote brackets">
<dt class="label" id="id6"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>En el mundo del software libre es <a class="reference external" href="http://www.gnu.org/software/mailman/">mailman</a></p>
</dd>
<dt class="label" id="id7"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>Un gestor, obviamente, permite gestionar múltiples listas de correo.</p>
</dd>
<dt class="label" id="id8"><span class="brackets"><a class="fn-backref" href="#id3">3</a></span></dt>
<dd><p>Lo cual no debería ocurrir.</p>
</dd>
<dt class="label" id="id9"><span class="brackets"><a class="fn-backref" href="#id4">4</a></span></dt>
<dd><p>Para ventilarnos con una unica línea todas las listas que pudiéramos
crear, el fichero nos está pidiendo que usemos una expresión regular:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/^(.+)@ml.mail1.org$/       mlmmj:$1
</pre></div>
</div>
<p>pero el uso de sustituciones en la parte derecha de la tabla está vetado por
razones de seguridad.</p>
</dd>
<dt class="label" id="id10"><span class="brackets"><a class="fn-backref" href="#id5">5</a></span></dt>
<dd><p>Si prueba a instalar directamente el código fuente tenga presenta que el
script <code class="file docutils literal notranslate"><span class="pre">mlmmj-webarchiver.sh</span></code> requiere <strong class="program">bash</strong>, pero su línea
de <em>sheebang</em> cita <strong class="program">sh</strong>.</p>
</dd>
</dl>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../../../index.html">Tabla de contenido</a></h3>
  <ul>
<li><a class="reference internal" href="#">7.3.5.6. Listas de correo</a><ul>
<li><a class="reference internal" href="#direccion-de-la-lista">7.3.5.6.1. Dirección de la lista</a></li>
<li><a class="reference internal" href="#instalacion">7.3.5.6.2. Instalación</a></li>
<li><a class="reference internal" href="#integracion-en-postfix">7.3.5.6.3. Integración en <strong class="program">postfix</strong></a></li>
<li><a class="reference internal" href="#creacion-de-listas">7.3.5.6.4. Creación de listas</a></li>
<li><a class="reference internal" href="#configuracion-minima">7.3.5.6.5. Configuración mínima</a></li>
<li><a class="reference internal" href="#gestion">7.3.5.6.6. Gestión</a></li>
<li><a class="reference internal" href="#consulta-del-historico">7.3.5.6.7. Consulta del histórico</a></li>
</ul>
</li>
</ul>

  <h4>Tema anterior</h4>
  <p class="topless"><a href="../04-webmail/index.html"
                        title="capítulo anterior"><span class="section-number">7.3.5.5. </span>Servicio de webmail</a></p>
  <h4>Próximo tema</h4>
  <p class="topless"><a href="../../../04.vpn/index.html"
                        title="próximo capítulo"><span class="section-number">7.4. </span>Redes VPN</a></p>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../../../../_sources/07.serre/03.mail/04-misc/06-maillist/index.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Ir a" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="../../../04.vpn/index.html" title="7.4. Redes VPN"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="../04-webmail/index.html" title="7.3.5.5. Servicio de webmail"
             >anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" ><span class="section-number">7. </span>Servicios de red</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../index.html" ><span class="section-number">7.3. </span>Correo electrónico</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" ><span class="section-number">7.3.5. </span>Otros aspectos</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Derechos de autor CC BY 4.0, 2016-2020, José Miguel Sánchez Alés.
      Creado con <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.3.
    </div>
  </body>
</html>