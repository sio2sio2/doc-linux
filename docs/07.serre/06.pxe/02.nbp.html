


<!DOCTYPE html>

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>7.6.2. NBP &#8212; documentación de Linuxnomicón - rolling</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/classic.css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/translations.js"></script>
    
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../search.html" />
    <link rel="next" title="7.6.3. Implementación" href="03.implementacion.html" />
    <link rel="prev" title="7.6.1. Conceptos" href="01.desc.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="03.implementacion.html" title="7.6.3. Implementación"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="01.desc.html" title="7.6.1. Conceptos"
             accesskey="P">anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" ><span class="section-number">7. </span>Servicios de red</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U"><span class="section-number">7.6. </span>PXE</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">7.6.2. </span><abbr title="Network Bootstrap Program">NBP</abbr></a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="nbp">
<span id="id1"></span><h1><span class="section-number">7.6.2. </span><abbr title="Network Bootstrap Program">NBP</abbr><a class="headerlink" href="#nbp" title="Enlazar permanentemente con este título">¶</a></h1>
<p>El <abbr title="Network Bootstrap Program">NBP</abbr> es el programa que ejecuta el cliente <abbr title="Preboot eXecution Environment">PXE</abbr> y que permite, a su vez, la
carga del sistema operativo remoto que acabará ejecutando la maquinas. De hecho,
la única función del cliente es poder llegar a ejecutar el <abbr title="Network Bootstrap Program">NBP</abbr> para cederle el
control. Ya hemos visto que esto exige obtener primero una configuración de red
y, una vez ya con capacidad para comunicarse, obtener el propio <abbr title="Network Bootstrap Program">NBP</abbr> para su
ejecución.</p>
<p>Como el objetivo del arranque por red es llegar a cargar un sistema operativo y
el <abbr title="Network Bootstrap Program">NBP</abbr> forma parte de esta tarea, es precisa también estudiar cómo se comporta
y cómo se configura, ya que en su configuración se expresan las instrucciones
para la carga de los sistemas operativos remotos disponibles.</p>
<p>Bajo el epígrafe presentaremos dos posibilidades:</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#syslinux"><span class="std std-ref">syslinux</span></a>, que es más habitual y cuya configuración da mucho
juego.</p></li>
<li><p><a class="reference internal" href="#ipxe"><span class="std std-ref">iPXE</span></a>, que es más bien un cliente <abbr title="Preboot eXecution Environment">PXE</abbr> con posibilidades de
arrancar directamente un sistema remoto.</p></li>
</ol>
<p>La guía está enfocada al uso de <strong class="program">syslinux</strong>, pero se darán algunas
pautas y consejos sobre <strong class="program">iPXE</strong>.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Con la aparición de <abbr title="Unified Extensible Firmware Interface">UEFI</abbr> <strong class="program">syslinux</strong> ha sido progresivamente
desplazado por <abbr title="GRand Unified Bootloader">GRUB</abbr>.</p>
</div>
<section id="carga">
<span id="nbp-carga"></span><h2><span class="section-number">7.6.2.1. </span>Carga<a class="headerlink" href="#carga" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Antes de nada, es preciso aclarar cómo conoce el cliente <abbr title="Preboot eXecution Environment">PXE</abbr> cuál es el <abbr title="Network Bootstrap Program">NBP</abbr>
que debe arrancar. El método depende de si la información la ofrece el servidor
<abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> o si lo hace un servidor <abbr title="Preboot eXecution Environment">PXE</abbr> independiente.</p>
<section id="dhcp">
<h3><span class="section-number">7.6.2.1.1. </span><abbr title="Dynamic Host Configuration Protocol">DHCP</abbr><a class="headerlink" href="#dhcp" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Los paquetes <em>DHCPoffer</em> que envía el cliente al servidor contienen unos campos
iniciales<a class="footnote-reference brackets" href="#id16" id="id2">1</a><a class="footnote-reference brackets" href="#id17" id="id3">2</a> entre las cuales está el campo «<em>siaddr</em>» que indica la
<abbr title="Internet Protocol">IP</abbr> del servidor desde el que descargar el <abbr title="Network Bootstrap Program">NBP</abbr> y el campo «<em>file</em>» que
permite indicar cuál es el fichero.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>En el cliente del <abbr title="Internet Systems Consortium">ISC</abbr> se da valor a estos campos mediante las
directivas <code class="docutils literal notranslate"><span class="pre">next-server</span></code> y <code class="docutils literal notranslate"><span class="pre">filename</span></code>.</p>
</div>
<p>No obstante lo anterior, existen las opciones 66 (<em>TFTP server name</em>) y 67
(<em>Bootfile name</em>) que cumplen esta misma función. El <span class="target" id="index-0"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc2132.html"><strong>RFC 2132</strong></a> explica cuándo
deben usarse estas opciones, pero ignoro cuándo se dan tales circunstancias. Lo
cierto es que, dando valor adecuado sólo a los campos <em>siaddr</em> y <em>file</em>, los
clientes <abbr title="Preboot eXecution Environment">PXE</abbr> parecen funcionar bien. Como, por lo general, los clientes <abbr title="Preboot eXecution Environment">PXE</abbr>
sólo soportan la descarga mediante <abbr title="Trivial FTP">TFTP</abbr>, no es necesario que en ningún lugar
se especifique el protocolo<a class="footnote-reference brackets" href="#id18" id="id4">3</a> para la descarga.</p>
</section>
<section id="pxe">
<h3><span class="section-number">7.6.2.1.2. </span><abbr title="Preboot eXecution Environment">PXE</abbr><a class="headerlink" href="#pxe" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En este caso, la cosa es un poco distinta: es el servicio <abbr title="Preboot eXecution Environment">PXE</abbr> el que informa
de cuál es servidor y cuál el <abbr title="Network Bootstrap Program">NBP</abbr> y, como ya se ha explicado, puede incluso
informar de más de una posibilidad para que el cliente <abbr title="Preboot eXecution Environment">PXE</abbr> construya un menú
de selección.</p>
</section>
</section>
<section id="ipxe">
<span id="id5"></span><h2><span class="section-number">7.6.2.2. </span><strong class="program">iPXE</strong><a class="headerlink" href="#ipxe" title="Enlazar permanentemente con este título">¶</a></h2>
<p><strong class="program">iPXE</strong> es, en realidad, un cliente <abbr title="Preboot eXecution Environment">PXE</abbr> <em>con esteroides</em>, hasta el
punto de que puede <a class="reference external" href="http://ipxe.org/howto/romburning">cargarse en la memoria flash de una tarjera de red</a> para que sustituya al cliente que incorpora
la propia tarjeta. Sólo hay que compilar la imagen adecuada o <a class="reference external" href="https://rom-o-matic.eu/">escogerla via web</a>.</p>
<p>Pero a diferencia de un cliente <abbr title="Preboot eXecution Environment">PXE</abbr> normal que se limita a cargar el <abbr title="Network Bootstrap Program">NBP</abbr> y
cederle el control, <strong class="program">iPXE</strong> incorpora un sencillo lenguaje de <em>script</em> que da más
posibilidades.</p>
<p class="rubric">Ventajas</p>
<ul>
<li><p>Soporta directamente la descarga por <abbr title="Trivial FTP">TFTP</abbr>, <abbr title="HyperText Transfer Protocol">HTTP</abbr> e incluso <abbr title="File Transfer Protocol">FTP</abbr>. Los
clientes <abbr title="Preboot eXecution Environment">PXE</abbr> sólo soportan <abbr title="Trivial FTP">TFTP</abbr>.</p></li>
<li><p><a class="reference external" href="http://ipxe.org/scripting">Su lenguaje de script</a> incorpora <a class="reference external" href="http://ipxe.org/cfg">variables</a> que permiten acceder a la información que envían los
servidores <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> y <abbr title="Domain Name Server">DNS</abbr> al cliente. Esto, unido a la descarga
por <abbr title="HyperText Transfer Protocol">HTTP</abbr>, posibilita crear arranques con una configuración dinámica basada
en el tipo de máquina o la red en la que se encuentra.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Lea <a class="reference internal" href="#ipxe-consejos"><span class="std std-ref">los consejos</span></a> para más información.</p>
</div>
</li>
<li><p>Permite directamente cargar un sistema operativo (de ahí que lo hayamos
incluido dentro de esta categoría de <abbr title="Network Bootstrap Program">NBP</abbr>)</p></li>
</ul>
<p class="rubric">Desventajas</p>
<ul class="simple">
<li><p>No es el cliente <abbr title="Preboot eXecution Environment">PXE</abbr> que incorporan las tarjetas de red, por lo que hay que
buscarse las vueltas para poder usarlo.</p></li>
<li><p>Su lenguaje de <em>script</em> no permite la creación de menús de selección, así que
en principio sólo posibilitaría el arranque de un sistema operativo, a menos
que dispusiéramos de un servidor <abbr title="Preboot eXecution Environment">PXE</abbr> independiente que <a class="reference internal" href="01.desc.html#pxe-independiente"><span class="std std-ref">es capaz de
enviar un menú de selección</span></a>. En cualquier caso, las
posibilidades de selección son infinitamente menores a las que ofrece
<strong class="program">syslinux</strong>.</p></li>
</ul>
<section id="como-usarlo">
<h3><span class="section-number">7.6.2.2.1. </span>Cómo usarlo<a class="headerlink" href="#como-usarlo" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Las máquinas virtuales de <a class="reference external" href="https://www.qemu.org/">qemu</a> usan para su arranque
por red <strong class="program">iPXE</strong>. Sin embargo, las tarjetas de red reales no lo
incorporan, así que, si tenemos interés en usarlo, tenemos varias alternativas:</p>
<ol class="arabic simple">
<li><p>La más traumática, flashear la tarjeta de red.</p></li>
<li><p>Hacer que el cliente <abbr title="Preboot eXecution Environment">PXE</abbr> original, use como <abbr title="Network Bootstrap Program">NBP</abbr> una versión de <strong class="program">iPXE</strong>
preparada para este fin.</p></li>
<li><p>Hacer que el gestor de arranque (<strong class="program">grub</strong> habitualmente) del sistema
local incluya una entrada que lance <strong class="program">iPXE</strong>.</p></li>
</ol>
</section>
<section id="como-funciona">
<h3><span class="section-number">7.6.2.2.2. </span>Cómo funciona<a class="headerlink" href="#como-funciona" title="Enlazar permanentemente con este título">¶</a></h3>
<ol class="arabic">
<li><p>Busca una configuración de red y una de arranque. Para esta segunda, sigue
pautas señaladas baja el epígrafe sobre  <a class="reference internal" href="#nbp-carga"><span class="std std-ref">la carga del NBP</span></a>.</p></li>
<li><p>Si el fichero de arranque que se le facilita es otro <abbr title="Network Bootstrap Program">NBP</abbr>
(<strong class="program">syslinux</strong>, por ejemplo), entonces cede el control a éste y su uso
no tiene ninguna diferencia respecto a un cliente <abbr title="Preboot eXecution Environment">PXE</abbr> normal. Ahora bien,
como <strong class="program">iPXE</strong> soporta <em>scripting</em>, el fichero puede no ser un <abbr title="Network Bootstrap Program">NBP</abbr>, sino un
<em>script</em> para que <strong class="program">iPXE</strong> lo cargue. Por ejemplo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span>!ipxe

<span class="go">exit</span>
</pre></div>
</div>
<p>cuyo efecto es evidente: salir de <strong class="program">iPXE</strong> lo que provoca que se siga la
secuencia de arranque de la <abbr title="Basic Input/Output System">BIOS</abbr>. Por supuesto, podemos hacer cosas más
complicadas, pero no es nuestro propósito.</p>
<p>Obsérvese que si usamos un servidor <abbr title="Preboot eXecution Environment">PXE</abbr> podemos enviar varios <em>scripts</em>
distintos<a class="footnote-reference brackets" href="#id19" id="id6">4</a> que hagan distintas cosas (arranque local, reinicio de la
máquina, arranque de un sistema de red, abrir una consola de <strong class="program">iPXE</strong>, etc.) y
el cliente <abbr title="Preboot eXecution Environment">PXE</abbr> será capaz de presentarnos un menú para que escojamos qué
hacer.</p>
</li>
<li><p>Una vez que se selecciona un ítem, o se ejecuta directamente si sólo había
uno, se descargará el sistema y se ejecutará con lo que finalizará el proceso
de arranque.</p></li>
</ol>
</section>
<section id="consejos">
<span id="ipxe-consejos"></span><h3><span class="section-number">7.6.2.2.3. </span>Consejos<a class="headerlink" href="#consejos" title="Enlazar permanentemente con este título">¶</a></h3>
<ul>
<li><p>Como <strong class="program">iPXE</strong> soporta <abbr title="HyperText Transfer Protocol">HTTP</abbr> para las descargas, el nombre del fichero enviado
al cliente puede ser, por ejemplo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">http://192.168.255.2/boot/start.ipxe</span>
</pre></div>
</div>
<p>lo que provocará que el fichero sea descargado por <abbr title="HyperText Transfer Protocol">HTTP</abbr> según tal <abbr title="Uniform Resource Locator">URL</abbr>.</p>
</li>
<li><p>Cuando se dispone un servidor <abbr title="Preboot eXecution Environment">PXE</abbr> independiente, éste es el que proporciona
la <abbr title="Internet Protocol">IP</abbr> del servidor de descargas y el nombre de fichero. En principio, <strong class="program">iPXE</strong>
facilita las variables <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">${next</kbd>-<kbd class="kbd docutils literal notranslate">server}</kbd></kbd> y <kbd class="kbd docutils literal notranslate">${filename}</kbd>, pero los
datos proporcionados por el servicio <abbr title="Preboot eXecution Environment">PXE</abbr> estarán accesibles en estas
variables, sólo si el servidor <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> envía vacíos los campos <em>siadd</em> y
<em>file</em>, lo cual no tiene por qué haberse producido. De hecho, algunos
servidores envían como <em>siaddr</em> la propia <abbr title="Internet Protocol">IP</abbr> del servidor <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> en caso de
que no se especifique una en su configuración, por lo que jamás envían vacío
este campo.</p>
<p>Si se quiere acceder a los datos que envía el servidor <abbr title="Preboot eXecution Environment">PXE</abbr>, pueden usarse
las variables <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">${proxydhcp/next</kbd>-<kbd class="kbd docutils literal notranslate">server}</kbd></kbd> y <kbd class="kbd docutils literal notranslate">${proxydhcp/filename}</kbd><a class="footnote-reference brackets" href="#id20" id="id7">5</a>.
Por ese motivo, la expresión anterior del fichero, habría sido mucho más
apropiada haberla hecho así:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">http://$</span><span class="o">{</span>proxydhcp/next-server<span class="o">}</span>/boot/start.ipxe
</pre></div>
</div>
</li>
<li><p>Abrir una <em>shell</em> de <strong class="program">iPXE</strong><a class="footnote-reference brackets" href="#id21" id="id8">6</a> puede ayudarnos a conocer mejor cómo ha sido el
arranque:</p>
<ul>
<li><p>La orden <strong class="command">config</strong> permite ver los valores de todas las variables
definidas:</p>
<img alt="../../_images/ipxe-config.png" src="../../_images/ipxe-config.png" />
</li>
<li><p>La orden <strong class="command">echo</strong> nos da simplemente el valor de una variable, pero
<strong class="command">show</strong> puede ayudar a saber de dónde toma tal valor:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">iPXE&gt; echo filename</span>
<span class="gp">http://$</span><span class="o">{</span>proxydhcp/next-server<span class="o">}</span>/boot/start.ipxe
<span class="go">iPXE&gt; show filename</span>
<span class="go">proxydhcp/filename:string = http://${proxydhcp/next-server}/boot/start.ipxe</span>
<span class="go">iPXE&gt; show next-server</span>
<span class="go">net0.dhcp/next-server:ipv4 = 192.168.255.1</span>
<span class="go">iPXE&gt; echo ${proxydhcp/next-server}</span>
<span class="go">192.168.255.2</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Nótese que con esta indagación conocemos que el valor de
<kbd class="kbd docutils literal notranslate">${filename}</kbd> procede del servidor <abbr title="Preboot eXecution Environment">PXE</abbr>, pero el valor de
<kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">${next</kbd>-<kbd class="kbd docutils literal notranslate">server}</kbd></kbd>, no; puesto que el servidor <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> envía el suyo
propio.</p>
</div>
</li>
</ul>
</li>
<li><p>Aunque con la orden <strong class="command">config</strong> no aparecen, las opciones de <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr>
también constituyen variables. Así, por ejemplo, podríamos definir que el
<em>script</em> cargado fuera este<a class="footnote-reference brackets" href="#id22" id="id9">7</a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">http://${proxydhcp/next-server}/boot/start.php?mac=${mac}&amp;domain=$</span><span class="o">{</span><span class="m">15</span><span class="o">}</span>
</pre></div>
</div>
<p>ya que la opción <strong>15</strong> es la que contiene el nombre de dominio. Obsérvese que
en este caso, estamos valiéndonos de que la descarga es por <abbr title="HyperText Transfer Protocol">HTTP</abbr>, para
descargar no un fichero estático, sino para ejecutar un <em>script</em> en <abbr title="PHP Hypertext Preprocessor">PHP</abbr> al
que alimientamos con la <abbr title="Media Access Control">MAC</abbr> del cliente y el dominio al que pertenece.</p>
</li>
</ul>
</section>
</section>
<section id="syslinux">
<span id="id10"></span><h2><span class="section-number">7.6.2.3. </span><strong class="program">syslinux</strong><a class="headerlink" href="#syslinux" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Si revisamos la <a class="reference external" href="https://www.syslinux.org">página del proyecto</a>,
comprobaremos que <strong class="program">syslinux</strong>, propiamente, es un gestor ligero de
arranque que cubre arranque local (<strong class="program">syslinux</strong> en sí), arranque con
<em>cdrom</em> (<strong class="program">isolinux</strong>) y arranque a través de la red
(<strong class="program">pxelinux</strong>). Por tanto, deberíamos hablar más bien de
<strong class="program">pxelinux</strong>.</p>
</div>
<p>Ha sido, sin duda, el <abbr title="Network Bootstrap Program">NBP</abbr> más utilizado durante muchos tiempo, gracias a que
pese a configurarse con bastante sencillez, permite una amplia gama de
configuraciones. La aparición de <abbr title="Unified Extensible Firmware Interface">UEFI</abbr> y un bajón en su ritmo de desarrollo, lo
han desbancado en favor de <abbr title="GRand Unified Bootloader">GRUB</abbr>.</p>
<section id="estructura">
<h3><span class="section-number">7.6.2.3.1. </span>Estructura<a class="headerlink" href="#estructura" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El arranque con <strong class="program">syslinux</strong> está constituido por:</p>
<ul>
<li><p>El <abbr title="Network Bootstrap Program">NBP</abbr>, que dispone de algunas variantes:</p>
<ul class="simple">
<li><p><code class="file docutils literal notranslate"><span class="pre">pxelinux.0</span></code> que sólo soporta descargas a través de <abbr title="Trivial FTP">TFTP</abbr>.</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">gpxelinux.0</span></code> que incluye código del <a class="reference external" href="http://etherboot.org/wiki/">proyecto gPXE</a>, lo que le permitía descargar del
servidor usando los protocolos <abbr title="HyperText Transfer Protocol">HTTP</abbr> o <abbr title="Trivial FTP">TFTP</abbr>.</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">lpxelinux.0</span></code> desde las últimas versiones de <strong class="program">syslinux</strong>, que
soporta de forma nativa <abbr title="HyperText Transfer Protocol">HTTP</abbr> y <abbr title="File Transfer Protocol">FTP</abbr> y es recomendable sobre la versión
anterior.</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">syslinuxx.efi</span></code> para sistemas con <abbr title="Unified Extensible Firmware Interface">UEFI</abbr> de 32 <em>bits</em> y de 64 <em>bits</em>
en vez de <abbr title="Basic Input/Output System">BIOS</abbr>. Son dos ejecutables distintos uno para un tipo de <abbr title="Unified Extensible Firmware Interface">UEFI</abbr> y
otro para la otra, Ambos soportan también descargas <abbr title="HyperText Transfer Protocol">HTTP</abbr> y <abbr title="File Transfer Protocol">FTP</abbr>.</p></li>
</ul>
<p>Lo cierto es que <abbr title="HyperText Transfer Protocol">HTTP</abbr> es bastante más recomendable que <abbr title="Trivial FTP">TFTP</abbr> e
indispensable si se quieren crear configuraciones dinámicas para
<strong class="program">syslinux</strong>, de modo que en esta guía usaremos <code class="file docutils literal notranslate"><span class="pre">lpxelinux.0</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Por supuesto, nos referimos exclusivamente a las variantes de
<strong class="program">pxelinux</strong>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>La <abbr title="Unified Extensible Firmware Interface">UEFI</abbr> trae por ahora dos arranque por red: el nativo (para el
cual necesitaremos <strong class="program">syslinux.efi</strong>) y uno llamado «<em>Legacy BIOS
mode</em>» que emula el arranque de la <abbr title="Basic Input/Output System">BIOS</abbr> y permite usar
<strong class="program">lpxelinux.0</strong>. Más adelante trataremos esto al configurar un
<a class="reference internal" href="03.implementacion/04.misc.html#pxe-multiarch"><span class="std std-ref">arranque multiarquitectura</span></a>.</p>
</div>
</li>
<li><p>Una serie de módulos con extensión <code class="file docutils literal notranslate"><span class="pre">.c32</span></code>, que permiten a
<strong class="program">syslinux</strong> ampliar sus capacidades. Por ejemplo, <code class="file docutils literal notranslate"><span class="pre">reboot.c32</span></code>
sirve para reiniciar el ordenador. De entre todos, es indispensable
<code class="file docutils literal notranslate"><span class="pre">ldlinux.c32</span></code> que el <abbr title="Network Bootstrap Program">NBP</abbr> intentará descargar inmediatamente después de
entrar en funcionamiento.</p></li>
<li><p>La configuración que permite establecer cuáles son los sistemas de arranque
disponibles. Puede estar cosntituida por un sólo fichero o varios que, al
igual que en el caso de los módulos, tendrán que descargarse del servidor de
ficheros.</p></li>
</ul>
</section>
<section id="id11">
<h3><span class="section-number">7.6.2.3.2. </span>Cómo funciona<a class="headerlink" href="#id11" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Una vez descargado el <abbr title="Network Bootstrap Program">NBP</abbr> (llamémoslo a partir de ahora <strong class="program">pxelinux</strong>),
este se procurará una serie de ficheros necesarios para poder realizar su
función. Los estrictamente necesarios son dos: el módulo <code class="file docutils literal notranslate"><span class="pre">ldlinux.c32</span></code> y
el fichero de configuración.</p>
<p>Antes, no obstante, de discutir sobre cómo los obtiene es necesario aclarar que
<strong class="program">syslinux</strong> maneja el concepto de <em class="dfn">directorio de trabajo</em> (<abbr title="Current Working Directory">CWD</abbr>),
que es aquel a partir del cual se construyen las direcciones relativas de los
ficheros que requieran descarga. Si el servicio se limitó a indicar la dirección
<abbr title="Internet Protocol">IP</abbr> del servidor y cuál era el <abbr title="Network Bootstrap Program">NBP</abbr>, el directorio de trabajo se considerará
aquel en donde se encontrara situado el <abbr title="Network Bootstrap Program">NBP</abbr>.</p>
<p>Por ejemplo, supongamos que el servidor <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> envía los siguientes datos:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 29%" />
<col style="width: 71%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Campo</p></th>
<th class="head"><p>Valor</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em>siaddr</em></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">192.168.255.1</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><em>filename</em></p></td>
<td><p><code class="file docutils literal notranslate"><span class="pre">bios/lpxelinux.0</span></code></p></td>
</tr>
</tbody>
</table>
<p>En este caso, <strong class="command">pxelinux</strong> (en particular el ejecutable
<code class="file docutils literal notranslate"><span class="pre">lpxelinux.0</span></code>) se descargará por <abbr title="Trivial FTP">TFTP</abbr> del servidor <em>192.168.255.1</em> y su
ruta dentro del servidor es <code class="file docutils literal notranslate"><span class="pre">bios/lpxelinux.0</span></code>. En consecuencia la <abbr title="Uniform Resource Locator">URL</abbr>
de descarga es:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">tftp://192.168.255.1/bios/lpxelinux.0</span>
</pre></div>
</div>
<p>y el <abbr title="Current Working Directory">CWD</abbr> se definirá como:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">tftp://192.168.255.1/bios/</span>
</pre></div>
</div>
<p>Ahora bien, <strong class="program">pxelinux</strong> también comprueba el valor de la opción <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr>
<strong>210</strong> y, si existe, toma este valor como <abbr title="Current Working Directory">CWD</abbr>. Consecuentemente, si se quiere
usar otro directorio de trabajo (p.e. <code class="file docutils literal notranslate"><span class="pre">http://192.168.255.1/boot/bios/</span></code>
para cambiar de protocolo de descarga) puede configurarse el servidor <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr>
para que envíe esta opción al cliente con el valor desedo.</p>
<p>Establecido el <abbr title="Current Working Directory">CWD</abbr>, se intentará descargar el módulo <code class="file docutils literal notranslate"><span class="pre">ldlinux.c32</span></code> de
distintas localizaciones en el siguiente orden:</p>
<ol class="arabic simple">
<li><p><code class="file docutils literal notranslate"><span class="pre">$CWD/ldlinux.c32</span></code></p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">$CWD/boot/isolinux/ldlinux.c32</span></code></p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">$CWD/isolinux/ldlinux.c32</span></code></p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">$CWD/boot/syslinux/ldlinux.c32</span></code></p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">$CWD/sysisolinux/ldlinux.c32</span></code></p></li>
</ol>
<p>Supuesto éxito, entonces se procederá a descargar el fichero de configuración.
Cuál es puede fijase enviando la opción <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> <strong>209</strong>, cuyo valor yuxtapuesto
al valor del <abbr title="Current Working Directory">CWD</abbr> dará la <abbr title="Uniform Resource Locator">URL</abbr> de tal fichero. Por ejemplo, si esto es lo que
recibe el cliente:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 36%" />
<col style="width: 64%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Campo</p></th>
<th class="head"><p>Valor</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em>siaddr</em></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">192.168.255.1</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><em>filename</em></p></td>
<td><p><code class="file docutils literal notranslate"><span class="pre">bios/lpxelinux.0</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Opción <strong>209</strong></p></td>
<td><p><code class="file docutils literal notranslate"><span class="pre">config/start.cfg</span></code></p></td>
</tr>
</tbody>
</table>
<p>La <abbr title="Uniform Resource Locator">URL</abbr> del fichero de configuración será:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">tftp://192.168.255.1/bios/config/start.cfg</span>
</pre></div>
</div>
<p>y de ahí será de donde intente obtenerse la configuración. Si no se envía valor
para la opción <strong>209</strong>, el <abbr title="Network Bootstrap Program">NBP</abbr> sigue un algoritmo para localizar un fichero.
Para ilustrar qué hace tomemos el ejemplo que usa <a class="reference external" href="https://www.syslinux.org/wiki/index.php?title=PXELINUX#Configuration">la propia documentación de
syslinux</a>.
Suponiendo que que el identificador del cliente sea
<em>b8945908-d6a6-41a9-611d-74a6ab80b83d</em>, la <abbr title="Media Access Control">MAC</abbr> de la tarjeta
<em>88:99:AA:BB:CC:DD</em> y la dirección <abbr title="Internet Protocol">IP</abbr> obtenida <em>192.168.2.91</em>,
<strong class="program">pxelinux</strong> intentara obtener su configuración de distintas
localizaciones siguiiente este orden:</p>
<ol class="arabic simple">
<li><p><code class="file docutils literal notranslate"><span class="pre">$CWD/pxelinux.cfg/b8945908-d6a6-41a9-611d-74a6ab80b83d</span></code></p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">$CWD/pxelinux.cfg/01-88-99-aa-bb-cc-dd</span></code></p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">$CWD/pxelinux.cfg/C0A8025B</span></code></p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">$CWD/pxelinux.cfg/C0A8025</span></code></p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">$CWD/pxelinux.cfg/C0A802</span></code></p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">$CWD/pxelinux.cfg/C0A80</span></code></p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">$CWD/pxelinux.cfg/C0A8</span></code></p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">$CWD/pxelinux.cfg/C0A</span></code></p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">$CWD/pxelinux.cfg/C0</span></code></p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">$CWD/pxelinux.cfg/C</span></code></p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">$CWD/pxelinux.cfg/default</span></code></p></li>
</ol>
<p>En principio, estos ficheros son los indispensables para poder funcionar. Ahora
bien, la propia configuración puede provocar la descarga de otros módulos y
ficheros de configuración:</p>
<ul>
<li><p>Cuando se invoca un módulo, por ejemplo, con:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">IU menu.c332</span>
</pre></div>
</div>
<p><strong class="program">pxelinux</strong> seguirá la misma estrategia que cuando intentó descargar
<code class="file docutils literal notranslate"><span class="pre">ldlinux.c32</span></code>.</p>
</li>
<li><p>CUando se cita otro fichero de configuración, se intentará descargar tomando
como base el <em>directorio de trabajo</em>.</p></li>
</ul>
<p>Si todo ha ido bien, la descarga de los ficheros resultará en la posibilidad de
que el usuario elija el sistema de red a arrancar entre todos los disponibles
que declara la configuración de <strong class="command">pxelinux</strong>. Una vez que éste haga su
selección, el <abbr title="Network Bootstrap Program">NBP</abbr> cargará el sistema según las instrucciones que recoge el
propio fichero de configuración.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Atender al valor de las opciones <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> <strong>209</strong> y <strong>210</strong> es algo
propio de <strong class="program">pxelinux</strong> y no del protocolo <abbr title="Preboot eXecution Environment">PXE</abbr> en general. En
consecuencia, los clientes <abbr title="Preboot eXecution Environment">PXE</abbr> no piden esas opciones al servidor y para
que éste las entregue al cliente debe forzarse su entrega. <strong class="program">syslinux</strong>
permite una alternativa: encapsular el valor de estas opciones dentro de la
opción <strong>43</strong>, que sí es requerida por los clientes <abbr title="Preboot eXecution Environment">PXE</abbr>. Se verá al
realizar la implementación.</p>
</div>
</section>
<section id="configuracion">
<h3><span class="section-number">7.6.2.3.3. </span>Configuración<a class="headerlink" href="#configuracion" title="Enlazar permanentemente con este título">¶</a></h3>
<p>La configuración de <strong class="program">syslinux</strong> es extensísima<a class="footnote-reference brackets" href="#id23" id="id12">8</a>, así que nos limitaremos
a hacer una guía somera para saber cómo empezar a hincarle el diente.</p>
<p>Un fichero de configuración de <strong class="program">syslinux</strong> consiste básicamente en la
relación de sistemas disponibles que puede arrancar el usuario, así que la
estructura general del fichero es la siguiente:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">DIRECTIVAS GLOBALES</span>
<span class="go">...</span>

<span class="go">LABEL sistema1</span>
<span class="go">   DIRECTIVAS PARA EL SISTEMA 1</span>
<span class="go">   ...</span>

<span class="go">LABEL sistema2</span>
<span class="go">   DIRECTIVAS PARA EL SISTEMA 1</span>
<span class="go">   ...</span>
</pre></div>
</div>
<section id="sin-menu">
<h4><span class="section-number">7.6.2.3.3.1. </span>Sin menú<a class="headerlink" href="#sin-menu" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Por ejemplo, usemos con apenas variaciones el fichero de configuración con que
remataremos el estudio:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> Estas son las directivas globales y esto, en concreto,
<span class="gp">#</span> un comentario porque emnnpieza por almohadilla.
<span class="go">PROMPT 1</span>
<span class="go">TIMEOUT 100</span>
<span class="go">DEFAULT local</span>
<span class="go">SAY Arranque por red del dpto. de Informatica</span>

<span class="go">F1 ../cfg/files/ayuda.txt</span>
<span class="go">KBDMAP ../cfg/files/es.ktl</span>

<span class="gp">#</span> Deshabilitadas.
<span class="gp">#</span>NOCOMPLETE <span class="m">1</span>

<span class="go">LABEL slitaz</span>
<span class="go">   MENU LABEL ^Slitaz</span>
<span class="go">   KERNEL ../ssoo/slitaz/bzImage</span>
<span class="go">   APPEND initrd=../ssoo/slitaz/rootfs.gz lang=es_ES kmap=es rw root=/dev/null vga=normal autologin BOOT_IMAGE=../ssoo/slitaz/bzImage</span>

<span class="go">LABEL memtest</span>
<span class="go">   MENU LABEL ^Test de memoria</span>
<span class="go">   LINUX ../ssoo/memtest86+.bin</span>

<span class="go">LABEL local</span>
<span class="go">   MENU LABEL Secuencia ^local de arranque</span>
<span class="go">   LOCALBOOT -1</span>

<span class="go">LABEL reboot</span>
<span class="go">   MENU LABEL ^Reiniciar</span>
<span class="go">   KERNEL reboot.c32 -w</span>

<span class="go">LABEL apagar</span>
<span class="go">   MENU LABEL ^Apagar</span>
<span class="go">   COM32 poweroff.c32</span>
</pre></div>
</div>
<p>Este fichero mostrará la interfaz de selección más sencilla. Un simple mensaje:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">boot:</span>
</pre></div>
</div>
<p>que espera que introduzcamos la etiqueta (<kbd class="kbd docutils literal notranslate">local</kbd>, <kbd class="kbd docutils literal notranslate">slitaz</kbd>, etc.) o
la tecla <kbd class="kbd docutils literal notranslate">TAB</kbd> que muestra las opciones disponibles.</p>
<p>Obsérvese que las directivas (<code class="docutils literal notranslate"><span class="pre">PROMPT</span></code>, <code class="docutils literal notranslate"><span class="pre">LABEL</span></code>, etc.) las hemos escrito en
mayúsculas. Pueden escribirse también en minúsculas, ya que <strong class="program">syslinux</strong>
no atiende a ello, pero escribirlas en mayúscula es una buena forma de
distinguir la directiva del resto de la línea.</p>
<p>De forma global hemos determinado que:</p>
<ul class="simple">
<li><p>Se muestre el <em>prompt</em> «<code class="docutils literal notranslate"><span class="pre">boot:</span></code>».</p></li>
<li><p>El tiempo de temporización sean 10 segundos (<em>100/10</em>).</p></li>
<li><p>Pasado el tiempo, si no ha habido selección, se ejecute el ítem «<em>local</em>».
En interfaces que presenten menú, es el ítem que aparece resaltado al
comienzo.</p></li>
<li><p>Antes de la línea de «<code class="docutils literal notranslate"><span class="pre">boot:</span></code>», se muestre la frase introducido con <code class="docutils literal notranslate"><span class="pre">SAY</span></code>.
Una alternativa más sofisticada a ésto es la orden <code class="docutils literal notranslate"><span class="pre">DISPLAY</span></code>, que trataremos
<a class="reference internal" href="03.implementacion/04.misc.html#pxe-syslinux-display"><span class="std std-ref">al describir algunas particularidades</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">F1</span></code> (y así hasta <code class="docutils literal notranslate"><span class="pre">F12</span></code>) permiten mostrar ficheros alternativos de ayuda.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">KBDMAP</span></code> permite fijar el mapa de teclado, útil si se desea editar opciones.
Hay <a class="reference external" href="https://www.syslinux.org/wiki/index.php?title=Directives/kbdmap">una página de la wiki</a> que
explica cómo generarlos, aunque también podemos optar por copiarlos de algún
sistema que ya los tenga creados.</p></li>
<li><p>Comentada está la opción <code class="docutils literal notranslate"><span class="pre">NOCOMPLETE</span></code> que impide que <strong class="program">syslinux</strong>
muestre todas las etiquetas disponibles al pulsar <kbd class="kbd docutils literal notranslate">TAB</kbd>.</p></li>
</ul>
<p>Para la definición de cada ítem hemos usado:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">LABEL</span></code> que introduce la etiqueta asociada al ítem y es obligatoria.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MENU</span> <span class="pre">LABEL</span></code> es la leyenda que se mostrará en el menú para el ítem, pero no
tiene ningún efecto, puesto la interfaz no muestra un menú.</p></li>
<li><p>La carga efectiva del sistema se hace a través de <code class="docutils literal notranslate"><span class="pre">KERNEL</span></code> o una directiva
más específica (<code class="docutils literal notranslate"><span class="pre">LINUX</span></code>, <code class="docutils literal notranslate"><span class="pre">COM32</span></code>, etc.). Hay distintos tipos de sistemas
que requieren ser cargados de distinto modo y <strong class="program">syslinux</strong> puede
basarse en la extensión del fichero si se usa la directiva genérica
<code class="docutils literal notranslate"><span class="pre">KERNEL</span></code><a class="footnote-reference brackets" href="#id24" id="id13">9</a>. A este respecto:</p>
<ul>
<li><p>La carga de <strong class="program">memtest</strong> presenta un problema: debe cargarse al estilo
de los núcleos de linux, pero su extensión <kbd class="kbd docutils literal notranslate">.bin</kbd> confundiría a
<code class="docutils literal notranslate"><span class="pre">KERNEL</span></code>, así que usamos la directiva específica <code class="docutils literal notranslate"><span class="pre">LINUX</span></code>.</p></li>
<li><p><em>apagar</em> y <em>reboot</em> muestran cómo es indiferente usar la directiva general o
la específica (<code class="docutils literal notranslate"><span class="pre">COM32</span></code> en este caso), si no hay problemas con la
extensión.</p></li>
<li><p>Se muestra cómo continuar la secuencia de arranque con <code class="docutils literal notranslate"><span class="pre">LOCALBOOT</span></code>. En
algunos sistemas quizás sea necesario sustituir el <strong>-1</strong> por <strong>0</strong> (lo cual
podría dar pie a la generación dinámica de este número dependiendo de cuál
fuera el cliente que lo requiere).</p>
<p>También podría optarse por usar el módulo <a class="reference external" href="https://www.syslinux.org/wiki/index.php?title=Comboot/chain.c32">chain.c32</a> para
arrancar el disco duro<a class="footnote-reference brackets" href="#id25" id="id14">10</a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">LABEL local</span>
<span class="go">   MENU LABEL Disco duro</span>
<span class="go">   KERNEL chain.c32 hd0 0</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">APPEND</span></code> permite añadir las opciones de carga que, por otra parte, se pueden
incluir en la misma línea <code class="docutils literal notranslate"><span class="pre">KERNEL</span></code>. En el ejemplo hay entradas que usan
<code class="docutils literal notranslate"><span class="pre">APPEND</span></code>, como <em>slitaz</em>, y entradas que incluyen las opciones en el propio
<code class="docutils literal notranslate"><span class="pre">KERNEL</span></code> como <em>reboot</em>. Por supuesto, tal decisión es absolutamente
caprichosa y podría haberse hecho perfectamente al revés.</p></li>
</ul>
<p>Una posibilidad muy interesante de la que no hemos hecho uso es la de dividir la
configuración en distintos ficheros:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>PROMPT 1
TIMEOUT 100
DEFAULT local
SAY Arranque por red del dpto. de Informatica

F1 ../cfg/files/ayuda.txt
KBDMAP ../cfg/files/es.ktl

<span class="hll">INCLUDE ../cfg/items.cfg
</span>
# Añadimos una entrada extra que explicaremos a continuación
LABEL menu
   CONFIG ../cfg/menu
</pre></div>
</div>
<p>Para ello, se usa la directiva <code class="docutils literal notranslate"><span class="pre">INCLUDE</span></code> que no hace más que incluir el
contenido del fichero justamente en el lugar en el que aparece. Por supuesto, en
<code class="file docutils literal notranslate"><span class="pre">items.cfg</span></code> deberíamos ioncluir todas las entradas que relacionamos antes.</p>
<p>Por último, es posible recargar por completo la configuración haciendo uso de la
directiva <code class="docutils literal notranslate"><span class="pre">CONFIG</span></code> que una de las directivas específicas de la familia de
<code class="docutils literal notranslate"><span class="pre">KERNEL</span></code>. En el ejemplo, la entrada <em>menu</em> sustituye la configuración actual
por una nueva que se haya dentro del fichero homónimo. El contenido de este
fichero lo describiremos bajo el próximo apartado.</p>
</section>
<section id="menu-no-grafico">
<h4><span class="section-number">7.6.2.3.3.2. </span>Menú no gráfico<a class="headerlink" href="#menu-no-grafico" title="Enlazar permanentemente con este título">¶</a></h4>
<p>La interfaz anterior es muy básica y es la que proporciona <strong class="program">syslinux</strong>,
si no especificamos interfaz alguna. Para especificarla debe incluirse la
directiva <code class="docutils literal notranslate"><span class="pre">IU</span></code> seguida por el módulo que la desarrolla. <strong class="program">syslinux</strong>
posee dos:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.syslinux.org/wiki/index.php?title=Comboot/menu.c32">menu.c32</a>,
que despliega un menú de texto.</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">vesamenu.c32</span></code>, para menús gráficos. Añade algunas directivas a la
interfaz anteriores para embellecerla (imagen de fondo, etc.)</p></li>
</ul>
<p>Ilustremos la primera:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span><span class="hll">UI menu.c32
</span>TIMEOUT 100
DEFAULT local

<span class="hll">MENU AUTOBOOT Arranque local en # seconds
</span><span class="hll">MENU TITLE Sistemas arrancables
</span>
INCLUDE ../cfg/items.cf
</pre></div>
</div>
<p>En esta configuración hemos prescindido de <code class="docutils literal notranslate"><span class="pre">PROMPT</span></code> que no sirve para nada, y
hemos añadido dos directivas suficientemente explicativas.</p>
<p>Una opción muy interesante que admite la interfaz de <em>menú</em> es incluir la
directiva:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">MENU SHIFTKEY</span>
</pre></div>
</div>
<p>que hace que se muestre el menú solo en caso de que estemos pulsando las teclas
<kbd class="kbd docutils literal notranslate">Shift</kbd> o <kbd class="kbd docutils literal notranslate">Alt</kbd>, porque si no es así se ejecuta directamente la
entrada predeterminada (<em>local</em> en nuestro ejemplo).</p>
<p>En cuanto a las entradas debemos asegurarnos de que contienen la directiva
<code class="docutils literal notranslate"><span class="pre">MENU</span> <span class="pre">LABEL</span></code>. En la leyenda que acompaña a esta directiva, opcionalmente, se
puede incluir un «^» antes de una de las letras. Al pulsar sobre tal letra,
iremos directamente la opción. Es por ello que en cada entrada debemos elegir
una letra distinta para este cometido.</p>
<p>Ahora bien, las entradas admiten más juego que en el caso anterior. Por ejemplo:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>LABEL local
   MENU LABEL Secuencia ^local de arranque
   LOCALBOOT -1
<span class="hll">   MENU PASSWD $1$.x/EOPp0$qmj9Xt.3kfF6a0ulTEb1Q/
</span><span class="hll">   TEXT HELP
</span><span class="hll">      Prueba el siguiente dispositivo de la secuencia
</span><span class="hll">      de arranque predefinida en la BIOS.
</span><span class="hll">   ENDTEXT
</span></pre></div>
</div>
<p>Hemos hecho dos añadidos:</p>
<ul>
<li><p>Hemos asegurado la entrada con contraseña, de manera que sólo podrá
seleccionarse si se conoce ésta. La contraseña puede escribirse en claro (muy
mala idea) o cifrada con una función de <em>hash</em>. Lo más sencillo es usar
<abbr title="Secure Hash Algorithm">SHA</abbr>-1 como en el ejemplo de arriba en que la contraseña es «1234». Para
crearla basta con:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">echo</span> -n <span class="s2">&quot;contraseña_secreta&quot;</span> <span class="p">|</span> openssl passwd -1 -stdin
</pre></div>
</div>
</li>
<li><p>Hemos añadido un párrafo que explica qué implica la selección de la entrada.
Aparece, fuera del menú, en la parte inferior de la pantalla.</p></li>
</ul>
<p>Otro añadido interesante (en conjunción con alguna otra posibilidad que veremos
más adelante) es sangrar la opción para que aparezca más a la derecha (el número
indica el ancho del sangrado):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">MENU INDENT 1</span>
</pre></div>
</div>
<p>Otra posibilidad es crear entradas no seleccionables que pero que ayudan a
componer mejor el texto. Por ejemplo:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span><span class="hll">LABEL -
</span><span class="hll">   MENU LABEL Sistemas remotos
</span><span class="hll">   MENU DISABLE
</span>
LABEL slitaz
   MENU LABEL ^Slitaz
<span class="hll">   MENU INDENT 1
</span>   KERNEL ../ssoo/slitaz/bzImage
   APPEND initrd=../ssoo/slitaz/rootfs.gz lang=es_ES kmap=es rw root=/dev/null vga=normal autologin BOOT_IMAGE=../ssoo/slitaz/bzImage

LABEL memtest
   MENU LABEL ^Test de memoria
<span class="hll">   MENU INDENT 1
</span>   LINUX ../ssoo/memtest86+.bin

<span class="hll">MENU SEPARATOR
</span>
LABEL local
   MENU LABEL Secuencia ^local de arranque
   LOCALBOOT -1

LABEL reboot
   MENU LABEL ^Reiniciar
   KERNEL reboot.c32 -w

LABEL apagar
   MENU LABEL ^Apagar
   COM32 poweroff.c32
</pre></div>
</div>
<p>Lo cual genera lo siguiente:</p>
<img alt="../../_images/menu-disable.png" src="../../_images/menu-disable.png" />
<p>Como puede verse, hemos añadido <code class="docutils literal notranslate"><span class="pre">MENU</span> <span class="pre">SEPARATOR</span></code> que, simplemente deja en
blanco un línea y ayuda a hacer más legible el menú,</p>
<p>Una alternativa a esta organización es crear un submenú con <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">MENU</kbd> <kbd class="kbd docutils literal notranslate">BEGIN</kbd> <kbd class="kbd docutils literal notranslate">...</kbd>
<kbd class="kbd docutils literal notranslate">MENU</kbd> <kbd class="kbd docutils literal notranslate">END</kbd></kbd>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span><span class="hll">MENU BEGIN remotos
</span>
   # El submenú puede tener su propio título
   MENU TITLE Sistemas arrancables por red

   LABEL slitaz
      MENU LABEL ^Slitaz
      KERNEL ../ssoo/slitaz/bzImage
      APPEND initrd=../ssoo/slitaz/rootfs.gz lang=es_ES kmap=es rw root=/dev/null vga=normal autologin BOOT_IMAGE=../ssoo/slitaz/bzImage

   LABEL memtest
      MENU LABEL ^Test de memoria
<span class="hll">      MENU DEFAULT
</span>      LINUX ../ssoo/memtest86+.bin

   MENU SEPARATOR

<span class="hll">   LABEL -
</span><span class="hll">      MENU LABEL ^Volver al menú principal...
</span><span class="hll">      MENU EXIT
</span>
<span class="hll">MENU END
</span>
MENU SEPARATOR

LABEL local
   MENU LABEL Secuencia ^local de arranque
   LOCALBOOT -1

LABEL reboot
   MENU LABEL ^Reiniciar
   KERNEL reboot.c32 -w

LABEL apagar
   MENU LABEL ^Apagar
   COM32 poweroff.c32
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Los ficheros de configuración deben estar codificados
en <a class="reference external" href="https://es.wikipedia.org/wiki/P%C3%A1gina_de_c%C3%B3digos_850">cp850</a>
para que los caracteres aceptuados puedan verse sin problemas. Lo más
probable, sin embargo, es que nuestro editor los escriba en UTF-8. Para
hacer la conversión, puede usarse <strong class="command">iconv</strong>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> iconv -f utf8 -t cp850 cfg/items.cfg.utf8 &gt; cfg/items.cfg
</pre></div>
</div>
</div>
<p>En este caso, hay dos pantallas de menú: el <em>principal</em>:</p>
<img alt="../../_images/menu-principal.png" src="../../_images/menu-principal.png" />
<p>y el <em>secundario</em> con las dos entradas de sistemas remotas y una adicional para
volver al menú anterior, y en la que la opción inicialmente marcada es la de
<strong class="program">memtest</strong>, pues lo hemos indicado con <code class="docutils literal notranslate"><span class="pre">MENU</span> <span class="pre">DEFAULT</span></code>:</p>
<img alt="../../_images/menu-secundario.png" src="../../_images/menu-secundario.png" />
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p><strong class="program">syslinux</strong> salta las líneas que es incapaz de entender. Esto
posibilita que podamos escribir un mismo <code class="file docutils literal notranslate"><span class="pre">items.cfg</span></code> para ambas
versiones. De hecho, en el <code class="file docutils literal notranslate"><span class="pre">items.cfg</span></code> original incluímos de primeras
una directva (<code class="docutils literal notranslate"><span class="pre">MENU</span> <span class="pre">LABEL</span></code>) sin sentido para la interfaz sin menús.</p>
</div>
</section>
<section id="menu-grafico">
<h4><span class="section-number">7.6.2.3.3.3. </span>Menú gráfico<a class="headerlink" href="#menu-grafico" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Este menú, disponible gracias a <code class="file docutils literal notranslate"><span class="pre">vesamenu.c32</span></code>, funciona exactamente igual
al anterior, pero añade la posibilidad de cambiar colores, añádir fondos de
pantalla, etc. que hacen mucho más vistoso su aspecto. En la página del proyecto
dedicada a <a class="reference external" href="https://www.syslinux.org/wiki/index.php?title=Menu">los menús</a>
pueden leerse cuáles son estas directivas (<code class="docutils literal notranslate"><span class="pre">MENU</span> <span class="pre">BACKGROUND</span></code>, <code class="docutils literal notranslate"><span class="pre">MENU</span> <span class="pre">COLOR</span></code>,
etc.). No trataremos aquí cómo hacer estos cambios cosméticos. Para conocer
rápidamente cómo montarnos una interfaz atractiva lo más rápido es descargar una
imagen de alguna distribución que la use<a class="footnote-reference brackets" href="#id26" id="id15">11</a> y curiosear su ficheros.</p>
<p class="rubric">Notas al pie</p>
<dl class="footnote brackets">
<dt class="label" id="id16"><span class="brackets"><a class="fn-backref" href="#id2">1</a></span></dt>
<dd><p>Véase el <span class="target" id="index-1"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc2131.html"><strong>RFC 2131</strong></a> para más información.</p>
</dd>
<dt class="label" id="id17"><span class="brackets"><a class="fn-backref" href="#id3">2</a></span></dt>
<dd><p>No hay que confundir estos campos con las opciones numeradas (referidas
en el <span class="target" id="index-2"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc2132.html"><strong>RFC 2132</strong></a>) del <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr>. De hecho, el último de los campos se llama
<em>options</em> y es en él en donde se incluyen todas las opciones. El <span class="target" id="index-3"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc2131.html"><strong>RFC 2131</strong></a>
incluye un dibujo muy revelador.</p>
</dd>
<dt class="label" id="id18"><span class="brackets"><a class="fn-backref" href="#id4">3</a></span></dt>
<dd><p><strong class="program">iPXE</strong> ya veremos que permite otros protocolos como <abbr title="HyperText Transfer Protocol">HTTP</abbr>. En su caso,
se puede especificar el protocolo, inclyendo la <em>URL</em> completa en el campo
<em>file</em>. Eso sí, siempre que tal <em>URL</em> no supere los 128 caracteres.</p>
</dd>
<dt class="label" id="id19"><span class="brackets"><a class="fn-backref" href="#id6">4</a></span></dt>
<dd><p>Ya veremos que con <a class="reference internal" href="../../06.infraestructura/02.dhcp/03.dnsmasq.html#dnsmasq"><span class="std std-ref">dnsmasq</span></a> se hace así:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">pxe-server=x86PC,&quot;Arranque local&quot;,local.ipxe</span>
<span class="go">pxe-server=x86PC,&quot;Slitaz por red&quot;,slitaz.ipxe</span>
<span class="go">pxe-server=x86PC,&quot;Shell de iPXE&quot;,shell.ipxe</span>
<span class="go">pxe-server=x86PC,&quot;Reiniciar&quot;,reboot.ipxe</span>
</pre></div>
</div>
<p>Como vemos, cada ítem carga un <em>script</em> distinto.</p>
</dd>
<dt class="label" id="id20"><span class="brackets"><a class="fn-backref" href="#id7">5</a></span></dt>
<dd><p>En versiones más antiguas quizás tenga que recurrir a la sección
<code class="docutils literal notranslate"><span class="pre">pxebs</span></code>, en vez de a <code class="docutils literal notranslate"><span class="pre">proxydhcp</span></code>.</p>
</dd>
<dt class="label" id="id21"><span class="brackets"><a class="fn-backref" href="#id8">6</a></span></dt>
<dd><p>Para acceder a ella basta con pulsar <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Ctrl</kbd>+<kbd class="kbd docutils literal notranslate">B</kbd></kbd> durante el proceso de
obtención de <abbr title="Internet Protocol">IP</abbr>.</p>
</dd>
<dt class="label" id="id22"><span class="brackets"><a class="fn-backref" href="#id9">7</a></span></dt>
<dd><p>Es cierto que para el nombre de dominio, no es necesario recurrir al
número de opción, ya que <strong class="program">iPXE</strong> le dedica la variable <kbd class="kbd docutils literal notranslate">${domain}</kbd>.</p>
</dd>
<dt class="label" id="id23"><span class="brackets"><a class="fn-backref" href="#id12">8</a></span></dt>
<dd><p>Unas buenas páginas de referencia son <a class="reference external" href="https://www.syslinux.org/wiki/index.php?title=SYSLINUX">èsta</a> y <a class="reference external" href="https://www.syslinux.org/wiki/index.php?title=Config">esta otra</a>, ambas
pertenecientes a la <em>wiki</em> del proyecto.</p>
</dd>
<dt class="label" id="id24"><span class="brackets"><a class="fn-backref" href="#id13">9</a></span></dt>
<dd><p>Véase la explicación sobre <a class="reference external" href="https://www.syslinux.org/wiki/index.php?title=SYSLINUX#KERNEL_file">esta directiva en la wiki</a>.</p>
</dd>
<dt class="label" id="id25"><span class="brackets"><a class="fn-backref" href="#id14">10</a></span></dt>
<dd><p>La entrada no es equivalente: la otra continuaba la secuencia de
arranque, cuyo siguiente dispositivo podía ser otro (el <em>cdrom</em> por ejemplo)</p>
</dd>
<dt class="label" id="id26"><span class="brackets"><a class="fn-backref" href="#id15">11</a></span></dt>
<dd><p>Por ejemplo, la estupenda <a class="reference external" href="http://www.slax.org/">slax</a>.</p>
</dd>
</dl>
</section>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Tabla de contenido</a></h3>
  <ul>
<li><a class="reference internal" href="#">7.6.2. <abbr title="Network Bootstrap Program">NBP</abbr></a><ul>
<li><a class="reference internal" href="#carga">7.6.2.1. Carga</a><ul>
<li><a class="reference internal" href="#dhcp">7.6.2.1.1. <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr></a></li>
<li><a class="reference internal" href="#pxe">7.6.2.1.2. <abbr title="Preboot eXecution Environment">PXE</abbr></a></li>
</ul>
</li>
<li><a class="reference internal" href="#ipxe">7.6.2.2. <strong class="program">iPXE</strong></a><ul>
<li><a class="reference internal" href="#como-usarlo">7.6.2.2.1. Cómo usarlo</a></li>
<li><a class="reference internal" href="#como-funciona">7.6.2.2.2. Cómo funciona</a></li>
<li><a class="reference internal" href="#consejos">7.6.2.2.3. Consejos</a></li>
</ul>
</li>
<li><a class="reference internal" href="#syslinux">7.6.2.3. <strong class="program">syslinux</strong></a><ul>
<li><a class="reference internal" href="#estructura">7.6.2.3.1. Estructura</a></li>
<li><a class="reference internal" href="#id11">7.6.2.3.2. Cómo funciona</a></li>
<li><a class="reference internal" href="#configuracion">7.6.2.3.3. Configuración</a><ul>
<li><a class="reference internal" href="#sin-menu">7.6.2.3.3.1. Sin menú</a></li>
<li><a class="reference internal" href="#menu-no-grafico">7.6.2.3.3.2. Menú no gráfico</a></li>
<li><a class="reference internal" href="#menu-grafico">7.6.2.3.3.3. Menú gráfico</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Tema anterior</h4>
  <p class="topless"><a href="01.desc.html"
                        title="capítulo anterior"><span class="section-number">7.6.1. </span>Conceptos</a></p>
  <h4>Próximo tema</h4>
  <p class="topless"><a href="03.implementacion.html"
                        title="próximo capítulo"><span class="section-number">7.6.3. </span>Implementación</a></p>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/07.serre/06.pxe/02.nbp.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Ir a" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="03.implementacion.html" title="7.6.3. Implementación"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="01.desc.html" title="7.6.1. Conceptos"
             >anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" ><span class="section-number">7. </span>Servicios de red</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" ><span class="section-number">7.6. </span>PXE</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">7.6.2. </span><abbr title="Network Bootstrap Program">NBP</abbr></a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Derechos de autor CC BY 4.0, 2016-2022, José Miguel Sánchez Alés.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.3.2.
    </div>
  </body>
</html>