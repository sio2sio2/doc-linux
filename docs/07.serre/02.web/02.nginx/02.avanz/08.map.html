


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="es">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>7.2.2.2.9. Definición mediante mapeo &#8212; documentación de ServidorLinux - 0.1.0</title>
    <link rel="stylesheet" href="../../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/custom.css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../../../_static/translations.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Índice" href="../../../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../../../search.html" />
    <link rel="next" title="7.2.2.2.10. Compresión" href="09.gzip.html" />
    <link rel="prev" title="7.2.2.2.8. Conexión segura" href="07.https.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="09.gzip.html" title="7.2.2.2.10. Compresión"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="07.https.html" title="7.2.2.2.8. Conexión segura"
             accesskey="P">anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">documentación de ServidorLinux - 0.1.0</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >7. Servicios de red</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../index.html" >7.2. Web</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" >7.2.2. nginx</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="index.html" accesskey="U">7.2.2.2. Configuración</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="definicion-mediante-mapeo">
<h1>7.2.2.2.9. Definición mediante mapeo<a class="headerlink" href="#definicion-mediante-mapeo" title="Enlazar permanentemente con este título">¶</a></h1>
<p>Si requerimos definir una variable dependiendo del valor de otra, disponemos de
la directiva <a class="reference external" href="http://nginx.org/en/docs/http/ngx_http_map_module.html#map">map</a>:</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="k">map</span> <span class="nv">$host</span> <span class="nv">$dominio</span> <span class="p">{</span>
   <span class="kn">hostnames</span><span class="p">;</span>

   <span class="kn">default</span>              <span class="s">&quot;desconocido&quot;</span><span class="p">;</span>
   <span class="kn">*.example.net</span>        <span class="s">&quot;example&quot;</span><span class="p">;</span>
   <span class="kn">*.dominio.org</span>        <span class="s">&quot;dominio&quot;</span><span class="p">;</span>
   <span class="kn">~[^.]+\.otro\.[^.]+</span>  <span class="s">&quot;otro&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>En este caso, se define la variable <code class="docutils literal notranslate"><span class="pre">$dominio</span></code> a partir de los valores de la
variable <code class="docutils literal notranslate"><span class="pre">$host</span></code>. Se comprueba si el valor de esta última concuerda con
alguna entrada de la izquierda y, si es así, se asigna el valor de la columna
derecha correspondiente. Si no hay concordancia, se usa la entrada <em>default</em>.
Además, se puede incluir la palabra <kbd class="kbd docutils literal notranslate">hostnames</kbd> para expresar que lo
contenido son nombres de máquina y que se entienda la notación con asterisco.
Si la lista es larga, puede usarse <code class="docutils literal notranslate"><span class="pre">include</span></code>:</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="k">map</span> <span class="nv">$host</span> <span class="nv">$dominio</span> <span class="p">{</span>
   <span class="kn">hostnames</span><span class="p">;</span>

   <span class="kn">include</span> <span class="s">dominios.txt</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>y en el fichero <code class="file docutils literal notranslate"><span class="pre">/etc/nginx/dominios.txt</span></code> escribir la lista de dos
columnas.</p>
<p>Dado que el módulo <a class="reference external" href="http://nginx.org/en/docs/http/ngx_http_referer_module.html">ngx_http_referer</a> no está incluido
en el ejecutable que viene en el paquete <em>nginx-light</em> y el paquete no es
instalable de forma separada, podríamos emular medianamente el comportamiento de
<code class="docutils literal notranslate"><span class="pre">$invalid_referer</span></code> del siguiente modo:</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="k">map</span> <span class="nv">$http_referer</span> <span class="nv">$invalid_referer</span> <span class="p">{</span>
   <span class="kn">default</span>                 <span class="mi">1</span><span class="p">;</span>

   <span class="c1"># Dominios  para los que se permite se considera válido el referer.</span>
   <span class="kn">&quot;~www.example.net&quot;</span>      <span class="mi">0</span><span class="p">;</span>
   <span class="kn">&quot;~example.net&quot;</span>          <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Tema anterior</h4>
  <p class="topless"><a href="07.https.html"
                        title="capítulo anterior">7.2.2.2.8. Conexión segura</a></p>
  <h4>Próximo tema</h4>
  <p class="topless"><a href="09.gzip.html"
                        title="próximo capítulo">7.2.2.2.10. Compresión</a></p>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../../../../_sources/07.serre/02.web/02.nginx/02.avanz/08.map.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Ir a" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="09.gzip.html" title="7.2.2.2.10. Compresión"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="07.https.html" title="7.2.2.2.8. Conexión segura"
             >anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">documentación de ServidorLinux - 0.1.0</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >7. Servicios de red</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../index.html" >7.2. Web</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" >7.2.2. nginx</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="index.html" >7.2.2.2. Configuración</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Derechos de autor 2016, José Miguel Sánchez Alés.
      Creado con <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>