


<!DOCTYPE html>

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>7.2.2.3.5. Wordpress &#8212; documentación de Linuxnomicón - rolling</title>
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/translations.js"></script>
    
    <link rel="index" title="Índice" href="../../../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../../../search.html" />
    <link rel="next" title="7.2.2.3.6. Moodle" href="04.moodle.html" />
    <link rel="prev" title="7.2.2.3.4. Webmail" href="02.webmail.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="04.moodle.html" title="7.2.2.3.6. Moodle"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="02.webmail.html" title="7.2.2.3.4. Webmail"
             accesskey="P">anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" ><span class="section-number">7. </span>Servicios de red</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../index.html" ><span class="section-number">7.2. </span>Web</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" ><span class="section-number">7.2.2. </span>nginx</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="index.html" accesskey="U"><span class="section-number">7.2.2.3. </span>Recetas</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">7.2.2.3.5. </span>Wordpress</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="wordpress">
<span id="nginx-wordpress"></span><h1><span class="section-number">7.2.2.3.5. </span>Wordpress<a class="headerlink" href="#wordpress" title="Enlazar permanentemente con este título">¶</a></h1>
<p><a class="reference external" href="http://wordpress.org">wordpress</a> es un <abbr title="Content Management System">CMS</abbr> orientado a la creación de
<em>blogs</em>, aunque se usa también incluso para crear sitios <em>web</em> generales.</p>
<p>Lo habitual es que se instale para albergar un único <em>blog</em>, pero es posible
también hacer una instalación que permita la gestión de varios, cada uno de los
cuales con su administrador. Ambas instalaciones las trataremos bajo este
epígrafe.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>En el momento de la escritura de estos párrafos la última versión
de <strong class="program">wordpress</strong> es la <strong>4.9.4</strong>.</p>
</div>
<div class="section" id="blog-unico">
<span id="nginx-wordpress-mono"></span><h2><span class="section-number">7.2.2.3.5.1. </span>Blog único<a class="headerlink" href="#blog-unico" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="section" id="preliminares">
<h3><span class="section-number">7.2.2.3.5.1.1. </span>Preliminares<a class="headerlink" href="#preliminares" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Se supone instalado ya un servidor <a class="reference internal" href="../index.html#n-ginx"><span class="std std-ref">nginx</span></a> con soporte para
contenido dinámico en <abbr title="PHP Hypertext Preprocessor">PHP</abbr> y <em>MySQL</em>, que reservaremos para
<strong class="program">wordpress</strong> el nombre <em>blog.example.net</em> y que albergaremos la
aplicación en <code class="file docutils literal notranslate"><span class="pre">/srv/www/blog</span></code>.</p>
<p>Se necesitan, adicionalmente, los siguientes módulos de <abbr title="PHP Hypertext Preprocessor">PHP</abbr>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> apt-get install php-<span class="o">{</span>gd,mbstring,xml<span class="o">{</span>,rpc<span class="o">}}</span>
</pre></div>
</div>
<p>Además es necesario crear una base de datos para <strong class="program">wordpress</strong> y un
usuario que la gestione:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> mysql
<span class="go">mysql&gt; CREATE DATABASE wordpress;</span>
<span class="go">mysql&gt; GRANT ALL PRIVILEGES ON wordpress.* TO &#39;wordpress&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;contraseñadificil&#39;;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>El usuario y la contraseña sólo serán necesarios recordarlos para el
proceso de instalación con <strong class="program">wordpress</strong>, así que no es demasiado
molesto que ambos sean complicadísimos.</p>
</div>
<p>Por último, debe descargarse y descomprimirse <strong class="program">wordpress</strong> en
<code class="file docutils literal notranslate"><span class="pre">/srv/www/blog</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> mkdir -p /srv/www/blog
<span class="gp">#</span> wget -q http://wordpress.org/latest.tar.gz -O - <span class="p">|</span> tar -C /srv/www/blog --strip-components<span class="o">=</span><span class="m">1</span> -zxvf -
<span class="gp">#</span> chown -R www-data /srv/www/blog
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Durante la instalación damos la propiedad de toda la aplicación al
usuario <em>www-data</em>, es decir, a aquel que ejecuta el servidor <em>web</em>. Esto
permitirá que el proceso de instalación pueda hacer las modificaciones
pertinentes sin problemas. Tras instalar, corregiremos esto para mejorar la
seguridad del sitio.</p>
</div>
</div>
<div class="section" id="configuracion-de-nginx">
<span id="nginx-wordpress-simple"></span><h3><span class="section-number">7.2.2.3.5.1.2. </span>Configuración de <strong class="program">nginx</strong><a class="headerlink" href="#configuracion-de-nginx" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Como la aplicación requiere la introducción de contraseñas, es conveniente que
corra en un sitio seguro, así que podemos utilizar <a class="reference download internal" download="" href="../../../../_downloads/a0f8285a43f3e7ac45bd6c3f49ce1915/site-blog"><code class="xref download docutils literal notranslate"><span class="pre">esta</span> <span class="pre">configuración</span></code></a>:</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="k">server</span> <span class="p">{</span>
   <span class="kn">listen</span>  <span class="mi">80</span><span class="p">;</span>
   <span class="kn">listen</span> <span class="mi">443</span> <span class="s">ssl</span><span class="p">;</span>

   <span class="kn">server_name</span> <span class="s">blog.example.net</span><span class="p">;</span>

   <span class="kn">root</span> <span class="s">/srv/www/blog</span><span class="p">;</span>
   <span class="kn">try_files</span> <span class="nv">$uri</span> <span class="nv">$uri/</span> <span class="s">/index.php</span><span class="nv">$is_args$args</span><span class="p">;</span>
   <span class="kn">index</span> <span class="s">index.php</span><span class="p">;</span>

   <span class="kn">include</span> <span class="s">snippets/snakeoil.conf</span><span class="p">;</span>

   <span class="c1"># Separamos los logs en ficheros aparte</span>
   <span class="kn">access_log</span>   <span class="s">/var/log/nginx/blog.access.log</span><span class="p">;</span>
   <span class="kn">error_log</span>    <span class="s">/var/log/nginx/blog.error.log</span><span class="p">;</span>

   <span class="c1"># Redirección al sitio seguro</span>
   <span class="kn">if</span> <span class="s">(</span><span class="nv">$https</span> <span class="s">!=</span> <span class="s">&quot;on&quot;)</span> <span class="p">{</span>
      <span class="kn">return</span> <span class="mi">301</span> <span class="s">https://</span><span class="nv">$host$request_uri</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="kn">include</span> <span class="s">snippets/robotsoff.conf</span><span class="p">;</span>
   <span class="kn">include</span> <span class="s">snippets/faviconoff.conf</span><span class="p">;</span>

   <span class="c1"># Evita que se ejecute cualquier</span>
   <span class="c1"># script php subido por el usuario.</span>
   <span class="kn">location</span> <span class="s">^~</span> <span class="s">/wp-content/uploads/</span> <span class="p">{</span>
      <span class="kn">expires</span> <span class="s">max</span><span class="p">;</span>
      <span class="kn">access_log</span> <span class="no">off</span><span class="p">;</span>
      <span class="kn">log_not_found</span> <span class="no">off</span><span class="p">;</span>
   <span class="p">}</span> 

   <span class="kn">location</span> <span class="p">~</span> <span class="sr">\.php$</span> <span class="p">{</span>
      <span class="kn">include</span> <span class="s">snippets/fastcgi-php.conf</span><span class="p">;</span>
      <span class="kn">fastcgi_pass</span> <span class="s">php</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="kn">location</span> <span class="p">~</span><span class="sr">*</span> <span class="s">\.(?:js|css|jpe?g|gif|htc|ico|png|html|xml|otf|ttf|eot|woff2?|svg)</span>$ <span class="p">{</span>
      <span class="kn">expires</span> <span class="s">max</span><span class="p">;</span>
      <span class="kn">access_log</span> <span class="no">off</span><span class="p">;</span>
      <span class="kn">log_not_found</span> <span class="no">off</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p id="nginx-faviconoff"><span id="nginx-robotsoff"></span>La configuración incluye dos <em>snippets</em>:</p>
<dl>
<dt><code class="file docutils literal notranslate"><span class="pre">robotsoff.conf</span></code></dt><dd><p>que deshabilita el registro de las consultas al fichero <a class="reference external" href="https://es.wikipedia.org/wiki/Est%C3%A1ndar_de_exclusi%C3%B3n_de_robots">robots.txt</a>:</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="c1"># /etc/nginx/snippets/robotsoff.conf</span>
<span class="k">location</span> <span class="p">=</span> <span class="s">/robots.txt</span> <span class="p">{</span>
        <span class="kn">allow</span> <span class="s">all</span><span class="p">;</span>
        <span class="kn">log_not_found</span> <span class="no">off</span><span class="p">;</span>
        <span class="kn">access_log</span> <span class="no">off</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
<dt><code class="file docutils literal notranslate"><span class="pre">faviconoff.conf</span></code></dt><dd><p>que deshabilita el registro de acceso al <a class="reference external" href="https://es.wikipedia.org/wiki/Favicon">favicon</a>:</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="c1"># /etc/nginx/snippets/faviconoff.conf</span>
<span class="k">location</span> <span class="p">=</span> <span class="s">/favicon.ico</span> <span class="p">{</span>
   <span class="kn">log_not_found</span> <span class="no">off</span><span class="p">;</span>
   <span class="kn">access_log</span> <span class="no">off</span><span class="p">;</span>
   <span class="kn">return</span> <span class="mi">410</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="instalacion">
<span id="wp-permisos"></span><h3><span class="section-number">7.2.2.3.5.1.3. </span>Instalación<a class="headerlink" href="#instalacion" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Basta con visitar el sitio desde un navegador y seguir las sencillísimas
instrucciones. Al término, conviene cambiar los permisos para aumentar la
seguridad del sitio:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> chown -R root:root /srv/www/blog
<span class="gp">#</span> chown -R www-data /srv/www/blog/wp-<span class="o">{</span>config.php,content<span class="o">}</span>
</pre></div>
</div>
<p id="nginx-plugins">Además, si se quiere permitir la instalación de <em>plugins</em> desde la interfaz
<em>web</em>, debe añadirse la siguiente línea al fichero <code class="file docutils literal notranslate"><span class="pre">wp-config.php</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> Instalación directa de plugins
<span class="go">define(&#39;FS_METHOD&#39;, &#39;direct&#39;);</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Esta línea (y otras que se añadan a mano más adelante) deben
añadirse siempre antes de la línea que reza:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">/* That&#39;s all, stop editing! Happy blogging. */</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="optimizaciones">
<span id="nginx-wordpress-optimo"></span><h3><span class="section-number">7.2.2.3.5.1.4. </span>Optimizaciones<a class="headerlink" href="#optimizaciones" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="section" id="cacheo-de-contenido-dinamico">
<h4><span class="section-number">7.2.2.3.5.1.4.1. </span>Cacheo de contenido dinámico<a class="headerlink" href="#cacheo-de-contenido-dinamico" title="Enlazar permanentemente con este título">¶</a></h4>
<p>El rendimiento de nuestra <em>blog</em> puede verse mejorado muy sensiblemente si
habilitamos una caché para las páginas dinámicas, de manera que el código <abbr title="PHP Hypertext Preprocessor">PHP</abbr>
sólo vuelva a generar la página, si esta realmente ha cambiado; en caso
contrario echaremos mano de la página cacheada.</p>
<p>Para este propósito necesitamos dos componentes:</p>
<ol class="arabic simple">
<li><p>Habilitar la capacidad de <em>proxy</em> caché de <strong class="program">nginx</strong>, de manera
semejante a como lo hicimos para <a class="reference internal" href="01.dpkg-cache.html#nginx-debcache"><span class="std std-ref">crear la caché de paquetes de debian</span></a>, pero en este caso cacheando <em>fastcgi</em>.</p></li>
<li><p>Un plugin de <strong class="program">wordpress</strong>, <a class="reference external" href="https://es.wordpress.org/plugins/nginx-cache/">nginx cache</a>, que ordene a
<strong class="program">nginx</strong> borrar las páginas cacheadas que han sufrido algún cambio
al producirse una acción en <strong class="program">nginx</strong>.</p></li>
</ol>
<p>Para lo primero basta con crear un directorio adecuado que, por coherencia con
el epígrafe dedicado a la otra cache, llamaremos:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> mkdir -pm700 /var/cache/nginx
<span class="gp">#</span> chown www-data /var/cache/nginx
</pre></div>
</div>
<p>y modificar el <a class="reference download internal" download="" href="../../../../_downloads/a0f8285a43f3e7ac45bd6c3f49ce1915/site-blog"><code class="xref download docutils literal notranslate"><span class="pre">fichero</span> <span class="pre">de</span> <span class="pre">configuración</span> <span class="pre">ya</span> <span class="pre">propuesto</span></code></a> para añadir<a class="footnote-reference brackets" href="#id14" id="id2">1</a>:</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="k">fastcgi_cache_path</span> <span class="s">/var/cache/nginx/wp-cache</span>
</span><span class="hll">                   <span class="s">levels=1:2</span>
</span><span class="hll">                   <span class="s">keys_zone=wp-cache:100m</span>
</span><span class="hll">                   <span class="s">inactive=60m</span><span class="p">;</span>
</span>
<span class="k">server</span> <span class="p">{</span>

   <span class="c1"># Configuracion...</span>

   <span class="kn">include</span> <span class="s">snippets/robotsoff.conf</span><span class="p">;</span>
   <span class="kn">include</span> <span class="s">snippets/faviconoff.conf</span><span class="p">;</span>

<span class="hll">   <span class="c1"># Evitamos cachear el panel de administración, porque</span>
</span><span class="hll">   <span class="c1"># el plugin no parece funcionar bien y no lo purga cuando debe.</span>
</span><span class="hll">   <span class="kn">set</span> <span class="nv">$skip_cache</span> <span class="mi">0</span><span class="p">;</span>
</span><span class="hll">   <span class="kn">if</span> <span class="s">(</span> <span class="nv">$request_uri</span> <span class="p">~</span> <span class="sr">/wp-admin/</span> <span class="s">)</span> <span class="p">{</span>
</span><span class="hll">      <span class="kn">set</span> <span class="nv">$skip_cache</span> <span class="mi">1</span><span class="p">;</span>
</span><span class="hll">   <span class="p">}</span>
</span>
   <span class="c1"># Evita que se ejecute cualquier</span>
   <span class="c1"># script php subido por el usuario.</span>
   <span class="kn">location</span> <span class="s">^~</span> <span class="s">/wp-content/uploads/</span> <span class="p">{</span>
      <span class="kn">expires</span> <span class="s">max</span><span class="p">;</span>
      <span class="kn">access_log</span> <span class="no">off</span><span class="p">;</span>
      <span class="kn">log_not_found</span> <span class="no">off</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="kn">location</span> <span class="p">~</span> <span class="sr">\.php$</span> <span class="p">{</span>
      <span class="kn">include</span> <span class="s">snippets/fastcgi-php.conf</span><span class="p">;</span>
      <span class="kn">fastcgi_pass</span> <span class="s">php</span><span class="p">;</span>

<span class="hll">      <span class="kn">fastcgi_no_cache</span> <span class="nv">$skip_cache</span><span class="p">;</span>
</span><span class="hll">      <span class="kn">fastcgi_cache</span> <span class="s">wp-cache</span><span class="p">;</span>
</span><span class="hll">      <span class="kn">fastcgi_cache_valid</span> <span class="mi">60m</span><span class="p">;</span>
</span><span class="hll">      <span class="kn">fastcgi_cache_bypass</span> <span class="nv">$http_pragma</span><span class="p">;</span>  <span class="c1"># Evita la cache con Ctrl+F5 (Pragma: no-cache)</span>
</span><span class="hll">      <span class="kn">fastcgi_cache_key</span> <span class="s">&quot;</span><span class="nv">$scheme$request_method$host$request_uri&quot;</span><span class="p">;</span>
</span><span class="hll">      <span class="kn">fastcgi_cache_use_stale</span> <span class="s">error</span> <span class="s">timeout</span> <span class="s">invalid_header</span> <span class="s">http_500</span><span class="p">;</span>
</span><span class="hll">      <span class="kn">fastcgi_ignore_headers</span> <span class="s">Cache-Control</span> <span class="s">Expires</span> <span class="s">Set-Cookie</span><span class="p">;</span>
</span><span class="hll">      <span class="kn">add_header</span> <span class="s">X-RunCloud-Cache</span> <span class="nv">$upstream_cache_status</span><span class="p">;</span>
</span>   <span class="p">}</span>

   <span class="c1"># Resto de configuración ...</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">Ver también</p>
<p>Para saber más sobre el cacheo de contenido dinámico, consulte
<a class="reference internal" href="../02.avanz/06.dynamic.html#nginx-fastcgi-cache"><span class="std std-ref">el apartado dedicado a ello</span></a>.</p>
</div>
<p>Para lo segundo, no hay más que instalar el <em>plugin</em> y, al configurarlo, indicar
cuál es el fichero de caché.</p>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Sobre esta configuración es indispensable hacer dos precisiones:</p>
<ul>
<li><p>El <em>plugin</em> no se comporta bien con las páginas del panel de administración,
por lo que debemos evitar cachearlas según se propone en la configuración
de más arriba.</p></li>
<li><p>Es una <a class="reference internal" href="#nginx-wordpress-multi"><span class="std std-ref">instalación multisitio</span></a> es necesario:</p>
<ul>
<li><p>Configurar el <em>plugin</em> para cada blog particular.</p></li>
<li><p>El bloque:</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="s">(!-e</span> <span class="nv">$request_filename</span><span class="s">)</span> <span class="p">{</span>
      <span class="kn">rewrite</span> <span class="s">^/wp-admin/network(/.*)</span> <span class="s">/wp-admin</span><span class="nv">$1</span> <span class="s">last</span><span class="p">;</span>
      <span class="kn">rewrite</span> <span class="s">^(?:/[^/]+)?(/.*)</span> <span class="nv">$1</span> <span class="s">last</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>no</strong> debe situarse antes del bloque condicional que fija el valor de la
variable <em>$skip_cache</em>.</p>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="cacheo-de-contenido-estatico">
<h4><span class="section-number">7.2.2.3.5.1.4.2. </span>Cacheo de contenido estático<a class="headerlink" href="#cacheo-de-contenido-estatico" title="Enlazar permanentemente con este título">¶</a></h4>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Esta optimización es independiente de la anterior, así que si se
quiere aplicar las dos no hay más que incluir los cambios expuestos bajo el
epígrafe anterior a la configuración sugerida bajo éste.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Aunque bajo en el epígrafe se entremezclen, esta optimización sobre
contenido estático, se basa en dos aspectos que pueden ser implementados
independientemente:</p>
<ul class="simple">
<li><p>En que <a class="reference internal" href="../index.html#n-ginx"><span class="std std-ref">nginx</span></a> indexe los contenidos estáticos para que sea
capaz de servirlos más eficientemente (las sentencias
<code class="code docutils literal notranslate"><span class="pre">open_file_cache</span></code>).</p></li>
<li><p>En que los contenidos estáticos se sirvan con otro nombre
(<em>static.example.net</em>) a fin de que con este nombre la transferencia sea
<abbr title="HyperText Transfer Protocol">HTTP</abbr> y no <abbr title="HyperText Transfer Protocol">HTTP</abbr>s, lo cual permitirá a proxies intermedios cachear ese
contenido. Ahora bien, esto sólo funciona si el certificado es válido y
acreditado, ya que en caso contrario el navegador rechazará los contenidos
de <em>static.example.net</em> sin llegar a preguntarnos si confiamos en el
certificado para este segundo sitio, pues nunca entramos explícitamente en
el.</p></li>
</ul>
<p>Si utiliza un servicio como <a class="reference internal" href="../../../../08.redes/99.ataques/02.tecnicas/00.dos.html#dos-cloudflare"><span class="std std-ref">Cloudflare</span></a> este segundo
aspecto es absolutamente irrelevante, ya que este proxy se encarga de
descifrar y recifrar para el cliente; y sólo tiene interés implmentar el
primer aspeecto.</p>
</div>
<p>La configuración sugerida para <strong class="program">nginx</strong> obliga a que toda la
comunicación sea segura. Sin embargo, que la configuración sea segura tiene un
pequeño inconveniente: inutiliza los <em>proxies</em> caché intermedios ya que todo
está cifrado, incluso las cabeceras. Por ello, vamos a hacer lo siguiente:</p>
<ul class="simple">
<li><p>Crearemos otro nombre de máquina <em>static.example.net</em>.</p></li>
<li><p>Modificaremos la configuración de <strong class="program">wordpress</strong> para que el contenido
estático lo pida a través de este nombre y para que las <em>cookies</em> estén
asociadas exclusivamente al otro (<em>blog.example.net</em>).</p></li>
<li><p>Modificamos <strong class="program">nginx</strong> para que al pedir contenido estático, excepto
javascript y <abbr title="CSS Cascade StyleSheets">CSS</abbr><a class="footnote-reference brackets" href="#id15" id="id3">2</a>, la petición se redirija al sitio no seguro.</p></li>
</ul>
<dl class="simple">
<dt><strong>Ventajas</strong></dt><dd><ol class="arabic simple">
<li><p>Como la solicitud de contenido estático no incluye <em>cookie</em> alguna,
podemos cachear con el propio <em>nginx</em> el contenido.</p></li>
<li><p>Si hay un <em>proxy</em> intermedio que cachea contenidos, todo nuestro contenido
estático, excepto javascript y css, lo cacheará también.</p></li>
</ol>
</dd>
<dt><strong>Desventajas</strong></dt><dd><ol class="arabic simple">
<li><p>El contenido estático no seguro se pide dos veces: primero por <abbr title="HyperText Transfer Protocol">HTTP</abbr>s y
luego por <abbr title="HyperText Transfer Protocol">HTTP</abbr>, que es cuando se sirve. En cualquier caso, como la
redirección es permanente (código <strong>301</strong>), cada navegador sólo repetirá
la petición una vez.</p></li>
</ol>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>El cacheo local de contenidos que permite a <strong class="program">nginx</strong> acelerar
el servicio de contenido estático es independiente de que los contenidos se
sirvan por protocolo seguro o no. Por tanto, podríamos poner en práctica la
mitad de esta configuración (la referente a las directivas
<code class="docutils literal notranslate"><span class="pre">open_file_cache</span></code>) sin llegar a hacer la redirección hacia el sitio no
seguro.</p>
</div>
<p>Para llevarlo a cabo hay que editar el fichero <code class="file docutils literal notranslate"><span class="pre">wp-config.php</span></code> del
directorio raíz de <strong class="program">wordpress</strong> y añadir estas tres líneas al comienzo
del fichero:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">define(&quot;WP_CONTENT_URL&quot;, &quot;https://static.example.net/wp-content&quot;);</span>
<span class="go">define(&quot;COOKIE_DOMAIN&quot;, &quot;blog.example.net&quot;);</span>
<span class="go">define(&quot;WP_PLUGIN_URL&quot;, &quot;https://static.example.net/wp-content/plugins&quot;);</span>
</pre></div>
</div>
<p>Y dejar una <a class="reference download internal" download="" href="../../../../_downloads/188de78631fec616805eef7de58b2939/site-blog.alternativo"><code class="xref download docutils literal notranslate"><span class="pre">configuración</span> <span class="pre">para</span> <span class="pre">nginx</span> <span class="pre">como</span> <span class="pre">esta</span></code></a><a class="footnote-reference brackets" href="#id16" id="id4">3</a>:</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="k">server</span> <span class="p">{</span>
   <span class="kn">listen</span>  <span class="mi">80</span><span class="p">;</span>
   <span class="kn">listen</span> <span class="mi">443</span> <span class="s">ssl</span><span class="p">;</span>

   <span class="kn">server_name</span> <span class="s">blog.example.net</span>
<span class="hll">               <span class="s">static.example.net</span><span class="p">;</span>
</span>
   <span class="kn">root</span> <span class="s">/srv/www/blog</span><span class="p">;</span>
   <span class="kn">index</span> <span class="s">index.php</span><span class="p">;</span>

   <span class="kn">include</span> <span class="s">snippets/snakeoil.conf</span><span class="p">;</span>

<span class="hll">   <span class="kn">access_log</span>     <span class="no">off</span><span class="p">;</span>
</span><span class="hll">   <span class="kn">log_not_found</span>  <span class="no">off</span><span class="p">;</span>
</span>   <span class="kn">error_log</span>    <span class="s">/var/log/nginx/blog.error.log</span><span class="p">;</span>

   <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
      <span class="kn">try_files</span> <span class="nv">$uri</span> <span class="nv">$uri/</span> <span class="s">/index.php</span><span class="nv">$is_args$args</span><span class="p">;</span>

      <span class="c1"># Redirección al sitio seguro</span>
      <span class="kn">if</span> <span class="s">(</span><span class="nv">$https</span> <span class="s">!=</span> <span class="s">&quot;on&quot;)</span> <span class="p">{</span>
         <span class="kn">return</span> <span class="mi">301</span> <span class="s">https://</span><span class="nv">$host/$request_uri</span><span class="p">;</span>
      <span class="p">}</span>

<span class="hll">      <span class="kn">location</span> <span class="p">~</span><span class="sr">*</span> <span class="s">\.(?:js|css)</span>$ <span class="p">{</span>
</span><span class="hll">         <span class="c1"># Habilitamos la caché de nginx</span>
</span><span class="hll">         <span class="kn">open_file_cache</span> <span class="s">max=3000</span> <span class="s">inactive=120s</span><span class="p">;</span>
</span><span class="hll">         <span class="kn">open_file_cache_valid</span> <span class="s">45s</span><span class="p">;</span>
</span><span class="hll">         <span class="kn">open_file_cache_min_uses</span> <span class="mi">2</span><span class="p">;</span>
</span><span class="hll">         <span class="kn">open_file_cache_errors</span> <span class="no">off</span><span class="p">;</span>
</span><span class="hll">      <span class="p">}</span>
</span>
      <span class="kn">location</span> <span class="s">^~</span> <span class="s">/wp-content/uploads/</span> <span class="p">{</span>
         <span class="kn">expires</span> <span class="s">max</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="kn">location</span> <span class="p">~</span> <span class="sr">\.php$</span> <span class="p">{</span>
         <span class="kn">access_log</span>     <span class="s">/var/log/nginx/blog.access.log</span><span class="p">;</span>
         <span class="kn">log_not_found</span>  <span class="no">on</span><span class="p">;</span>

         <span class="kn">include</span> <span class="s">snippets/fastcgi-php.conf</span><span class="p">;</span>
         <span class="kn">fastcgi_pass</span> <span class="s">php</span><span class="p">;</span>
      <span class="p">}</span>
   <span class="p">}</span>

<span class="hll">   <span class="kn">location</span> <span class="p">~</span><span class="sr">*</span> <span class="s">\.(?:jpe?g|gif|htc|ico|png|html|xml|otf|ttf|eot|woff2?|svg)</span>$ <span class="p">{</span>
</span><span class="hll">      <span class="kn">expires</span> <span class="s">max</span><span class="p">;</span>
</span><span class="hll">
</span><span class="hll">      <span class="c1"># Habilitamos la caché de nginx</span>
</span><span class="hll">      <span class="kn">open_file_cache</span> <span class="s">max=3000</span> <span class="s">inactive=120s</span><span class="p">;</span>
</span><span class="hll">      <span class="kn">open_file_cache_valid</span> <span class="s">45s</span><span class="p">;</span>
</span><span class="hll">      <span class="kn">open_file_cache_min_uses</span> <span class="mi">2</span><span class="p">;</span>
</span><span class="hll">      <span class="kn">open_file_cache_errors</span> <span class="no">off</span><span class="p">;</span>
</span><span class="hll">
</span><span class="hll">      <span class="c1"># Redirección al sitio no seguro</span>
</span><span class="hll">      <span class="kn">set</span> <span class="nv">$check_ssl</span> <span class="s">&quot;</span><span class="nv">${https}${host}&quot;</span><span class="p">;</span>
</span><span class="hll">      <span class="kn">if</span> <span class="s">(</span><span class="nv">$check_ssl</span> <span class="p">=</span> <span class="s">&quot;onstatic.example.net&quot;)</span> <span class="p">{</span>
</span><span class="hll">         <span class="kn">return</span> <span class="mi">301</span> <span class="s">http://</span><span class="nv">$host$request_uri$is_args$args</span><span class="p">;</span>
</span><span class="hll">      <span class="p">}</span>
</span><span class="hll">   <span class="p">}</span>
</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Si quiere utilizar esta optimización y la anterior, asegúrese
de incluir el bloque que define la variable <em>$skip_cache</em> <strong>fuera</strong>
del bloque <code class="code docutils literal notranslate"><span class="pre">location</span> <span class="pre">/</span></code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Si el cambio se lleva a cabo, cuando el <em>blog</em> ya está en
funcionamiento y contiene entradas y mensajes, entonces habría que cambiar
en la base de datos referencias de <em>blog</em> a <em>static</em>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> mysql wordpress
<span class="go">mysql&gt; UPDATE wp_posts SET post_content = REPLACE(post_content,</span>
<span class="go"> -&gt; &#39;//blog.example.net/wp-content/uploads/&#39;,&#39;//static.example.net/wp-content/uploads/&#39;);</span>
</pre></div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>En una <a class="reference internal" href="#nginx-wordpress-multi"><span class="std std-ref">instalación multisitio</span></a>,
asegúrese de que el bloque:</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="s">(!-e</span> <span class="nv">$request_filename</span><span class="s">)</span> <span class="p">{</span>
   <span class="kn">rewrite</span> <span class="s">^/wp-admin/network(/.*)</span> <span class="s">/wp-admin</span><span class="nv">$1</span> <span class="s">last</span><span class="p">;</span>
   <span class="kn">rewrite</span> <span class="s">^(?:/[^/]+)?(/.*)</span> <span class="nv">$1</span> <span class="s">last</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>se encuentra fuera del bloque <code class="code docutils literal notranslate"><span class="pre">location</span> <span class="pre">/</span></code>.</p>
</div>
</div>
</div>
</div>
<div class="section" id="multisitio">
<span id="nginx-wordpress-multi"></span><h2><span class="section-number">7.2.2.3.5.2. </span>Multisitio<a class="headerlink" href="#multisitio" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Las versiones modernas de <strong class="program">wordpress</strong> (a partir de la versión <em>3.0</em>)
permiten el alojamiento de múltiples <em>blogs</em> independientes en vez de uno sólo
(que es el caso que se ha visto bajo <a class="reference internal" href="#nginx-wordpress-mono"><span class="std std-ref">el epígrafe anterior</span></a>).</p>
<p>Nuestra intención ahora es alojar una multitud de <em>blogs</em> bajo el dominio
<em>blogs.example.net</em>, de manera que se llegue a ellos a través de
subdirectorios<a class="footnote-reference brackets" href="#id17" id="id5">4</a>.  Por tanto:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Blog</p></th>
<th class="head"><p>Dirección</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>principal</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">https://blogs.example.net</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>blog2</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">https://blogs.example.net/blog2</span></code></p></td>
</tr>
<tr class="row-even"><td><p>etc</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">https://blogs.example.net/etc</span></code></p></td>
</tr>
</tbody>
</table>
<div class="section" id="id6">
<h3><span class="section-number">7.2.2.3.5.2.1. </span>Preliminares<a class="headerlink" href="#id6" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Siguiendo la <a class="reference internal" href="#nginx-wordpress-simple"><span class="std std-ref">instalación para un único blog</span></a>
necesitamos tener instalados en el servidor <a class="reference internal" href="../index.html#n-ginx"><span class="std std-ref">nginx</span></a>, <abbr title="PHP Hypertext Preprocessor">PHP</abbr> y
<em>MySQL</em>.  Hecho esto, procedemos a realizar una instalación de
<strong class="program">wordpress</strong> como si pretendiéramos configurarlo para un solo blog
usando el <a class="reference download internal" download="" href="../../../../_downloads/a0f8285a43f3e7ac45bd6c3f49ce1915/site-blog"><code class="xref download docutils literal notranslate"><span class="pre">fichero</span> <span class="pre">de</span> <span class="pre">configuración</span></code></a> ya facilitado.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Todo es igual salvo por el hecho de que, ya que la instalación nos
servirá para varios sitios, hemos decidido:</p>
<ul class="simple">
<li><p>Llamar a la máquina <em>blogs.example.net</em>.</p></li>
<li><p>Usar como directorio raíz <code class="file docutils literal notranslate"><span class="pre">/srv/www/blogs</span></code>.</p></li>
</ul>
<p>El fichero de configuración debe modificarse para que así sea.</p>
</div>
</div>
<div class="section" id="configuracion">
<h3><span class="section-number">7.2.2.3.5.2.2. </span>Configuración<a class="headerlink" href="#configuracion" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Completada la instalación de <strong class="program">wordpress</strong>, lo primero que debemos hacer
es añadir estas dos líneas a <code class="file docutils literal notranslate"><span class="pre">wp-config.php</span></code> a fin de que aparezcan las
opciones multisitio en la interfaz de administración:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> Multisitio
<span class="go">define(&#39;WP_ALLOW_MULTISITE&#39;, true);</span>
<span class="go">define(&#39;WPMU_ACCEL_REDIRECT&#39;, true);</span>
</pre></div>
</div>
<p>Hecho lo cual, debemos volver a entrar en la interfaz de administración de
wordpress, donde veremos, ahora sí, la entrada <code class="docutils literal notranslate"><span class="pre">Tools&gt;Network</span> <span class="pre">Setup</span></code>. Basta
con elegir un nombre para nuestra red de blogs y pinchar sobre <em>Install</em>. El
propio <strong class="program">wordpress</strong> nos advertirá de qué debemos escribir en el fichero
<code class="file docutils literal notranslate"><span class="pre">wp-config.php</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">define(&#39;MULTISITE&#39;, true);</span>
<span class="go">define(&#39;SUBDOMAIN_INSTALL&#39;, false);</span>
<span class="go">define(&#39;DOMAIN_CURRENT_SITE&#39;, &#39;blogs.example.net&#39;);</span>
<span class="go">define(&#39;PATH_CURRENT_SITE&#39;, &#39;/&#39;);</span>
<span class="go">define(&#39;SITE_ID_CURRENT_SITE&#39;, 1);</span>
<span class="go">define(&#39;BLOG_ID_CURRENT_SITE&#39;, 1);</span>
</pre></div>
</div>
<p>Con ello debemos modificar la configuración de <strong class="program">nginx</strong> para dejarlo de
<a class="reference download internal" download="" href="../../../../_downloads/51fe1510575fdce998bb3c2f0c85c08b/site-blog.multisitio"><code class="xref download docutils literal notranslate"><span class="pre">esta</span> <span class="pre">otra</span> <span class="pre">forma</span></code></a>:</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="k">map</span> <span class="nv">$uri</span> <span class="nv">$blogname</span> <span class="p">{</span>
</span><span class="hll">    <span class="kn">default</span> <span class="s">main</span><span class="p">;</span>  <span class="c1"># O como se quiera llamar al blog principal</span>
</span><span class="hll">    <span class="kn">~^/(?!wp-)(?P&lt;blogpath&gt;[^/]+)/.*$</span>       <span class="nv">$blogpath</span><span class="p">;</span>
</span><span class="hll"><span class="p">}</span>
</span>
<span class="k">server</span> <span class="p">{</span>
   <span class="kn">listen</span>  <span class="mi">80</span><span class="p">;</span>
   <span class="kn">listen</span> <span class="mi">443</span> <span class="s">ssl</span><span class="p">;</span>

   <span class="kn">server_name</span> <span class="s">blogs.example.net</span><span class="p">;</span>

   <span class="kn">root</span> <span class="s">/srv/www/blogs</span><span class="p">;</span>
   <span class="kn">try_files</span> <span class="nv">$uri</span> <span class="nv">$uri/</span> <span class="s">/index.php</span><span class="nv">$is_args$args</span><span class="p">;</span>
   <span class="kn">index</span> <span class="s">index.php</span><span class="p">;</span>

   <span class="kn">include</span> <span class="s">snippets/snakeoil.conf</span><span class="p">;</span>

   <span class="c1"># Separamos los logs en ficheros aparte</span>
   <span class="c1"># Pero los errores no admiten variables (https://trac.nginx.org/nginx/ticket/562)</span>
<span class="hll">   <span class="kn">access_log</span>   <span class="s">/var/log/nginx/blogs.</span><span class="nv">$blogname.access.log</span><span class="p">;</span>
</span>   <span class="kn">error_log</span>    <span class="s">/var/log/nginx/blogs.error.log</span><span class="p">;</span>

   <span class="c1"># Redirección al sitio seguro</span>
   <span class="kn">if</span> <span class="s">(</span><span class="nv">$https</span> <span class="s">!=</span> <span class="s">&quot;on&quot;)</span> <span class="p">{</span>
      <span class="kn">return</span> <span class="mi">301</span> <span class="s">https://</span><span class="nv">$host$request_uri</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="kn">include</span> <span class="s">snippets/robotsoff.conf</span><span class="p">;</span>
   <span class="kn">include</span> <span class="s">snippets/faviconoff.conf</span><span class="p">;</span>

<span class="hll">   <span class="kn">if</span> <span class="s">(!-e</span> <span class="nv">$request_filename</span><span class="s">)</span> <span class="p">{</span>
</span><span class="hll">      <span class="kn">rewrite</span> <span class="s">^/wp-admin/network(/.*)</span> <span class="s">/wp-admin</span><span class="nv">$1</span> <span class="s">last</span><span class="p">;</span>
</span><span class="hll">      <span class="kn">rewrite</span> <span class="s">^(?:/[^/]+)?(/.*)</span> <span class="nv">$1</span> <span class="s">last</span><span class="p">;</span>
</span><span class="hll">   <span class="p">}</span>
</span>
   <span class="c1"># Evita que se ejecute cualquier</span>
   <span class="c1"># script php subido por el usuario.</span>
   <span class="kn">location</span> <span class="s">^~</span> <span class="s">/wp-content/uploads/</span> <span class="p">{</span>
      <span class="kn">expires</span> <span class="s">max</span><span class="p">;</span>
      <span class="kn">access_log</span> <span class="no">off</span><span class="p">;</span>
      <span class="kn">log_not_found</span> <span class="no">off</span><span class="p">;</span>
   <span class="p">}</span> 

   <span class="kn">location</span> <span class="p">~</span> <span class="sr">\.php$</span> <span class="p">{</span>
      <span class="kn">include</span> <span class="s">snippets/fastcgi-php.conf</span><span class="p">;</span>
      <span class="kn">fastcgi_pass</span> <span class="s">php</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="kn">location</span> <span class="p">~</span><span class="sr">*</span> <span class="s">\.(?:js|css|jpe?g|gif|htc|ico|png|html|xml|otf|ttf|eot|woff2?|svg)</span>$ <span class="p">{</span>
      <span class="kn">expires</span> <span class="s">max</span><span class="p">;</span>
      <span class="kn">access_log</span> <span class="no">off</span><span class="p">;</span>
      <span class="kn">log_not_found</span> <span class="no">off</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Los añadidos no son muchos<a class="footnote-reference brackets" href="#id18" id="id7">5</a>. En puridad, sólo es necesario el bloque
<code class="docutils literal notranslate"><span class="pre">if</span></code>.  El otro añadido, que implica usar <code class="docutils literal notranslate"><span class="pre">map</span></code>, sólo sirve para dividir los
registros de acceso para que cada blog lo haga en fichero aparte. Para que esto
sea viable, además, es necesario que el usuario <em>www-data</em> pueda crear los
ficheros de registro en <code class="file docutils literal notranslate"><span class="pre">/var/log/nginx</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> chown www-data /var/log/nginx
<span class="gp">#</span> chmod g+s /var/log/nginx
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Por alguna razón, al hacer una instalación multisitio, la vista de
las entradas pertenecientes a una categoría, deja de funcionar, porque
<em>wordpress</em> convierte las direcciones en:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">http://blogs.example.net/nombre-blog/category/nombre-categoria</span>
</pre></div>
</div>
<p>Podemos soslayar este problema, configurando cada <em>blog</em> particular para que
en <code class="docutils literal notranslate"><span class="pre">Ajustes&gt;Enlaces</span> <span class="pre">permanentes</span></code>, la <code class="docutils literal notranslate"><span class="pre">Categoría</span> <span class="pre">base</span></code> sea
<code class="file docutils literal notranslate"><span class="pre">/category</span></code> u otra cualquiera de nuestra elección (p.e.
<code class="file docutils literal notranslate"><span class="pre">/secciones</span></code>).</p>
</div>
</div>
<div class="section" id="id8">
<h3><span class="section-number">7.2.2.3.5.2.3. </span>Optimizaciones<a class="headerlink" href="#id8" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Como en el caso de un solo blog, es posible el cacheo de contenido estático y
dinámico. Como en la configuración multisitio los cambios son mínimos, no es
difícil implementarlos siguiendo <a class="reference internal" href="#nginx-wordpress-optimo"><span class="std std-ref">las instrucciones ya indicadas</span></a>.</p>
</div>
</div>
<div class="section" id="postinstalacion">
<h2><span class="section-number">7.2.2.3.5.3. </span>Postinstalación<a class="headerlink" href="#postinstalacion" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="section" id="extensiones-indispensables">
<h3><span class="section-number">7.2.2.3.5.3.1. </span>Extensiones indispensables<a class="headerlink" href="#extensiones-indispensables" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Completada la instalación, hay ciertas extensiones (<em>plugins</em>) que pueden
resultarnos muy útiles:</p>
<dl>
<dt><a class="reference external" href="https://es.wordpress.org/plugins/nginx-cache/">nginx cache</a></dt><dd><p>Plugin para gestionar una caché interna que aceleré <em>wordpress</em>. Se ha
tratado al hablar sobre las optimizaciones.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>En una instalación multisitio, es necesario tener en cuenta que
hay que habilitar el plugin para cada sitio por separado.</p>
</div>
</dd>
<dt><a class="reference external" href="https://es.wordpress.org/plugins/advanced-nocaptcha-recaptcha/">Advanced noCaptcha &amp; invisible Captcha (v2 &amp; v3)</a></dt><dd><p>Habilita la <cite>versión 2 &lt;https://www.google.com/recaptcha/intro/v2.html&gt;</cite> o la <a class="reference external" href="https://www.google.com/recaptcha/intro/v3.html">versión 3</a> de Google reCaptcha. Es
necesario generar en el enlace facilitado un par de claves con una cuenta de
<em>Google</em> para poder usarlo, ya que la configuración lo requiere. Con las
extensión podemos proteger el formulario de acceso, el de registro, la
creación de comentarios y la petición para cambio de contraseña.</p>
</dd>
<dt><a class="reference external" href="https://es.wordpress.org/plugins/easy-wp-smtp/">Easy WP SMTP</a></dt><dd><p><em>Plugin</em> indispensable para permitir que <em>Wordpress</em> use un servidor <abbr title="Simple Mail Transfer Protocol">SMTP</abbr>
para expedir correos, en vez del módulo de <abbr title="PHP Hypertext Preprocessor">PHP</abbr> que por lo general provoca
que los mensajes sean rechazados por los servidores y, en consecuencia, jamás
sean entregados.</p>
<p>Con la extensión podemos o usar nuestro servidor de correo local, si es que
lo hemos instalado y configurado; o un servidor externo al que accedamos por
autenticación.</p>
</dd>
<dt><a class="reference external" href="https://es.wordpress.org/plugins/click-datos-lopd/">Adaptación RGPD/LOPD</a></dt><dd><p>En mayo de 2018 entró en vigor el <a class="reference external" href="https://rgpd.es/">Reglamento General de Protección de Datos</a> que obliga a informar al usuario del tratamiento que se
hará de sus datos y cómo será este. Para adecuar nuestro <em>Wordpress</em> a él
este <em>plugin</em> es extraordinariamente útil.</p>
<div class="admonition seealso">
<p class="admonition-title">Ver también</p>
<p><a class="reference external" href="https://www.webempresa.com/blog/rgpd-en-wordpress-guia-facil-aplicacion-normativa-reglamento.html">Esta entrada en la web de webempresa.com</a>
puede servirnos de mucha ayuda.</p>
</div>
</dd>
</dl>
<p>Estas cuatro (o tres si no optimizamos) extensiones debe ser de obligada
instalación, o bien, otras tales que hagan la misma tarea. La instalación de
otras extensiones dependerá de cuál sea el uso que demos al sitio.</p>
</div>
<div class="section" id="actualizaciones">
<h3><span class="section-number">7.2.2.3.5.3.2. </span>Actualizaciones<a class="headerlink" href="#actualizaciones" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Con los <a class="reference internal" href="#wp-permisos"><span class="std std-ref">permisos sugeridos</span></a>, tanto la actualización de
temas como la de <em>plugins</em>, debe llevarse a cabo a través de la interfaz web sin
problemas. La actualización a una versión de <strong class="program">wordpress</strong>, en cambio,
exige un cambio global de permisos:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> chown -R www-data /srv/www/blog
</pre></div>
</div>
<p>para poder llevar a cabo la actualización. Una vez completada ésta, es
recomendable volver a los permisos anteriores:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> chown -R root /srv/www/blog
<span class="gp">#</span> chown -R www-data /srv/www/blog/wp-<span class="o">{</span>config.php,content<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="usuarios">
<h3><span class="section-number">7.2.2.3.5.3.3. </span>Usuarios<a class="headerlink" href="#usuarios" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Los usuarios de <em>Wordpress</em> tienen un rol, esto es, un distinto nivel de
privilegios:</p>
<ol class="arabic simple">
<li><p><em>Administrador de la red</em> o <em>Superadministrador</em>, que será el administrador
total de todo el sitio y podrá realizar cualquier tarea y, en exclusiva:</p>
<ul class="simple">
<li><p>Instalar <em>plugins</em> en la aplicación.</p></li>
<li><p>Instalar <em>temas</em> en la aplicación<a class="footnote-reference brackets" href="#id19" id="id10">6</a>.</p></li>
<li><p>Ajustar parámetros que afectan al funcionamiento general del sitio (activar
el resgistro automático de usuarios, fijar el tamño máximo de archivo, etc.)</p></li>
</ul>
</li>
<li><p><em>Administrador de blog</em><a class="footnote-reference brackets" href="#id20" id="id11">7</a>, que es aquel que tiene la labor de gestionar
por completo un <em>blog</em> particular del sitio.</p></li>
<li><p><em>Editor</em>, que tiene capacidad de publicar entradas y de editar logias propias
y ajenas.</p></li>
<li><p><em>Autor</em>, capaz de publicar y editar sólo sus propias entradas.</p></li>
<li><p><em>Colaborador</em>, que puede editar sus propiar entradas, pero no publicarlas.</p></li>
<li><p><em>Suscriptor</em>, que sólo es capaz de leer entradas y editar su perfil.</p></li>
</ol>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>En instalaciones <em>multisitio</em>, salvo el primero, como es natural,
el resto de <em>roles</em> se tienen para un <em>blog</em> particular, de modo que
un <em>usuario</em> puede tener un <em>rol</em> en un <em>blog</em> y otro <em>rol</em> distinto en otro.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>En principio, el auto-registro de nuevos usuarios está deshabilitado y
sólo es posible mediante invitación del <em>superadministrador</em>. El
auto-registro puede habilitarlo el <em>superadministrador</em> en <code class="docutils literal notranslate"><span class="pre">Ajustes&gt;Ajustes</span>
<span class="pre">de</span> <span class="pre">la</span> <span class="pre">red</span></code>. Sea como sea, el registro sólo implica el alta en la red de
<em>blogs</em>, no el adquirir un rol determinado en un <em>blog</em> particular. Para esto
segúndo, deberá el administrador de tal blog conferir uno concreto.</p>
</div>
<p class="rubric">Autenticación con <em>Google</em></p>
<p>Es posible autenticarse en <strong class="program">wordpress</strong> mediante el sistema de
autenticación de <em>Google</em>, para lo cual debe instalarse un <em>plugin</em> apropiado
como <a class="reference external" href="https://es.wordpress.org/plugins/login-with-google/">Login with Google</a>.
Hay que tener presente varios aspectos:</p>
<ul class="simple">
<li><p>Se necesitarán unas credenciales de Google para hacer efectivo el plugin.
Basta una cuenta en <em>Google</em> y acudir a la <a class="reference external" href="https://console.developers.google.com/">consola de desarrollo</a> para crer un proyecto y, dentro de
él, unas credenciales.</p></li>
<li><p>La autenticación con <em>Google</em> permite la autenticación alternativa de
<em>usuarios</em>  y puede configurarse el <em>plugin</em> para que si el usuario no existe,
se genere automáticamente una cuenta.</p></li>
</ul>
</div>
<div class="section" id="recetas">
<h3><span class="section-number">7.2.2.3.5.3.4. </span>Recetas<a class="headerlink" href="#recetas" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Bajo el presente epígrafe se enumeran muy esquemáticamente algunas recetas para
incorporar contenido al sitio.</p>
<dl>
<dt><strong>Vídeo</strong></dt><dd><p>Mediante incorporación de elementos <code class="docutils literal notranslate"><span class="pre">iframe</span></code> al contenido. En el caso
particular de <a class="reference external" href="http://www.youtube.com">youtube</a> es posible, simplemente,
incorporando en párrafo aparte el enlace en la vista <em>visual</em>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">https://www.youtube.com/watch?v=e8TZbze72Bc</span>
</pre></div>
</div>
<p>Si se quiere tener más control sobre el formato (p.e. ajustar el tamaño),
entonces debe recurrirse a añadir directamente el <code class="docutils literal notranslate"><span class="pre">&lt;iframe&gt;</span></code>, cuyo código
puede obtenerse del enlace «<em>Compartir</em>», y dentro de él «<em>Insertar</em>»</p>
</dd>
<dt><strong>Mapas</strong> (de <em>Google</em>)</dt><dd><p>Basta, de igual modo, con hacerse con el <code class="docutils literal notranslate"><span class="pre">iframe</span></code> de la vista que nos
interese. El código puede obtenerse del enlace «<em>Compartir</em>».</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Si lo que se pretende es crear mapas interactivos, siga las
<a class="reference external" href="https://neliosoftware.com/es/blog/anadir-mapas-de-google-maps-en-wordpress/#attachment_3517">instrucciones de esta página</a>.</p>
</div>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>En general, cualquier objeto no-<abbr title="HyperText Markup Language">HTML</abbr> que deseamos mostrar, podrá
incustrarse recurriendo al código con <code class="docutils literal notranslate"><span class="pre">&lt;iframe&gt;</span></code> que se nos facilite (p.e.
cualquier <em>podcast</em> ofrecido a través de la plataforma <a class="reference external" href="https://www.ivoox.com/">ivoox</a>)</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>En los <strong class="program">wordpress</strong> multisitio sólo el superadministrador
puede incrustar elementos <code class="docutils literal notranslate"><span class="pre">&lt;iframe&gt;</span></code>. En el siguiente apartado se
proporciona <a class="reference internal" href="#wp-iframes"><span class="std std-ref">una solución para sortear este inconveniente</span></a>.</p>
</div>
</div>
<div class="section" id="migracion">
<h3><span class="section-number">7.2.2.3.5.3.5. </span>Migración<a class="headerlink" href="#migracion" title="Enlazar permanentemente con este título">¶</a></h3>
<p><strong class="program">wordpress</strong> incorpora un sencillo mecanismo para migrar un blog desde
un servidor de internet a otro distinto, que sigue el siguiente esquema:</p>
<img alt="../../../../_images/wp-migracion.png" src="../../../../_images/wp-migracion.png" />
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>No se realiza la migración de un sitio entero, sino de un blog
particular, lo cual debe tener en cuenta si la instalación es un
<strong class="program">wordpress</strong> multisitio</p>
</div>
<p>Para poder llevar a cabo la migración:</p>
<dl class="simple">
<dt>En el <strong>servidor web original</strong></dt><dd><p>debemos exportar el <em>blog</em> a través de la entrada
«Herramientas» del Escritorio del blog en cuestión. Tal acción generará un
fichero <abbr title="eXtensible Markup Language">XML</abbr> que contendrá el texto y la estructura del blog. En cambio, del
contenido multimedia, como las fotos, sólo se incluirá el enlace a su
ubicación en el sitio original (<em>www.example.net</em> en el ejemplo).</p>
</dd>
<dt>En el <strong>servidor web de destino</strong></dt><dd><p>con wordpress instalado, se importa el
contenido del <em>blog</em> también a través de la entrada «Herramientas»<a class="footnote-reference brackets" href="#id21" id="id12">8</a>.
Durante este proceso de importación, el <em>plugin</em> de importación se encargara
de descargar desde el sitio web original el contenido multimedia y añadirlo a
la biblioteca multimedia.</p>
</dd>
</dl>
<p>Es importante tener claro los siguientes aspectos de la migración:</p>
<ul class="simple">
<li><p>Se migra un único <em>blog</em>.</p></li>
<li><p>Se importan contenido y usuarios<a class="footnote-reference brackets" href="#id22" id="id13">9</a>, pero nada más: estilos y <em>plugins</em>
corren de nuestra cuenta.</p></li>
<li><p>Durante el proceso los dos servidores deben estar activos.</p></li>
<li><p>Los servidores deben tener distinto nombre.</p></li>
</ul>
<p class="rubric">¿Y si no es posible mantener el línea el antiguo servidor?</p>
<p>El procedimiento es bastante sencillo al margen de que requiramos volver a
recrear el estilo o instalar <em>plugins</em>. Sin embargo, es absolutamente inútil, si
no disponemos del antiguo servidor en línea. Un caso en que esto no es posible
se produce cuando cambiamos el sistema de servidor, de modo que en el momento en
que tenemos el nuevo sistema en línea, el sistema ya ha dejado de existir por
pura sustitución.</p>
<p>A pesar de ello, podemos ingeniárnoslas para ensayar este esquema de migración:</p>
<img alt="../../../../_images/wp-migracion-auto.png" src="../../../../_images/wp-migracion-auto.png" />
<p>Esto es:</p>
<dl class="simple">
<dt>Antes de inutilizar el <strong>antiguo servidor</strong></dt><dd><p>descargamos el <abbr title="eXtensible Markup Language">XML</abbr> de importación y los ficheros multimedia en un paquete
hecho con <a class="reference internal" href="../../../../02.conbas/11.backup/02.empaquetado.html#tar"><span class="std std-ref">tar</span></a>. El <abbr title="eXtensible Markup Language">XML</abbr> lo manipulamos para que los enlaces
incluidos en él cambien el nombre de la máquina por <em>localhost</em>.</p>
</dd>
<dt>En el <strong>nuevo servidor</strong></dt><dd><p>creamos un nuevo sitio web estático al que subimos los ficheros multimedia y
configuramos el servidor web para que los ficheros se descarguen según sean
enlazados en el <abbr title="eXtensible Markup Language">XML</abbr>. Hecho esto, procedemos a importar el <abbr title="eXtensible Markup Language">XML</abbr> tal como
hicimos en el caso anterior y, si hemos procedido correctamente, la migración
se resolverá sin problema. Finalmente, podremos borrar el sitio estático.</p>
</dd>
</dl>
<p>Paso a paso, y suponiendo que el nombre antiguo era <em>www.example.net</em>, debemos
hacer lo siguiente:</p>
<ol class="arabic">
<li><p>Exportar en <abbr title="eXtensible Markup Language">XML</abbr> el <em>blog</em> a través de su menú «Herramientas» (supongamos
que lo llamamos <code class="file docutils literal notranslate"><span class="pre">blogs.xml</span></code>).</p></li>
<li><p>Crear un paquete con las imágenes del <em>blog</em>. Tales imágenes están dentro el
subdirectorio <code class="file docutils literal notranslate"><span class="pre">wp-content/uploads</span></code>, así que crearemos el <a class="reference external" href="http://computing.help.inf.ed.ac.uk/FAQ/whats-tarball-or-how-do-i-unpack-or-create-tgz-or-targz-file">tarball</a>
con el contenido de tal fichero:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> tar -C /srv/www/blogs/wp-content -acvf /tmp/multimedia.tar.gz uploads
</pre></div>
</div>
<p>Obviamente, debemos rescatar el fichero del servidor.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Este <em>tarball</em> contendrá las ficheros multimedia de todos los <em>blogs</em>
en caso de una instalación multisitio. Si desea extraer sólo los ficheros
del sitio en cuestión debe hacer para el caso del sitio principal:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> tar --exclude<span class="o">=</span>uploads/sites -C /srv/www/blogs/wp-content -acvf /tmp/multimedia.tar.gz uploads
</pre></div>
</div>
<p>y para el caso de cualquier otro <em>blog</em>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> tar -C /srv/www/blogs/wp-content -acvf /tmp/multimedia.tar.gz uploads/sites/N
</pre></div>
</div>
<p>donde <strong>N</strong> es <strong>2</strong>, <strong>3</strong>, <strong>4</strong>… y es un número que identifica al
blog en cuestión y se asigna en el momento de la creación. Para saber qué
número tiene asignado cada <em>blog</em> basta con consultar la ruta de uno de
sus imágenes.</p>
</div>
</li>
<li><p>Modificamos el <abbr title="eXtensible Markup Language">XML</abbr> para sustituir el nombre <em>www.example.net</em> por
<em>localhost</em>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> sed -ri <span class="s1">&#39;s;((http)s(://))?www\.example\.net\b;\2\3localhost;g&#39;</span> blog.xml
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>La expresión, además de modificar el nombre, convierte el protocolo
<abbr title="HyperText Transfer Protocol">HTTP</abbr>s en <abbr title="HyperText Transfer Protocol">HTTP</abbr> en caso de que sea necesario.</p>
</div>
</li>
<li><p>Subimos el paquete al nuevo servidor, y lo descomprimimos en un lugar
adecuado:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> mkdir -p /srv/www/BORRAR
<span class="gp">#</span> tar -C /srv/www/BORRAR -axvf /tmp/multimedia.tar.xz
</pre></div>
</div>
</li>
<li><p>Creamos un sitio adecuado para que sirva los ficheros multimedia manteniendo
su ruta original (excepto porque ahora la máquina será <em>localhost</em>):</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="c1"># /etc/nginx/sites-availables/BORRAR</span>
<span class="k">server</span> <span class="p">{</span>
   <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
   <span class="kn">server_name</span> <span class="s">localhost</span><span class="p">;</span>

   <span class="kn">access_log</span> <span class="s">/var/log/nginx/access.BORRAR.log</span><span class="p">;</span>
   <span class="kn">error_log</span>  <span class="s">/var/log/nginx/error.BORRAR.log</span><span class="p">;</span>

   <span class="kn">location</span> <span class="s">/SITIO/wp-content</span> <span class="p">{</span>
      <span class="kn">alias</span> <span class="s">/srv/www/BORRAR</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>«<em>SITIO</em>» es el nombre del sitio que aparece en la ruta, y que tuvo que
definirse al crearlo. En el caso del blog principal debemos eliminarlo
por completo con lo que la localización será, simplemente,
<code class="file docutils literal notranslate"><span class="pre">/wp-content</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Si queremos estar seguros de que hemos hecho correctamente la
configuración podemos intentar desde el propio servidor acceder a alguna
de las imágenes cuyo <em>link</em> contenga el <abbr title="eXtensible Markup Language">XML</abbr>. Por ejemplo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> wget -S --spider http://localhost/wp-content/uploads/2019/01/foto.jpg
<span class="go">  HTTP/1.1 200 OK</span>
<span class="go">  Server: nginx/1.10.3</span>
<span class="go">  Date: Tue, 15 Jan 2019 17:48:47 GMT</span>
<span class="go">  Content-Type: image/jpeg</span>
<span class="go">  ...</span>
</pre></div>
</div>
<p>o un enlace parecido.</p>
</div>
</li>
<li id="wp-iframes"><p>Para evitar que <strong class="program">wordpress</strong> se niegue a descargar los ficheros de
una <abbr title="Internet Protocol">IP</abbr> privada y que no importe correctamente los <code class="docutils literal notranslate"><span class="pre">&lt;iframe&gt;</span></code>, si no se
usa como usuario importador el superadministrador, es necesario subir
<a class="reference download internal" download="" href="../../../../_downloads/1b0a8392de207cb785006079c73695b3/myfunctions.php"><code class="xref download docutils literal notranslate"><span class="pre">este</span> <span class="pre">fichero</span> <span class="pre">al</span> <span class="pre">servidor</span></code></a>, colocarlo en el
directorio de plugins:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> mv /tmp/myfunctions.php /srv/www/blogs/wp-content/plugins/
</pre></div>
</div>
<p>y activarlo en la sección de <em>plugins</em> en la que debe aparecer como <em>plugin</em>
disponible.</p>
</li>
<li><p>Instalamos los <em>plugins</em> que sean necesarios para que funcione el <em>blog</em> que
importamos. Por ejemplo, si usamos formularios de
<a class="reference external" href="https://es.wordpress.org/plugins/contact-form-7/">Contact Form 7</a>
necesitaremos tener instalada el <em>plugin</em> previamente.</p></li>
<li><p>Si la instalación es <em>multisitio</em>, creamos un nuevo <em>blog</em> sobre el que
importaremos el antiguo. Antes (o después de la importación) convendrá borrar
la entrada «¡Hola, mundo!», porque la importación no elimina los contenidos
que ya contuviera el blog.</p></li>
<li><p>Aplicamos sobre el blog el <em>tema</em> que tuviera en el sitio original.</p></li>
<li><p>Procedemos a la importación a través del menú «Herramientas». Si no hemos
realizado otra importación anteriormente, el <em>plugin</em> importador no se
encontrará instalado, por lo cual deberemos previamente instalarlo bien desde
la página de instalación de <em>plugins</em> (se llama <a class="reference external" href="https://es.wordpress.org/plugins/wordpress-importer/">Wordpress Importer</a>), bien desde la
página de importación del <em>blog</em> principal.</p>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Si lo hace de este segundo modo en una instalación multisitio,
asegúrese de volver al <em>blog</em> en el que realmente quiere hacer la
importación.</p>
</div>
</li>
<li><p>Restablecer la configuración del servidor para que no quede ni rastro
de nuestra argucia:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> rm /srv/www/BORRAR -rf
<span class="gp">#</span> rm /etc/nginx/sites-<span class="o">{</span>available,enabled<span class="o">}</span>/BORRAR -f
<span class="gp">#</span> invoke-rc.d nginx restart
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Si el <em>blog</em> importado tenía muchas entradas, es posible que el
proceso se demore demasiado y ante la falta de respuesta por parte del
procesador <abbr title="PHP Hypertext Preprocessor">PHP</abbr> el servidor cancele la operación. Para evitarlo puede
<a class="reference internal" href="04.moodle.html#timeout-php"><span class="std std-ref">aumentar el tiempo de temporización</span></a>.</p>
</div>
</div>
<div class="section" id="enlaces-de-interes">
<h3><span class="section-number">7.2.2.3.5.3.6. </span>Enlaces de interés<a class="headerlink" href="#enlaces-de-interes" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://www.webempresa.com/wordpress/curso-wordpress-gratis.html">Curso de Wordpress con videotutoriales</a>.</p></li>
<li><p><a class="reference external" href="https://decodecms.com/">Blog con recetas para Wordpress</a></p></li>
</ul>
<p class="rubric">Notas al pie</p>
<dl class="footnote brackets">
<dt class="label" id="id14"><span class="brackets"><a class="fn-backref" href="#id2">1</a></span></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">fastcgi_cache</span></code> permite el valor <em>off</em>, así que puede temporalmente
incluirse la configuración necesaria pero con este valor inicialmente y,
cuando se tenga totalmente instalado todo, incluido el plugin necesario,
cambiar su valor al nombre de la caché que escogiéramos (<em>wp-cache</em>, en
nuestra configuración).</p>
</dd>
<dt class="label" id="id15"><span class="brackets"><a class="fn-backref" href="#id3">2</a></span></dt>
<dd><p>Los navegadores bloquean este tipo de contenido si es inseguro y la
página que lo carga segura.</p>
</dd>
<dt class="label" id="id16"><span class="brackets"><a class="fn-backref" href="#id4">3</a></span></dt>
<dd><p>Otra pequeña diferencia de esta configuración respecto a la anterior es
como tratamos los registros: por defecto no registramos los accesos y sólo
cuando se ejecuta un <em>script</em> sí se hace. Esto nos evita el uso de los
<em>snippets</em> anteriores.</p>
</dd>
<dt class="label" id="id17"><span class="brackets"><a class="fn-backref" href="#id5">4</a></span></dt>
<dd><p>Hay otra posible configuración multisitio que consiste en reservar un
subdominio para cada blog, de manera que las direcciones quedaría así:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Blog</p></th>
<th class="head"><p>Dirección</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>principal</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">https://blogs.example.net</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>blog2</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">https://blogs2.blogs.example.net</span></code></p></td>
</tr>
<tr class="row-even"><td><p>etc</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">https://etc.blogs.example.net</span></code></p></td>
</tr>
</tbody>
</table>
<p>Esta configuración no se tratará aquí.</p>
</dd>
<dt class="label" id="id18"><span class="brackets"><a class="fn-backref" href="#id7">5</a></span></dt>
<dd><p>Descontado, claro, está que hemos deficido poner «<em>blogs</em>» donde antes
decía «<em>blog</em>».</p>
</dd>
<dt class="label" id="id19"><span class="brackets"><a class="fn-backref" href="#id10">6</a></span></dt>
<dd><p>En instalaciones <em>monositio</em> los roles de <em>Administrador del sitio</em> y
<em>Administrador del blog</em> se fusionan.</p>
</dd>
<dt class="label" id="id20"><span class="brackets"><a class="fn-backref" href="#id11">7</a></span></dt>
<dd><p>Los administradores de los blogs tienen libertad para habilitar o
deshabilitar plugins o cambiar el tema en el blog que gestionan, pero siempre
sobre aquellos plugins y temas que hayan sido instalados por el
<em>Administrador de la red</em>.</p>
</dd>
<dt class="label" id="id21"><span class="brackets"><a class="fn-backref" href="#id12">8</a></span></dt>
<dd><p>El importador es un <em>plugin</em> que debe instalarse, pero la propia entrada
«Herramientas» facilita su instalación sin necesidad de recurrir a la sección
de <em>plugins</em>.</p>
</dd>
<dt class="label" id="id22"><span class="brackets"><a class="fn-backref" href="#id13">9</a></span></dt>
<dd><p>La importación detectará los usuarios que hayan participado en el <em>blog</em>
antiguo y nos permitirá para cada uno:</p>
<ul class="simple">
<li><p>Crear un nuevo usuario que lo sustituya.</p></li>
<li><p>Asimilar el usuario a uno ya existente en el blog.</p></li>
</ul>
<div class="admonition-todo admonition" id="id23">
<p class="admonition-title">Por hacer</p>
<p>Es posible que esto sólo sea posible si se importa desde la cuenta
de superadministrador. Debe comprobarse.</p>
</div>
</dd>
</dl>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../../../index.html">Tabla de contenido</a></h3>
  <ul>
<li><a class="reference internal" href="#">7.2.2.3.5. Wordpress</a><ul>
<li><a class="reference internal" href="#blog-unico">7.2.2.3.5.1. Blog único</a><ul>
<li><a class="reference internal" href="#preliminares">7.2.2.3.5.1.1. Preliminares</a></li>
<li><a class="reference internal" href="#configuracion-de-nginx">7.2.2.3.5.1.2. Configuración de <strong class="program">nginx</strong></a></li>
<li><a class="reference internal" href="#instalacion">7.2.2.3.5.1.3. Instalación</a></li>
<li><a class="reference internal" href="#optimizaciones">7.2.2.3.5.1.4. Optimizaciones</a><ul>
<li><a class="reference internal" href="#cacheo-de-contenido-dinamico">7.2.2.3.5.1.4.1. Cacheo de contenido dinámico</a></li>
<li><a class="reference internal" href="#cacheo-de-contenido-estatico">7.2.2.3.5.1.4.2. Cacheo de contenido estático</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#multisitio">7.2.2.3.5.2. Multisitio</a><ul>
<li><a class="reference internal" href="#id6">7.2.2.3.5.2.1. Preliminares</a></li>
<li><a class="reference internal" href="#configuracion">7.2.2.3.5.2.2. Configuración</a></li>
<li><a class="reference internal" href="#id8">7.2.2.3.5.2.3. Optimizaciones</a></li>
</ul>
</li>
<li><a class="reference internal" href="#postinstalacion">7.2.2.3.5.3. Postinstalación</a><ul>
<li><a class="reference internal" href="#extensiones-indispensables">7.2.2.3.5.3.1. Extensiones indispensables</a></li>
<li><a class="reference internal" href="#actualizaciones">7.2.2.3.5.3.2. Actualizaciones</a></li>
<li><a class="reference internal" href="#usuarios">7.2.2.3.5.3.3. Usuarios</a></li>
<li><a class="reference internal" href="#recetas">7.2.2.3.5.3.4. Recetas</a></li>
<li><a class="reference internal" href="#migracion">7.2.2.3.5.3.5. Migración</a></li>
<li><a class="reference internal" href="#enlaces-de-interes">7.2.2.3.5.3.6. Enlaces de interés</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Tema anterior</h4>
  <p class="topless"><a href="02.webmail.html"
                        title="capítulo anterior"><span class="section-number">7.2.2.3.4. </span>Webmail</a></p>
  <h4>Próximo tema</h4>
  <p class="topless"><a href="04.moodle.html"
                        title="próximo capítulo"><span class="section-number">7.2.2.3.6. </span>Moodle</a></p>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../../../../_sources/07.serre/02.web/02.nginx/03.misc/03.wordpress.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Ir a" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="04.moodle.html" title="7.2.2.3.6. Moodle"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="02.webmail.html" title="7.2.2.3.4. Webmail"
             >anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" ><span class="section-number">7. </span>Servicios de red</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../index.html" ><span class="section-number">7.2. </span>Web</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../index.html" ><span class="section-number">7.2.2. </span>nginx</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="index.html" ><span class="section-number">7.2.2.3. </span>Recetas</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">7.2.2.3.5. </span>Wordpress</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Derechos de autor CC BY 4.0, 2016-2021, José Miguel Sánchez Alés.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.5.4.
    </div>
  </body>
</html>