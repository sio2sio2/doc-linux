


<!DOCTYPE html>

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>8.7.3.2.2. Reglas &#8212; documentación de Linuxnomicón - rolling</title>
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <script src="../../../_static/translations.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Índice" href="../../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../../search.html" />
    <link rel="next" title="8.7.3.2.3. Uso práctico" href="03.conn.html" />
    <link rel="prev" title="8.7.3.2.1. Creación del armazón" href="01.conceptos.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="03.conn.html" title="8.7.3.2.3. Uso práctico"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="01.conceptos.html" title="8.7.3.2.1. Creación del armazón"
             accesskey="P">anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" ><span class="section-number">8. </span>Conceptos avanzados de redes</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" ><span class="section-number">8.7. </span>Cortafuegos</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="index.html" accesskey="U"><span class="section-number">8.7.3.2. </span>nftables</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">8.7.3.2.2. </span>Reglas</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="reglas">
<span id="iptables-rules"></span><h1><span class="section-number">8.7.3.2.2. </span>Reglas<a class="headerlink" href="#reglas" title="Enlazar permanentemente con este título">¶</a></h1>
<p>Si nuestro cortafuegos no lleva a cabo tareas muy complicadas, es posible seguir
usando la <a class="reference internal" href="../01.iptables/01.basico.html#iptables-sintaxis"><span class="std std-ref">sintaxis de iptables</span></a> a través de la familia
de órdenes <strong class="program">iptables-nft</strong>, <strong class="program">ip6tables-nft</strong>,
<strong class="program">ebtables-nft</strong> y <strong class="program">arptables-nft</strong> sin preocuparnos siquiera de crear
tablas ni cadenas, puesto que estas órdenes, al ser ejecutadas, crean las
cadenas pertinentes. Así pues<a class="footnote-reference brackets" href="#id5" id="id1">1</a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> iptables-nft -vnL
</pre></div>
</div>
<p>creará las cadenas incluidas en las tablas <em>filter</em><a class="footnote-reference brackets" href="#id6" id="id2">2</a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> nft list table filter
<span class="go">table ip filter {</span>
<span class="go">   chain INPUT {</span>
<span class="go">      type filter hook input priority filter; policy accept;</span>
<span class="go">   }</span>

<span class="go">   chain FORWARD {</span>
<span class="go">      type filter hook forward priority filter; policy accept;</span>
<span class="go">   }</span>

<span class="go">   chain OUTPUT {</span>
<span class="go">      type filter hook output priority filter; policy accept;</span>
<span class="go">   }</span>
<span class="go">}</span>
</pre></div>
</div>
<p>y la expresión de una regla también será interpretada sin problemas:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> iptables -A INPUT -p tcp --dport <span class="m">80</span> -j DROP
<span class="gp">#</span> nft list chain filter INPUT
<span class="go">table ip filter {</span>
<span class="go">   chain INPUT {</span>
<span class="go">      type filter hook input priority filter; policy accept;</span>
<span class="go">      meta l4proto tcp tcp dport 80 counter packets 0 bytes 0 drop</span>
<span class="go">   }</span>
<span class="go">}</span>
</pre></div>
</div>
<p>Hay, además, un traductor que permite ver cuál es el equivalente sin
llegar a hacer la orden efectiva:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> iptables-translate -A INPUT -p tcp --dport <span class="m">80</span> -j DROP
<span class="go">nft add rule ip filter INPUT tcp dport 80 counter drop</span>
</pre></div>
</div>
<p>Para tareas más complicadas, en cambio, es forzoso conocer la sintaxis modernas
y a ello nos dedicaremos.</p>
<div class="section" id="sintaxis">
<h2><span class="section-number">8.7.3.2.2.1. </span>Sintaxis<a class="headerlink" href="#sintaxis" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Las reglas se añaden a las cadenas y se van comprobando en el orden en el que
se encuentran en ella. se añaden del siguiente modo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> nft add<span class="p">|</span>insert rule <span class="o">[</span>&lt;famiy&gt;<span class="o">]</span> &lt;table&gt; &lt;chain&gt; <span class="o">[</span>handle &lt;value&gt;<span class="o">]</span> <span class="o">[</span>&lt;selectores&gt;<span class="o">]</span> <span class="o">[</span>&lt;acciones&gt;<span class="o">]</span> <span class="o">[</span>comment <span class="s2">&quot;Comentario&quot;</span><span class="o">]</span>
</pre></div>
</div>
<p>esto es:</p>
<ul class="simple">
<li><p>Se puede añadir (<kbd class="kbd docutils literal notranslate">add</kbd>) o insertar (<kbd class="kbd docutils literal notranslate">ìnsert</kbd>).</p></li>
<li><p>Se indica la cadena a la que pertenece la regla.</p></li>
<li><p>Con <kbd class="kbd docutils literal notranslate">handle</kbd> se indica la posición de adición o inserción. Añadir
implica hacerlo tras la posición e insertar antes de ella. Si no se indica
<kbd class="kbd docutils literal notranslate">handle</kbd>, <kbd class="kbd docutils literal notranslate">add</kbd> añadirá la regla al final de la cadena e
<kbd class="kbd docutils literal notranslate">insert</kbd>, al commienza.</p></li>
<li><p>Los selectores (uno o varios) permiten especificar cuál es el tráfico al que
afecta la regla.</p></li>
<li><p>Debe especificarse cuál es el efecto o efectos de la regla sobre
el tráfico al que afecta.</p></li>
<li><p>Por último, puede añadirse un comentario que explique qué hace la regla.</p></li>
</ul>
<p>Por ejemplo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> nft add rule filter INPUT ip daddr <span class="m">10</span>.0.0.0/8 accept
</pre></div>
</div>
<p>en este caso, hay una condición, que la dirección de destino esté en la red
<em>10.0.0.0/8</em>; y una acción terminal: aceptar el tráfico. Puede no incluirse
acción alguna, en cuyo caso, la regla comprobará la condición… pero no
hará nada en particular (aunque puede tener sentido si <a class="reference internal" href="#nftables-counter"><span class="std std-ref">se quieren contar
paquetes</span></a>).</p>
<p>Para listar reglas podemos:</p>
<ul>
<li><p>Listar las reglas de una cadena:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nft list chain [&lt;family&gt;] &lt;table&gt; &lt;nombre&gt;</span>
</pre></div>
</div>
<p>como, por ejemplo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> nft list chain filter INPUT
</pre></div>
</div>
</li>
<li><p>Listas las reglas de todas las cadenas de una tabla:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nft list table [&lt;family&gt;] &lt;nombre&gt;</span>
</pre></div>
</div>
<p>como por ejemplo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> nft list table filter
</pre></div>
</div>
</li>
<li><p>Listar todas las reglas:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> nft list ruleset
</pre></div>
</div>
</li>
</ul>
<p>Es interesante la opción <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate"></kbd>-<kbd class="kbd docutils literal notranslate">a</kbd></kbd> que indica para cada regla el <em>handle</em> que le
corresponde y que podemos usar para borrar reglas:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> nft delete rule <span class="o">[</span>&lt;family&gt;<span class="o">]</span> &lt;table&gt; &lt;chain&gt; handle &lt;handle&gt;
</pre></div>
</div>
<p>como por ejemplo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> nft delete rule filter INPUT handle <span class="m">1</span>
</pre></div>
</div>
<p>Si sustituimos <kbd class="kbd docutils literal notranslate">list</kbd> por <kbd class="kbd docutils literal notranslate">flush</kbd> lograremos el efecto de vaciar de
reglas la cadena, todas las cadenas de la tabla o todas las cadenas de todas las
tablas:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> nft flush chain filter INPUT
<span class="gp">#</span> nft flush table filter
<span class="gp">#</span> nft flush ruleset
</pre></div>
</div>
<div class="section" id="condiciones">
<h3><span class="section-number">8.7.3.2.2.1.1. </span>Condiciones<a class="headerlink" href="#condiciones" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Algunas de las condiciones que podemos indicar son:</p>
<table class="nftables-matches docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 21%" />
<col style="width: 66%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Criterio</p></th>
<th class="head"><p>Argumento</p></th>
<th class="head"><p>Descripción</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="6"><p>ip</p></td>
<td rowspan="2"><p>protocol</p></td>
<td><p>Protocolo de la capa superior (incluido <abbr title="Internet Control Message Protocol">ICMP</abbr>)</p></td>
</tr>
<tr class="row-odd"><td><p>ip protocol icmp
ip protocol != tcp
ip protocol {tcp, udp}</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>saddr</p></td>
<td><p>Dirección de origen.</p></td>
</tr>
<tr class="row-odd"><td><p>ip saddr 8.8.8.8
ip saddr 192.168.255.0/24</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>daddr</p></td>
<td><p>Dirección de destino.</p></td>
</tr>
<tr class="row-odd"><td><p>ip daddr 8.8.8.8
ip daddr != 192.168.255.0/24</p></td>
</tr>
<tr class="row-even"><td rowspan="4"><p>ip6</p></td>
<td rowspan="2"><p>saddr</p></td>
<td><p>Dirección de origen.</p></td>
</tr>
<tr class="row-odd"><td><p>ip saddr ::/64</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>daddr</p></td>
<td><p>Dirección de destino.</p></td>
</tr>
<tr class="row-odd"><td><p>ip daddr ::/64</p></td>
</tr>
<tr class="row-even"><td rowspan="6"><p>tcp</p></td>
<td rowspan="2"><p>sport</p></td>
<td><p>Puerto de origen.</p></td>
</tr>
<tr class="row-odd"><td><p>tcp sport ssh
tcp sport 22-80</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>dport</p></td>
<td><p>Puerto de destino.</p></td>
</tr>
<tr class="row-odd"><td><p>tcp dport != telnet
tcp dport {22, 23}</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>flags</p></td>
<td><p>Indicadores <abbr title="Transmission Control Protocol">TCP</abbr></p></td>
</tr>
<tr class="row-odd"><td><p>tcp dport != telnet
tcp dport {22, 23}</p></td>
</tr>
<tr class="row-even"><td rowspan="4"><p>udp</p></td>
<td rowspan="2"><p>sport</p></td>
<td><p>Puerto de origen.</p></td>
</tr>
<tr class="row-odd"><td><p>udp sport 53</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>dport</p></td>
<td><p>Puerto de destino.</p></td>
</tr>
<tr class="row-odd"><td><p>udp dport != 53</p></td>
</tr>
<tr class="row-even"><td rowspan="6"><p>ether</p></td>
<td rowspan="2"><p>saddr</p></td>
<td><p><abbr title="Media Access Control">MAC</abbr> de origen.</p></td>
</tr>
<tr class="row-odd"><td><p>ether saddr 00:11:22:33:44:55</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>daddr</p></td>
<td><p><abbr title="Media Access Control">MAC</abbr> de destino.</p></td>
</tr>
<tr class="row-odd"><td><p>ether daddr 00:11:22:33:44:55</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>type</p></td>
<td><p>Tipo de protocolo de capa superior.</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">ether type arp</div>
<div class="line">ether type ip</div>
<div class="line">ether type vlan</div>
</div>
</td>
</tr>
<tr class="row-even"><td rowspan="2"><p>vlan</p></td>
<td rowspan="2"><p>id</p></td>
<td><p>Identificador de la <abbr title="Virtual LAN">VLAN</abbr>.</p></td>
</tr>
<tr class="row-odd"><td><p>vlan id 10</p></td>
</tr>
<tr class="row-even"><td rowspan="10"><p>ct</p></td>
<td rowspan="2"><p>state</p></td>
<td><p>Estado de la conexión: <em>new</em>, <em>established</em>,
<em>related</em>, <em>untracked</em>, <em>invalid</em>.</p></td>
</tr>
<tr class="row-odd"><td><p>ct state {established, related}</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>status</p></td>
<td><p>Estado de la conexión (<em>snat</em> o <em>dnat</em> si el
tráfico ha sufrido <abbr title="Source NAT">SNAT</abbr> o <abbr title="Destination NAT">DNAT</abbr>, respectivamente)</p></td>
</tr>
<tr class="row-odd"><td><p>ct status dnat</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>mark [set]</p></td>
<td><p>Comprueba la marca de la conexión o la fija si se
usa <kbd class="kbd docutils literal notranslate">set</kbd>.</p></td>
</tr>
<tr class="row-odd"><td><p>ct mark 1
ct mark set 1</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>direction</p></td>
<td><p>Dirección del paquete: <em>original</em> o <em>reply</em></p></td>
</tr>
<tr class="row-odd"><td><p>ct direction reply</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>count [over]</p></td>
<td><p>Comprueba si la cantidad de conexiones simultáneas
no supera el límite indicado. Con <kbd class="kbd docutils literal notranslate">over</kbd> se
comprueba si lo supera.</p></td>
</tr>
<tr class="row-odd"><td><p>ct state new ct count 20</p></td>
</tr>
<tr class="row-even"><td rowspan="10"><p>meta</p></td>
<td rowspan="2"><div class="line-block">
<div class="line">iifname</div>
<div class="line">oifname</div>
</div>
</td>
<td><p>Nombre de la interfaz de entrada o salida.</p></td>
</tr>
<tr class="row-odd"><td><p>meta iifname «eth0»
meta iifname «eth*»</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><div class="line-block">
<div class="line">iif</div>
<div class="line">oif</div>
</div>
</td>
<td><p>Índice de la interfaz que se adjudica al crearla
y puede consultarse en
<code class="file docutils literal notranslate"><span class="pre">/class/net/eth0/ifindex</span></code>. La comparación es
más eficiente que para <kbd class="kbd docutils literal notranslate">iifname</kbd>, pero el
índice no es
reciclable, por lo que sólo es recomendable usarlo
si la interfaz se crea una vez y no se destruye
(p.e. una interfaz física). Consulte <a class="reference external" href="https://serverfault.com/a/985167">este enlace</a>.</p></td>
</tr>
<tr class="row-odd"><td><p>meta iif eth0</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><div class="line-block">
<div class="line">iifgroup</div>
<div class="line">oifgroup</div>
</div>
</td>
<td><p>Grupo al que pertenece la interfaz de entrada o
salida. Las interfaces pueden asignarse a un grupo
(ver <em class="manpage"><a class="manpage reference external" href="https://manpages.debian.org/ip-link(8)">ip-link(8)</a></em>) y definir los nombres
de los grupos en <code class="file docutils literal notranslate"><span class="pre">/etc/iproute2/groups</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p>meta iifgroup 99</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><div class="line-block">
<div class="line">iiftype</div>
<div class="line">oiftype</div>
</div>
</td>
<td><p>Tipo de la interfaz (<em>ether</em>, <em>loopback</em>, etc.)</p></td>
</tr>
<tr class="row-odd"><td><p>meta iiftype loopback</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>mark [set]</p></td>
<td><p>Comprueba o establece la marca del paquete.</p></td>
</tr>
<tr class="row-odd"><td><p>meta mark 2
meta mark set 2</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Consulte <em class="manpage"><a class="manpage reference external" href="https://manpages.debian.org/nft(8)">nft(8)</a></em> para una lista completa de criterios y
argumentos o <a class="reference external" href="https://wiki.nftables.org/wiki-nftables/index.php/Quick_reference-nftables_in_10_minutes">este artículo en la wiki de nftables</a>.</p>
</div>
<p>Tenga presenta que:</p>
<ul>
<li><p>Pueden acomularse condiciones en una misma sentencia:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ip saddr 8.8.8.8 tcp dport telnet</span>
</pre></div>
</div>
</li>
<li><p>Cuando los valores son numéricos la igualdad se nota no indicando operador,
pero también pueden usarse operadores de comparación (<kbd class="kbd docutils literal notranslate">!=</kbd>, <kbd class="kbd docutils literal notranslate">&lt;</kbd>),
rangos o valores hexadecimales (usando la notación <kbd class="kbd docutils literal notranslate">0x</kbd>):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">tcp dport 80</span>
<span class="go">tcp dport != 80</span>
<span class="go">tcp dport &gt;= 80</span>
<span class="go">tcp dport 0x50</span>
<span class="go">tcp dport 80-120</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Si ejecuta órdenes directamente en la <em>shell</em> tendrá que escapar
algunos de estos caracteres.</p>
</div>
</li>
<li><p>Es posible incluir como valor conjuntos de valores:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">tcp dport {http, https}</span>
<span class="go">tcp dport != {http, https}</span>
<span class="go">iif {eth0, eth1}</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">Ver también</p>
<p>Revise el <a class="reference internal" href="04.ext.html#nftables-sets"><span class="std std-ref">epígrafe dedicado a conjuntos</span></a>.</p>
</div>
</li>
</ul>
</div>
<div class="section" id="acciones">
<h3><span class="section-number">8.7.3.2.2.1.2. </span>Acciones<a class="headerlink" href="#acciones" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Las acciones pueden ser:</p>
<ul class="simple">
<li><p><em>Terminales</em>, que terminan la evaluación de la regla.</p></li>
<li><p><em>No terminales</em>, que son aquellas que no acaban la evaluación o establecen una condición.</p></li>
</ul>
<p>En una regla puede encontrarse como mucho una acción terminal, pero pueden añadirse varias no terminales.
Además las terminales no tienen por qué encontrarse al final de la sentencia,
sino que pueden intercalarse entre las condiciones. Por ejemplo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> nft add table filter
<span class="gp">#</span> nft add chain filter INPUT <span class="s2">&quot;{type filter hook input priority 0;}&quot;</span>
<span class="gp">#</span> nft add rule filter INPUT ct state new ip protocol TCP log prefix <span class="s1">&#39;&quot;TCP: &quot;&#39;</span> <span class="se">\</span>
                                         tcp dport ssh log prefix <span class="s1">&#39;&quot;SSH: &quot;&#39;</span> accept
</pre></div>
</div>
<p>generará una línea de registro advirtiendo de que una nueva conexión cuando ésta
sea <abbr title="Transmission Control Protocol">TCP</abbr>, y añadirá otra línea adicional advirtiendo de que es <abbr title="Security SHell">SSH</abbr> cuando,
además, sea tráfico de este tipo.</p>
<p class="rubric" id="nftables-acc-term">Acciones terminales</p>
<table class="nftables-acc-term docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 81%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Acción</p></th>
<th class="head"><p>Descripción</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>accept</p></td>
<td><p>Permite el paquete y acaba la evaluación de la cadena.</p></td>
</tr>
<tr class="row-odd"><td><p>drop</p></td>
<td><p>Desecha el paquete y acaba la evaluación.</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>reject</p></td>
<td><p>Rechaza el paquete, pero informando al emisor. Admite
añadir la causa (el tipo <abbr title="Internet Control Message Protocol">ICMP</abbr> o un <abbr title="Transmission Control Protocol">TCP</abbr> reset si el
tráfico de origen es <abbr title="Transmission Control Protocol">TCP</abbr>). Si se prescinde de la causa,
se envía un <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate">port</kbd>-<kbd class="kbd docutils literal notranslate">unreachable</kbd></kbd></p></td>
</tr>
<tr class="row-odd"><td><p>reject with icmp type host-unreachable
reject with icmp type port-unreachable
reject with tcp reset</p></td>
</tr>
<tr class="row-even"><td><p>queue</p></td>
<td><p>Envía el paquete a una cola en el espacio de usuario para
que lo gestione una aplicación y acaba la evaluación.
Véase <a class="reference external" href="https://wiki.nftables.org/wiki-nftables/index.php/Queueing_to_userspace">cómo enviarlos a la cola</a>.</p></td>
</tr>
<tr class="row-odd"><td><p>continue</p></td>
<td><p>Prosegue la evaluación con la siguiente regla.</p></td>
</tr>
<tr class="row-even"><td><p>return</p></td>
<td><p>Deja de evaluar las reglas de la cadena actual y regresa
a la regla posterior a la que invocó el salto. En una
cadena base, equivale a <em>accept</em>.</p></td>
</tr>
<tr class="row-odd"><td><p>jump &lt;chain&gt;</p></td>
<td><p>Salta a la cadena de usuario que se especifique y, al
término de ésta se prosigue por la siguiente regla.</p></td>
</tr>
<tr class="row-even"><td><p>goto &lt;chain&gt;</p></td>
<td><p>Salta también a la cadena especificada, pero al término
prosigue al final de la cadena desde la que se invocó.</p></td>
</tr>
</tbody>
</table>
<p class="rubric" id="nftables-acc-no-term">Acciones no terminales</p>
<p>No llevan acabo una acción que interrumpa la evaluación o introducen alguna
condición adicional</p>
<table class="nftables-acc-no-term docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 12%" />
<col style="width: 78%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Acción</p></th>
<th class="head"><p>Argumento</p></th>
<th class="head"><p>Descripción</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="2"><p>log</p></td>
<td rowspan="2"><div class="line-block">
<div class="line">prefix</div>
<div class="line">level</div>
</div>
</td>
<td><p>Registra el paso de un paquete. <kbd class="kbd docutils literal notranslate">prefix</kbd> añade un prefijo a la
cadena de registro y <kbd class="kbd docutils literal notranslate">level</kbd> indica cuál debe ser la importancia:
<em>emerg</em>, <em>alert</em>, <em>crit</em>, <em>err</em>, <em>warn</em>, <em>notice</em>, <em>info</em> o <em>debug</em>.</p></td>
</tr>
<tr class="row-odd"><td><p>nft add rule filter INPUT ct state new dport ssh log prefix “«SSH: «” level info</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>counter</p></td>
<td rowspan="2"><p>[name]</p></td>
<td><p>Añade un contador a la regla.</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">nft add rule filter INPUT ct state new dport ssh counter</div>
<div class="line">nft add rule filter INPUT ct state new dport ssh counter name pines</div>
</div>
</td>
</tr>
<tr class="row-even"><td rowspan="2"><p>snat</p></td>
<td rowspan="2"><p>to</p></td>
<td><p>Realiza un <abbr title="Source NAT">SNAT</abbr>.</p></td>
</tr>
<tr class="row-odd"><td><p>nft add rule nat POSTROUNTING oif eth0 snat to 172.22.0.2</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>masquerade</p></td>
<td rowspan="2"><p>[to :port]</p></td>
<td><p>Realiza un <abbr title="Source NAT">SNAT</abbr> copiando la dirección de la interfaz de salida.</p></td>
</tr>
<tr class="row-odd"><td><p>nft add rule nat POSTROUNTING oif eth0 masquerade</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>dnat</p></td>
<td rowspan="2"><p>to</p></td>
<td><p>Realiza un <abbr title="Destination NAT">DNAT</abbr>.</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">nft add rule nat PREROUNTING iif eth0 tcp dport {http,https} dnat to 192.168.255.10</div>
<div class="line">nft add rule nat PREROUNTING iif eth0 tcp dport 8080 dnat to 192.168.255.10:80</div>
<div class="line">nft add rule nat PREROUNTING iif eth0 dnat tcp port map {80: 10.0.0.3,443: 10.0.0.4}</div>
</div>
</td>
</tr>
<tr class="row-even"><td rowspan="2"><p>redirect</p></td>
<td rowspan="2"><p>[to :port]</p></td>
<td><p>Realiza un <abbr title="Destination NAT">DNAT</abbr> hacia la propia máquina.</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">nft add rule nat PREROUNTING iif eth0 tcp dport 80 redirect</div>
<div class="line">nft add rule nat PREROUNTING iif eth0 tcp dport 8080 redirect to :80</div>
</div>
</td>
</tr>
<tr class="row-even"><td rowspan="2"><div class="line-block">
<div class="line">add</div>
<div class="line">update</div>
</div>
</td>
<td rowspan="2"><p>&#64;setname</p></td>
<td><p>Añade o actualiza elementos de un <a class="reference internal" href="04.ext.html#nftables-sets"><span class="std std-ref">conjunto</span></a> desde una regla.</p></td>
</tr>
<tr class="row-odd"><td><p>nft add rule filter INPUT icmp type echo-request add &#64;testers {ip saddr timeout 2m}</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="objetos-de-inspeccion-de-estado">
<span id="nftables-stateful-objects"></span><h2><span class="section-number">8.7.3.2.2.2. </span>Objetos de inspección de estado<a class="headerlink" href="#objetos-de-inspeccion-de-estado" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Hay definidos tres:</p>
<ul class="simple">
<li><p>Los contadores.</p></li>
<li><p>Los caudales de tráfico (o límites de ratio de tráfico si se prefiere).</p></li>
<li><p>Las cuotas.</p></li>
</ul>
<p>Los tres se caracterizan porque:</p>
<ul>
<li><p>Pueden ser anónimos o definidos con un nombre. En el primer caso se crean
sobre la marcha al definir una regla, mientras que en el segundo se crean antes
y se usan luego en una o más reglas utilizando el nombre creado.</p></li>
<li><p>Son afectados por la regla en la que se encuentran. Por ejemplo, el contador:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> nft add filter input tcp dport ssh counter
</pre></div>
</div>
<p>incrementa en uno su valor al cumplir un paquete las condiciones incluidas en
la regla anteriores a su declaración. Por tanto cualquier paquete entrante de
trafico <abbr title="Security SHell">SSH</abbr> incrementará el valor del contador. En cambio, en este otro
caso de dos contadores:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> nft add filter input tcp dport ssh counter ct state new counter
</pre></div>
</div>
<p>hay dos contadores, el primero de los cuales se actualiza con cualquier
paquete entrante <abbr title="Security SHell">SSH</abbr>, pero el segundo sólo cuando uno de estos paquetes
inicia una conexión.</p>
</li>
<li><p>Un contador es una acción (se actualizan), pero no suponen ninguna condición;
mientras que el ratio y la cuota son ambas cosas: son acción porque se
actualizan y son condición porque establecen unos umbrales.</p></li>
</ul>
<p>Además de estos tres, tenemos una condición que se comporta de modo semejante y
puede usarse en <a class="reference internal" href="04.ext.html#nftables-meters"><span class="std std-ref">conjuntos dinámicos</span></a>, la de conexiones
simultáneas, por lo que la incluiremos dentro de este apartado.</p>
<div class="section" id="contadores">
<span id="nftables-counter"></span><h3><span class="section-number">8.7.3.2.2.2.1. </span>Contadores<a class="headerlink" href="#contadores" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Partiendo de esto:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> nft add table filter
<span class="gp">#</span> nft add chain filter INPUT <span class="s2">&quot;{type filter hook input prority 0;}&quot;</span>
<span class="gp">#</span> nft add rule filter INPUT icmp <span class="nb">type</span> echo-request counter
<span class="gp">#</span> nft list table filter
</pre></div>
</div>
<p>hemos creado un contador anónimo que contabilizará las peticiones <abbr title="Internet Control Message Protocol">ICMP</abbr> entrantes.
Podríamos en cambio haber creado un contador con nombre asociado a la tabla y
usarlo en la regla:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> nft add counter filter pines
<span class="gp">#</span> nft add rule filter INPUT ip protocol icmp counter name pines
</pre></div>
</div>
<p>Los contadores con nombre pueden usarse en varias reglas y, además, resetear su
valor:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> nft reset counter filter pines
</pre></div>
</div>
</div>
<div class="section" id="caudales">
<span id="nftables-limit"></span><h3><span class="section-number">8.7.3.2.2.2.2. </span>Caudales<a class="headerlink" href="#caudales" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El objeto <em>limit</em> permite contabilizar el tráfico de datos y mantenerlo dentro
de un umbral máximo.</p>
<table class="nftables-acc-no-term docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 12%" />
<col style="width: 78%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Acción</p></th>
<th class="head"><p>Argumento</p></th>
<th class="head"><p>Descripción</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="2"><p>limit</p></td>
<td rowspan="2"><p>rate [over]</p></td>
<td><p>Establece una condición que será verdadera mientras no se supere (o sí con <em>over</em>)
el ratio espeficiado. El ratio cuenta paquetes, <em>bytes</em>, <em>kbytes</em>, <em>mbytes</em> en
periodos de <em>second</em>, <em>minute</em>, <em>hour</em>, <em>day</em> o <em>week</em>. Puede además añadir
<kbd class="kbd docutils literal notranslate">burst</kbd> para la <a class="reference internal" href="../01.iptables/03.ext.html#iptables-limit"><span class="std std-ref">definición de la ráfaga</span></a>.</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">nft add rule filter INPUT icmp type echo-request limit rate 1/second accept</div>
<div class="line">nft add rule filter INPUT icmp type echo-request limit rate over 1/second drop</div>
<div class="line">nft add rule filter INPUT iff eth0 limit rate over 10/seconds burst 50 packets drop</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Por ejemplo, esta regla contabiliza las peticiones <abbr title="Internet Control Message Protocol">ICMP</abbr> entrantes y las acepta
mientras no se supere la ratio de un paquete al segundo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> nft add rule filter INPUT icmp <span class="nb">type</span> echo-request limit rate <span class="m">1</span>/second accept
</pre></div>
</div>
<p>los que la superen acabarán rechazados si la política predeterminada es la de
<em>lista blanca</em>. En cambio, si la política es de <strong>lista negra</strong>, lo que debemos
hacer es rechazar las peticiones que superen la tasa:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> nft add rule netdev filter INGRESS icmp <span class="nb">type</span> echo-request limit rate over <span class="m">1</span>/second drop
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Hay que tener presente que, por defecto, la <a class="reference internal" href="../01.iptables/03.ext.html#iptables-limit"><span class="std std-ref">ráfaga admisible</span></a> es de <strong>5</strong>, por lo que si se hacen pruebas de concepto para
comprobar cómo funciona la limitación es preferible limitar la ráfaga al
ratio (es decir para <em>2/second</em>, <em>2</em>):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> nft add rule filter INPUT icmp <span class="nb">type</span> echo-request limit rate <span class="m">2</span>/second burst <span class="m">2</span> packets accept
</pre></div>
</div>
</div>
<p>Como ocurre con las cuotas, para limitar teniendo en cuenta también la dirección
<abbr title="Internet Protocol">IP</abbr> de origen de los paquetes, deberíamos combinar el objeto con el uso de
<a class="reference internal" href="04.ext.html#nftables-meters"><span class="std std-ref">conjuntos dinámicos</span></a> y <a class="reference internal" href="04.ext.html#nftables-concat"><span class="std std-ref">concatenaciones</span></a>, ya que cada dirección de origen distinta debería
contabilizar la ratio o la cuota de forma independiente.</p>
<p>Es posible, por supuesto, definir una limitación con nombre, de forma análoga a
como se hacía con los contadores:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> nft add limit filter icmpratio <span class="o">{</span>rate <span class="m">1</span>/second<span class="o">}</span>
<span class="gp">#</span> nft add rule filter INPUT icmp <span class="nb">type</span> echo-request limit name icmpratio accept
</pre></div>
</div>
<p>o resetearlas.</p>
<div class="admonition-todo admonition" id="id3">
<p class="admonition-title">Por hacer</p>
<p>Implementar defensa contra ataque DoS a semejanza de iptables.</p>
</div>
</div>
<div class="section" id="cuotas">
<span id="nftables-quota"></span><h3><span class="section-number">8.7.3.2.2.2.3. </span>Cuotas<a class="headerlink" href="#cuotas" title="Enlazar permanentemente con este título">¶</a></h3>
<p>De modo análogo podemos definir cuotas, que funcionan como límite del tráfico
total que cumple con la regla.</p>
<table class="nftables-acc-no-term docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 13%" />
<col style="width: 77%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Acción</p></th>
<th class="head"><p>Argumento</p></th>
<th class="head"><p>Descripción</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="2"><p>quota</p></td>
<td rowspan="2"><p>[over]</p></td>
<td><p>Establece una cuota para la tranferencia. Debe añadirse
cuál es el umbral y las unidades (<em>bytes</em>, <em>kbytes</em>, <em>mbytes</em>)</p></td>
</tr>
<tr class="row-odd"><td><p>nft add rule filter OUTPUT tcp sport 22 quota over 10 mbytes drop</p></td>
</tr>
</tbody>
</table>
<p>Es posible crear cuotas con nombre:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> nft add quota ssh-quota <span class="o">{</span>over <span class="m">10</span> mbytes<span class="o">}</span>
<span class="gp">#</span> nft add rule filter OUTPUT tcp sport <span class="m">22</span> quota name ssh-quota drop
</pre></div>
</div>
<p>aunque esto establecerá un límite general para todo el tráfico <abbr title="Security SHell">SSH</abbr> de descarga
y no por cliente lo que exige <a class="reference internal" href="04.ext.html#nftables-meters"><span class="std std-ref">conjuntos dinámicos</span></a>.</p>
</div>
<div class="section" id="conexiones-simultaneas">
<span id="nftables-ctcount"></span><h3><span class="section-number">8.7.3.2.2.2.4. </span>Conexiones simultáneas<a class="headerlink" href="#conexiones-simultaneas" title="Enlazar permanentemente con este título">¶</a></h3>
<p><strong class="program">nftables</strong> brinda también la posibilidad de contar la cantidad de
conexiones simultáneas:</p>
<table class="nftables-acc-no-term docutils align-default">
<colgroup>
<col style="width: 9%" />
<col style="width: 14%" />
<col style="width: 77%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Acción</p></th>
<th class="head"><p>Argumento</p></th>
<th class="head"><p>Descripción</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="2"><p>ct</p></td>
<td rowspan="2"><p>count [over]</p></td>
<td><p>Cuenta y comprueba que el número de conexiones simultáneas
se mantenga en un umbral. Si se añade <kbd class="kbd docutils literal notranslate">over</kbd>, se cumplirá
la condición cuando se supere el umbral.</p></td>
</tr>
<tr class="row-odd"><td><p>nft add rule filter OUTPUT ct state new tcp sport 22 ct count over 2 drop</p></td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Basta hacer la comprobación al primer paquete y, además, es
bastante costosa, por lo que los desarrolladores <a class="reference external" href="https://patchwork.ozlabs.org/patch/859932/">recomiendan siempre
restringirla al paquete que abre la conexión</a> (véase el ejemplo ilustrativo
de la tabla).</p>
</div>
</div>
</div>
<div class="section" id="persistencia">
<h2><span class="section-number">8.7.3.2.2.3. </span>Persistencia<a class="headerlink" href="#persistencia" title="Enlazar permanentemente con este título">¶</a></h2>
<p>A diferencia de <a class="reference internal" href="../01.iptables/index.html#iptables"><span class="std std-ref">iptables</span></a>, <strong class="program">nftables</strong> tiene una
pequeña capacidad de generación de <em>scripts</em> que permite definir reglas, incluir
reglas definidas en otros ficheros, definir variables y añadir comentarios. No
hay, sin embargo, ni sentencias condicionales ni bucles.</p>
<p>Un script de estas características tenemos dos formas de ejecutarlo:</p>
<ol class="arabic">
<li><p>Con <strong class="command">nft</strong>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> nft -f reglas,nft
</pre></div>
</div>
</li>
<li><p>Incluyendo en él una primera línea de <em>sheebang</em> y dándole permisos de
ejecución:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/sbin/nft -f</span>

<span class="c1"># Borra todas las reglas</span>
flush ruleset

<span class="c1"># Configuración del cortafuegos ...</span>
</pre></div>
</div>
</li>
</ol>
<p>Particularmente, en <em>Debian</em> existe deshabilitado un servicio <em>nftables</em> que si
se habilita, lee el contenido del fichero <code class="file docutils literal notranslate"><span class="pre">/etc/nftables.conf</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> systemctl status nftables
<span class="go">● nftables.service - nftables</span>
<span class="go">   Loaded: loaded (/lib/systemd/system/nftables.service; disabled; vendor</span>
<span class="go">preset: enabled)</span>
<span class="go">   Active: inactive (dead)</span>
<span class="go">     Docs: man:nft(8)</span>
<span class="go">           http://wiki.nftables.org</span>
</pre></div>
</div>
<p>así que el modo más sencillo de configurar el cortafuegos es escribir dentro de
este fichero las reglas y habilitar el servicio.</p>
<div class="section" id="sentencias-adicionales">
<h3><span class="section-number">8.7.3.2.2.3.1. </span>Sentencias adicionales<a class="headerlink" href="#sentencias-adicionales" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Pueden ser:</p>
<dl>
<dt><strong>Comentarios</strong></dt><dd><p>Se notan, como en el lenguaje de la <em>shell</em> con «#». Cualquier texto incluido
tras uno, no se procesa.</p>
</dd>
<dt><strong>Inclusión de ficheros externos</strong></dt><dd><p>Se hace mediante la sentencia <kbd class="kbd docutils literal notranslate">include</kbd> y un argumento que indica el
fichero a leeri para el cual:</p>
<ul class="simple">
<li><p>Se permiten comodines.</p></li>
<li><p>No se leen ficheros ocultos.</p></li>
<li><p>Si se indca una ruta es relativa, esta es relativa al directorio que se haya
indicado mediante la opción <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate"></kbd>-<kbd class="kbd docutils literal notranslate"></kbd>-<kbd class="kbd docutils literal notranslate">includepath</kbd></kbd> y, si esta no se incluye, a
un directorio predefinido en tiempo de compilación que en <em>Debian</em> es
<code class="file docutils literal notranslate"><span class="pre">/etc/</span></code>.</p></li>
</ul>
<p>Por tanto, si incluímos dentro de <code class="file docutils literal notranslate"><span class="pre">/etc/nftables,conf</span></code> la línea:</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="k">include</span> <span class="n">&quot;nftables.d/*.nft&quot;</span>
</pre></div>
</div>
<p>podremos crear el directorio <code class="file docutils literal notranslate"><span class="pre">/etc/nftables.d</span></code> y, dentro de él, crear
varios ficheros de extensión <code class="file docutils literal notranslate"><span class="pre">.nft</span></code> para una configuración modular.</p>
</dd>
<dt><strong>Definición de variables</strong></dt><dd><p>Que pueden usarse luego en la definición de las reglas anteponiendo un «$» al
nombre:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> /etc/nftables.d/prueba.nft

<span class="go">define entrada eth0</span>

<span class="go">add rule inet filter iif $entrada counter</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="id4">
<h3><span class="section-number">8.7.3.2.2.3.2. </span>Reglas<a class="headerlink" href="#id4" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Las definición reglas dentro del fichero puede hacerse mediante dos formatos
distintos:</p>
<ul>
<li><p>El que se usaría para escribir una regla con la orden <strong class="command">nft</strong>, pero sin
incluir el propio <kbd class="kbd docutils literal notranslate">nft</kbd>. La regla con que acaba el epígrafe anterior es
un ejemplo.</p></li>
<li><p>Utilizando el mismo formato que devuelve una orden <kbd class="kbd docutils literal notranslate"><kbd class="kbd docutils literal notranslate">nft</kbd> <kbd class="kbd docutils literal notranslate">list</kbd></kbd>. Por
ejemplo, esto funciona perfectamente:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> <span class="nb">echo</span> <span class="s2">&quot;flush ruleset&quot;</span> &gt; script.nft
<span class="gp">#</span> nft list ruleset &gt;&gt; script.nft
<span class="gp">#</span> nft -f script.nft
</pre></div>
</div>
</li>
</ul>
<p class="rubric">Notas al pie</p>
<dl class="footnote brackets">
<dt class="label" id="id5"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>EN <em>Buster</em> basta con utilizar <strong class="command">iptables</strong>, puesto que es la
alternativa predeterminada frente al antiguo <strong class="command">iptables</strong> que ha
pasado a renombrase como <strong class="command">iptables-legacy</strong>.</p>
</dd>
<dt class="label" id="id6"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>No debe entenderse de lo dicho que para crear las tablas, hay que usar la
orden de listado primero. Insertar una regla, por ejemplo, ya crea la
infraestructura necesaria.</p>
</dd>
</dl>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../../index.html">Tabla de contenido</a></h3>
  <ul>
<li><a class="reference internal" href="#">8.7.3.2.2. Reglas</a><ul>
<li><a class="reference internal" href="#sintaxis">8.7.3.2.2.1. Sintaxis</a><ul>
<li><a class="reference internal" href="#condiciones">8.7.3.2.2.1.1. Condiciones</a></li>
<li><a class="reference internal" href="#acciones">8.7.3.2.2.1.2. Acciones</a></li>
</ul>
</li>
<li><a class="reference internal" href="#objetos-de-inspeccion-de-estado">8.7.3.2.2.2. Objetos de inspección de estado</a><ul>
<li><a class="reference internal" href="#contadores">8.7.3.2.2.2.1. Contadores</a></li>
<li><a class="reference internal" href="#caudales">8.7.3.2.2.2.2. Caudales</a></li>
<li><a class="reference internal" href="#cuotas">8.7.3.2.2.2.3. Cuotas</a></li>
<li><a class="reference internal" href="#conexiones-simultaneas">8.7.3.2.2.2.4. Conexiones simultáneas</a></li>
</ul>
</li>
<li><a class="reference internal" href="#persistencia">8.7.3.2.2.3. Persistencia</a><ul>
<li><a class="reference internal" href="#sentencias-adicionales">8.7.3.2.2.3.1. Sentencias adicionales</a></li>
<li><a class="reference internal" href="#id4">8.7.3.2.2.3.2. Reglas</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Tema anterior</h4>
  <p class="topless"><a href="01.conceptos.html"
                        title="capítulo anterior"><span class="section-number">8.7.3.2.1. </span>Creación del armazón</a></p>
  <h4>Próximo tema</h4>
  <p class="topless"><a href="03.conn.html"
                        title="próximo capítulo"><span class="section-number">8.7.3.2.3. </span>Uso práctico</a></p>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/08.redes/07.cortafuegos/02.nftables/02.reglas.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Ir a" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="03.conn.html" title="8.7.3.2.3. Uso práctico"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="01.conceptos.html" title="8.7.3.2.1. Creación del armazón"
             >anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" ><span class="section-number">8. </span>Conceptos avanzados de redes</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" ><span class="section-number">8.7. </span>Cortafuegos</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="index.html" ><span class="section-number">8.7.3.2. </span>nftables</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">8.7.3.2.2. </span>Reglas</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Derechos de autor CC BY 4.0, 2016-2020, José Miguel Sánchez Alés.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
  </body>
</html>