


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="es">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>8.7.3.2.2. Reglas &#8212; documentación de Linuxnomicón - rolling</title>
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../../_static/translations.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Índice" href="../../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../../search.html" />
    <link rel="next" title="8.7.3.2.3. Uso práctico" href="03.conn.html" />
    <link rel="prev" title="8.7.3.2.1. Creación del armazón" href="01.conceptos.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="03.conn.html" title="8.7.3.2.3. Uso práctico"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="01.conceptos.html" title="8.7.3.2.1. Creación del armazón"
             accesskey="P">anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >8. Conceptos avanzados de redes</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" >8.7. Cortafuegos</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="index.html" accesskey="U">8.7.3.2. nftables</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="reglas">
<span id="iptables-rules"></span><h1>8.7.3.2.2. Reglas<a class="headerlink" href="#reglas" title="Enlazar permanentemente con este título">¶</a></h1>
<p>Si nuestro cortafuegos no lleva a cabo tareas muy complicadas, es posible seguir
usando la <a class="reference internal" href="../01.iptables/01.basico.html#iptables-sintaxis"><span class="std std-ref">sintaxis de iptables</span></a> a través de la familia
de órdenes <strong class="program">iptables-nft</strong>, <strong class="program">ip6tables-nft</strong>,
<strong class="program">ebtables-nft</strong> y <strong class="program">arptables-nft</strong> sin preocuparnos siquiera de crear
tablas ni cadenas, puesto que estas órdenes, al ser ejecutadas, crean las
cadenas pertinentes. Así pues<a class="footnote-reference" href="#id3" id="id1">[1]</a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> iptables-nft -vnL
</pre></div>
</div>
<p>creará las cadenas incluidas en las tablas <em>filter</em><a class="footnote-reference" href="#id4" id="id2">[2]</a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> nft list table filter
<span class="go">table ip filter {</span>
<span class="go">   chain INPUT {</span>
<span class="go">      type filter hook input priority filter; policy accept;</span>
<span class="go">   }</span>

<span class="go">   chain FORWARD {</span>
<span class="go">      type filter hook forward priority filter; policy accept;</span>
<span class="go">   }</span>

<span class="go">   chain OUTPUT {</span>
<span class="go">      type filter hook output priority filter; policy accept;</span>
<span class="go">   }</span>
<span class="go">}</span>
</pre></div>
</div>
<p>y la expresión de una regla también será interpretada sin problemas:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> iptables -A INPUT -p tcp --dport <span class="m">80</span> -j DROP
<span class="gp">#</span> nft list chain filter INPUT
<span class="go">table ip filter {</span>
<span class="go">   chain INPUT {</span>
<span class="go">      type filter hook input priority filter; policy accept;</span>
<span class="go">      meta l4proto tcp tcp dport 80 counter packets 0 bytes 0 drop</span>
<span class="go">   }</span>
<span class="go">}</span>
</pre></div>
</div>
<p>Hay, además, un traductor que permite ver cuál es el equivalente sin
llegar a hacer la orden efectiva:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> iptables-translate -A INPUT -p tcp --dport <span class="m">80</span> -j DROP
<span class="go">nft add rule ip filter INPUT tcp dport 80 counter drop</span>
</pre></div>
</div>
<p>Para tareas más complicadas, en cambio, es forzoso conocer la sintaxis modernas
y a ello nos dedicaremos.</p>
<div class="section" id="sintaxis">
<h2>8.7.3.2.2.1. Sintaxis<a class="headerlink" href="#sintaxis" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Las reglas se añaden a las cadenas y se van comprobando en el orden en el que
se encuentran en ella. se añaden del siguiente modo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> nft add<span class="p">|</span>insert rule <span class="o">[</span>&lt;famiy&gt;<span class="o">]</span> &lt;table&gt; &lt;chain&gt; <span class="o">[</span>handle &lt;value&gt;<span class="o">]</span> <span class="o">[</span>&lt;selectores&gt;<span class="o">]</span> <span class="o">[</span>&lt;acciones&gt;<span class="o">]</span>
</pre></div>
</div>
<p>esto es:</p>
<ul class="simple">
<li>Se puede añadir (<kbd class="kbd docutils literal notranslate">add</kbd>) o insertar (<kbd class="kbd docutils literal notranslate">ìnsert</kbd>).</li>
<li>Se indica la cadena a la que pertenece la regla.</li>
<li>Con <kbd class="kbd docutils literal notranslate">handle</kbd> se indica la posición de adición o inserción. Añadir
implica hacerlo tras la posición e insertar antes de ella. Si no se indica
<kbd class="kbd docutils literal notranslate">handle</kbd>, <kbd class="kbd docutils literal notranslate">add</kbd> añadirá la regla al final de la cadena e
<kbd class="kbd docutils literal notranslate">insert</kbd>, al commienza.</li>
<li>Los selectores (uno o varios) permiten especificar cuál es el tráfico al que
afecta la regla.</li>
<li>Por último, debe especificarse cuál es el efecto o efectos de la regla sobre
el tráfico al que afecta.</li>
</ul>
<p>Por ejemplo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> nft add rule filter INPUT ip daddr <span class="m">10</span>.0.0.0/8 accept
</pre></div>
</div>
<p>en este caso, hay una condición, que la dirección de destino esté en la red
<em>10.0.0.0/8</em>; y una acción terminal: aceptar el tráfico. Puede no incluirse
acción alguna, en cuyo caso, la regla comprobará la condición… pero no
hará nada en particular (aunque puede tener sentido si <a class="reference internal" href="04.ext.html#nftables-counter"><span class="std std-ref">se quieren contar
paquetes</span></a>).</p>
<p>Para listar reglas podemos:</p>
<ul>
<li><p class="first">Listar las reglas de una cadena:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nft list chain [&lt;family&gt;] &lt;table&gt; &lt;nombre&gt;</span>
</pre></div>
</div>
<p>como, por ejemplo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> nft list chain filter INPUT
</pre></div>
</div>
</li>
<li><p class="first">Listas las reglas de todas las cadenas de una tabla:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nft list table [&lt;family&gt;] &lt;nombre&gt;</span>
</pre></div>
</div>
<p>como por ejemplo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> nft list table filter
</pre></div>
</div>
</li>
<li><p class="first">Listar todas las reglas:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> nft list ruleset
</pre></div>
</div>
</li>
</ul>
<p>Es interesante la opción <kbd class="kbd docutils literal notranslate">-a</kbd> que indica para cada regla el <em>handle</em> que le
corresponde y que podemos usar para borrar reglas:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> nft delete rule <span class="o">[</span>&lt;family&gt;<span class="o">]</span> &lt;table&gt; &lt;chain&gt; handle &lt;handle&gt;
</pre></div>
</div>
<p>como por ejemplo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> nft delete rule filter INPUT handle <span class="m">1</span>
</pre></div>
</div>
<p>Si sustituimos <kbd class="kbd docutils literal notranslate">list</kbd> por <kbd class="kbd docutils literal notranslate">flush</kbd> lograremos el efecto de vaciar de
reglas la cadena, todas las cadenas de la tabla o todas las cadenas de todas las
tablas:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> nft flush chain filter INPUT
<span class="gp">#</span> nft flush table filter
<span class="gp">#</span> nft flush ruleset
</pre></div>
</div>
<div class="section" id="condiciones">
<h3>8.7.3.2.2.1.1. Condiciones<a class="headerlink" href="#condiciones" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Algunas de las condiciones que podemos indicar son:</p>
<table border="1" class="nftables-matches docutils">
<colgroup>
<col width="13%" />
<col width="21%" />
<col width="66%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Criterio</th>
<th class="head">Argumento</th>
<th class="head">Descripción</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td rowspan="6">ip</td>
<td rowspan="2">protocol</td>
<td>Protocolo de la capa superior (incluido <abbr title="Internet Control Message Protocol">ICMP</abbr>)</td>
</tr>
<tr class="row-odd"><td>ip protocol icmp
ip protocol != tcp
ip protocol {tcp, udp}</td>
</tr>
<tr class="row-even"><td rowspan="2">saddr</td>
<td>Dirección de origen.</td>
</tr>
<tr class="row-odd"><td>ip saddr 8.8.8.8
ip saddr 192.168.255.0/24</td>
</tr>
<tr class="row-even"><td rowspan="2">daddr</td>
<td>Dirección de destino.</td>
</tr>
<tr class="row-odd"><td>ip daddr 8.8.8.8
ip daddr != 192.168.255.0/24</td>
</tr>
<tr class="row-even"><td rowspan="4">ip6</td>
<td rowspan="2">saddr</td>
<td>Dirección de origen.</td>
</tr>
<tr class="row-odd"><td>ip saddr ::/64</td>
</tr>
<tr class="row-even"><td rowspan="2">daddr</td>
<td>Dirección de destino.</td>
</tr>
<tr class="row-odd"><td>ip daddr ::/64</td>
</tr>
<tr class="row-even"><td rowspan="6">tcp</td>
<td rowspan="2">sport</td>
<td>Puerto de origen.</td>
</tr>
<tr class="row-odd"><td>tcp sport ssh
tcp sport 22-80</td>
</tr>
<tr class="row-even"><td rowspan="2">dport</td>
<td>Puerto de destino.</td>
</tr>
<tr class="row-odd"><td>tcp dport != telnet
tcp dport {22, 23}</td>
</tr>
<tr class="row-even"><td rowspan="2">flags</td>
<td>Indicadores <abbr title="Transmission Control Protocol">TCP</abbr></td>
</tr>
<tr class="row-odd"><td>tcp dport != telnet
tcp dport {22, 23}</td>
</tr>
<tr class="row-even"><td rowspan="4">udp</td>
<td rowspan="2">sport</td>
<td>Puerto de origen.</td>
</tr>
<tr class="row-odd"><td>udp sport 53</td>
</tr>
<tr class="row-even"><td rowspan="2">dport</td>
<td>Puerto de destino.</td>
</tr>
<tr class="row-odd"><td>udp dport != 53</td>
</tr>
<tr class="row-even"><td rowspan="6">ether</td>
<td rowspan="2">saddr</td>
<td><abbr title="Media Access Control">MAC</abbr> de origen.</td>
</tr>
<tr class="row-odd"><td>ether saddr 00:11:22:33:44:55</td>
</tr>
<tr class="row-even"><td rowspan="2">daddr</td>
<td><abbr title="Media Access Control">MAC</abbr> de destino.</td>
</tr>
<tr class="row-odd"><td>ether daddr 00:11:22:33:44:55</td>
</tr>
<tr class="row-even"><td rowspan="2">type</td>
<td>Tipo de protocolo de capa superior.</td>
</tr>
<tr class="row-odd"><td>ether type arp
ether type ip
ether type vlan</td>
</tr>
<tr class="row-even"><td rowspan="2">vlan</td>
<td rowspan="2">id</td>
<td>Identificador de la <abbr title="Virtual LAN">VLAN</abbr>.</td>
</tr>
<tr class="row-odd"><td>vlan id 10</td>
</tr>
<tr class="row-even"><td rowspan="10">ct</td>
<td rowspan="2">state</td>
<td>Estado de la conexión: <em>new</em>, <em>established</em>,
<em>related</em>, <em>untracked</em>, <em>invalid</em>.</td>
</tr>
<tr class="row-odd"><td>ct state {established, related}</td>
</tr>
<tr class="row-even"><td rowspan="2">status</td>
<td>Estado de la conexión (<em>snat</em> o <em>dnat</em> si el
tráfico ha sufrido <abbr title="Source NAT">SNAT</abbr> o <abbr title="Destination NAT">DNAT</abbr>, respectivamente)</td>
</tr>
<tr class="row-odd"><td>ct status dnat</td>
</tr>
<tr class="row-even"><td rowspan="2">mark [set]</td>
<td>Comprueba la marca de la conexión o la fija si se
usa <kbd class="kbd docutils literal notranslate">set</kbd>.</td>
</tr>
<tr class="row-odd"><td>ct mark 1
ct mark set 1</td>
</tr>
<tr class="row-even"><td rowspan="2">direction</td>
<td>Dirección del paquete: <em>original</em> o <em>reply</em></td>
</tr>
<tr class="row-odd"><td>ct direction reply</td>
</tr>
<tr class="row-even"><td rowspan="2">count [over]</td>
<td>Comprueba si la cantidad de conexiones simultáneas
no supera el límite indicado. Con <kbd class="kbd docutils literal notranslate">over</kbd> se
comprueba si lo supera.</td>
</tr>
<tr class="row-odd"><td>ct count 20</td>
</tr>
<tr class="row-even"><td rowspan="10">meta</td>
<td rowspan="2"><div class="first last line-block">
<div class="line">iifname</div>
<div class="line">oifname</div>
</div>
</td>
<td>Nombre de la interfaz de entrada o salida.</td>
</tr>
<tr class="row-odd"><td>meta iifname «eth0»
meta iifname «eth*»</td>
</tr>
<tr class="row-even"><td rowspan="2"><div class="first last line-block">
<div class="line">iif</div>
<div class="line">oif</div>
</div>
</td>
<td>Índice de la interfaz que se adjudica al crearla
y puede consultarse en
<code class="file docutils literal notranslate"><span class="pre">/class/net/eth0/ifindex</span></code>. La comparación es
más eficiente que para <kbd class="kbd docutils literal notranslate">iifname</kbd>, pero el
índice no es
reciclable, por lo que sólo es recomendable usarlo
si la interfaz se crea una vez y no se destruye
(p.e. una interfaz física). Consulte <a class="reference external" href="https://serverfault.com/a/985167">este enlace</a>.</td>
</tr>
<tr class="row-odd"><td>meta iif eth0</td>
</tr>
<tr class="row-even"><td rowspan="2"><div class="first last line-block">
<div class="line">iifgroup</div>
<div class="line">oifgroup</div>
</div>
</td>
<td>Grupo al que pertenece la interfaz de entrada o
salida. Las interfaces pueden asignarse a un grupo
(ver <em class="manpage"><a class="manpage reference external" href="https://manpages.debian.org/ip-link(8)">ip-link(8)</a></em>) y definir los nombres
de los grupos en <code class="file docutils literal notranslate"><span class="pre">/etc/iproute2/groups</span></code>.</td>
</tr>
<tr class="row-odd"><td>meta iifgroup 99</td>
</tr>
<tr class="row-even"><td rowspan="2"><div class="first last line-block">
<div class="line">iiftype</div>
<div class="line">oiftype</div>
</div>
</td>
<td>Tipo de la interfaz (<em>ether</em>, <em>loopback</em>, etc.)</td>
</tr>
<tr class="row-odd"><td>meta iiftype loopback</td>
</tr>
<tr class="row-even"><td rowspan="2">mark [set]</td>
<td>Comprueba o establece la marca del paquete.</td>
</tr>
<tr class="row-odd"><td>meta mark 2
meta mark set 2</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Consulte <em class="manpage"><a class="manpage reference external" href="https://manpages.debian.org/nft(8)">nft(8)</a></em> para una lista completa de criterios y
argumentos o <a class="reference external" href="https://wiki.nftables.org/wiki-nftables/index.php/Quick_reference-nftables_in_10_minutes">este artículo en la wiki de nftables</a>.</p>
</div>
<p>Tenga presenta que:</p>
<ul>
<li><p class="first">Pueden acomularse condiciones en una misma sentencia:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ip saddr 8.8.8.8 tcp dport telnet</span>
</pre></div>
</div>
</li>
<li><p class="first">Cuando los valores son numéricos la igualdad se nota no indicando operador,
pero también pueden usarse operadores de comparación (<kbd class="kbd docutils literal notranslate">!=</kbd>, <kbd class="kbd docutils literal notranslate">&lt;</kbd>),
rangos o valores hexadecimales (usando la notación <kbd class="kbd docutils literal notranslate">0x</kbd>):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">tcp dport 80</span>
<span class="go">tcp dport != 80</span>
<span class="go">tcp dport &gt;= 80</span>
<span class="go">tcp dport 0x50</span>
<span class="go">tcp dport 80-120</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Si ejecuta órdenes directamente en la <em>shell</em> tendrá que escapar
algunos de estos caracteres.</p>
</div>
</li>
<li><p class="first">Es posible incluir como valor conjuntos de valores:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">tcp dport {http, https}</span>
<span class="go">tcp dport != {http, https}</span>
<span class="go">iif {eth0, eth1}</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">Ver también</p>
<p class="last">Revise el <a class="reference internal" href="04.ext.html#nftables-sets"><span class="std std-ref">epígrafe dedicado a conjuntos</span></a>.</p>
</div>
</li>
</ul>
</div>
<div class="section" id="acciones">
<h3>8.7.3.2.2.1.2. Acciones<a class="headerlink" href="#acciones" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Las acciones pueden ser:</p>
<ul class="simple">
<li><em>Terminales</em>, que terminan la evaluación de la regla.</li>
<li><em>No terminales</em>, que son aquellas que no acaban la evaluación o establecen una condición.</li>
</ul>
<p>En una regla puede encontrarse como mucho una acción terminal, pero pueden añadirse varias no terminales.
Además las terminales no tienen por qué encontrarse al final de la sentencia,
sino que pueden intercalarse entre las condiciones. Por ejemplo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> nft add table filter
<span class="gp">#</span> nft add chain filter INPUT <span class="s2">&quot;{type filter hook input priority 0;}&quot;</span>
<span class="gp">#</span> nft add rule filter INPUT ct state new ip protocol TCP log prefix <span class="s1">&#39;&quot;TCP: &quot;&#39;</span> <span class="se">\</span>
                                         tcp dport ssh log prefix <span class="s1">&#39;&quot;SSH: &quot;&#39;</span> accept
</pre></div>
</div>
<p>generará una línea de registro advirtiendo de que una nueva conexión cuando ésta
sea <abbr title="Transmission Control Protocol">TCP</abbr>, y añadirá otra línea adicional advirtiendo de que es <abbr title="Security SHell">SSH</abbr> cuando,
además, sea tráfico de este tipo.</p>
<p class="rubric" id="nftables-acc-term">Acciones terminales</p>
<table border="1" class="nftables-acc-term docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Acción</th>
<th class="head">Descripción</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>accept</td>
<td>Permite el paquete y acaba la evaluación de la cadena.</td>
</tr>
<tr class="row-odd"><td>drop</td>
<td>Desecha el paquete y acaba la evaluación.</td>
</tr>
<tr class="row-even"><td rowspan="2">reject</td>
<td>Rechaza el paquete, pero informando al emisor. Admite
añadir la causa (el tipo <abbr title="Internet Control Message Protocol">ICMP</abbr> o un <abbr title="Transmission Control Protocol">TCP</abbr> reset si el
tráfico de origen es <abbr title="Transmission Control Protocol">TCP</abbr>). Si se prescinde de la causa,
se envía un <kbd class="kbd docutils literal notranslate">port-unreachable</kbd></td>
</tr>
<tr class="row-odd"><td>reject with icmp type host-unreachable
reject with icmp type port-unreachable
reject with tcp reset</td>
</tr>
<tr class="row-even"><td>queue</td>
<td>Envía el paquete a una cola en el espacio de usuario para
que lo gestione una aplicación y acaba la evaluación.
Véase <a class="reference external" href="https://wiki.nftables.org/wiki-nftables/index.php/Queueing_to_userspace">cómo enviarlos a la cola</a>.</td>
</tr>
<tr class="row-odd"><td>continue</td>
<td>Prosegue la evaluación con la siguiente regla.</td>
</tr>
<tr class="row-even"><td>return</td>
<td>Deja de evaluar las reglas de la cadena actual y regresa
a la regla posterior a la que invocó el salto. En una
cadena base, equivale a <em>accept</em>.</td>
</tr>
<tr class="row-odd"><td>jump &lt;chain&gt;</td>
<td>Salta a la cadena de usuario que se especifique y, al
término de ésta se prosigue por la siguiente regla.</td>
</tr>
<tr class="row-even"><td>goto &lt;chain&gt;</td>
<td>Salta también a la cadena especificada, pero al término
prosigue al final de la cadena desde la que se invocó.</td>
</tr>
</tbody>
</table>
<p class="rubric" id="nftables-acc-no-term">Acciones no terminales</p>
<p>No llevan acabo una acción que interrumpa la evaluación o introducen alguna
condición adicional</p>
<table border="1" class="nftables-acc-no-term docutils">
<colgroup>
<col width="11%" />
<col width="12%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Acción</th>
<th class="head">Argumento</th>
<th class="head">Descripción</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td rowspan="2">log</td>
<td rowspan="2"><div class="first last line-block">
<div class="line">prefix</div>
<div class="line">level</div>
</div>
</td>
<td>Registra el paso de un paquete. <kbd class="kbd docutils literal notranslate">prefix</kbd> añade un prefijo a la
cadena de registro y <kbd class="kbd docutils literal notranslate">level</kbd> indica cuál debe ser la importancia:
<em>emerg</em>, <em>alert</em>, <em>crit</em>, <em>err</em>, <em>warn</em>, <em>notice</em>, <em>info</em> o <em>debug</em>.</td>
</tr>
<tr class="row-odd"><td>nft add rule filter INPUT ct state new dport ssh log prefix “«SSH: «” level info</td>
</tr>
<tr class="row-even"><td rowspan="2">counter</td>
<td rowspan="2">[name]</td>
<td>Añade un contador a la regla.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">nft add rule filter INPUT ct state new dport ssh counter</div>
<div class="line">nft add rule filter INPUT ct state new dport ssh counter name pines</div>
</div>
</td>
</tr>
<tr class="row-even"><td rowspan="2">snat</td>
<td rowspan="2">to</td>
<td>Realiza un <abbr title="Source NAT">SNAT</abbr>.</td>
</tr>
<tr class="row-odd"><td>nft add rule nat POSTROUNTING oif eth0 snat to 172.22.0.2</td>
</tr>
<tr class="row-even"><td rowspan="2">masquerade</td>
<td rowspan="2">[to :port]</td>
<td>Realiza un <abbr title="Source NAT">SNAT</abbr> copiando la dirección de la interfaz de salida.</td>
</tr>
<tr class="row-odd"><td>nft add rule nat POSTROUNTING oif eth0 masquerade</td>
</tr>
<tr class="row-even"><td rowspan="2">dnat</td>
<td rowspan="2">to</td>
<td>Realiza un <abbr title="Destination NAT">DNAT</abbr>.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">nft add rule nat PREROUNTING iif eth0 tcp dport {http,https} dnat to 192.168.255.10</div>
<div class="line">nft add rule nat PREROUNTING iif eth0 tcp dport 8080 dnat to 192.168.255.10:80</div>
<div class="line">nft add rule nat PREROUNTING iif eth0 dnat tcp port map {80: 10.0.0.3,443: 10.0.0.4}</div>
</div>
</td>
</tr>
<tr class="row-even"><td rowspan="2">redirect</td>
<td rowspan="2">[to :port]</td>
<td>Realiza un <abbr title="Destination NAT">DNAT</abbr> hacia la propia máquina.</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">nft add rule nat PREROUNTING iif eth0 tcp dport 80 redirect</div>
<div class="line">nft add rule nat PREROUNTING iif eth0 tcp dport 8080 redirect to :80</div>
</div>
</td>
</tr>
<tr class="row-even"><td rowspan="2"><div class="first last line-block">
<div class="line">add</div>
<div class="line">update</div>
</div>
</td>
<td rowspan="2">&#64;setname</td>
<td>Añade o actualiza elementos de un <a class="reference internal" href="04.ext.html#nftables-sets"><span class="std std-ref">conjunto</span></a> desde una regla.</td>
</tr>
<tr class="row-odd"><td>nft add rule filter INPUT icmp type echo-request add &#64;testers {ip saddr timeout 2m}</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="persistencia">
<h2>8.7.3.2.2.2. Persistencia<a class="headerlink" href="#persistencia" title="Enlazar permanentemente con este título">¶</a></h2>
<p class="rubric">Notas al pie</p>
<table class="docutils footnote" frame="void" id="id3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>EN <em>Buster</em> basta con utilizar <strong class="command">iptables</strong>, puesto que es la
alternativa predeterminada frente al antiguo <strong class="command">iptables</strong> que ha
pasado a renombrase como <strong class="command">iptables-legacy</strong>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>No debe entenderse de lo dicho que para crear las tablas, hay que usar la
orden de listado primero. Insertar una regla, por ejemplo, ya crea la
infraestructura necesaria.</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">8.7.3.2.2. Reglas</a><ul>
<li><a class="reference internal" href="#sintaxis">8.7.3.2.2.1. Sintaxis</a><ul>
<li><a class="reference internal" href="#condiciones">8.7.3.2.2.1.1. Condiciones</a></li>
<li><a class="reference internal" href="#acciones">8.7.3.2.2.1.2. Acciones</a></li>
</ul>
</li>
<li><a class="reference internal" href="#persistencia">8.7.3.2.2.2. Persistencia</a></li>
</ul>
</li>
</ul>

  <h4>Tema anterior</h4>
  <p class="topless"><a href="01.conceptos.html"
                        title="capítulo anterior">8.7.3.2.1. Creación del armazón</a></p>
  <h4>Próximo tema</h4>
  <p class="topless"><a href="03.conn.html"
                        title="próximo capítulo">8.7.3.2.3. Uso práctico</a></p>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/08.redes/07.cortafuegos/02.nftables/02.reglas.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Ir a" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="03.conn.html" title="8.7.3.2.3. Uso práctico"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="01.conceptos.html" title="8.7.3.2.1. Creación del armazón"
             >anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >8. Conceptos avanzados de redes</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" >8.7. Cortafuegos</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="index.html" >8.7.3.2. nftables</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Derechos de autor CC BY 4.0, 2016-2020, José Miguel Sánchez Alés.
      Creado con <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>