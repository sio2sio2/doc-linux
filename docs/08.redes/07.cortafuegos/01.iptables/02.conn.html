


<!DOCTYPE html>

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>8.7.3.1.2. Uso práctico &#8212; documentación de Linuxnomicón - rolling</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/classic.css" />
    <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
    
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/translations.js"></script>
    
    <link rel="index" title="Índice" href="../../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../../search.html" />
    <link rel="next" title="8.7.3.1.3. Extensiones" href="03.ext.html" />
    <link rel="prev" title="8.7.3.1.1. Conceptos básicos" href="01.basico.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="03.ext.html" title="8.7.3.1.3. Extensiones"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="01.basico.html" title="8.7.3.1.1. Conceptos básicos"
             accesskey="P">anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" ><span class="section-number">8. </span>Conceptos avanzados de redes</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" ><span class="section-number">8.7. </span>Cortafuegos</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="index.html" accesskey="U"><span class="section-number">8.7.3.1. </span>IPtables</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">8.7.3.1.2. </span>Uso práctico</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="uso-practico">
<span id="iptables-uso"></span><h1><span class="section-number">8.7.3.1.2. </span>Uso práctico<a class="headerlink" href="#uso-practico" title="Enlazar permanentemente con este título">¶</a></h1>
<p>Para introducirnos en <strong class="program">iptables</strong> es imprescindible entender cómo
analizar el estado de las conexiones e ilustrar su uso con ejemplos prácticos.
Por ello dividiremos este epígrafe en dos grandes secciones: una dedicada a casos
ejemplares y otra a casos prácticos. Antes, no obstante, es necesario introducir
los módulos dedicadas a analizar paquetes según la conexión a la que pertenezcan.</p>
<table class="iptables-ext docutils align-default" id="iptables-conn">
<colgroup>
<col style="width: 10%" />
<col style="width: 19%" />
<col style="width: 71%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Extension</p></th>
<th class="head"><p>Opción</p></th>
<th class="head"><p>Descripción</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="2"><p>state</p></td>
<td rowspan="2"><p>–state</p></td>
<td><p><a class="reference internal" href="01.basico.html#iptables-packet-type"><span class="std std-ref">Tipo de paquete</span></a> según la conexión a la que
pertenece. No es posible utilizar ni <em>DNAT</em> ni <em>SNAT</em>.</p></td>
</tr>
<tr class="row-odd"><td><p>iptables -A FORWARD –p tcp ! –syn -m state –state NEW -j DROP</p></td>
</tr>
<tr class="row-even"><td rowspan="7"><p>conntrack</p></td>
<td rowspan="2"><p>–cstate</p></td>
<td><p><a class="reference internal" href="01.basico.html#iptables-packet-type"><span class="std std-ref">Tipo de paquete</span></a> según la conexión a la que
pertenece.</p></td>
</tr>
<tr class="row-odd"><td><p>iptables -A FORWARD –p tcp ! –syn -m conntrack –ctstate NEW -j DROP</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>-ctdir</p></td>
<td><p>Si el paqute es de ida (<em>ORIGINAL</em>) o de vuelta (<em>REPLY</em>)</p></td>
</tr>
<tr class="row-odd"><td><p>iptables -A FORWARD -m conntrack –ctdir REPLY -j RETURN</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><div class="line-block">
<div class="line">–ctorigsrc</div>
<div class="line">–ctorigdst</div>
<div class="line">–ctreplsrc</div>
<div class="line">–ctrepldst</div>
</div>
</td>
<td><p>Dirección original de origen o de destino en la ida (<em>-orig-</em>) o la vuelta
(<em>-repl-</em>).</p></td>
</tr>
<tr class="row-odd"><td><p>iptables -A FORWARD -i eth0 -m conntrack !  –ctorigdst 172.22.0.2 -j DROP</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">–ctorigsrcport</div>
<div class="line">–ctorigdstport</div>
<div class="line">–ctreplsrcport</div>
<div class="line">–ctrepldstport</div>
</div>
</td>
<td><p>Puerto original de origen o de destino en la ida (<em>-orig-</em>) o la vuelta
(<em>-repl-</em>).</p></td>
</tr>
</tbody>
</table>
<p>En conclusión, ambos módulos sirven para el mismo fin, pero <em>conntrack</em> es preferible  por brindar más posibilidades.</p>
<section id="casos-ejemplares">
<h2><span class="section-number">8.7.3.1.2.1. </span>Casos ejemplares<a class="headerlink" href="#casos-ejemplares" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Analizaremos tres casos particulares que permiten ilustrar el seguimiento de
conexiones.</p>
<section id="conexion-a-servidor-generico">
<h3><span class="section-number">8.7.3.1.2.1.1. </span>Conexión a servidor genérico<a class="headerlink" href="#conexion-a-servidor-generico" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Supongamos el siguiente caso:</p>
<img alt="../../../_images/casos-conexion-simple.png" src="../../../_images/casos-conexion-simple.png" />
<p>en el que nuestro cortafuegos se interpone entre una red interna de clientes y
el exterior. Esta red externa puede o no ser internet. Lo que realmente
distingue a la red externa de la interna es que en la interfaz con la que
conecta el cortafuegos (<em>eth0</em>) se hace enmascaramiento, de manera que los
clientes internos son conscientes de que se comunican con el exterior, mientras
que las máquinas externas no son capaces de ver más allá de <em>eth0</em>. Por tanto,
partimos de que hay definida esta regla:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> iptables -t nat -A POSTROUTING -o eth0 -j SNAT --to-source <span class="m">172</span>.22.0.2
</pre></div>
</div>
<p>Estudiemos dos casos de distintos de conexión de un cliente a un servidor:</p>
<ul class="simple">
<li><p>El caso en que un cliente interno quiere conectar con un servidor web externo.</p></li>
<li><p>El caso en que un cliente externo quiere conectar con un servidor web de la
red interna (supondremos su <abbr title="Internet Protocol">IP</abbr> 192.168.255.10).</p></li>
</ul>
<p>Además, supondremos una política de lista blanca:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> iptables -P FORWARD DROP
</pre></div>
</div>
<dl>
<dt><strong>Servidor externo</strong></dt><dd><p>Si es un cliente externo el que quiere acceder al exterior necesitaremos que
las peticiones sean capaces de atravesar el cortafuegos:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> iptables -A FORWARD -i eth1 -o eth0 -p tcp -m multiport --dports <span class="m">80</span>,443 -j ACCEPT
</pre></div>
</div>
<p>Ahora bien, las respuestas también deben regresar, por lo que:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> iptables -A FORWARD -i eth0 -o eth1 -m conntrack --ctstate ESTABLISHED -j ACCEPT
</pre></div>
</div>
<p>En esta última regla, podemos ahorranos el sentido del tráfico, como
esta regla sea efectiva supone siempre permitir antes un tráfico nuevo, no tendrá efecto en el
sentido contrario, mientras no permitamos algún tráfico entrante; y, si lo permitimos, entonces
necesitaremos habilitar el tráfico establecido en ambos sentidos. Poniendo las dos reglas juntas
resulta:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> iptables -A FORWARD -i eth1 -o eth0 -p tcp -m multiport --dports <span class="m">80</span>,443 -j ACCEPT
<span class="gp">#</span> iptables -A FORWARD -m conntrack --ctstate ESTABLISHED -j ACCEPT
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Obviamente, no seremoa capaces de navegador si no somos capaces de
resolver direcciones, por lo que también necesitaremos esta regla:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> iptables -A FORWARD -i eth1 -o eth0 -p udp --dport <span class="m">53</span> -j ACCEPT
</pre></div>
</div>
</div>
</dd>
<dt><strong>Servidor interno</strong></dt><dd><p>La diferencia fundamental con el caso anterior es que los clientes externos
desconocen por completo la existencia de la red interna, por lo que para
conectar con el servidor intentarán hacerlo con el cortafuegos y será éste el
que tenga redirigir la petición hacia el servidor web:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> iptables -t nat -A PREROUTING -i eth0 -p tcp -m multiport --dports <span class="m">80</span>,443 -j DNAT --to-destination <span class="m">192</span>.168.255.10
</pre></div>
</div>
<p>Ahora bien, debemos también permitir que el tráfico atraviese el
cortafuegos:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> iptables -A FORWARD -m conntrack --ctstate DNAT -j ACCEPT
</pre></div>
</div>
<p>y no necesitamos más. Podríamos haber hecho el calco de la solución anterior,
intercambiado el sentido del tráfico, pero es más concisa esta solución:
dejamos atravesar el cortafuegos a aquel tráfico del que hemos hecho <abbr title="Destination NAT">DNAT</abbr>.
Como no ponemos sentido, también el tráfico de vuelta pasará.</p>
</dd>
</dl>
</section>
<section id="conexion-a-servidor-ftp">
<span id="iptables-ftp"></span><h3><span class="section-number">8.7.3.1.2.1.2. </span>Conexión a servidor <abbr title="File Transfer Protocol">FTP</abbr><a class="headerlink" href="#conexion-a-servidor-ftp" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El protocolo <abbr title="File Transfer Protocol">FTP</abbr> es un poco especialito, por decirlo de algún modo.
Habitualmente los protocolos de comunicación establecen un sólo canal de
comunicación. En cambio, el <abbr title="File Transfer Protocol">FTP</abbr> establece dos canales de comunicación: uno de
control y otro para datos.</p>
<div class="admonition seealso">
<p class="admonition-title">Ver también</p>
<p>Lea con atención el epígrafe sobre los <a class="reference internal" href="../../../07.serre/01.ftp/01.desc.html#ftp-modos"><span class="std std-ref">modos de
funcionamiento de FTP|</span></a>.</p>
</div>
<p>El quebradero de cabeza que supone la comunicación mediante <abbr title="File Transfer Protocol">FTP</abbr>, lo provoca la
singularidad que supone la existencia del canal de datos, sobre todo el modo
activo, en que el canal de datos lo inicia el servidor, no el cliente. Los
cortafuegos de inspección de estado son capaces de lidiar con esto, gracias a
que son capaces de distinguir conexiones y saber que una conexión está
relacionada con la otra (<em>RELATED</em>)<a class="footnote-reference brackets" href="#id2" id="id1">1</a>.</p>
<p>Partiendo de una politica de lista blanca, retomaremos el caso anterior, pero
suponiendo que la conexión se realiza con servidor <abbr title="File Transfer Protocol">FTP</abbr>. En este caso, es
indispensable que el núcleo de <em>Linux</em> haga seguimiento de las conexiones <abbr title="File Transfer Protocol">FTP</abbr>,
a fin de ser capaz de reconocer que el canal de datos está relacionado con su
correspondiente canal de control. para lo cual se requiere tener cargado el módulo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> modprobe nf_conntrack_ftp
</pre></div>
</div>
<p>y a partir de la versión <em>4.7</em> del núcleo fijar a <em>1</em> un parámetro del núcleo:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> <span class="nb">echo</span> <span class="m">1</span> &gt; /proc/sys/net/netfilter/nf_conntrack_helper
</pre></div>
</div>
<p>Hay otra dificultad añadida, porque el cortafuegos situado entre la red interna y
la externa hace enmascaramiento y como consecuencia los máquinas externas creen
estar hablando con el cortafuegos y no con máquinas de la red interna:</p>
<ul class="simple">
<li><p>En el modo <em>activo</em> en el caso de servidor externo, éste intentará abrir el
canal de datos con el cortafuegos, no con el cliente y es preciso añadir un
<abbr title="Destination NAT">DNAT</abbr> adicional para este canal también. En principio, es fácil de
solucionar, porque el puerto de origen es siempre el <em>20</em>.</p></li>
<li><p>En el modo <em>pasivo</em> en el caso de servidor interno, el cliente externo
intentará abrir el canal de datos con el cortafuegos no con el cliente y, de
nuevo, es necesario añadir <abbr title="Destination NAT">DNAT</abbr> para este canal. El problema es que ni el
puerto de origen ni el de destino estan prefijados y en consecuencia es
imposible crear una regla estática para solucionar este problema.</p></li>
</ul>
<p>Afortunadamente, existe un módulo en el núcleo de <em>Linux</em> capaz de detectar si
hubo <abbr title="Destination NAT">DNAT</abbr> en el canal de control y hacer automáticamente el <abbr title="Destination NAT">DNAT</abbr> necesario
en el canal de datos, sin que tengamos que escribir la regla adicional en
<strong class="program">iptables</strong>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> modprobe nf_nat_ftp
</pre></div>
</div>
<div class="admonition note" id="iptables-ftp-modules">
<p class="admonition-title">Nota</p>
<p>Para automatizar en el arranque la carga de los dos módulos y el
cambio en el valor del parámetro del núcleo podemos hacer:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> cat &gt; /etc/modules-load.d/ftp.conf
<span class="go">nf_conntrack_ftp</span>
<span class="go">nf_nat_ftp</span>

<span class="gp">#</span> <span class="nb">echo</span> <span class="s2">&quot;net.netfilter.nf_conntrack_helper = 1&quot;</span> &gt;&gt; /etc/sysctl.conf
</pre></div>
</div>
</div>
<p>Hecho lo cual, podemos comenzar.</p>
<dl>
<dt><strong>Servidor externo</strong></dt><dd><p>El establecimiento del canal de control es análogo al establecimiento del
canal de comunicación de cualquier servicio, por tanto:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> iptables -A FORWARD -i eth1 -o eth0 -p tcp --dport <span class="m">21</span> -j ACCEPT
<span class="gp">#</span> iptables -A FORWARD -i eth0 -o eth1 -m conntrack --ctstate ESTABLISHED -j ACCEPT
</pre></div>
</div>
<p>La forma de habilitar el canal de datos depende de si del modo. Si es activo,
es el propio servidor el que lo abre, así que se podría habilitar así:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> iptables -A FORWARD -i eth0 -o eth1 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
<span class="gp">#</span> iptables -A FORWARD -i eth1 -o eth0 -m conntrack --ctstate ESTABLISHED -j ACCEPT
</pre></div>
</div>
<p>Si el modo es pasivo, el canal de datos lo abre también el cliente y las
reglas son las siguientes:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> iptables -A FORWARD -i eth1 -o eth0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
<span class="gp">#</span> iptables -A FORWARD -i eth0 -o eth1 -m conntrack --ctstate ESTABLISHED -j ACCEPT
</pre></div>
</div>
<p>La última de las cuales ya se había utilizado para establecer el canal de
control y, por tanto, sobra. Finalmente, si deseamos habilitar ambos modos y
simplificamos un poco las reglas sin comprometer la seguridad llegamos a que
<strong>basta con lo siguiente</strong>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> iptables -A FORWARD -i eth1 -o eth0 -p tcp --dport <span class="m">21</span> -j ACCEPT
<span class="gp">#</span> iptables -A FORWARD -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
</pre></div>
</div>
<p>es decir, que la <em>receta</em> es la misma que para otro servidor que
use un sólo canal de comunicación con la salvedad de tener que añadir también
el tráfico relacionado en la segunda regla.</p>
</dd>
<dt><strong>Servidor interno</strong></dt><dd><p>El caso es análogo al anterior salvo por el hecho de que el sentido es el
inverso y que, además, hay que hacer <abbr title="Destination NAT">DNAT</abbr> en la interfaz <em>eth0</em> para redirigir
el tráfico al servidor interno. Si, por otro lado, tenemos en cuenta lo
discutido para un servicio genérico y permitos pasar el tráfico con estado
<abbr title="Destination NAT">DNAT</abbr>, llegamos a las siguientes reglas:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> iptables -t nat -A PREROUTING -i eth0 -p tcp --dport <span class="m">21</span> -j DNAT --to-destination <span class="m">192</span>.168.255.10
<span class="gp">#</span> iptables -A FORWARD -m conntrack --ctstate DNAT -j ACCEPT
<span class="gp">#</span> iptables -A FORWARD -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="conexion-a-un-servidor-antipatico">
<h3><span class="section-number">8.7.3.1.2.1.3. </span>Conexión a un servidor <em>antipático</em><a class="headerlink" href="#conexion-a-un-servidor-antipatico" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Consideremos la siguiente red:</p>
<img alt="../../../_images/servcli.png" src="../../../_images/servcli.png" />
<p>En esa el servidor web, sólo admite comunicaciones con el cortaguegos
(<em>192.168.255.1</em>), por lo que el cliente no puede comunicarse directamente con
él:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> iptables -P INPUT DROP
<span class="gp">#</span> iptables -P OUTPUT DROP
<span class="gp">#</span> iptables -A INPUT -i lo -j ACCEPT
<span class="gp">#</span> iptables -A OUTPUT -o lo -j ACCEPT
<span class="gp">#</span> iptables -A INPUT -s <span class="m">192</span>.168.255.1 -j ACCEPT
<span class="gp">#</span> iptables -A OUTPUT -d <span class="m">192</span>.168.255.1 -j ACCEPT
</pre></div>
</div>
<p>Por ello, el cliente deberá pedir las páginas al cortafuegos y éste
redirigir ese tráfico hacia el servidor web con esta regla:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> iptables -t nat -A PREROUTING -i eth0 -p tcp -m multiport --dports <span class="m">80</span>,443 -d <span class="m">192</span>.168.255.1 <span class="se">\</span>
   -j DNAT --to-destination <span class="m">192</span>.168.255.2
</pre></div>
</div>
<p>Si embargo, esto sólo cambia la <abbr title="Internet Protocol">IP</abbr> de destino, no la de origen, que seguirá
siendo <em>192.168.255.3</em>. En consecuencia:</p>
<ul class="simple">
<li><p>El servidor no responderá, puerto que sólo se comunica con la <em>192.168.255.1</em>
y la petición parece proceder de <em>192.168.255.3</em>.</p></li>
<li><p>Aun en el supuesto de que respondiera, la <abbr title="Internet Protocol">IP</abbr> de destino de la respuesta
sería <em>192.168.255.3</em>, por lo que el servidor respondería directamente a esta
<abbr title="Internet Protocol">IP</abbr>. La consecuencia sería que nunca se desaría el <abbr title="Destination NAT">DNAT</abbr> y el cliente recibiría
un paquete procedente de <em>192.168.255.2</em>, cuando habría esperado recibirlo de
<em>192.168.255.1</em>. Como consecuencia, lo rechazaría.</p></li>
</ul>
<p>La solución es hacer un <abbr title="Source NAT">SNAT</abbr> a la salida de <em>eth0</em> para cambiar también la
<abbr title="Internet Protocol">IP</abbr> de origen y que el servidor la devuelva al cortafuegos:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span>  iptables -t nat -A POSTROUTING -o eth0 -p tcp -m multiport --dports <span class="m">80</span>,443 <span class="se">\</span>
      -m conntrack --ctstate DNAT -j SNAT --to-source <span class="m">192</span>.168.255.1
</pre></div>
</div>
<p>Obviamente, enmascaramos solamente los paquetes a los que previamente se aplicó
el <abbr title="Destination NAT">DNAT</abbr>.</p>
<table class="iptables-anti docutils align-default" id="iptables-antipatico-tabla">
<colgroup>
<col style="width: 8%" />
<col style="width: 25%" />
<col style="width: 11%" />
<col style="width: 12%" />
<col style="width: 11%" />
<col style="width: 12%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" rowspan="2"><p>Instante</p></th>
<th class="head" rowspan="2"><p>Lugar</p></th>
<th class="head" colspan="2"><p>Origen</p></th>
<th class="head" colspan="2"><p>Destino</p></th>
<th class="head" rowspan="2"><p>Comentario</p></th>
</tr>
<tr class="row-even"><th class="head"><p>Máquina</p></th>
<th class="head"><p>IP</p></th>
<th class="head"><p>Máquina</p></th>
<th class="head"><p>IP</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>1</p></td>
<td><p>Entre ciliente y cortafuegos</p></td>
<td><p>Cliente</p></td>
<td><p>192.168.255.3</p></td>
<td><p>Cortafuegos</p></td>
<td><p>192.168.255.1</p></td>
<td><p><abbr title="Destination NAT">DNAT</abbr> en <em>PREROUTING</em></p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>Dentro del cortafuegos</p></td>
<td><p>Cliente</p></td>
<td><p>192.168.255.3</p></td>
<td><p>Servidor</p></td>
<td><p>192.168.255.2</p></td>
<td><p><abbr title="Source NAT">SNAT</abbr> en <em>POSTROUTING</em></p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>Entre cortafuegos y servidor</p></td>
<td><p>Cortafuegos</p></td>
<td><p>192.168.255.1</p></td>
<td><p>Servidor</p></td>
<td><p>192.168.255.2</p></td>
<td><p>Servidor recibe paquete</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>Entre servidor y cortafuegos</p></td>
<td><p>Servidor</p></td>
<td><p>192.168.255.2</p></td>
<td><p>Cortafuegos</p></td>
<td><p>192.168.255.1</p></td>
<td><p><abbr title="Destination NAT">DNAT</abbr> automático</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>Dentro del cortafuegos</p></td>
<td><p>Servidor</p></td>
<td><p>192.168.255.2</p></td>
<td><p>Cliente</p></td>
<td><p>192.168.255.3</p></td>
<td><p><abbr title="Source NAT">SNAT</abbr> automático</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p>Entre cortafuegos y cliente</p></td>
<td><p>Cortafuegos</p></td>
<td><p>192.168.255.1</p></td>
<td><p>Cliente</p></td>
<td><p>192.168.255.3</p></td>
<td><p>Cliente recibe paquete</p></td>
</tr>
</tbody>
</table>
<p>Obsérvese que el cliente envía un paquete (instante 1) y recibe otro (instante
6) que, como es natural. tiene las <abbr title="Internet Protocol">IP</abbr> de origen y destino intercambiadas. Por
su parte el servidor recibe un paquete del cortafuegos (instante 3) y responde
a éste (instante 4).</p>
</section>
</section>
<section id="casos-practicos">
<h2><span class="section-number">8.7.3.1.2.2. </span>Casos prácticos<a class="headerlink" href="#casos-practicos" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Para ilustrar cómo puede usarse <strong class="program">iptables</strong>  haremos la configuración de
algunos casos simples. En todos ellos se presupondrá una política de lista
blanca y que a la salida del cortafuegos hacia la red externa se hace
enmascaramiento,</p>
<section id="acceso-simple">
<h3><span class="section-number">8.7.3.1.2.2.1. </span>Acceso simple<a class="headerlink" href="#acceso-simple" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Se dispone de un cortafuegos con <abbr title="Security SHell">SSH</abbr> instalado para configurarlo
exclusivamente desde la red interna. Los clientes internos deberían ser capaces
de navegador.</p>
<img alt="../../../_images/caso1.png" src="../../../_images/caso1.png" />
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
 
<span class="c1"># Limpiamos todas las tablas</span>
iptables -F
iptables -t nat -F
iptables -t mangle -F
 
<span class="c1"># Lista blanca</span>
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT DROP
 
<span class="c1"># Tráfico local interno, permitido</span>
iptables -A INPUT -i lo -j ACCEPT
iptables -A OUTPUT -o lo -j ACCEPT

<span class="c1"># Enmascaramiento</span>
iptables -t nat -A POSTROUTING -o eth0 -j SNAT --to-source <span class="m">172</span>.22.0.2
 
<span class="c1"># Acceso al servidor SSH (petición y respuesta)</span>
iptables -A INPUT -i eth1 -p tcp --dport <span class="m">22</span> -j ACCEPT
iptables -A OUTPUT -m conntrack --ctstate ESTABLISHED -j ACCEPT
 
<span class="c1"># Peticiones DNS (es requisito previo para navegar)</span>
iptables -A FORWARD -o eth0 -p udp --dport <span class="m">53</span> -j ACCEPT
iptables -A FORWARD -o eth0 -p tcp --dport <span class="m">53</span> -j ACCEPT
 
<span class="c1"># Peticiones WEB</span>
iptables -A FORWARD -o eth0 -p tcp -m multiport --dport <span class="m">80</span>,443 -j ACCEPT
 
<span class="c1"># Respuestas a los servicios anteriores</span>
iptables -A FORWARD -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>La inclusión del tráfico relacionado en la última no es estrictamente
necesaria, pero es conveniente ya que las respuestas de un servidor
rechazando una conexión son tráfico relacionado. Por ello, si lo incluimos
recibiremos inmediatamente este rechazo, en vez de que acabe fallando la
conexión por temporización.</p>
</div>
</section>
<section id="acceso-con-dns-propio">
<h3><span class="section-number">8.7.3.1.2.2.2. </span>Acceso con <abbr title="Domain Name Server">DNS</abbr> propio<a class="headerlink" href="#acceso-con-dns-propio" title="Enlazar permanentemente con este título">¶</a></h3>
<p>A diferencia del caso anterior, para optimizar el ancho de banda se instala un
servidor <abbr title="Domain Name Server">DNS</abbr> en el cortafuegos.</p>
<img alt="../../../_images/caso2.png" src="../../../_images/caso2.png" />
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
 
<span class="c1"># Limpiamos todas las tablas</span>
iptables -F
iptables -t nat -F
iptables -t mangle -F
 
<span class="c1"># Políticas predeterminadas</span>
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT DROP
 
<span class="c1"># Tráfico local interno, permitido</span>
iptables -A INPUT -i lo -j ACCEPT
iptables -A OUTPUT -o lo -j ACCEPT

<span class="c1"># Enmascaramiento</span>
iptables -t nat -A POSTROUTING -o eth0 -j SNAT --to-source <span class="m">172</span>.22.0.2
 
<span class="c1">##</span>
<span class="c1"># Acceso al cortafuegos</span>
<span class="c1">##</span>
<span class="c1"># SSH</span>
iptables -A INPUT -i eth1 -p tcp --dport <span class="m">22</span> -j ACCEPT
 
<span class="c1"># DNS</span>
iptables -A INPUT -i eth1 -p udp --dport <span class="m">53</span> -j ACCEPT
iptables -A INPUT -i eth1 -p tcp --dport <span class="m">53</span> -j ACCEPT
 
<span class="c1"># Respuestas</span>
iptables -A OUTPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
 
<span class="c1">##</span>
<span class="c1"># Tráfico del cortafuegos</span>
<span class="c1">##</span>
<span class="c1"># DNS</span>
iptables -A OUTPUT -o eth0 -p udp --dport <span class="m">53</span> -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --dport <span class="m">53</span> -j ACCEPT
 
<span class="c1"># Respuesta</span>
iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
 
<span class="c1">##</span>
<span class="c1"># Tráfico a través del cortafuegos</span>
<span class="c1">##</span>
<span class="c1"># Peticiones WEB</span>
iptables -A FORWARD -o eth0 -p tcp -m multiport --dports <span class="m">80</span>,443 -j ACCEPT
 
<span class="c1"># Respuesta</span>
iptables -A FORWARD -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
</pre></div>
</div>
</section>
<section id="acceso-mediante-squid-modo-transparente">
<h3><span class="section-number">8.7.3.1.2.2.3. </span>Acceso mediante <strong class="program">squid</strong> (modo transparente)<a class="headerlink" href="#acceso-mediante-squid-modo-transparente" title="Enlazar permanentemente con este título">¶</a></h3>
<p>A la configuración anterior se añade que se quiere forzar a que la navegación no
segura se haga a través de un <em>proxy</em> <strong class="program">squid</strong> configurado en modo
transparente en el cortafuegos. Supóngase que el puerto de escucha de
<strong class="program">squid</strong> es el 3128.</p>
<img alt="../../../_images/caso3.png" src="../../../_images/caso3.png" />
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
 
<span class="c1"># Limpiamos todas las tablas</span>
iptables -F
iptables -t nat -F
iptables -t mangle -F
 
<span class="c1"># Políticas predeterminadas</span>
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT DROP
 
<span class="c1"># Tráfico local interno, permitido</span>
iptables -A INPUT -i lo -j ACCEPT
iptables -A OUTPUT -o lo -j ACCEPT

<span class="c1"># Enmascaramiento</span>
iptables -t nat -A POSTROUTING -o eth0 -j SNAT --to-source <span class="m">172</span>.22.0.2
 
<span class="c1"># Redirección HTTP -&gt; SQUID</span>
iptables -t nat -A PREROUTING -i eth1 -p tcp --dport <span class="m">80</span> -j REDIRECT --to-port <span class="m">3128</span>
 
<span class="c1">##</span>
<span class="c1"># Acceso al cortafuegos</span>
<span class="c1">##</span>
<span class="c1"># SSH</span>
iptables -A INPUT -i eth1 -p tcp --dport <span class="m">22</span> -j ACCEPT
<span class="c1"># SQUID</span>
iptables -A INPUT -i eth1 -m conntrack --ctstate DNAT -j ACCEPT
 
<span class="c1"># DNS</span>
iptables -A INPUT -i eth1 -p udp --dport <span class="m">53</span> -j ACCEPT
iptables -A INPUT -i eth1 -p tcp --dport <span class="m">53</span> -j ACCEPT
 
<span class="c1"># Respuesta</span>
iptables -A OUTPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
 
<span class="c1">##</span>
<span class="c1"># Tráfico del cortafuegos</span>
<span class="c1">##</span>
<span class="c1"># DNS</span>
iptables -A OUTPUT -o eth0 -p udp --dport <span class="m">53</span> -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --dport <span class="m">53</span> -j ACCEPT
<span class="c1"># HTTP</span>
iptables -A OUTPUT -o eth0 -p tcp --dport <span class="m">80</span> -j ACCEPT
 
<span class="c1"># Respuesta</span>
iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
 
<span class="c1">##</span>
<span class="c1"># Tráfico a través del cortafuegos</span>
<span class="c1">##</span>
<span class="c1"># HTTPS</span>
iptables -A FORWARD -o eth0 -p tcp -m multiport --dport <span class="m">443</span> -j ACCEPT
 
<span class="c1"># Respuesta</span>
iptables -A FORWARD -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
</pre></div>
</div>
</section>
<section id="acceso-mediante-squid-modo-directo">
<h3><span class="section-number">8.7.3.1.2.2.4. </span>Acceso mediante <strong class="program">squid</strong> (modo directo)<a class="headerlink" href="#acceso-mediante-squid-modo-directo" title="Enlazar permanentemente con este título">¶</a></h3>
<p>La misma configuración, pero en este caso, <strong class="program">squid</strong> se configura en modo
directo en el puerto 8080 tanto para tráfico web seguro como no seguro.</p>
<img alt="../../../_images/caso4.png" src="../../../_images/caso4.png" />
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
 
<span class="c1"># Limpiamos todas las tablas</span>
iptables -F
iptables -t nat -F
iptables -t mangle -F
 
<span class="c1"># Políticas predeterminadas</span>
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT DROP
 
<span class="c1"># Tráfico local interno, permitido</span>
iptables -A INPUT -i lo -j ACCEPT
iptables -A OUTPUT -o lo -j ACCEPT

<span class="c1"># Enmascaramiento</span>
iptables -t nat -A POSTROUTING -o eth0 -j SNAT --to-source <span class="m">172</span>.22.0.2
 
<span class="c1">##</span>
<span class="c1"># Acceso al cortafuegos</span>
<span class="c1">##</span>
<span class="c1"># SSH</span>
iptables -A INPUT -i eth1 -p tcp --dport <span class="m">22</span> -j ACCEPT
<span class="c1"># SQUID</span>
iptables -A INPUT -i eth1 -p tcp --dport <span class="m">8080</span> -j ACCEPT
 
<span class="c1"># DNS</span>
iptables -A INPUT -i eth1 -p udp --dport <span class="m">53</span> -j ACCEPT
iptables -A INPUT -i eth1 -p tcp --dport <span class="m">53</span> -j ACCEPT
 
<span class="c1"># Respuesta</span>
iptables -A OUTPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
 
<span class="c1">##</span>
<span class="c1"># Tráfico del cortafuegos</span>
<span class="c1">##</span>
<span class="c1"># DNS</span>
iptables -A OUTPUT -o eth0 -p udp --dport <span class="m">53</span> -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --dport <span class="m">53</span> -j ACCEPT
<span class="c1"># HTTP/HTTPS</span>
iptables -A OUTPUT -o eth0 -p tcp -m multiport --dport <span class="m">80</span>,443 -j ACCEPT
 
<span class="c1"># Respuesta</span>
iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
</pre></div>
</div>
</section>
<section id="servidor-web-interno">
<h3><span class="section-number">8.7.3.1.2.2.5. </span>Servidor web interno<a class="headerlink" href="#servidor-web-interno" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El supuesto es parecido al primero (una red interna a la que se quiere permitir
navegar), pero añade la existencia de un servidor web interno en 192.168.255.100
al que se quiere permitir acceso desde el exterior.</p>
<img alt="../../../_images/caso5.png" src="../../../_images/caso5.png" />
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
 
<span class="c1"># Limpiamos todas las tablas</span>
iptables -F
iptables -t nat -F
iptables -t mangle -F
 
<span class="c1"># Políticas predeterminadas</span>
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT DROP
 
<span class="c1"># Tráfico local interno, permitido</span>
iptables -A INPUT -i lo -j ACCEPT
iptables -A OUTPUT -o lo -j ACCEPT

<span class="c1">##</span>
<span class="c1">#Enmascaramiento</span>
<span class="c1">##</span>
<span class="c1"># Salida</span>
iptables -t nat -A POSTROUTING -o eth0 -j SNAT --to-source <span class="m">172</span>.22.0.2
<span class="c1"># WEB (interno)</span>
iptables -t nat -A PREROUTING -i eth0 -p tcp -m multiport --dports <span class="m">80</span>,443 -j DNAT --to-destination <span class="m">192</span>.168.255.100
 
<span class="c1">##</span>
<span class="c1"># Acceso al cortafuegos</span>
<span class="c1">##</span>
<span class="c1"># SSH</span>
iptables -A INPUT -p tcp --dport <span class="m">22</span> -j ACCEPT
 
<span class="c1"># Respuesta</span>
iptables -A OUTPUT -m conntrack --ctstate ESTABLISHED -j ACCEPT
 
<span class="c1">##</span>
<span class="c1"># Tráfico a través del cortafuegos</span>
<span class="c1">##</span>
<span class="c1"># DNS</span>
iptables -A FORWARD -o eth0 -p udp --dport <span class="m">53</span> -j ACCEPT
iptables -A FORWARD -o eth0 -p tcp --dport <span class="m">53</span> -j ACCEPT
<span class="c1"># WEB (Navegación)</span>
iptables -A FORWARD -o eth0 -p tcp -m multiport --dport <span class="m">80</span>,443 -j ACCEPT
<span class="c1"># WEB (interno)</span>
iptables -A FORWARD -m conntrack --ctstate DNAT -j ACCEPT
 
<span class="c1"># Respuesta a los servicios anteriores</span>
iptables -A FORWARD -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
</pre></div>
</div>
</section>
<section id="servidores-web-y-ftp-internos">
<h3><span class="section-number">8.7.3.1.2.2.6. </span>Servidores web y <abbr title="File Transfer Protocol">FTP</abbr> internos<a class="headerlink" href="#servidores-web-y-ftp-internos" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El servidor interno añade un servicio <abbr title="File Transfer Protocol">FTP</abbr>.</p>
<img alt="../../../_images/caso6.png" src="../../../_images/caso6.png" />
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Recuerde que para que funcione la detección del tráfico <abbr title="File Transfer Protocol">FTP</abbr>
relacionado, se requieren <a class="reference internal" href="#iptables-ftp-modules"><span class="std std-ref">algunas operaciones previas</span></a>.</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
 
<span class="c1"># Limpiamos todas las tablas</span>
iptables -F
iptables -t nat -F
iptables -t mangle -F
 
<span class="c1">#Políticas predeterminadas</span>
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT DROP
 
<span class="c1"># Tráfico local interno, permitido</span>
iptables -A INPUT -i lo -j ACCEPT
iptables -A OUTPUT -o lo -j ACCEPT

<span class="c1">##</span>
<span class="c1"># Enmascaramiento</span>
<span class="c1">##</span>
<span class="c1"># Salida</span>
iptables -t nat -A POSTROUTING -o eth0 -j SNAT --to-source <span class="m">172</span>.22.0.2
<span class="c1"># WEB (interno)</span>
iptables -t nat -A PREROUTING -i eth0 -p tcp -m multiports --dport <span class="m">80</span>,443 -j DNAT --to-destination <span class="m">192</span>.168.255.100
<span class="c1"># FTP (interno)</span>
iptables -t nat -A PREROUTING -i eth0 -p tcp --dport <span class="m">21</span> -j DNAT --to-destination <span class="m">192</span>.168.255.100
 
<span class="c1">##</span>
<span class="c1"># Acceso al cortafuegos</span>
<span class="c1">##</span>
<span class="c1"># SSH</span>
iptables -A INPUT -p tcp --dport <span class="m">22</span> -j ACCEPT
 
<span class="c1"># Respuesta</span>
iptables -A OUTPUT -m conntrack --ctstate ESTABLISHED -j ACCEPT
 
<span class="c1">##</span>
<span class="c1"># Tráfico a través del cortafuegos</span>
<span class="c1">##</span>
<span class="c1"># DNS</span>
iptables -A FORWARD -o eth0 -p udp --dport <span class="m">53</span> -j ACCEPT
iptables -A FORWARD -o eth0 -p tcp --dport <span class="m">53</span> -j ACCEPT
<span class="c1"># WEB (Navegación)</span>
iptables -A FORWARD -o eth0 -p tcp -m multiport --dport <span class="m">80</span>,443 -j ACCEPT
<span class="c1"># Servicios en el interior</span>
iptables -A FORWARD -o eth1 -m conntrack --ctstate DNAT -j ACCEPT
 
<span class="c1"># Respuesta a los servicios anteriores</span>
iptables -A FORWARD -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
</pre></div>
</div>
<p class="rubric">Notas al pie</p>
<dl class="footnote brackets">
<dt class="label" id="id2"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Esto supone un sobreesfuerzo del cortafuegos. Para más información lea la
<a class="reference internal" href="../../../07.serre/01.ftp/index.html#ftp"><span class="std std-ref">introducción al servicio FTP</span></a>.</p>
</dd>
</dl>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../../index.html">Tabla de contenido</a></h3>
  <ul>
<li><a class="reference internal" href="#">8.7.3.1.2. Uso práctico</a><ul>
<li><a class="reference internal" href="#casos-ejemplares">8.7.3.1.2.1. Casos ejemplares</a><ul>
<li><a class="reference internal" href="#conexion-a-servidor-generico">8.7.3.1.2.1.1. Conexión a servidor genérico</a></li>
<li><a class="reference internal" href="#conexion-a-servidor-ftp">8.7.3.1.2.1.2. Conexión a servidor <abbr title="File Transfer Protocol">FTP</abbr></a></li>
<li><a class="reference internal" href="#conexion-a-un-servidor-antipatico">8.7.3.1.2.1.3. Conexión a un servidor <em>antipático</em></a></li>
</ul>
</li>
<li><a class="reference internal" href="#casos-practicos">8.7.3.1.2.2. Casos prácticos</a><ul>
<li><a class="reference internal" href="#acceso-simple">8.7.3.1.2.2.1. Acceso simple</a></li>
<li><a class="reference internal" href="#acceso-con-dns-propio">8.7.3.1.2.2.2. Acceso con <abbr title="Domain Name Server">DNS</abbr> propio</a></li>
<li><a class="reference internal" href="#acceso-mediante-squid-modo-transparente">8.7.3.1.2.2.3. Acceso mediante <strong class="program">squid</strong> (modo transparente)</a></li>
<li><a class="reference internal" href="#acceso-mediante-squid-modo-directo">8.7.3.1.2.2.4. Acceso mediante <strong class="program">squid</strong> (modo directo)</a></li>
<li><a class="reference internal" href="#servidor-web-interno">8.7.3.1.2.2.5. Servidor web interno</a></li>
<li><a class="reference internal" href="#servidores-web-y-ftp-internos">8.7.3.1.2.2.6. Servidores web y <abbr title="File Transfer Protocol">FTP</abbr> internos</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Tema anterior</h4>
  <p class="topless"><a href="01.basico.html"
                        title="capítulo anterior"><span class="section-number">8.7.3.1.1. </span>Conceptos básicos</a></p>
  <h4>Próximo tema</h4>
  <p class="topless"><a href="03.ext.html"
                        title="próximo capítulo"><span class="section-number">8.7.3.1.3. </span>Extensiones</a></p>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/08.redes/07.cortafuegos/01.iptables/02.conn.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Ir a" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="03.ext.html" title="8.7.3.1.3. Extensiones"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="01.basico.html" title="8.7.3.1.1. Conceptos básicos"
             >anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" ><span class="section-number">8. </span>Conceptos avanzados de redes</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" ><span class="section-number">8.7. </span>Cortafuegos</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="index.html" ><span class="section-number">8.7.3.1. </span>IPtables</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">8.7.3.1.2. </span>Uso práctico</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Derechos de autor CC BY 4.0, 2016-2021, José Miguel Sánchez Alés.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.3.1.
    </div>
  </body>
</html>