


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="es">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>8.9.2.1. Ataques DoS &#8212; documentación de Linuxnomicón - rolling</title>
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../../_static/translations.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Índice" href="../../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../../search.html" />
    <link rel="next" title="8.9.2.2. Envenenamiento DNS" href="01.dns.html" />
    <link rel="prev" title="8.9.2. Técnicas" href="index.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="01.dns.html" title="8.9.2.2. Envenenamiento DNS"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="index.html" title="8.9.2. Técnicas"
             accesskey="P">anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >8. Conceptos avanzados de redes</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" >8.9. Ataques</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="index.html" accesskey="U">8.9.2. Técnicas</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="ataques-dos">
<span id="dos"></span><h1>8.9.2.1. Ataques <abbr title="Denial of Service">DoS</abbr><a class="headerlink" href="#ataques-dos" title="Enlazar permanentemente con este título">¶</a></h1>
<p>Los ataques <abbr title="Denial of Service">DoS</abbr> persiguen la interrupción de un servicio, por lo general:</p>
<ul class="simple">
<li>aprovechando alguna vulneralidad del propio servicio que provoca que no responda
bien ante paquetes malformados; o</li>
<li>generando tráfico malicioso que sobrecarga al servidor.</li>
<li>sobrepasando los límites de los recursos dedicados a proporcionar el servicio.
En este segundo caso, es habitual que el ataque se produzca simultáneamente
desde múltiples fuentes a la vez, lo que se conoce como <abbr title="Distributed Denial of Service">DDoS</abbr>, esto es, como
<abbr title="Denial of Service">DoS</abbr> distribuido.</li>
</ul>
<div class="section" id="metodos">
<h2>8.9.2.1.1. Métodos<a class="headerlink" href="#metodos" title="Enlazar permanentemente con este título">¶</a></h2>
<dl class="docutils">
<dt><strong>SYN flood</strong> (Inundación <em>SYN</em>):</dt>
<dd><p class="first">En el protocolo <abbr title="Transmission Control Protocol">TCP</abbr> el establecimiento de la conexión supone la emisión de
un primer paquete <em>SYN</em>, al que debe responder el servidor con otro paquete
<em>SYN/ACK</em> al cual a su vez responderá de nuevo el cliente con un paquete
<em>ACK</em> que confirma el establecimiento:</p>
<img alt="../../../_images/TCP.png" src="../../../_images/TCP.png" />
<p class="last">Este ataque consiste en enviar múltiples paquetes <em>SYN</em>, pero sin responder a
los paquetes <em>SYN/ACK</em> del servidor, de modo que el servidor se queda
esperando a que el cliente acabe de confirmar la conexión. Puede
complementarse falseando la <abbr title="Internet Protocol">IP</abbr> de origen, a fin de que el servidor envíe
los paquetes <em>SYN/ACK</em> a una tercera máquina ajena al ataque, que no
responderá tampoco, ya que jamás envío un paquete <em>SYN</em> a ese servidor. La
consecuencia del ataque es que el servidor queda esperando durante cierto
tiempo los mensajes que confirmar las conexiones lo que puede llevar al
límite de conexiones posibles. Si en el ínterim un cliente legítimo intenta
comenzar una conexión <abbr title="Transmission Control Protocol">TCP</abbr>, el servidor será incapaz de responder.</p>
</dd>
<dt><strong>ICMP flood</strong> (Inundación <abbr title="Internet Control Message Protocol">ICMP</abbr>):</dt>
<dd><p class="first">Consiste en consumir el ancho de banda del servidor enviándole paquetes de
<em>ping</em>. Como en el caso anterior, puede falsearse la <abbr title="Internet Protocol">IP</abbr> de origen para
evitar recibir las respuestas.</p>
<p class="last">Relacionado con el protocolo <abbr title="Internet Control Message Protocol">ICMP</abbr>, aunque no sea un ataque de inundación,
está el <em>Ping de la Muerte</em>, que consiste en crear un paquete <abbr title="Internet Protocol">IP</abbr> de tamaño
mayor a 64K. En sistema antiguos, esto provocaba la caída del sistema, pero
los sistemas modernos suelen estar inmunizados frente a este ataque.</p>
</dd>
<dt><strong>UDP flood</strong> (Inundación <abbr title="User Datagram Protocol">UDP</abbr>):</dt>
<dd>Si el objetivo responde con paquetes <abbr title="Internet Control Message Protocol">ICMP</abbr> a paquetes <abbr title="User Datagram Protocol">UDP</abbr> enviados a
puertos en los que no hay servicio, se puede ensayar este ataque que consiste
en enviar paquetes <abbr title="User Datagram Protocol">UDP</abbr> a puertos aleatorios del servidor. Como en los casos
anteriores, se puede falsear la <abbr title="Internet Protocol">IP</abbr> de origen para evitar recibir las
respuestas <abbr title="Internet Control Message Protocol">ICMP</abbr>.</dd>
</dl>
</div>
<div class="section" id="contramedidas">
<h2>8.9.2.1.2. Contramedidas<a class="headerlink" href="#contramedidas" title="Enlazar permanentemente con este título">¶</a></h2>
<ol class="arabic simple">
<li>Tener actualizado el servidor para evitar vulnerabilidades.</li>
<li>Rebajar la carga del servidor en cuestión utilizando distintas técnicas:<ul>
<li>Limitar el flujo de paquetes que llegan al servicio mediante el
cortafuegos.</li>
<li>Si el servidor es web, interponer un proxy que cachee tráfico dinámico para
reducir la carga del servidor al generar las páginas o distribuir la
consulta entre varios servidores sincronizados.</li>
</ul>
</li>
</ol>
<div class="section" id="flujo-de-paquetes">
<span id="iptables-limit"></span><h3>8.9.2.1.2.1. Flujo de paquetes<a class="headerlink" href="#flujo-de-paquetes" title="Enlazar permanentemente con este título">¶</a></h3>
<p>La técnica de limitar el flujo de paquetes es bastante burda y, simplemente,
asegura que el servidor no colapsará por consumir todos sus recursos en atender
peticiones. Es burda, decimos, porque desecha tráfico indiscriminadamente sin
atender a si es malicioso o no.</p>
<p>Para explicar su implementación, supongamos que tenemos un <a class="reference internal" href="../../../06.infraestructura/01.cortafuegos/01.iptables/index.html#iptables"><span class="std std-ref">cortafuegos con
iptables</span></a> que protege al servidor en cuestión y que tiene un regla
que redirige el tráfico web al servidor interno:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> iptables -t nat -A PREROUTING -i eth0 -p tcp -m multiport --dport http,https -j DNAT --to-destination <span class="m">192</span>.168.1.1
</pre></div>
</div>
<p>En estas condiciones (y suponiendo lista blanca), podemos limitir el tráfico que
llega de forma efectivamente del siguiente modo:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># SYN flood</span>
iptables -A FORWARD -i eth0 -p tcp --syn -m limit --limit <span class="m">5</span>/s --limit-burst <span class="m">10</span> -j ACCEPT

<span class="c1"># ICMP flood</span>
iptables -A INPUT -i eth0 -p icmp --icmp-type echo-request -m limit --limit <span class="m">1</span>/s -j ACCEPT

<span class="c1"># UDP flood</span>
iptables -A INPUT -i eth0 -p udp -m limit --limit <span class="m">10</span>/s -j ACCEPT

<span class="c1"># Conexiones con el servidor WEB</span>
iptables -A FORWARD -i eth0 -m conntrack --ctstate DNAT -m limit --limit <span class="m">10</span>/s --limit-burst <span class="m">15</span> -j ACCEPT
iptables -A FORWARD -i eth0 -m conntrack --ctstate DNAT -m connlimit --connlimit-upto <span class="m">3</span> -j ACCEPT
iptables -A FORWARD -i eth0 -m conntrack --ctstate DNAT -m hashlimit <span class="se">\</span>
                            --hashlimit-upto <span class="m">5</span>/s --hashlimit-burst <span class="m">10</span> --haslimit-mode srcip,dstip -j ACCEPT
</pre></div>
</div>
<p>Por supuesto, los límites dependerán de nuestro ancho de banda y de la capacidad
del servidor, así que es conveniente explicar cómo funcionan.
<strong class="program">iptables</strong> dispone de tres módulos que permiten limitar el flujo de
conexiones:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">limit</span></code></dt>
<dd>que establece límites generales para el flujo de paquetes.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">connlimit</span></code></dt>
<dd>que establece límites para conexiones simultáneas entre un cliente (o un
grupo de clientes) y un servidor (o grupo de servidores). Por tanto, no
limita ratios.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hashlimit</span></code></dt>
<dd>que establece límites para el flujo de forma más granular ya que se pueden
establecerse distintos criterios actuando conjuntamente (<abbr title="Internet Protocol">IP</abbr> de origen, <abbr title="Internet Protocol">IP</abbr>
destino, puerto de origen o puerto de destino). Si no se establece ninguno
actúa como <code class="docutils literal notranslate"><span class="pre">limit</span></code>.</dd>
</dl>
<p><em>limit</em> y <em>hashlimit</em> funcionan de forma semenjante: se establece un ratio medio
(<code class="docutils literal notranslate"><span class="pre">--limit</span></code>, <code class="docutils literal notranslate"><span class="pre">--hashlimit-upto</span></code>) y un límite máximo para las ráfagas
(<code class="docutils literal notranslate"><span class="pre">--limit-burst</span></code>, <code class="docutils literal notranslate"><span class="pre">--hashlimit-burst</span></code>) y el sistema funciona de forma
semejante a como lo haría un embudo:</p>
<img alt="../../../_images/limit.png" src="../../../_images/limit.png" />
<p>El ratio representa el caudal de desagüe, pero el embudo posee un vaso que
permite verter puntualmente más agua hasta un límite máximo. Cada paquete viene
representado en el dibujo por una bolita, de modo que se pueden acomular como
máximo el número de paquetes indicado con <code class="docutils literal notranslate"><span class="pre">--*limit-burst</span></code>, lo que permite
absorber una ráfaga intensa.</p>
</div>
<div class="section" id="proxy">
<h3>8.9.2.1.2.2. Proxy<a class="headerlink" href="#proxy" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Interponer un <em>proxy</em> entre los usuarios y el servidor web añade las siguientes
ventajas:</p>
<ul class="simple">
<li>Puede incluirse en la máquina con el proxy un mecanismo que restrinja las
conexiones entrantes al servidor web o aquellas que considere maliciosas, tal
como se hace en el punto anterior.</li>
<li>Se pueden cachear páginas y recursos en el proxy para aligerar la carga y
ahorrar ancho de banda del servidor<a class="footnote-reference" href="#id2" id="id1">[1]</a>. Esto, sin embargo, se topa con un
inconveniente si queremos que el tráfico sea cifrado (<abbr title="HyperText Transfer Protocol">HTTP</abbr>s): el <em>proxy</em>
intermedio es incapaz de entender la información que circula a través de él y,
en consecuencia, no puede cachear. Por este motivo, el cifrado con el usuario
se debe hacer en el propio <em>proxy</em> y, dependiendo de la confiabilidad de la
red entre el proxy y el servidor web, hacer un nuevo cifrado entre ellos dos.</li>
</ul>
<img alt="../../../_images/proxy.png" src="../../../_images/proxy.png" />
<p>Para implementar esta solución, tenemos dos alternativas:</p>
<ul class="simple">
<li>Implementar una solución personal con <em>software</em> apropiado, como una combinación
de <a class="reference internal" href="../../../04.servidor/10.ssh/04.adicional.html#haproxy"><span class="std std-ref">haproxy</span></a> y <a class="reference internal" href="../../../07.serre/05.proxies/index.html#varnish"><span class="std std-ref">varnish</span></a>.</li>
<li>Recurrir a una solución profesional externa como <a class="reference external" href="https://www.cloudflare.com/">Cloudflare</a>.</li>
</ul>
<div class="section" id="solucion-personal">
<h4>8.9.2.1.2.2.1. Solución personal<a class="headerlink" href="#solucion-personal" title="Enlazar permanentemente con este título">¶</a></h4>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Por hacer</p>
<p class="last">Construir la solución integrada con <strong class="program">haproxy</strong> y
<strong class="program">varnish</strong>.</p>
</div>
</div>
<div class="section" id="cloudflare">
<span id="dos-cloudflare"></span><h4>8.9.2.1.2.2.2. <a class="reference external" href="https://www.cloudflare.com/">Cloudflare</a><a class="headerlink" href="#cloudflare" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Delegar la protección en <a class="reference external" href="https://www.cloudflare.com/">Cloudflare</a> es bastante sencillo y, además, hay un
<a class="reference external" href="https://www.cloudflare.com/es-es/plans/">plan gratuito</a>. Nuestro esquema de
defensa es el siguiente:</p>
<img alt="../../../_images/cloudflare.png" src="../../../_images/cloudflare.png" />
<p>Para lo cual necesitamos:</p>
<ol class="arabic simple">
<li>Ser propietarios de un dominio (supongamos que <em>example.net</em>).</li>
<li>Disponer de una máquina con IP pública e instalar en ella un servidor web
con certificado autofirmado (si es que deseamos comunicación <abbr title="HyperText Transfer Protocol">HTTP</abbr>s, que
será lo normal).</li>
<li>Darnos de alta en <a class="reference external" href="https://www.cloudflare.com/">Cloudflare</a> con una cuenta de correo.</li>
<li>Añadir la protección de <a class="reference external" href="https://www.cloudflare.com/">Cloudflare</a> para el dominio <em>example.net</em> lo cual
exige la cesión a los servidores <abbr title="Domain Name Server">DNS</abbr> de <a class="reference external" href="https://www.cloudflare.com/">Cloudflare</a> de la gestión de la
zona. Para ello, debemos indicar a nuestro agente registrador que los
servidores de dominio de la zona <em>example.net</em> sean los dos que nos indique
<a class="reference external" href="https://www.cloudflare.com/">Cloudflare</a>. Además, <a class="reference external" href="https://www.cloudflare.com/">Cloudflare</a> copiará el contenido de dicha zona, pero
tendremos que esperar a que se complete la cesión, lo cual puede demorarse
hasta 24 horas.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last"><a class="reference external" href="https://www.cloudflare.com/">Cloudflare</a> nos proporciona automáticamente un certificado <abbr title="Secure Socket Layer">SSL</abbr>
gratuito válido, por lo que los navegadores de nuestro clientes podrán confiar
en nuestro sitio.</p>
</div>
<p>Una vez activo en <a class="reference external" href="https://www.cloudflare.com/">Cloudflare</a> el dominio <em>example.net</em>, podremos alterar los
registros <abbr title="Domain Name Server">DNS</abbr> de la zona desde el propio gestor de <a class="reference external" href="https://www.cloudflare.com/">Cloudflare</a> e indicar si
queremos que ese nombre esté protegido o no. Por ejemplo, podemos hacer que
<em>www.example.net</em> sí esté protegido, pero <em>example.net</em> no; para poder acceder
por <abbr title="Security SHell">SSH</abbr> con este segundo nombre a nuestro servidor.</p>
<div class="admonition seealso">
<p class="first admonition-title">Ver también</p>
<p class="last">Una guía con capturas de este proceso se encuentra en
<a class="reference external" href="https://creativolandia.com/cloudflare-tutorial-paso-a-paso-como-configurarlo/">creativolandia.com</a></p>
</div>
<p>El panel de gestión nos proporciona una configuración de seguridad
predeterminada en el que merece la pena gulismear para adaptarla a nuestras
necesitades.</p>
<div class="admonition seealso">
<p class="first admonition-title">Ver también</p>
<p class="last">En <a class="reference external" href="https://www.bloggeris.com/tutorial-cloudflare-cdn/">este tutorial de bloggeris.com</a> se comentan algunas
posibilidades de la configuración de seguridad.</p>
</div>
<p>Nótese que al situarse <a class="reference external" href="https://www.cloudflare.com/">Cloudflare</a> en medio de la comunicación y dedicarse a
cifrar entre él y el cliente con su propio certificado y a recifrar entre él y
nuestro servidor web, siempre tiene acceso a los contenidos sin cifrar y en
consecuencia cacheará contenidos que se presten a ello (los estáticos, por
ejemplo) en función de las directrices que reciba del servidor (cabeceras
<code class="docutils literal notranslate"><span class="pre">Cache-Control:</span></code> y <code class="docutils literal notranslate"><span class="pre">Expires:</span></code>). Por tanto, no sólo asegura el servicio, sino
que sirve para acelerarlo.</p>
<p>Por último, una medida de seguridad adicional que podemos implementar con ayuda
de <a class="reference internal" href="../../../06.infraestructura/01.cortafuegos/01.iptables/index.html#iptables"><span class="std std-ref">iptables</span></a> es impedir el acceso a web a nuestro servidor
desde máquinas distintas a la de la red de <a class="reference external" href="https://www.cloudflare.com/">Cloudflare</a>. Los rangos de <abbr title="Internet Protocol">IP</abbr> que
pertenecen a esta compañía <a class="reference external" href="https://www.cloudflare.com/ips/">están publicados en su propia página</a>.</p>
<p class="rubric">Notas al pie</p>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Obviamente, esto sería posible si el ancho de banda del proxy es mayor
que el ancho de banda del servidor.</td></tr>
</tbody>
</table>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">8.9.2.1. Ataques <abbr title="Denial of Service">DoS</abbr></a><ul>
<li><a class="reference internal" href="#metodos">8.9.2.1.1. Métodos</a></li>
<li><a class="reference internal" href="#contramedidas">8.9.2.1.2. Contramedidas</a><ul>
<li><a class="reference internal" href="#flujo-de-paquetes">8.9.2.1.2.1. Flujo de paquetes</a></li>
<li><a class="reference internal" href="#proxy">8.9.2.1.2.2. Proxy</a><ul>
<li><a class="reference internal" href="#solucion-personal">8.9.2.1.2.2.1. Solución personal</a></li>
<li><a class="reference internal" href="#cloudflare">8.9.2.1.2.2.2. Cloudflare</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Tema anterior</h4>
  <p class="topless"><a href="index.html"
                        title="capítulo anterior">8.9.2. Técnicas</a></p>
  <h4>Próximo tema</h4>
  <p class="topless"><a href="01.dns.html"
                        title="próximo capítulo">8.9.2.2. Envenenamiento <abbr title="Domain Name Server">DNS</abbr></a></p>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/08.redes/99.ataques/02.tecnicas/00.dos.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Ir a" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="01.dns.html" title="8.9.2.2. Envenenamiento DNS"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="index.html" title="8.9.2. Técnicas"
             >anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">documentación de Linuxnomicón - rolling</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >8. Conceptos avanzados de redes</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" >8.9. Ataques</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="index.html" >8.9.2. Técnicas</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Derechos de autor CC BY 4.0, 2016-2020, José Miguel Sánchez Alés.
      Creado con <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>