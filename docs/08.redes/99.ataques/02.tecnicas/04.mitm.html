


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="es">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>8.9.2.5. Ataques de modificación &#8212; documentación de ServidorLinux - 0.1.0</title>
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../../_static/translations.js"></script>
    
    <link rel="index" title="Índice" href="../../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../../search.html" />
    <link rel="next" title="8.9.3. Redes inalámbricas" href="../03.wifi/index.html" />
    <link rel="prev" title="8.9.2.4. Ataques contra la autenticación" href="03.brute.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="../03.wifi/index.html" title="8.9.3. Redes inalámbricas"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="03.brute.html" title="8.9.2.4. Ataques contra la autenticación"
             accesskey="P">anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">documentación de ServidorLinux - 0.1.0</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >8. Conceptos avanzados de redes</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" >8.9. Ataques</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="index.html" accesskey="U">8.9.2. Técnicas</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="ataques-de-modificacion">
<span id="mitm"></span><h1>8.9.2.5. Ataques de modificación<a class="headerlink" href="#ataques-de-modificacion" title="Enlazar permanentemente con este título">¶</a></h1>
<p>Para ilustrar los ataques de modificación analizaremos dos técnicas distintas.
En ambos casos, daremos por hecho ya que el atacante ha logrado interceptar el
tráfico (p.e. con un <a class="reference internal" href="02.arp.html#arp-spoofing"><span class="std std-ref">envenenamiento ARP</span></a>).</p>
<div class="section" id="sslstrip">
<span id="id1"></span><h2>8.9.2.5.1. SSLstrip<a class="headerlink" href="#sslstrip" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="section" id="concepto">
<h3>8.9.2.5.1.1. Concepto<a class="headerlink" href="#concepto" title="Enlazar permanentemente con este título">¶</a></h3>
<p><em>SSLstrip</em> es un ataque para capturar (y monitorizar en claro, claro está)
conexiones <abbr title="HyperText Transfer Protocol">HTTP</abbr>s:</p>
<img alt="../../../_images/sslstrip.png" src="../../../_images/sslstrip.png" />
<p>En la imagen se presentan dos conexiones distintas entre cliente y superior. En
la superior el tráfico está cifrado entre los dos extremos por lo que la
máquina que intercepta el tráfico poco puede hacer, ya que será incapaz de
descifrar el contenido envuelto por <abbr title="Secure Socket Layer">SSL</abbr>. A lo más podría interceptar la
consulta <abbr title="Domain Name Server">DNS</abbr> previa y hacer una resolución espúrea para que el nombre del
servidor se resolviera a la <abbr title="Internet Protocol">IP</abbr> de un servidor web que controlara el atacante.
De este modo, podría ser este segundo servidor y no el legítimo el que
contestara a la petición del cliente. El problema que presenta este ataque es
que el servidor suplantador presentará un certificado digital inválido y los
navegadores web son, desde hace varios años, muy claros al respecto. Por
tanto, sería muy, muy probable que el usuario se diera cuenta de que está
sufriendo un ataque.</p>
<p><em>SSLstrip</em>, sin embargo, no consiste en esto, sino en lo descrito en la
conexión inferior. Si el navegador es la primera vez que se conecta al
servidor, es probable que intente una conexión no cifrada y que el servidor web
legítimo le pida que repita la petición por <abbr title="HyperText Transfer Protocol">HTTP</abbr>s. Ahora bien, esa primera
conexión no es cifrada y, por tanto, es susceptible de ser capturada y
manipulada. El ataque <em>SSLstrip</em> consiste en atrapar esa primera petición
vulnerable y actuar como proxy repitiendo la petición hacia el servidor
legítimo.  Éste redigirá la petición hacia la conexión segura, el proxy la
realizará y recibirá la respuesta. En consecuencia, los dos extremos del tunel
<abbr title="Secure Socket Layer">SSL</abbr> son el servidor legítimo y el proxy atacante, y este último será capaz de
descifrar la respuesta. La respuesta sin cifrar la remitirá al cliente y este
la recibirá sin saber jamás que el servidor legítimo cifra las conexiones. De
este modo, el cliente realizará siempre peticiones <abbr title="HyperText Transfer Protocol">HTTP</abbr> y el <em>proxy</em> atacante
las cifrará y se comunicará con el servidor mediante <abbr title="HyperText Transfer Protocol">HTTP</abbr>s. En este caso,
el usuario no tiene por qué sospechar que hay un ataque, puesto que jamás
recibe ninguna alerta y sólo podría ponerse sobreaviso si considera sospechoso
establecer una conexión insegura con un servidor con el que intercambia
información sensible (p.e. datos bancarios si es la web de un banco).</p>
<p>El único pero que se le puede poner al ataque es que necesita que el cliente
realice una primera conexión insegura y eso no ocurrirá:</p>
<ul class="simple">
<li>si el navegador ya intentó la conexión no segura en el pasado y el servidor ya
lo redirigió al sitio seguro, puesto que con toda seguridad el servidor envió
un código <strong>301</strong>.</li>
<li>si el cliente accede directamente al sitio seguro, por ejemplo, porque llega a
él a través de un buscador como <cite>Google &lt;https://www.google.com&gt;</cite>, que le
presentará el enlace seguro y no el inseguro.</li>
</ul>
<p>Cuando <a class="reference external" href="https://es.wikipedia.org/wiki/Moxie_Marlinspike">Moxie Marlinspike</a>
presentó el ataque en 2009, no había forma de evitarlo. Servidores y
navegadores reaccionaron introduciendo con el <span class="target" id="index-0"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc6797.html"><strong>RFC 6797</strong></a> las campos de
cabecera <abbr title="HTTP Strict Transport Security">HSTS</abbr>, que son campos de cabecera <code class="docutils literal notranslate"><span class="pre">Strict-Transport-Security:</span></code> que
en la respuesta informan al cliente de que debe comunicarse con él usando
<abbr title="HyperText Transfer Protocol">HTTP</abbr>s y no <abbr title="HyperText Transfer Protocol">HTTP</abbr>. Como consecuencia, las respuestas del servidor siempre
incluyen una cabecera semejante a esta:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Strict-Transport-Security: max-age=31536000; includeSubDomains
</pre></div>
</div>
<p>que informa al navegador de que durante un año (31536000 segundos) debe acceder
al dominio solicitado y a todos sus subdominios usando protocolo seguro. Por
tanto, después de haber aceptado esta cabecera, el navegador convertirá
cualquier enlace inseguro en seguro y jamás hasta que se cumpla el plazo
establecido accederá al servidor por <abbr title="HyperText Transfer Protocol">HTTP</abbr>. Además, la aceptación de esta
cabecera, provoca que el navegador rechace la conexión al servidor si el
certificado no es fiable o inválido sin dar ocasión al usuario de aceptarlo de
todos modos.</p>
<p>Por lo general, los navegadores no atienden la cabecera cuando se realiza una
petición <abbr title="HyperText Transfer Protocol">HTTP</abbr>, ya que la cabecera ha podido ser inyectada por un proxy
malintencionado; o cuando, aunque sea <abbr title="HyperText Transfer Protocol">HTTP</abbr>s, el certificado sea inválido,
ya que no se puede asegurar que sea el servidor legítimo.</p>
<div class="admonition seealso">
<p class="first admonition-title">Ver también</p>
<p class="last">Para más información sobre esta cabecera consulte <a class="reference external" href="https://developer.mozilla.org/es/docs/Web/HTTP/Headers/Strict-Transport-Security">su descripción
en el sitio para desarrolladores del proyecto Mozilla</a>.</p>
</div>
<p>Este proceder, no obstante, no resuelve el caso en que se accede por primera
vez al sitio a través de un enlace no seguro. Para evitar la
vulnerabilidad en este momento, se mantienen listas <abbr title="Strict Transport Security">STS</abbr> que los navegadores
precargan. De este modo, la conexión a un sitio incluido en la lista siempre
será segura, aunque se haga por primera vez y mediante enlace no seguro.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">En el navegador <a class="reference external" href="https://www.google.com/chrome/">Chrome</a>, puede consultar cuáles son las cabeceras <abbr title="HTTP Strict Transport Security">HSTS</abbr>
que se utilizan utilizan a través del enlace <a class="reference external" href="chrome://net-internals#hsts">chrome://net-internals#hsts</a>.</p>
</div>
</div>
<div class="section" id="implementacion">
<span id="bettercap"></span><h3>8.9.2.5.1.2. Implementación<a class="headerlink" href="#implementacion" title="Enlazar permanentemente con este título">¶</a></h3>
</div>
</div>
<div class="section" id="mitmproxy">
<h2>8.9.2.5.2. mitmproxy<a class="headerlink" href="#mitmproxy" title="Enlazar permanentemente con este título">¶</a></h2>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">8.9.2.5. Ataques de modificación</a><ul>
<li><a class="reference internal" href="#sslstrip">8.9.2.5.1. SSLstrip</a><ul>
<li><a class="reference internal" href="#concepto">8.9.2.5.1.1. Concepto</a></li>
<li><a class="reference internal" href="#implementacion">8.9.2.5.1.2. Implementación</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mitmproxy">8.9.2.5.2. mitmproxy</a></li>
</ul>
</li>
</ul>

  <h4>Tema anterior</h4>
  <p class="topless"><a href="03.brute.html"
                        title="capítulo anterior">8.9.2.4. Ataques contra la autenticación</a></p>
  <h4>Próximo tema</h4>
  <p class="topless"><a href="../03.wifi/index.html"
                        title="próximo capítulo">8.9.3. Redes inalámbricas</a></p>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/08.redes/99.ataques/02.tecnicas/04.mitm.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Ir a" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="../03.wifi/index.html" title="8.9.3. Redes inalámbricas"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="03.brute.html" title="8.9.2.4. Ataques contra la autenticación"
             >anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">documentación de ServidorLinux - 0.1.0</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >8. Conceptos avanzados de redes</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" >8.9. Ataques</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="index.html" >8.9.2. Técnicas</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Derechos de autor 2016, José Miguel Sánchez Alés.
      Creado con <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>